{"sections":[],"abstract":[{"text":"Some problems are easier to solve by creating a customized programming language, or “domain-specific language.” While creating a DSL traditionally requires writing your own compiler, you can instead use result builders with Swift 5.4 to make your code both easier to read and maintain. We’ll take you through best practices for designing a custom language for Swift: Learn about result builders and trailing closure arguments, explore modifier-style methods and why they work well, and discover how you can extend Swift’s normal language rules to turn Swift into a DSL.","type":"text"}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc21-10253-write-a-dsl-in-swift-using-result-builders"],"traits":[{"interfaceLanguage":"swift"}]}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21"]]},"metadata":{"role":"sampleCode","roleHeading":"WWDC21","title":"Write a DSL in Swift using result builders","modules":[{"name":"WWDC Notes"}]},"sampleCodeDownload":{"action":{"identifier":"https:\/\/developer.apple.com\/wwdc21\/10253","isActive":true,"type":"reference","overridingTitle":"Watch Video (46 min)"},"kind":"sampleDownload"},"schemaVersion":{"major":0,"patch":0,"minor":3},"primaryContentSections":[{"content":[{"anchor":"overview","type":"heading","level":2,"text":"Overview"},{"name":"Note","style":"note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/developer.apple.com\/documentation\/swiftui\/fruta_building_a_feature-rich_app_with_swiftui","isActive":true,"type":"reference"}]}]},{"anchor":"Whats-a-DSL","type":"heading","level":2,"text":"What’s a DSL"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"D","type":"text"}]},{"text":"omain-","type":"text"},{"type":"strong","inlineContent":[{"text":"S","type":"text"}]},{"text":"pecific ","type":"text"},{"type":"strong","inlineContent":[{"text":"L","type":"text"}]},{"text":"anguage","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Programming language which builds in an assumption about the problem space","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Because the language is designed with a particular kind of work in mind, it can have special features which make that kind of work easier to do"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Your code only specifies the custom parts; language adds implicit behavior","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Often declarative (think like SwiftUI)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Standalone DSL"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"tranditional way to create DSL","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"you’d design the entire language from scratch and write an interpreter\/compiler for it"}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Embedded DSL"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"you use the built-in features of a host language (e.g., Swift) to add the DSL’s implicit behavior to some parts of your code, effectively modifying the host language into one tailored for your domain (e.g., SwiftUI)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"easier to implement"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"the parts written in the DSL look like normal code to the rest of the app, so you have a much easier time interoperating","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"lets you use existing tool for the host language (e.g., debuggers and editors for Swift)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"easier to learn"}],"type":"paragraph"}]}],"type":"unorderedList"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Swift features are used together to build the SwiftUI DSL:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Property wrappers - These let clients declare variables that are tied to DSL behavior","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Trailing closure arguments - These let the DSL provide functions or initializers that read almost like custom syntax that’s been added to the language"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Result builders - These collect the values computed in your DSL’s code into a return value so you can process them","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Modifier-style methods - These are methods that return a wrapped or modified version of the value they’re called on"}],"type":"paragraph"}]}],"type":"unorderedList"},{"syntax":"swift","type":"codeListing","code":["struct FavoriteSmoothies: View {","  @EnvironmentObject \/\/ 👈🏻 Property wrappers","  private var model: FrutaModel","","  var body: some View {","    SmoothieList(smoothies: model.favoriteSmoothies)","      .overlay(","        Group { \/\/ 👈🏻 Trailing closure arguments","          if model.favoriteSmoothies.isEmpty { \/\/ 👈🏻 Result builders","            Text(\"Add some smoothies!\")","              .foregroundColor(.secondary)","              .frame(maxWidth: .infinity, maxHeight: .infinity) ","          }","        }","      )","      .navigationTitle(\"Favorites\") \/\/ 👈🏻 Modifier-style methods","  }","}"]},{"anchor":"How-result-builders-work","type":"heading","level":2,"text":"How result builders work"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Help to implement your DSL’s domain-specific assumed behavior"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Applied to a function, method, getter, or closure","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Wrap statements in implicit method calls so you can use their results","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Take over function’s return value","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"When you apply a result builder to a function body, Swift inserts various calls to static methods on the result builder. These end up capturing the results of statements that would otherwise have been discarded. So where Swift would normally ignore a return value, it instead gets passed to the result builder. These calls ultimately compute a value which is returned from the function body.","type":"text"}]}]}]}]},{"content":[{"inlineContent":[{"text":"Compile time feature","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"SwiftUI example:","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC21-10253-swiftui-example","type":"image"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"In short, we go from"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["VStack {","  Text(\"Title\").font(.title)","  Text(\"Contents\")","}"]},{"inlineContent":[{"type":"text","text":"to:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["VStack.init(content: {","  let v0 = Text(\"Title\").font(.title)","  let v1 = Text(\"Contents\")","  return ViewBuilder.buildBlock(v0, v1)","})"]},{"inlineContent":[{"type":"text","text":"Result builders limitations:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Syntax in a result builder function is the same as the host language"}]}]},{"content":[{"inlineContent":[{"text":"Looks for names in the normal places","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Result builders disable some language keywords (mostly interrupt controls like ","type":"text"},{"type":"codeVoice","code":"try"},{"text":" ","type":"text"},{"type":"codeVoice","code":"catch"},{"text":", that don’t fit well into statement results)","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"some keywords are enabled conditionallv (depending whether the result builder provides extra methods that are used to implement them)"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If a keyword is permitted, it will work as usual - Result builders just capture the statement results that would otherwise have been thrown away, nothing more"}]}]}],"type":"unorderedList"},{"anchor":"Writing-a-result-builder","type":"heading","level":2,"text":"Writing a result builder"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"define an enum "},{"code":"@resultBuilder","type":"codeVoice"},{"type":"text","text":":"}],"type":"paragraph"}]}],"type":"orderedList"},{"syntax":"swift","type":"codeListing","code":["@resultBuilder","enum SmoothieArrayBuilder {","}"]},{"inlineContent":[{"text":"This type is a container for result builders static methods, hence declaring it as a caseless enum makes sense","type":"text"}],"type":"paragraph"},{"start":2,"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"all result builders require a "},{"type":"codeVoice","code":"buildBlock(_:)"},{"type":"text","text":" method:"}]}]}],"type":"orderedList"},{"syntax":"swift","type":"codeListing","code":["@resultBuilder","enum SmoothieArrayBuilder {","  static func buildBlock(_ components: Smoothie...) -> [Smoothie] {","    components","  }","}"]},{"inlineContent":[{"text":"Each statement in your result builder body gets assigned to a variable, and then all variables are all passed to ","type":"text"},{"type":"codeVoice","code":"buildBlock(_:)"},{"text":" for you to use","type":"text"}],"type":"paragraph"},{"start":2,"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"(optional) if you need to support if statements, define the associated ","type":"text"},{"type":"codeVoice","code":"buildOptional(_:)"},{"text":" method:","type":"text"}]}]}],"type":"orderedList"},{"syntax":"swift","type":"codeListing","code":["@resultBuilder","enum SmoothieArrayBuilder {","  \/\/\/ This is called once for the if closure and once when the if closure is not called (`buildOptional(nil)` will be called).","  static func buildOptional(_ component: [Smoothie]?) -> [Smoothie] {","    component ?? []","  }","  ","  static func buildBlock(_ components: Smoothie...) -> [Smoothie] {","    components","  }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"However, we now need a "},{"type":"codeVoice","code":"buildBlock(_:)"},{"type":"text","text":" definition that accepts both "},{"type":"codeVoice","code":"Smoothie"},{"type":"text","text":" and "},{"type":"codeVoice","code":"[Smoothie]"},{"type":"text","text":", two ways to fix this:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Make the parameter type match both ","type":"text"},{"code":"Smoothie","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"[Smoothie]","type":"codeVoice"},{"text":" (this is how SwiftUI solves this)","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Convert Smoothies returned by statements into "},{"code":"[Smoothie]","type":"codeVoice"},{"type":"text","text":", we can do this via "},{"code":"buildExpression(_:)","type":"codeVoice"}]}]}]},{"type":"paragraph","inlineContent":[{"code":"buildExpression(_:)","type":"codeVoice"},{"text":" passes each bare expression to that method before it captures it into a variable (that is then passed to ","type":"text"},{"code":"buildBlock(_:)","type":"codeVoice"},{"text":".","type":"text"}]},{"syntax":"swift","code":["@resultBuilder","enum SmoothieArrayBuilder {","  static func buildOptional(_ component: [Smoothie]?) -> [Smoothie] {","    component ?? []","  }","  ","  static func buildBlock(_ components: [Smoothie]...) -> [Smoothie] {","    components.flatMap { $0 }","  }","  ","  static func buildExpression(_ expression: Smoothie) -> [Smoothie] {","    [expression]","  }","}"],"type":"codeListing"},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"text":"(optional) add support for if-else, if let, switch via ","type":"text"},{"code":"buildEither(first:)","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"buildEither(second:)","type":"codeVoice"}],"type":"paragraph"}]}],"start":3},{"syntax":"swift","code":["@resultBuilder","enum SmoothieArrayBuilder {","  static func buildEither(first component: [Smoothie]) -> [Smoothie] {","    component","  }","  ","  static func buildEither(second component: [Smoothie]) -> [Smoothie] {","    component","  }","  ","  static func buildOptional(_ component: [Smoothie]?) -> [Smoothie] {","    component ?? []","  }","  ","  static func buildBlock(_ components: [Smoothie]...) -> [Smoothie] {","    components.flatMap { $0 }","  }","  ","  static func buildExpression(_ expression: Smoothie) -> [Smoothie] {","    [expression]","  }","}"],"type":"codeListing"},{"anchor":"Written-By","level":2,"text":"Written By","type":"heading"},{"type":"row","columns":[{"content":[{"inlineContent":[{"identifier":"zntfdr","type":"image"}],"type":"paragraph"}],"size":1},{"content":[{"anchor":"Federico-Zanetello","type":"heading","level":3,"text":"Federico Zanetello"},{"inlineContent":[{"isActive":true,"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/zntfdr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/zntfdr.dev","type":"reference"}],"type":"paragraph"}],"size":4}],"numberOfColumns":5},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}]},{"anchor":"Related-Sessions","level":2,"text":"Related Sessions","type":"heading"},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10192-Whats-new-in-Swift","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-415-Modern-Swift-API-Design"]},{"type":"small","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}],"kind":"content"}],"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10253-Write-a-DSL-in-Swift-using-result-builders"},"references":{"https://github.com/zntfdr":{"titleInlineContent":[{"text":"GitHub","type":"text"}],"identifier":"https:\/\/github.com\/zntfdr","title":"GitHub","type":"link","url":"https:\/\/github.com\/zntfdr"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","type":"link","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"WWDC21-10253-swiftui-example":{"alt":null,"identifier":"WWDC21-10253-swiftui-example","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC21-10253-swiftui-example.gif"}]},"zntfdr":{"alt":"Profile image of Federico Zanetello","identifier":"zntfdr","type":"image","variants":[{"url":"\/images\/zntfdr.jpeg","traits":["1x","light"]}]},"zntfdr.jpeg":{"alt":null,"identifier":"zntfdr.jpeg","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}]},"WWDCNotes.png":{"alt":null,"identifier":"WWDCNotes.png","type":"image","variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21":{"images":[{"type":"icon","identifier":"WWDC21-Icon.png"},{"type":"card","identifier":"WWDC21.jpeg"}],"kind":"article","type":"topic","role":"collectionGroup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21","abstract":[{"text":"Xcode 13, Swift 5.5, iOS 15, macOS 12 (Monterey), tvOS 15, watchOS 8.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"MusicKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"DocC","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit 2","type":"codeVoice"},{"text":", and more.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc21","title":"WWDC21"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10192-Whats-new-in-Swift":{"kind":"article","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc21-10192-whats-new-in-swift","abstract":[{"text":"Join us for an update on Swift. Discover the latest language advancements that make your code easier to read and write. Explore the growing number of APIs available as Swift packages. And we’ll introduce you to Swift’s async\/await syntax, structured concurrency, and actors.","type":"text"}],"title":"What‘s new in Swift","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10192-Whats-new-in-Swift"},"doc://WWDCNotes/documentation/WWDCNotes":{"role":"collection","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"url":"\/documentation\/wwdcnotes","title":"WWDC Notes","type":"topic","kind":"symbol"},"https://developer.apple.com/wwdc21/10253":{"checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc21\/10253","type":"download","url":"https:\/\/developer.apple.com\/wwdc21\/10253"},"WWDC21.jpeg":{"type":"image","identifier":"WWDC21.jpeg","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC21.jpeg"}]},"https://developer.apple.com/documentation/swiftui/fruta_building_a_feature-rich_app_with_swiftui":{"url":"https:\/\/developer.apple.com\/documentation\/swiftui\/fruta_building_a_feature-rich_app_with_swiftui","type":"link","titleInlineContent":[{"text":"Sample Code","type":"text"}],"title":"Sample Code","identifier":"https:\/\/developer.apple.com\/documentation\/swiftui\/fruta_building_a_feature-rich_app_with_swiftui"},"WWDC21-Icon.png":{"type":"image","identifier":"WWDC21-Icon.png","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC21-Icon.png"}]},"https://zntfdr.dev":{"url":"https:\/\/zntfdr.dev","type":"link","titleInlineContent":[{"text":"Blog","type":"text"}],"title":"Blog","identifier":"https:\/\/zntfdr.dev"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"images":[{"type":"card","identifier":"zntfdr.jpeg"},{"type":"icon","identifier":"zntfdr.jpeg"}],"role":"sampleCode","kind":"article","type":"topic","title":"Federico Zanetello (332 notes)","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","url":"\/documentation\/wwdcnotes\/zntfdr"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-415-Modern-Swift-API-Design":{"url":"\/documentation\/wwdcnotes\/wwdc19-415-modern-swift-api-design","title":"Modern Swift API Design","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-415-Modern-Swift-API-Design","abstract":[{"type":"text","text":"Every programming language has a set of conventions that people come to expect. Learn about the patterns that are common to Swift API design, with examples from new APIs like SwiftUI, Combine, and RealityKit. Whether you’re developing an app as part of a team, or you’re publishing a library for others to use, find out how to use new features of Swift to ensure clarity and correct use of your APIs."}],"role":"sampleCode","kind":"article"}}}