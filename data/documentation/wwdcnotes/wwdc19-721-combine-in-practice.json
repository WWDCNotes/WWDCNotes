{"kind":"article","variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc19-721-combine-in-practice"]}],"abstract":[{"text":"Expand your knowledge of Combine, Apple’s new unified, declarative framework for processing values over time. Learn about how to correctly handle errors, schedule work and integrate Combine into your app today.","type":"text"}],"sections":[],"sampleCodeDownload":{"kind":"sampleDownload","action":{"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc19\/721","overridingTitle":"Watch Video (34 min)","isActive":true}},"metadata":{"title":"Combine in Practice","role":"sampleCode","roleHeading":"WWDC19","modules":[{"name":"WWDC Notes"}]},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19"]]},"primaryContentSections":[{"kind":"content","content":[{"anchor":"overview","text":"Overview","level":2,"type":"heading"},{"inlineContent":[{"text":"In this session more Combine operators are introduced:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"code":"map","type":"codeVoice"},{"text":", ","type":"text"},{"code":"tryMap","type":"codeVoice"},{"text":", ","type":"text"},{"code":"decode","type":"codeVoice"},{"text":", ","type":"text"},{"code":"assertNoFailure","type":"codeVoice"},{"text":", ","type":"text"},{"code":"retry","type":"codeVoice"},{"text":", ","type":"text"},{"code":"catch","type":"codeVoice"},{"text":", ","type":"text"},{"code":"mapError","type":"codeVoice"},{"text":", ","type":"text"},{"code":"setFailureType","type":"codeVoice"},{"text":" …","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"Just"},{"text":": special ","type":"text"},{"type":"codeVoice","code":"Publisher"},{"text":" for when you already have a value that you want to publish. It’s called ","type":"text"},{"type":"codeVoice","code":"Just"},{"text":", as in just publish this value.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Scheduled-Operators","text":"Scheduled Operators","level":2,"type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Describes when and where a particular event is delivered","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Supported by "},{"type":"codeVoice","code":"RunLoop"},{"type":"text","text":" and "},{"type":"codeVoice","code":"DispatchQueue"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Delay: defers the delivery of an event until some future time."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Throttle: guarantees that events are delivered no faster than a specified rate.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"Receive(on:)"},{"text":": guarantees that downstream received events will be delivered on a particular thread or queue.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Subscriber","text":"Subscriber","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"Subscribers have three functions:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"receive(subscription:)"},{"type":"text","text":" when subscribing the publisher will call this function exactly once"}]}]},{"content":[{"inlineContent":[{"code":"receive(_:)","type":"codeVoice"},{"text":" the publisher will provide 0 or more values via this method","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"receive(completion:)"},{"type":"text","text":" the publisher can eventually provide a completion only once, meaning that it has completed or a failure has risen"}]}]}],"type":"orderedList"},{"inlineContent":[{"text":"Once ","type":"text"},{"code":"receive(completion:)","type":"codeVoice"},{"text":" is called, no further value will be forwarded.","type":"text"}],"type":"paragraph"},{"anchor":"Special-Subscriptions","text":"Special Subscriptions","level":2,"type":"heading"},{"anchor":"Sink","text":"`Sink`","level":3,"type":"heading"},{"inlineContent":[{"text":"Just provide a closure and now for every value received, the closure is going to get called with the value.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"This ","type":"text"},{"code":"Sink","type":"codeVoice"},{"text":" will return a ","type":"text"},{"code":"canceller","type":"codeVoice"},{"text":", which is like a token where we can call cancel when we no longer want to get new values.","type":"text"}],"type":"paragraph"},{"anchor":"Subjects","text":"`Subjects`","level":3,"type":"heading"},{"inlineContent":[{"text":"Behaves like Publisher and Subscriber.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Supporting multi casting a single value (broadcast to multiple subscribers)"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Two kinds of subjects:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"code":"Passthrough","type":"codeVoice"},{"type":"text","text":": doesn’t store any value, therefore we’ll get a value only once a new one will be sentWe can inject a passthrough subjects in a stream by calling "},{"code":"onePublisher.share()","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"CurrentValue","type":"codeVoice"},{"type":"text","text":": like "},{"code":"Passthrough","type":"codeVoice"},{"type":"text","text":", however it stores the last value, so new subscribers have an opportunity to catch up"}]}]}],"type":"unorderedList"},{"anchor":"SwiftUI","text":"SwiftUI","level":2,"type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"SwiftUI owns the subscriber"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"We only need to provide a publisher","type":"text"}]}]}],"type":"unorderedList"},{"anchor":"BindableObject","text":"`@BindableObject`","level":3,"type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"@BindableObject"},{"text":"s in SwiftUI have a single associated type.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"It’s a Publisher that is constrained to never fail.","type":"text"}]}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"Example:"}],"type":"paragraph"},{"code":["class WizardModel: BindableObject { ","\tvar trick: WizardTrick { didSet { didChange.send() }","\tvar wand: Wand? { didSet { didChange.send() } ","","\tlet didChange PassthroughSubject<Void, Never>()","}","","struct TrickView: View { ","  @ObjectBinding var model: WizardModel ","","  var body: some View { ","  \tText(model.trick.name)","  }","}"],"type":"codeListing","syntax":"swift"},{"items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"@ObjectBinding"},{"type":"text","text":" allows SwiftUI to automatically discover and subscribe to our Publisher."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"SwiftUI will automatically generate a new body whenever we signal that the model has changed."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Note how the “combine upstream” value is "},{"code":"Void","type":"codeVoice"},{"type":"text","text":", we do not use as the "},{"code":"View","type":"codeVoice"},{"type":"text","text":" owns the model anyway, so we can access it from there instead."}]}]}],"type":"unorderedList"},{"anchor":"Published","text":"`@Published`","level":3,"type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Adds a publisher to a property","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Access the the published via wrapped value (in the example below, "},{"type":"codeVoice","code":"$password"},{"type":"text","text":" is the publisher aka wrapped value)"}]}]}],"type":"unorderedList"},{"code":["@Published var password: String ","","self.password = \"1234\"","","let currentPassword: String = self.password","","let printerSubscription = $password.sink {","\tprint(\"The published value is '\\($0)'\")","} ","","self. password = \"password\" "],"type":"codeListing","syntax":"swift"},{"anchor":"eraseToAnyPublisher","text":"`eraseToAnyPublisher`","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"Advertise the exact contract we want for our API boundary and hide all the implementation details along the way."}],"type":"paragraph"},{"inlineContent":[{"text":"Example:","type":"text"}],"type":"paragraph"},{"code":["@Published var username: String = \"\" ","","var validatedUsername: AnyPublisher<String, Never> {","\treturn $username ","    .debounce(for: 0.5, scheduler: RunLoop.main)","    .removeDuplicates()","    .eraseToAnyPublisher() ","}"],"type":"codeListing","syntax":"swift"},{"inlineContent":[{"text":"Further example with Future:","type":"text"}],"type":"paragraph"},{"code":["@Published var username: String = \"\"","","var validatedUsername: AnyPublisher<String?, Never> { ","\treturn $username ","    .debounce (for: 0.5, scheduler: RunLoop.main) ","    .removeDuplicates()","    .flatMap { username in ","    \treturn Future { promise in ","        self.usernameAvailable(username) { available in","        \tpromise (.success(available ? username : nil))","        }","      }","    } ","    .eraseToAnyPublisher() ","}"],"type":"codeListing","syntax":"swift"},{"anchor":"AnyCancellable","text":"`AnyCancellable`","level":3,"type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"What is returned after creating a subscriber"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"This class automatically calls "},{"type":"codeVoice","code":"cancel()"},{"type":"text","text":" on "},{"type":"codeVoice","code":"deinit"},{"type":"text","text":"."}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Written-By","text":"Written By","level":2,"type":"heading"},{"type":"row","numberOfColumns":5,"columns":[{"content":[{"inlineContent":[{"identifier":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4","type":"image"}],"type":"paragraph"}],"size":1},{"content":[{"text":"Federico Zanetello","anchor":"Federico-Zanetello","level":3,"type":"heading"},{"inlineContent":[{"isActive":true,"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/zntfdr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/zntfdr.dev","type":"reference"}],"type":"paragraph"}],"size":4}]},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","isActive":true,"identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"anchor":"Related-Sessions","text":"Related Sessions","level":2,"type":"heading"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-210-Whats-New-in-AppKit-for-macOS","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-212-Introducing-Multiple-Windows-on-iPad","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-226-Data-Flow-Through-SwiftUI","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-415-Modern-Swift-API-Design","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-712-Advances-in-Networking-Part-1","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-722-Introducing-Combine"],"type":"links","style":"list"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-721-Combine-in-Practice"},"schemaVersion":{"patch":0,"minor":3,"major":0},"references":{"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"kind":"article","title":"Federico Zanetello (330 notes)","url":"\/documentation\/wwdcnotes\/zntfdr","type":"topic","abstract":[{"text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","role":"sampleCode"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-212-Introducing-Multiple-Windows-on-iPad":{"role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc19-212-introducing-multiple-windows-on-ipad","kind":"article","abstract":[{"type":"text","text":"Multitasking is an exciting way to add power to your iPad app. It is easy to enable your app to run two instances of your interface side-by-side, and your customers will love it. Learn how to take your existing features like drag and drop and use them to easily create a second window. Find out how supporting multiple windows changes the app lifecycle and what that means for all applications. Hear about some common mistakes and how to solve them, setting you and your customers up for a fantastic experience."}],"title":"Introducing Multiple Windows on iPad","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-212-Introducing-Multiple-Windows-on-iPad","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","type":"topic","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection"},"https://avatars.githubusercontent.com/u/5277837?v=4":{"type":"image","identifier":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4","variants":[{"traits":["1x","light"],"url":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4"}],"alt":"Profile image of Federico Zanetello"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19":{"type":"topic","url":"\/documentation\/wwdcnotes\/wwdc19","title":"WWDC19","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"role":"collectionGroup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19","kind":"article","abstract":[{"type":"text","text":"Xcode 11, Swift 5.1, iOS 13, macOS 10.15 (Catalina), tvOS 13, watchOS 6."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"Combine"},{"type":"text","text":", "},{"type":"codeVoice","code":"Core Haptics"},{"type":"text","text":", "},{"type":"codeVoice","code":"Create ML"},{"type":"text","text":", and more."}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-722-Introducing-Combine":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-722-Introducing-Combine","url":"\/documentation\/wwdcnotes\/wwdc19-722-introducing-combine","type":"topic","role":"sampleCode","abstract":[{"text":"Combine is a unified declarative framework for processing values over time. Learn how it can simplify asynchronous code like networking, key value observing, notifications and callbacks.","type":"text"}],"kind":"article","title":"Introducing Combine"},"WWDCNotes.png":{"type":"image","identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-210-Whats-New-in-AppKit-for-macOS":{"role":"sampleCode","title":"What’s New in AppKit for macOS","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-210-Whats-New-in-AppKit-for-macOS","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc19-210-whats-new-in-appkit-for-macos","abstract":[{"type":"text","text":"Learn about the latest APIs in AppKit and associated frameworks. Get an overview of the enhancements coming in macOS Catalina to help you save time, take advantage of the latest hardware, and add polish to your application."}]},"https://github.com/zntfdr":{"type":"link","titleInlineContent":[{"text":"GitHub","type":"text"}],"title":"GitHub","identifier":"https:\/\/github.com\/zntfdr","url":"https:\/\/github.com\/zntfdr"},"https://developer.apple.com/wwdc19/721":{"type":"download","checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc19\/721","url":"https:\/\/developer.apple.com\/wwdc19\/721"},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"type":"link","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-226-Data-Flow-Through-SwiftUI":{"type":"topic","url":"\/documentation\/wwdcnotes\/wwdc19-226-data-flow-through-swiftui","kind":"article","role":"sampleCode","title":"Data Flow Through SwiftUI","abstract":[{"text":"SwiftUI was built from the ground up to let you write beautiful and correct user interfaces free of inconsistencies. Learn how to connect your data as dependencies while keeping the UI fully predictable and error free. Familiarize yourself with SwiftUI’s powerful data flow tools and understand what the best tool is for each situation.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-226-Data-Flow-Through-SwiftUI"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-712-Advances-in-Networking-Part-1":{"type":"topic","kind":"article","title":"Advances in Networking, Part 1","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc19-712-advances-in-networking-part-1","abstract":[{"text":"Keep up with new and evolving networking protocols and standards by leveraging the modern networking frameworks on all Apple platforms and following best practices for efficiency and performance. In this session, learn about Low Data Mode, Combine in URLSession, WebSocket, and improvements to network mobility.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-712-Advances-in-Networking-Part-1"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-415-Modern-Swift-API-Design":{"kind":"article","abstract":[{"type":"text","text":"Every programming language has a set of conventions that people come to expect. Learn about the patterns that are common to Swift API design, with examples from new APIs like SwiftUI, Combine, and RealityKit. Whether you’re developing an app as part of a team, or you’re publishing a library for others to use, find out how to use new features of Swift to ensure clarity and correct use of your APIs."}],"title":"Modern Swift API Design","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-415-Modern-Swift-API-Design","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc19-415-modern-swift-api-design","type":"topic"},"https://zntfdr.dev":{"title":"Blog","url":"https:\/\/zntfdr.dev","identifier":"https:\/\/zntfdr.dev","type":"link","titleInlineContent":[{"type":"text","text":"Blog"}]}}}