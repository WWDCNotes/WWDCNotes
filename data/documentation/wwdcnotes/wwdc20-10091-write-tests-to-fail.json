{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10091-Write-tests-to-fail"},"metadata":{"role":"sampleCode","roleHeading":"WWDC20","title":"Write tests to fail","modules":[{"name":"WWDC Notes"}]},"sections":[],"sampleCodeDownload":{"action":{"isActive":true,"type":"reference","overridingTitle":"Watch Video (17 min)","identifier":"https:\/\/developer.apple.com\/wwdc20\/10091"},"kind":"sampleDownload"},"kind":"article","variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc20-10091-write-tests-to-fail"]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"abstract":[{"type":"text","text":"Plan for failure: Design great tests to help you find and diagnose even the toughest bugs. Learn how to improve your automated tests with XCTest to find hidden issues in even the best code. We’ll explain how to prepare your tests for failure to make triaging issues easier, letting you solve interface issues and deliver fixes quickly."}],"primaryContentSections":[{"content":[{"type":"heading","anchor":"overview","text":"Overview","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your main focus while writing Tests is to fail"}]}]}]},{"type":"heading","anchor":"The-test-template-follows-this-pattern","text":"The test template follows this pattern","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Set up","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Test: actions","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Test: assertions"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Tear down","type":"text"}]}]}]},{"type":"heading","anchor":"Set-Up","text":"Set Up","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"This is where you explicitly state the required assumptions and set the right environment for your app to run in","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You can use "},{"type":"codeVoice","code":"setUpWithError() throws"},{"type":"text","text":" that allows you to throw an error during your set up, you may need this in a case for example where your previous tests have modifier the state of your app, example:"}]}]}]},{"syntax":"swift","type":"codeListing","code":["class RecipesTests: XCTestCase {","\tlet app = FrutaApp()","","\toverride func setUpWithError() throws {","    \tcontinueAfterFailure = false","    \tapp.launchArguments.append(\"-recipes-tests\")","    \tapp.launch()","\t}","}"]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":"continueAfterFailure = false","type":"codeVoice"},{"text":" causes your testing process to stop immediately instead of test failing for no obvious reasons","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"launchArguments","type":"codeVoice"},{"type":"text","text":" can be used to pass flags to bypass certain parts of your app, for example, here we’re bypassing the first tap "},{"code":".menu","type":"codeVoice"},{"type":"text","text":" and jumping to the last one "},{"code":".recipes","type":"codeVoice"},{"type":"text","text":":"}],"type":"paragraph"}]}]},{"syntax":"swift","type":"codeListing","code":["@State private var selection: Tab = CommandLine.arguments.contains(\"-recipes-tests\") ? .recipes : .menu"]},{"type":"heading","anchor":"Test-actions","text":"Test: actions","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Tests names should reflect what the test is doing"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Minimize the number of actions a test is doing as much as possible"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Use enum cases to extract typed ","type":"text"},{"code":"String","type":"codeVoice"},{"text":"s from your tests, this makes it easier to update them later, and reduces the not-so-obvious errors coming from misspelling strings","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Factor out common code into separate functions to reduce repetitive bits and allow for more time to focus on hardening these paths to reduce errors","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Try to model your app domain and design a test language around those models, for example, here we’re creating a ","type":"text"},{"type":"codeVoice","code":"FrutaApp"},{"text":" object that can retrieve an array of ","type":"text"},{"type":"codeVoice","code":"SmoothieList"},{"text":":","type":"text"}]}]}]},{"syntax":"swift","type":"codeListing","code":["public class FrutaApp : XCUIApplication {","  public func smoothieList() throws -> SmoothieList {  }","} ","","public class SmoothieList : FrutaUIElement {","  public func selectRecipe(smoothie: SmoothieType) throws -> Recipe {  }","}"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This helps in increasing the readability of your code and organizes the hierarchy of objects"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Consider creating shared frameworks or shared Swift Packages when your test codebase becomes large, and especially when sharing code between multiple applications"}]}]}]},{"type":"heading","anchor":"Test-assertions","text":"Test: assertions","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Try to make use of optional descriptions in different "},{"type":"codeVoice","code":"XCTAssert*"},{"type":"text","text":" functions as much as possible, this gives more context for failure messages when viewed from the test results bundle"}]}]}]},{"syntax":"swift","type":"codeListing","code":["XCTAssertEqual(","\tcount, ","\texpectedCount, ","\t\"\\(SmoothieType.berryBlue.rawValue) smoothie is expected to have \\(expectedCount) ingredients: \\(expectedIngredients), however, there were \\(count) found.\"",")"]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Leave out too specific details such as date, timestamps and file paths from your assertion messages","type":"text"}]}],"type":"aside","style":"note","name":"Note"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"When testing asynchronous logic, avoid using "},{"type":"codeVoice","code":"sleep()"},{"type":"text","text":", you should otherwise use built in "},{"type":"codeVoice","code":"wait"},{"type":"text","text":" functions such as "},{"type":"codeVoice","code":"waitForExistence"},{"type":"text","text":" , this allows you to thrown a custom error and lets you view the time async operations took to finish in the tests results"}]}]},{"content":[{"inlineContent":[{"text":"Unwrap your optionals gracefully, force unwrapping causes crashes and halts your tests, examples of techniques that can be used to unwrap optionals:","type":"text"}],"type":"paragraph"}]}]},{"syntax":"swift","type":"codeListing","code":["if let favs = favorites {  }","guard let favs = favorites else { \/* throw an error *\/ }","let favs = favorites ?? []","let favs = try XCTUnwrap(favorites, \"favorites is nil, so there is nothing to count”)"]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Unlike crashing, failing a test gracefully on unwrap allows your teardown method to be called"}]}],"type":"aside","style":"note","name":"Note"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"User "},{"type":"codeVoice","code":"throw"},{"type":"text","text":" in your shared code functions this allows sharing basic testing logic between different test cases, you can also throw custom errors to give more clear error messages:"}],"type":"paragraph"}]}]},{"syntax":"swift","type":"codeListing","code":["public func verify(ingredients: [String]) throws {","\t...","\tthrow RecipeError.ingredientDoesNotExist(ingredient)","}","","public enum RecipeError : Error, CustomStringConvertible {","\tcase ingredientDoesNotExist(String)","","\tpublic var description : String {","    \tswitch self {","    \tcase .ingredientDoesNotExist(let ingredient):","        \treturn \"\\(ingredient) does not exist in the Ingredients View.)\"","    \t}","\t}","}"]},{"syntax":"swift","type":"codeListing","code":["![][image-1]","","> New in Xcode 12, you can see the back trace for thrown errors, which allows you to see directly from which inner\/shared code an error was thrown "]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use "},{"type":"codeVoice","code":"XCTContext.runActivity()"},{"type":"text","text":" to provide custom entries in your results bundle that helps identifying the current context, you can add "},{"type":"codeVoice","code":"XCTAttachment"},{"type":"text","text":" as well and it will show along the given context:"}]}]}]},{"syntax":"swift","type":"codeListing","code":["public func verify(ingredients: [String]) throws {","\ttry XCTContext.runActivity(named: \"Verifying \\(ingredients) exists in the Recipe screen.\")","\t{ verifyingRecipe in","    \tfor ingredient in ingredients {","        \tif !element.switches[ingredient].waitForExistence(timeout: 5) {","            \tlet attachment = XCTAttachment(string: element.debugDescription)","            \tverifyingRecipe.add(attachment)","            \t throw RecipeError.ingredientDoesNotExist(ingredient)","        \t}","    \t}","\t}","}"]},{"inlineContent":[{"type":"image","identifier":"WWDC20-10091-context_result_bundle"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Use ","type":"text"},{"type":"codeVoice","code":"XCTSkip()"},{"text":", ","type":"text"},{"type":"codeVoice","code":"XCTSkipIf()"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"XCTSkipUnless()"},{"text":" when you want to skip certain test cases when it’s not a suitable time for them to run, or they’re not relevant to a certain platform","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"This is particularly useful for when a test is failing due to flawed code that is due fixing in the near future, or for when the test is written before the code itself","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Skipping the test will still make it appear in the results bundle, reminding you that you still have to go back and fill that missing code or fix it at sometime"}]}]}]},{"type":"heading","anchor":"Tear-Down","text":"Tear Down","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use "},{"code":"tearDownWithError() throws","type":"codeVoice"},{"type":"text","text":" and take advantage of the provided error management"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Collect additional logging that’s relevant to your tests, including some analysis of the failures"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Remember to reset the environment from the changes that were done during the set up"}]}]}]},{"type":"heading","anchor":"Written-By","text":"Written By","level":2},{"columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"ATahhan"}]}]},{"size":4,"content":[{"level":3,"type":"heading","text":"Ammar AlTahhan","anchor":"Ammar-AlTahhan"},{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/ATahhan","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/github.com\/ATahhan","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/","type":"reference","isActive":true}]}]}],"type":"row","numberOfColumns":5},{"type":"thematicBreak"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"reference"}],"type":"paragraph"},{"type":"heading","anchor":"Related-Sessions","text":"Related Sessions","level":2},{"type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110361-Author-fast-and-reliable-tests-for-Xcode-Cloud","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10142-Build-scalable-enterprise-app-suites","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10164-XCTSkip-your-tests","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10220-Handle-interruptions-and-alerts-in-UI-tests","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10221-Get-your-test-results-faster","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10687-Triage-test-failures-with-XCTIssue"],"style":"list"},{"inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}],"type":"small"}],"kind":"content"}],"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10220-Handle-interruptions-and-alerts-in-UI-tests":{"abstract":[{"type":"text","text":"Learn how to anticipate potential interruptions to your app’s interface and build smart tests to identify them. UI interruptions often appear indeterminately, typically during onboarding or first launch, which can make them hard to track down. Learn how to understand interruptions, write stronger tests with UI interruption handlers, and manage expected alerts."}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10220-Handle-interruptions-and-alerts-in-UI-tests","type":"topic","role":"sampleCode","title":"Handle interruptions and alerts in UI tests","url":"\/documentation\/wwdcnotes\/wwdc20-10220-handle-interruptions-and-alerts-in-ui-tests"},"https://developer.apple.com/wwdc20/10091":{"type":"download","identifier":"https:\/\/developer.apple.com\/wwdc20\/10091","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc20\/10091"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10142-Build-scalable-enterprise-app-suites":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10142-Build-scalable-enterprise-app-suites","kind":"article","abstract":[{"text":"Learn how to build focused enterprise apps that work well together. In this session, we’ll introduce you to Apple Retail’s suite of enterprise apps, which help employees interact with customers, track operations, manage stores, and stay connected. Discover how Apple Retail created a unified set of apps by adopting Swift Packages and testing for app scalability. And explore how managing apps in production with configurations can help tailor app suites to different regions and locations.","type":"text"}],"type":"topic","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc20-10142-build-scalable-enterprise-app-suites","title":"Build scalable enterprise app suites"},"ATahhan.jpeg":{"type":"image","alt":null,"identifier":"ATahhan.jpeg","variants":[{"url":"\/images\/WWDCNotes\/ATahhan.jpeg","traits":["1x","light"]}]},"WWDC20-Icon.png":{"type":"image","identifier":"WWDC20-Icon.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC20-Icon.png"}],"alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","url":"\/documentation\/wwdcnotes\/wwdc20","kind":"article","role":"collectionGroup","images":[{"type":"icon","identifier":"WWDC20-Icon.png"},{"type":"card","identifier":"WWDC20.jpeg"}],"title":"WWDC20","abstract":[{"text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"WidgetKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit Testing","type":"codeVoice"},{"type":"text","text":", and more."}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10687-Triage-test-failures-with-XCTIssue":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10687-Triage-test-failures-with-XCTIssue","kind":"article","abstract":[{"type":"text","text":"Put your test failures to work: Learn how to triage and diagnose uncaught issues in your app using the latest testing APIs in Xcode. We’ll show you how to help ease your testing workflow and put failures into context to help you deliver the best quality product."}],"type":"topic","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc20-10687-triage-test-failures-with-xctissue","title":"Triage test failures with XCTIssue"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10221-Get-your-test-results-faster":{"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc20-10221-get-your-test-results-faster","title":"Get your test results faster","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10221-Get-your-test-results-faster","abstract":[{"text":"Improve your testing suite to speed up your feedback loop and get fixes in faster. Learn more about the latest improvements to testing in Xcode, including how to leverage test plans, Xcodebuild updates, and APIs to eliminate never-ending and badly-behaved tests. We’ll explore Test Timeouts and Execution Time Allowances in XCTest, examine device parallelization, and detail recommended practices for balancing performance with clear fault localization.","type":"text"}],"role":"sampleCode","type":"topic"},"https://":{"url":"https:\/\/","type":"link","identifier":"https:\/\/","title":"Blog","titleInlineContent":[{"text":"Blog","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes":{"abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","url":"\/documentation\/wwdcnotes","kind":"symbol","role":"collection","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"type":"topic","title":"WWDC Notes"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10164-XCTSkip-your-tests":{"url":"\/documentation\/wwdcnotes\/wwdc20-10164-xctskip-your-tests","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10164-XCTSkip-your-tests","kind":"article","type":"topic","abstract":[{"text":"Get the test results that matter — and skip the ones that don’t. Discover how you can implement XCTSkip to conditionally avoid tests at runtime. We’ll take you through how to return this new test result and better document tests beyond pass and fail within your test bundle.","type":"text"}],"title":"XCTSkip your tests","role":"sampleCode"},"ATahhan":{"type":"image","alt":"Profile image of Ammar AlTahhan","identifier":"ATahhan","variants":[{"url":"\/images\/WWDCNotes\/ATahhan.jpeg","traits":["1x","light"]}]},"WWDCNotes.png":{"type":"image","identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"alt":null},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110361-Author-fast-and-reliable-tests-for-Xcode-Cloud":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110361-Author-fast-and-reliable-tests-for-Xcode-Cloud","title":"Author fast and reliable tests for Xcode Cloud","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc22-110361-author-fast-and-reliable-tests-for-xcode-cloud","type":"topic","abstract":[{"text":"Discover how you can create effective testing plans for Xcode Cloud, Apple’s continuous integration and continuous delivery service. We’ll show you how testing can be an essential tool to consistently verify your code works correctly. Learn how you can author fast, reliable, and efficient tests for Xcode Cloud, avoid irrelevant failures, and verify your code changes quickly.","type":"text"}],"kind":"article"},"WWDC20-10091-context_result_bundle":{"type":"image","alt":null,"identifier":"WWDC20-10091-context_result_bundle","variants":[{"url":"\/images\/WWDCNotes\/WWDC20-10091-context_result_bundle.png","traits":["1x","light"]}]},"https://github.com/ATahhan":{"type":"link","identifier":"https:\/\/github.com\/ATahhan","titleInlineContent":[{"type":"text","text":"GitHub"}],"url":"https:\/\/github.com\/ATahhan","title":"GitHub"},"doc://WWDCNotes/documentation/WWDCNotes/ATahhan":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/ATahhan","title":"Ammar AlTahhan (12 notes)","role":"sampleCode","images":[{"identifier":"ATahhan.jpeg","type":"card"},{"identifier":"ATahhan.jpeg","type":"icon"}],"url":"\/documentation\/wwdcnotes\/atahhan","type":"topic","abstract":[{"type":"text","text":"Software Engineer"}],"kind":"article"},"WWDC20.jpeg":{"type":"image","identifier":"WWDC20.jpeg","alt":null,"variants":[{"url":"\/images\/WWDCNotes\/WWDC20.jpeg","traits":["1x","light"]}]}}}