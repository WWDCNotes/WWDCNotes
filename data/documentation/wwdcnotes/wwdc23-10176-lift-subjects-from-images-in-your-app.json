{"schemaVersion":{"minor":3,"patch":0,"major":0},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10176-Lift-subjects-from-images-in-your-app","interfaceLanguage":"swift"},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc23-10176-lift-subjects-from-images-in-your-app"],"traits":[{"interfaceLanguage":"swift"}]}],"kind":"article","abstract":[{"text":"Discover how you can easily pull the subject of an image from its background in your apps. Learn how to lift the primary subject or to access the subject at a given point with VisionKit. We’ll also share how you can lift subjects using Vision and combine that with lower-level frameworks like Core Image to create fun image effects and more complex compositing pipelines.","type":"text"}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"sections":[],"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":2,"text":"Overview","anchor":"overview"},{"type":"paragraph","inlineContent":[{"text":"Speakers: Lizzy Board and Saumitro Dasgupta","type":"text"}]},{"type":"heading","level":2,"text":"What is a subject?","anchor":"What-is-a-subject"},{"style":"note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"A subject is the foreground object, or objects, of a photo. This is not always a person or a pet. It can be anything from a building, a plate of food, or some pairs of shoes."}]}],"name":"Note"},{"type":"heading","level":2,"text":"Supporting frameworks","anchor":"Supporting-frameworks"},{"type":"heading","level":3,"text":"VisionKit","anchor":"VisionKit"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Allows you to very easily adopt system-like subject lifting behavior, right out of the box.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Lets you easily recreate the subject lifting UI that we all know and love, with just a few lines of code.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Exposes some basic information about these subjects.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"All happens out-of-process, which has performance benefits but mens the image size is limited."}]}]}],"type":"unorderedList"},{"level":3,"text":"Vision","anchor":"Vision","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Lower-level framework that doesn’t have out-of-the-box UI.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Support multiple input sources and higher image resolution.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Good for more advanced image editing pipelines."}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Subject lifting in VisionKit","anchor":"Subject-lifting-in-VisionKit","type":"heading"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"iOS"}]},{"text":":","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Initialize an "},{"type":"codeVoice","code":"ImageAnalysisInteraction"},{"type":"text","text":"."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Add the interaction to a view containing the image (this can be an "},{"type":"codeVoice","code":"UIImageView"},{"type":"text","text":", but doesn’t need to be)."}],"type":"paragraph"}]}],"type":"orderedList"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"macOS"}],"type":"strong"},{"text":":","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Initialize an ","type":"text"},{"code":"ImageAnalysisOverlayView","type":"codeVoice"},{"text":".","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Add the view as a subview of the ","type":"text"},{"code":"NSView","type":"codeVoice"},{"text":" containing the image.","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"inlineContent":[{"text":"A preferred interaction type can be set on the ","type":"text"},{"type":"codeVoice","code":"ImageAnalysisInteraction"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"ImageAnalysisOverlayView"},{"text":" to choose which interactions should be supported.","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Default is "},{"type":"codeVoice","code":".automatic"},{"type":"text","text":" which mirrors system behavior. This supports subject lifting, live text and data detectors."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The new "},{"type":"codeVoice","code":".imageSubject"},{"type":"text","text":" supports only subject lifting."}]}]}],"type":"unorderedList"},{"level":3,"text":"Manually analyzing images","anchor":"Manually-analyzing-images","type":"heading"},{"syntax":"swift","code":["let analyzer = ImageAnalyzer()","let analysis = try? await analyzer.analyze(image, configuration: configuration)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"ImageAnalysis"},{"type":"text","text":" struct has a property "},{"type":"codeVoice","code":"subjects"},{"type":"text","text":" which contains a list of the image’s "},{"type":"codeVoice","code":"Subject"},{"type":"text","text":"s which contains an image and its bounds. It also has a property "},{"type":"codeVoice","code":"highlightedSubjects"},{"type":"text","text":" which contains the highlighted subjects. This can be changed programatically."}],"type":"paragraph"},{"level":3,"text":"Looking up a subject","anchor":"Looking-up-a-subject","type":"heading"},{"syntax":"swift","code":["let subject = try? await interaction.subject(at: point)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"If there are no subjects at that point, this method will return nil."}],"type":"paragraph"},{"level":3,"text":"Generating subject images","anchor":"Generating-subject-images","type":"heading"},{"syntax":"swift","code":["\/\/ For an image for a single Subject:","subject.image","\/\/ For an image composed of multiple Subjects:","interaction.image(for: interaction.subjects)"],"type":"codeListing"},{"level":2,"text":"Subject lifting in Vision","anchor":"Subject-lifting-in-Vision","type":"heading"},{"level":3,"text":"Different kind of APIs","anchor":"Different-kind-of-APIs","type":"heading"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Saliency:"}],"type":"strong"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"VNGenerateAttentionBasedSaliencyImageRequest"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"VNGenerateObjectnessBasedSaliencyImageRequest","type":"text"}]}]}],"type":"unorderedList"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Saliency requests, like the ones for attention and objectness, are best used for coarse, region-based analysis."}]}],"style":"note","type":"aside"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"text":"The generated saliency maps are at a fairly low resolution and as such, not suitable for segmentation. Instead, you could use the salient regions for tasks like auto-cropping an image.","type":"text"}]}],"style":"note","type":"aside"},{"inlineContent":[{"inlineContent":[{"text":"Person segmentation:","type":"text"}],"type":"strong"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"VNGeneratePersonSegmentationRequest"}]}]}],"type":"unorderedList"},{"name":"Note","content":[{"inlineContent":[{"text":"It shines at producing detailed segmentation masks for people in the scene. Use this if you specifically want to focus on segmenting people.","type":"text"}],"type":"paragraph"}],"style":"note","type":"aside"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Person instance segmentation:","type":"text"}]}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"VNGeneratePersonInstanceMaskRequest "},{"type":"emphasis","inlineContent":[{"inlineContent":[{"text":"NEW","type":"text"}],"type":"strong"}]}]}]}],"type":"unorderedList"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"text":"The new person instance segmentation API takes things further by providing a separate mask for each person in the scene.","type":"text"}]}],"style":"note","type":"aside"},{"inlineContent":[{"inlineContent":[{"text":"See more in the session “Explore 3D body pose and person segmentation in Vision”.","type":"text"}],"type":"emphasis"}],"type":"paragraph"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Subject lifting:"}],"type":"strong"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"VNGenerateForegroundInstanceMaskRequest ","type":"text"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"NEW","type":"text"}]}],"type":"emphasis"}],"type":"paragraph"}]}],"type":"unorderedList"},{"name":"Note","content":[{"inlineContent":[{"text":"The newly introduced subject lifting API is “class agnostic”. Any foreground object, regardless of its semantic class, can be potentially segmented.","type":"text"}],"type":"paragraph"}],"style":"note","type":"aside"},{"level":3,"text":"Concepts","anchor":"Concepts","type":"heading"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You start with an input image. The subject lifting request processes this image and produces a soft segmentation mask at the same resolution. Taking this mask and applying it to the source image results in the masked image."}]}],"style":"note","type":"aside"},{"name":"Note","content":[{"inlineContent":[{"text":"Each distinct segmented object is referred to as an instance.","type":"text"}],"type":"paragraph"}],"style":"note","type":"aside"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Vision also provides you with pixelwise information about these instances. This instance mask maps pixels in the source image to their instance index. The zero index is reserved for the background, and then each foreground instance is labeled sequentially, starting at 1."}]}],"style":"note","type":"aside"},{"inlineContent":[{"text":"The ordering of the IDs are not guaranteed.","type":"text"}],"type":"paragraph"},{"level":3,"text":"Generate a masked image","anchor":"Generate-a-masked-image","type":"heading"},{"syntax":"swift","code":["let request = VNGenerateForegroundInstanceMaskRequest()","let handler = VNImageRequestHandler(cgImage: image)","try handler.perform([request])","guard let result = request.results?.first else {","  return","}","let output = result.generateMaskedImage(","  ofInstances: result.allInstances,","  from: requestHandler,","  croppedToInstancesExtent: false)"],"type":"codeListing"},{"inlineContent":[{"text":"This is a resource intensive task and best deferred to a background thread so as not to block the UI.","type":"text"}],"type":"paragraph"},{"level":3,"text":"Working with masks","anchor":"Working-with-masks","type":"heading"},{"syntax":"swift","code":["result.generateScaledMaskForImage(","  forInstances: result.allInstances,","  from: requestHandler)"],"type":"codeListing"},{"name":"Note","content":[{"inlineContent":[{"type":"text","text":"The mask I just generated is perfectly suited for use with CoreImage. Vision, much like VisionKit, produces SDR outputs. Performing the masking in CoreImage, however, preserves the high dynamic range of the input."}],"type":"paragraph"}],"style":"note","type":"aside"},{"syntax":"swift","code":["func apply(mask: CIImage, toImage image: CIImage) -> CIImage {","  let filter = CIFilter.blendWithMask()","  filter.inputImage = image","  filter.maskImage = mask","  filter.backgroundImage = CIImage.empty()","  return filter.outputImage!","}"],"type":"codeListing"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"See more in the session “Support HDR images in your app”."}],"type":"emphasis"}],"type":"paragraph"},{"level":3,"text":"Demo app \/ putting it all together","anchor":"Demo-app--putting-it-all-together","type":"heading"},{"inlineContent":[{"type":"text","text":"Between 13:22 and 18:04, the code snippets above, and some more are put together, to enable a visual effects demo app."}],"type":"paragraph"},{"level":2,"text":"Written By","anchor":"Written-By","type":"heading"},{"columns":[{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"MortenGregersen"}]}],"size":1},{"content":[{"level":3,"text":"Morten Bjerg Gregersen","anchor":"Morten-Bjerg-Gregersen","type":"heading"},{"inlineContent":[{"type":"reference","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/MortenGregersen"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/MortenGregersen"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"http:\/\/atterdagapps.com"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/x.com\/mortengregersen"}],"type":"paragraph"}],"size":4}],"numberOfColumns":5,"type":"row"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"reference"}],"type":"paragraph"},{"level":2,"text":"Related Sessions","anchor":"Related-Sessions","type":"heading"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10048-Whats-new-in-VisionKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-111241-Explore-3D-body-pose-and-person-segmentation-in-Vision"],"style":"list","type":"links"},{"inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}]}],"metadata":{"role":"sampleCode","roleHeading":"WWDC23","modules":[{"name":"WWDC Notes"}],"title":"Lift subjects from images in your app"},"sampleCodeDownload":{"kind":"sampleDownload","action":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10176","isActive":true,"overridingTitle":"Watch Video (18 min)","type":"reference"}},"references":{"MortenGregersen.jpeg":{"variants":[{"url":"\/images\/MortenGregersen.jpeg","traits":["1x","light"]}],"type":"image","alt":null,"identifier":"MortenGregersen.jpeg"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","role":"collectionGroup","kind":"article","type":"topic","title":"WWDC23","url":"\/documentation\/wwdcnotes\/wwdc23","abstract":[{"type":"text","text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"SwiftData"},{"type":"text","text":", "},{"type":"codeVoice","code":"Observation"},{"type":"text","text":", "},{"type":"codeVoice","code":"StoreKit"},{"type":"text","text":" views, and more."}],"images":[{"type":"icon","identifier":"WWDC23-Icon.png"},{"type":"card","identifier":"WWDC23.jpeg"}]},"https://github.com/MortenGregersen":{"titleInlineContent":[{"text":"GitHub","type":"text"}],"type":"link","identifier":"https:\/\/github.com\/MortenGregersen","title":"GitHub","url":"https:\/\/github.com\/MortenGregersen"},"https://x.com/mortengregersen":{"titleInlineContent":[{"text":"X\/Twitter","type":"text"}],"type":"link","identifier":"https:\/\/x.com\/mortengregersen","url":"https:\/\/x.com\/mortengregersen","title":"X\/Twitter"},"WWDC23.jpeg":{"identifier":"WWDC23.jpeg","type":"image","alt":null,"variants":[{"url":"\/images\/WWDC23.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/MortenGregersen":{"type":"topic","kind":"article","title":"Morten Bjerg Gregersen (21 notes)","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/MortenGregersen","url":"\/documentation\/wwdcnotes\/mortengregersen","role":"sampleCode","abstract":[{"text":"Hi 👋 I am Morten - I live in Denmark 🇩🇰","type":"text"}],"images":[{"type":"card","identifier":"MortenGregersen.jpeg"},{"identifier":"MortenGregersen.jpeg","type":"icon"}]},"https://developer.apple.com/wwdc23/10176":{"type":"download","checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc23\/10176","url":"https:\/\/developer.apple.com\/wwdc23\/10176"},"http://atterdagapps.com":{"titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link","identifier":"http:\/\/atterdagapps.com","title":"Blog","url":"http:\/\/atterdagapps.com"},"doc://WWDCNotes/documentation/WWDCNotes":{"abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","kind":"symbol","title":"WWDC Notes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"url":"\/documentation\/wwdcnotes","type":"topic","role":"collection"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10048-Whats-new-in-VisionKit":{"abstract":[{"type":"text","text":"Discover how VisionKit can help people quickly lift subjects from images in your app and learn more about the content of an image with Visual Look Up. We’ll also take a tour of the latest updates to VisionKit for Live Text interaction, data scanning, and expanded support for macOS apps."}],"url":"\/documentation\/wwdcnotes\/wwdc23-10048-whats-new-in-visionkit","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10048-Whats-new-in-VisionKit","role":"sampleCode","type":"topic","title":"What’s new in VisionKit","kind":"article"},"WWDC23-Icon.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC23-Icon.png"}],"type":"image","alt":null,"identifier":"WWDC23-Icon.png"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-111241-Explore-3D-body-pose-and-person-segmentation-in-Vision":{"abstract":[{"type":"text","text":"Discover how to build person-centric features with Vision. Learn how to detect human body poses and measure individual joint locations in 3D space. We’ll also show you how to take advantage of person segmentation APIs to distinguish and segment up to four individuals in an image."}],"url":"\/documentation\/wwdcnotes\/wwdc23-111241-explore-3d-body-pose-and-person-segmentation-in-vision","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-111241-Explore-3D-body-pose-and-person-segmentation-in-Vision","role":"sampleCode","type":"topic","title":"Explore 3D body pose and person segmentation in Vision","kind":"article"},"MortenGregersen":{"type":"image","identifier":"MortenGregersen","variants":[{"url":"\/images\/MortenGregersen.jpeg","traits":["1x","light"]}],"alt":"Profile image of Morten Bjerg Gregersen"}}}