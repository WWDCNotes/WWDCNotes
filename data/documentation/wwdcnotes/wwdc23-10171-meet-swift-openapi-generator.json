{"schemaVersion":{"minor":3,"major":0,"patch":0},"metadata":{"modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC23","role":"sampleCode","title":"Meet Swift OpenAPI Generator"},"kind":"article","hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"primaryContentSections":[{"content":[{"type":"heading","text":"Challenges of defining an API","anchor":"Challenges-of-defining-an-API","level":2},{"type":"paragraph","inlineContent":[{"identifier":"WWDC23-10171-api-definition-challenges","type":"image"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Most services have some kind of documentation, but hand-written can be outdated"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"With access to source code, implementation can be used – but incomplete understanding"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Support forums might help, but those who help might be underinformed","type":"text"},{"text":" ","type":"text"},{"text":"-> incomplete picture","type":"text"}]}]}]},{"type":"heading","text":"Exploring OpenAPI","anchor":"Exploring-OpenAPI","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Tried-and-tested Industry-standard","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"You declare your API in YAML or JSON","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Rich ecosystem of tooling","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Known for interactive documentation","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Core motivation is code generation"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Without OpenAPI, creating query & interpreting the response can be complex"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Working with larger APIs detracts from the core logic of the app"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"identifier":"WWDC23-10171-openapi-tools","type":"image"}]},{"type":"paragraph","inlineContent":[{"text":"Example OpenAPI document:","type":"text"}]},{"syntax":"yaml","type":"codeListing","code":["openapi: \"3.0.3\"","info:","  title: \"GreetingService\"","  version: \"1.0.0\"","servers:","- url: \"http:\/\/localhost:8080\/api\"","  description: \"Production\"","paths:","  \/greet:","    get:","      operationId: \"getGreeting\"","      parameters:","      - name: \"name\"","        required: false","        in: \"query\"","        description: \"Personalizes the greeting.\"","        schema:","          type: \"string\"","      responses:","        \"200\":","          description: \"Returns a greeting\"","          content:","            application\/json:","              schema:","                $ref: \"#\/components\/schemas\/Greeting\" "]},{"type":"paragraph","inlineContent":[{"text":"With the help of an OpenAPI Generator complex API handling can become as simple as this with safe types:","type":"text"}]},{"syntax":"Swift","type":"codeListing","code":["switch try await client.getGreeting(Operations.getGreeting.Input(query: Operations.getGreeting.Input.Query(name: \"Jane\"))) {","case .ok(let response):","\tswitch response.body {","\t\tcase .json(let greeting):","\t\tprint(greeting.message)","\t}","}"]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Swift OpenAPI Generator is a Swift package plugin, generates code at build time"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Always in sync with OpenAPI document, no need to commit code to source control","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"identifier":"WWDC23-10171-code-generation","type":"image"}]},{"type":"heading","text":"Making API calls from your app","anchor":"Making-API-calls-from-your-app","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"To use OpenAPI Generator, add package to your app from "},{"type":"codeVoice","code":"https:\/\/github.com\/apple\/swift-openapi-generator"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Next, add also the package from "},{"type":"codeVoice","code":"https:\/\/github.com\/apple\/swift-openapi-runtime"},{"type":"text","text":" to your app"}]}]},{"content":[{"inlineContent":[{"text":"Lastly, add also the package from ","type":"text"},{"code":"https:\/\/github.com\/apple\/swift-openapi-urlsession","type":"codeVoice"},{"text":" for the code to be generated for ","type":"text"},{"code":"URLSession","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"In “Build Phases”, in the “Run Build Tool Plug-Ins”, add ","type":"text"},{"type":"codeVoice","code":"OpenAPIGenerator"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"WWDC23-10171-build-tool-plugins"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The plugin expects 2 files in project: ","type":"text"},{"code":"openapi-generator-config.yaml","type":"codeVoice"},{"text":" (config) and ","type":"text"},{"code":"openapi.yaml","type":"codeVoice"},{"text":" (spec)","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The config file specifies what code to generate, e.g. "},{"type":"codeVoice","code":"generate: [types, client]"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"In SwiftUI, import ","type":"text"},{"type":"codeVoice","code":"OpenAPIRuntime"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"OpenAPIURLSession"},{"text":", then initialize a ","type":"text"},{"type":"codeVoice","code":"Client(severURL: ..., transport: URLSessionTransport())"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Now you can call the API using ","type":"text"},{"code":"try await client.getEmoji(Operations.getEmoji.Input())","type":"codeVoice"},{"text":" or with whatever endpoints are defined in the spec","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The reponse of this call is an enum with all possible cases documented + content types -> forces us to handle all scenarios"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"To also handle any behavior that is not documented, there’s "},{"code":".undocumented(statusCode:_:)","type":"codeVoice"},{"type":"text","text":" to handle it gracefully"}]}]}]},{"type":"heading","text":"Adapting as the API evolves","anchor":"Adapting-as-the-API-evolves","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"For example, when adding a new parameter to the API document like "},{"code":"count","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The generated Swift code will force you to add the parameter in all places where needed, else Swift fails"}],"type":"paragraph"}]}]},{"type":"heading","text":"Testing your app with mocks","anchor":"Testing-your-app-with-mocks","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Define "},{"type":"codeVoice","code":"MockClient: APIProtocol"},{"type":"text","text":", the compiler will give you errors and fix-its to fill in the APIs you need"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Make the view generic over "},{"type":"codeVoice","code":"C: APIProtocol"},{"type":"text","text":" like in "},{"type":"codeVoice","code":"struct ContentView<C: APIProtocol>: View"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Update your ","type":"text"},{"code":"client","type":"codeVoice"},{"text":" property to use the generic type ","type":"text"},{"code":"C","type":"codeVoice"},{"text":" instead","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Define a new initializer where the client is passed (","type":"text"},{"type":"codeVoice","code":"init(client: C)"},{"text":") for dependency injection","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Use ","type":"text"},{"type":"codeVoice","code":"where C == Client"},{"text":" on default initializer to use real server when app launched","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Pass "},{"type":"codeVoice","code":"MockClient()"},{"type":"text","text":" when previewing the UI in Xcode"}]}]}]},{"type":"heading","text":"Server development in Swift","anchor":"Server-development-in-Swift","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"All the code needed to write a simple test server using the OpenAPI generator that handles the requests is this:"}]},{"syntax":"Swift","type":"codeListing","code":["import Foundation","import OpenAPIRuntime","import OpenAPIVapor","import Vapor","","struct Handler: APIProtocol {","    func getEmoji(_ input: Operations.getEmoji.Input) async throws -> Operations.getEmoji.Output {","        let candidates = \"🐱😹😻🙀😿😽😸😺😾😼\"","        let chosen = String(candidates.randomElement()!)","        let count = input.query.count ?? 1","        let emojis = String(repeating: chosen, count: count)","        return .ok(Operations.getEmoji.Output.Ok(body: .text(emojis)))","    }","}","","@main","struct CatService {","    public static func main() throws {","        let app = Vapor.Application()","        let transport = VaporTransport(routesBuilder: app)","        let handler = Handler()","        try handler.registerHandlers(on: transport, serverURL: Servers.server1())","        try app.run()","    }","}"]},{"type":"paragraph","inlineContent":[{"text":"The related ","type":"text"},{"code":"Package.swift","type":"codeVoice"},{"text":" file of the server package looks like this:","type":"text"}]},{"syntax":"Swift","type":"codeListing","code":["\/\/ swift-tools-version: 5.8","import PackageDescription","","let package = Package(","    name: \"CatService\",","    platforms: [","        .macOS(.v13),","    ],","    dependencies: [","        .package(url: \"https:\/\/github.com\/apple\/swift-openapi-generator\", .upToNextMinor(from: \"0.1.0\")),","        .package(url: \"https:\/\/github.com\/apple\/swift-openapi-runtime\", .upToNextMinor(from: \"0.1.0\")),","        .package(url: \"https:\/\/github.com\/swift-server\/swift-openapi-vapor\", .upToNextMinor(from: \"0.1.0\")),","        .package(url: \"https:\/\/github.com\/vapor\/vapor\", .upToNextMajor(from: \"4.69.2\")),","    ],","    targets: [","        .executableTarget(","            name: \"CatService\",","            dependencies: [","                .product(name: \"OpenAPIRuntime\", package: \"swift-openapi-runtime\"),","                .product(name: \"OpenAPIVapor\", package: \"swift-openapi-vapor\"),","                .product(name: \"Vapor\", package: \"vapor\"),","            ],","            resources: [.process(\"Resources\/cat.mp4\")],","            plugins: [.plugin(name: \"OpenAPIGenerator\", package: \"swift-openapi-generator\")]","        ),","    ]",")"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Additionally, on the "},{"type":"codeVoice","code":"openapi-generator-config.yaml"},{"type":"text","text":" file, instead of "},{"type":"codeVoice","code":"client"},{"type":"text","text":", add "},{"type":"codeVoice","code":"server"},{"type":"text","text":" for the right code to be generated (alongside "},{"type":"codeVoice","code":"types"},{"type":"text","text":")."}]},{"type":"paragraph","inlineContent":[{"text":"Like on the client side, when making changes to the API spec, like adding new endpoints, the server package build will fail and offer fix-its to add the missing parts.","type":"text"}]},{"type":"heading","text":"Main Takeaway","anchor":"Main-Takeaway","level":2},{"type":"paragraph","inlineContent":[{"text":"Start with defining the OpenAPI doc to use this kind of flow saving you time on both the client & server. This is called “Spec-Driven Development”.","type":"text"}]},{"type":"heading","text":"Written By","anchor":"Written-By","level":2},{"numberOfColumns":5,"type":"row","columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"Jeehut"}]}]},{"size":4,"content":[{"text":"Cihat Gündüz","type":"heading","level":3,"anchor":"Cihat-G%C3%BCnd%C3%BCz"},{"inlineContent":[{"type":"reference","isActive":true,"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Jeehut","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}]},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/Jeehut"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/x.com\/Jeehut"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/fline.dev"}],"type":"paragraph"}]}]},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}]},{"type":"heading","text":"Related Sessions","anchor":"Related-Sessions","level":2},{"type":"links","style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110359-Meet-Swift-Package-plugins","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110360-Use-Xcode-for-serverside-development"]},{"type":"small","inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}],"kind":"content"}],"abstract":[{"type":"text","text":"Discover how Swift OpenAPI Generator can help you work with HTTP server APIs whether you’re extending an iOS app or writing a server in Swift. We’ll show you how this package plugin can streamline your workflow and simplify your codebase by generating code from an OpenAPI document."}],"sampleCodeDownload":{"action":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10171","isActive":true,"overridingTitle":"Watch Video (21 min)","type":"reference"},"kind":"sampleDownload"},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc23-10171-meet-swift-openapi-generator"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10171-Meet-Swift-OpenAPI-Generator","interfaceLanguage":"swift"},"sections":[],"references":{"https://x.com/Jeehut":{"identifier":"https:\/\/x.com\/Jeehut","url":"https:\/\/x.com\/Jeehut","type":"link","title":"X\/Twitter","titleInlineContent":[{"type":"text","text":"X\/Twitter"}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}]},"WWDC23-10171-code-generation":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC23-10171-code-generation.png","traits":["1x","light"]}],"identifier":"WWDC23-10171-code-generation","type":"image","alt":null},"WWDC23.jpeg":{"identifier":"WWDC23.jpeg","type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC23.jpeg","traits":["1x","light"]}],"alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110359-Meet-Swift-Package-plugins":{"type":"topic","title":"Meet Swift Package plugins","url":"\/documentation\/wwdcnotes\/wwdc22-110359-meet-swift-package-plugins","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110359-Meet-Swift-Package-plugins","role":"sampleCode","abstract":[{"text":"Discover how you can perform actions on Swift packages and Xcode projects with Swift package plugins. We’ll go over how these plugins work and explore how you can use them to generate source code and automate your development workflow.","type":"text"}],"kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/Jeehut":{"type":"topic","abstract":[{"text":"Spatial-first Indie Developer for  Platforms. Actively contributing to Open Source since 2011!","type":"text"}],"title":"Cihat Gündüz (61 notes)","images":[{"type":"card","identifier":"Jeehut.jpeg"},{"type":"icon","identifier":"Jeehut.jpeg"}],"url":"\/documentation\/wwdcnotes\/jeehut","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Jeehut","kind":"article","role":"sampleCode"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110360-Use-Xcode-for-serverside-development":{"title":"Use Xcode for server-side development","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110360-Use-Xcode-for-serverside-development","url":"\/documentation\/wwdcnotes\/wwdc22-110360-use-xcode-for-serverside-development","kind":"article","abstract":[{"text":"Discover how you can create, build, and deploy a Swift server app alongside your pre-existing Xcode projects within the same workspace. We’ll show you how to create your own local app and test endpoints using Xcode, and explore how you can structure and share code between server and client apps to ease your development process","type":"text"}],"type":"topic","role":"sampleCode"},"https://fline.dev":{"identifier":"https:\/\/fline.dev","url":"https:\/\/fline.dev","type":"link","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}]},"WWDCNotes.png":{"type":"image","alt":null,"identifier":"WWDCNotes.png","variants":[{"url":"\/images\/WWDCNotes\/WWDCNotes.png","traits":["1x","light"]}]},"https://github.com/Jeehut":{"identifier":"https:\/\/github.com\/Jeehut","url":"https:\/\/github.com\/Jeehut","title":"GitHub","type":"link","titleInlineContent":[{"text":"GitHub","type":"text"}]},"https://developer.apple.com/wwdc23/10171":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10171","url":"https:\/\/developer.apple.com\/wwdc23\/10171","type":"download","checksum":null},"WWDC23-10171-build-tool-plugins":{"type":"image","alt":null,"identifier":"WWDC23-10171-build-tool-plugins","variants":[{"url":"\/images\/WWDCNotes\/WWDC23-10171-build-tool-plugins.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"type":"topic","abstract":[{"type":"text","text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"SwiftData"},{"type":"text","text":", "},{"type":"codeVoice","code":"Observation"},{"type":"text","text":", "},{"type":"codeVoice","code":"StoreKit"},{"type":"text","text":" views, and more."}],"title":"WWDC23","images":[{"type":"icon","identifier":"WWDC23-Icon.png"},{"type":"card","identifier":"WWDC23.jpeg"}],"url":"\/documentation\/wwdcnotes\/wwdc23","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","kind":"article","role":"collectionGroup"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"title":"WWDC Notes","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","kind":"symbol","role":"collection"},"WWDC23-10171-openapi-tools":{"identifier":"WWDC23-10171-openapi-tools","type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC23-10171-openapi-tools.png","traits":["1x","light"]}],"alt":"OpenAPI tools: Client code generation, API gateways, Data validation, Statis analysis, Fuzz testing, Middleware, Interactive documentation, API evolution, Graphical editors, Server stub generation, Mock testing, Specification generation, Documentation generation, Format conversion, Editor support, …"},"WWDC23-10171-api-definition-challenges":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC23-10171-api-definition-challenges.png","traits":["1x","light"]}],"identifier":"WWDC23-10171-api-definition-challenges","type":"image","alt":"API definition: Serve URL, API endpoint, HTTP method, Path parameters, Query string, HTTP header fields, Content type, Request body, Status codes, Response body, Errors, Required parameters, Optional parameters, Encoding, Authorization, API version, …"},"Jeehut":{"type":"image","alt":"Profile image of Cihat Gündüz","identifier":"Jeehut","variants":[{"url":"\/images\/WWDCNotes\/Jeehut.jpeg","traits":["1x","light"]}]},"Jeehut.jpeg":{"identifier":"Jeehut.jpeg","type":"image","variants":[{"url":"\/images\/WWDCNotes\/Jeehut.jpeg","traits":["1x","light"]}],"alt":null},"WWDC23-Icon.png":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC23-Icon.png","traits":["1x","light"]}],"identifier":"WWDC23-Icon.png","type":"image","alt":null}}}