{"metadata":{"roleHeading":"WWDC19","title":"Introducing PencilKit","modules":[{"name":"WWDC Notes"}],"role":"sampleCode"},"sections":[],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19"]]},"abstract":[{"text":"Meet PencilKit, Apple’s feature-rich drawing and annotation framework. With just a few lines of code, you can add a full drawing experience to your app — with access to a canvas, responsive inks, rich tool palette and drawing model. Hear the technical details that make a great Apple Pencil experience. Learn about the new screenshot editor and how you can adopt just a few small APIs to enable your full content to be captured beyond the size of the screen, with or without your app’s user interface.","type":"text"}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc19-221-introducing-pencilkit"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-221-Introducing-PencilKit","interfaceLanguage":"swift"},"schemaVersion":{"minor":3,"patch":0,"major":0},"sampleCodeDownload":{"action":{"overridingTitle":"Watch Video (34 min)","isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc19\/221"},"kind":"sampleDownload"},"kind":"article","primaryContentSections":[{"kind":"content","content":[{"level":2,"text":"Before `PencilKit`","anchor":"Before-PencilKit","type":"heading"},{"inlineContent":[{"type":"text","text":"How to use the pencil at full:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Force, azimuth, and altitude allow expressive marks","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Pencil taps switch modes (for pencil 2nd gen)"}]}]}],"type":"unorderedList"},{"inlineContent":[{"type":"image","identifier":"WWDC19-221-pencilChart"}],"type":"paragraph"},{"level":2,"text":"Pencil behind the scenes","anchor":"Pencil-behind-the-scenes","type":"heading"},{"inlineContent":[{"type":"text","text":"The Pencil gives us:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"a uniquely, precise "},{"inlineContent":[{"type":"text","text":"touch location"}],"type":"strong"},{"type":"text","text":" on the screen, 240 times\/second."}]}]},{"content":[{"inlineContent":[{"text":"an ","type":"text"},{"inlineContent":[{"type":"text","text":"azimuth"}],"type":"strong"},{"text":", which is the angle around the perpendicular of the iPad. And it gives us ","type":"text"},{"inlineContent":[{"type":"text","text":"altitude or tilt"}],"type":"strong"},{"text":", which is the steepness at which the user is holding the Pencil. The Pencil generates a second hit and touchpoint on the surface of the iPad. And using trigonometry, it uses that to calculate azimuth and altitude. This is a ","type":"text"},{"inlineContent":[{"text":"hidden","type":"text"}],"type":"emphasis"},{"text":" sensor in the pencil.","type":"text"},{"text":" ","type":"text"},{"type":"image","identifier":"WWDC19-221-az"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"A "},{"type":"strong","inlineContent":[{"text":"force\/press","type":"text"}]},{"type":"text","text":" value, the Pencil has an axial force sensor that detects the pressure and it sends that data over Bluetooth."}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"There are a few consequences of all of this:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Azimuth\/altitude may be estimated (when users covers this second point with their hands)","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Azimuth is imprecise when the pencil is perpendicular","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Force data is delayed (as Bluetooth is slower than whatever the Pencil uses to transfer the rest of the data)"}]}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Because the force data is delayed, when we lift the pencil there’s the last region of the stroke that’s still waiting for those final force values:","type":"text"},{"text":" ","type":"text"},{"text":"we need to keep listening to them even after touch has ended.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"It’s possible that the user starts drawing the next stroke before the last stroke has gotten all the final press values.","type":"text"},{"text":"\n","type":"text"},{"text":"Apple suggests to use a serial queue to only be handling one stroke at a time. The time is short enough that the user won’t notice.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"How to work for best latency:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Render with metal"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use predicted touches"}]}]}],"type":"unorderedList"},{"level":2,"text":"What is `PencilKit`?","anchor":"What-is-PencilKit","type":"heading"},{"inlineContent":[{"code":"PencilKit","type":"codeVoice"},{"text":" makes it easy to incorporate hand-drawn content into your iOS or macOS apps quickly and easily. PencilKit provides a drawing environment for your iOS app that takes input from Apple Pencil, or the user’s finger, and turns it into high quality images you display in either iOS or macOS. The environment comes with tools for creating, erasing, and selecting lines.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"In short, ","type":"text"},{"code":"PencilKit","type":"codeVoice"},{"text":" lets 3rd party apps use the annotation interface that we use when taking a screenshot.","type":"text"},{"text":" ","type":"text"},{"text":"Three lines of code to start doodling:","type":"text"}],"type":"paragraph"},{"code":["let canvas = PKCanvasView(frame: bounds)","view.addSubview(canvas) ","canvas.tool = PKInkingTool(.pen, color: .black, width: 30) "],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"codeVoice","code":"PKCanvasView"},{"type":"text","text":" provides (we provide) the drawable region of the app."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"It’s a scrollview (can pan and zoom), from the session is not clear how we can manage this."}],"type":"paragraph"},{"inlineContent":[{"type":"codeVoice","code":"PKDrawing"},{"type":"text","text":" model captures the user strokes: it’s the data model of PencilKit."},{"type":"text","text":" "},{"type":"text","text":"It has a data format and it allows us to load and store drawings to data."}],"type":"paragraph"},{"inlineContent":[{"type":"codeVoice","code":"PKTools"},{"type":"text","text":" are the tools that we let users to use in the canvas (think like pen, pencil, brush..). We can enable\/disable tools, even choose the available colors."}],"type":"paragraph"},{"level":2,"text":"Screenshots","anchor":"Screenshots","type":"heading"},{"inlineContent":[{"type":"text","text":"When taking a screenshot, we can now provide a better version of the current screen as a pdf (like in safari, we can choose to get the current screen screenshot, limited by the screen boundaries, or we can ask Safari to give us the whole web page, not just the screen crop, without all the unnecessary safari UI)."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"We do this by setting the property "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiwindowscene\/3213938-screenshotservice"},{"type":"text","text":" of the new "},{"type":"codeVoice","code":"UIWindowScene"},{"type":"text","text":"."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"We must return a "},{"type":"codeVoice","code":".pdf"}],"type":"paragraph"},{"level":2,"text":"Written By","anchor":"Written-By","type":"heading"},{"columns":[{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4"}]}],"size":1},{"content":[{"anchor":"Federico-Zanetello","text":"Federico Zanetello","level":3,"type":"heading"},{"inlineContent":[{"isActive":true,"type":"reference","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/zntfdr"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/zntfdr.dev"}],"type":"paragraph"}],"size":4}],"numberOfColumns":5,"type":"row"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"level":2,"text":"Related Sessions","anchor":"Related-Sessions","type":"heading"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10089-Whats-new-in-PDFKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10107-Whats-new-in-PencilKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10148-Inspect-modify-and-construct-PencilKit-drawings","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-212-Introducing-Multiple-Windows-on-iPad","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC17-706-Modernizing-Grand-Central-Dispatch-Usage"],"style":"list","type":"links"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}],"type":"small"}]}],"references":{"https://github.com/zntfdr":{"title":"GitHub","type":"link","identifier":"https:\/\/github.com\/zntfdr","url":"https:\/\/github.com\/zntfdr","titleInlineContent":[{"text":"GitHub","type":"text"}]},"https://zntfdr.dev":{"title":"Blog","type":"link","identifier":"https:\/\/zntfdr.dev","url":"https:\/\/zntfdr.dev","titleInlineContent":[{"type":"text","text":"Blog"}]},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","kind":"symbol","role":"collection","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}]},"WWDCNotes.png":{"type":"image","identifier":"WWDCNotes.png","alt":null,"variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC17-706-Modernizing-Grand-Central-Dispatch-Usage":{"kind":"article","title":"Modernizing Grand Central Dispatch Usage","url":"\/documentation\/wwdcnotes\/wwdc17-706-modernizing-grand-central-dispatch-usage","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC17-706-Modernizing-Grand-Central-Dispatch-Usage","role":"sampleCode","abstract":[{"type":"text","text":"macOS 10.13 and iOS 11 have reinvented how Grand Central Dispatch and the Darwin kernel collaborate, enabling your applications to run concurrent workloads more efficiently. Learn how to modernize your code to take advantage of these improvements and make optimal use of hardware resources."}]},"https://developer.apple.com/documentation/uikit/uiwindowscene/3213938-screenshotservice":{"title":"screenshotService","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiwindowscene\/3213938-screenshotservice","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiwindowscene\/3213938-screenshotservice","titleInlineContent":[{"type":"codeVoice","code":"screenshotService"}]},"https://avatars.githubusercontent.com/u/5277837?v=4":{"type":"image","identifier":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4","alt":"Profile image of Federico Zanetello","variants":[{"url":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4","traits":["1x","light"]}]},"https://developer.apple.com/wwdc19/221":{"type":"download","identifier":"https:\/\/developer.apple.com\/wwdc19\/221","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc19\/221"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10089-Whats-new-in-PDFKit":{"title":"What’s new in PDFKit","url":"\/documentation\/wwdcnotes\/wwdc22-10089-whats-new-in-pdfkit","abstract":[{"text":"Discover PDFKit — a full-featured framework that helps your app view, edit, and save PDF documents. We’ll take you through the latest features in PDFKit, including support for live text and forms, creating PDFs from images, building interactive overlays, and saving annotations.","type":"text"}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10089-Whats-new-in-PDFKit","role":"sampleCode","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"kind":"article","url":"\/documentation\/wwdcnotes\/zntfdr","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"type":"topic","title":"Federico Zanetello (332 notes)","role":"sampleCode"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10148-Inspect-modify-and-construct-PencilKit-drawings":{"abstract":[{"text":"Make Apple Pencil an even more useful tool for drawing and writing within your app. With PencilKit, you can delve into the strokes, inks, paths, and points that comprise a drawing, use these to build features that use recognition, and modify drawings in response to input. Discover how you can dynamically generate shapes and drawings and learn more about APIs like PKDrawings and PKStrokes.","type":"text"}],"title":"Inspect, modify, and construct PencilKit drawings","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10148-Inspect-modify-and-construct-PencilKit-drawings","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc20-10148-inspect-modify-and-construct-pencilkit-drawings","kind":"article"},"WWDC19-221-pencilChart":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC19-221-pencilChart.png"}],"identifier":"WWDC19-221-pencilChart","alt":null,"type":"image"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10107-Whats-new-in-PencilKit":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10107-Whats-new-in-PencilKit","abstract":[{"text":"PencilKit helps power creativity, writing, drawing, and animation in your iPad apps. Explore the latest improvements to our drawing and annotation framework, and discover how you can take advantage of APIs like PKToolPicker, PKCanvasView, and PKStroke to support new features in illustration and writing apps.","type":"text"}],"kind":"article","role":"sampleCode","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc20-10107-whats-new-in-pencilkit","title":"What’s new in PencilKit"},"WWDC19-221-az":{"variants":[{"url":"\/images\/WWDC19-221-az.png","traits":["1x","light"]}],"identifier":"WWDC19-221-az","alt":null,"type":"image"},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","type":"link","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19":{"images":[{"type":"icon","identifier":"WWDCNotes.png"}],"kind":"article","type":"topic","abstract":[{"text":"Xcode 11, Swift 5.1, iOS 13, macOS 10.15 (Catalina), tvOS 13, watchOS 6.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"Combine","type":"codeVoice"},{"text":", ","type":"text"},{"code":"Core Haptics","type":"codeVoice"},{"text":", ","type":"text"},{"code":"Create ML","type":"codeVoice"},{"text":", and more.","type":"text"}],"role":"collectionGroup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19","title":"WWDC19","url":"\/documentation\/wwdcnotes\/wwdc19"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-212-Introducing-Multiple-Windows-on-iPad":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-212-Introducing-Multiple-Windows-on-iPad","title":"Introducing Multiple Windows on iPad","kind":"article","abstract":[{"text":"Multitasking is an exciting way to add power to your iPad app. It is easy to enable your app to run two instances of your interface side-by-side, and your customers will love it. Learn how to take your existing features like drag and drop and use them to easily create a second window. Find out how supporting multiple windows changes the app lifecycle and what that means for all applications. Hear about some common mistakes and how to solve them, setting you and your customers up for a fantastic experience.","type":"text"}],"role":"sampleCode","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc19-212-introducing-multiple-windows-on-ipad"}}}