{"metadata":{"title":"Build Mail app extensions","roleHeading":"WWDC21","role":"sampleCode","modules":[{"name":"WWDC Notes"}]},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21"]]},"abstract":[{"type":"text","text":"Meet MailKit: the best way to build amazing experiences on top of Mail. MailKit enables apps to easily and securely interact with the Mail app for macOS. We‚Äôll deep dive into the MailKit API, and show you how to create extensions for composing messages, message actions, secure email, and content blocking."}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"identifier":"https:\/\/developer.apple.com\/wwdc21\/10168","type":"reference","overridingTitle":"Watch Video (18 min)","isActive":true}},"kind":"article","schemaVersion":{"minor":3,"patch":0,"major":0},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc21-10168-build-mail-app-extensions"]}],"sections":[],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10168-Build-Mail-app-extensions","interfaceLanguage":"swift"},"primaryContentSections":[{"kind":"content","content":[{"type":"heading","text":"Overview","anchor":"overview","level":2},{"type":"aside","style":"note","name":"Note","content":[{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/build_mail_app_extensions","isActive":true}]}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Mail plug-ins will stop working in a future macOS release","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"New "},{"identifier":"https:\/\/developer.apple.com\/documentation\/mailkit","type":"reference","isActive":true},{"type":"text","text":", macOS 12.0+"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Mail extensions are built on the same underlying foundation as other app extensions, like Safari app extensions and share sheet extensions","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"can be distributed standalone, bundled in an app (even notarized ones)","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Extension types:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"compose extensions - allow new workflows when composing mail messages"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"action extensions - help people manage their inbox by providing custom rules on incoming messages","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"content blocking extensions - provide WebKit content blockers for Mail messages","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"message security extensions - provide further security by signing, encrypting, and decrypting messages when people send and receive mail"}]}]}]},{"type":"heading","text":"Creating a new Mail Extension","anchor":"Creating-a-new-Mail-Extension","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"When you create a new Mail extension, you will be asked which types (among the ones above) your extension will be. This will enable\/disable capabilities on your extension accordingly."}]},{"type":"paragraph","inlineContent":[{"text":"The principal class of your extension must conform to the ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/meextension","isActive":true,"type":"reference"},{"text":" protocol.","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"MEExtension"},{"type":"text","text":" exposes optional handler methods for each of the four types of extensions"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"All the methods in "},{"code":"MEComposeSessionHandler","type":"codeVoice"},{"type":"text","text":" have a "},{"code":"MEComposeSession","type":"codeVoice"},{"type":"text","text":" argument which provides information about a compose window. Mail creates a unique "},{"code":"MEComposeSession","type":"codeVoice"},{"type":"text","text":" instance for every Mail compose window. Each window has a "},{"code":"MEMessage","type":"codeVoice"},{"type":"text","text":" property that exposes various details of the message being edited."}],"type":"paragraph"}]}]},{"type":"heading","text":"Compose extensions","anchor":"Compose-extensions","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Four ways your extension can interact with a Mail compose window:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"validate\/annotate recipient email addresses; as the user is editing them","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"present a view controller with additional context about the message being composed; the view controller must be a subclass of "},{"identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/meextensionviewcontroller","type":"reference","isActive":true}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"set additional headers on outgoing messages","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"validate\/alert the user of errors in the message before it is sent"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"For "},{"type":"codeVoice","code":"MEComposeSession"},{"type":"text","text":" you will need to provide a "},{"type":"codeVoice","code":"MEComposeIcon"},{"type":"text","text":" and "},{"type":"codeVoice","code":"MEComposeIconToolTip"},{"type":"text","text":" entries in your extension "},{"type":"text","text":"Info.plist"},{"type":"text","text":":"}]},{"type":"codeListing","code":["<?xml version=\"1.0\" encoding=\"UTF-8\"?>","<!DOCTYPE plist PUBLIC \"-\/\/Apple\/\/DTD PLIST 1.0\/\/EN\" \"http:\/\/www.apple.com\/DTDs\/PropertyList-1.0.dtd\">","<plist version=\"1.0\">","<dict>","  <key>NSExtension<\/key>","  <dict>","    <key>NSExtensionAttributes<\/key>","    <dict>","      <key>MEComposeSession<\/key>","      <dict>","        <key>MEComposeIcon<\/key> \/\/ üëàüèª","        <string>lock<\/string>","        <key>MEComposeIconToolTip<\/key> \/\/ üëàüèª","        <string>Recipient Validation Extension<\/string>","      <\/dict>","    <\/dict>","    <key>NSExtensionPointIdentifier<\/key>","    <string>com.apple.email.extension<\/string>","    <key>NSExtensionPrincipalClass<\/key>","    <string>$(PRODUCT_MODULE_NAME).MailExtension<\/string>","  <\/dict>","<\/dict>","<\/plist>"],"syntax":"xml"},{"type":"paragraph","inlineContent":[{"text":"Example on how to validate recipient addresses:","type":"text"}]},{"type":"codeListing","code":["func annotateAddressesForSession(_ session: MEMailComposeSession) async -> [String: MEAddressAnnotation] {","  var annotations: [String: MEAddressAnnotation] = [:]","  ","  \/\/ Iterate through all the recipients in the message.","  for address in session.mailMessage.allRecipientAddresses {","    \/\/ Annotate invalid recipients with an error.","    if address != \"seth@example.com\" {","      let message = \"example.com is not a valid domain\"","      let annotation = MEAddressAnnotation.error(withLocalizedDescription: message)","      annotations[address] = annotation","    }","  }","","  return annotations","}"],"syntax":"swift"},{"type":"heading","text":"Action extensions","anchor":"Action-extensions","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Three types:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"mark messages as read and\/or flag messages","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"move to other standard system mailboxes (e.g., Junk, Trash or Archive)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"apply colors on messages in the message list"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Your action extension must implement "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessageactionhandler","isActive":true},{"type":"text","text":"‚Äôs "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessageactionhandler\/3783568-decideaction","isActive":true}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"decideAction(for:completionHandler:)"},{"type":"text","text":" is called with a "},{"type":"codeVoice","code":"MEMessage"},{"type":"text","text":" argument"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Mail calls your handler‚Äôs decideAction for message for every new message that it downloads before it is even visible in the inbox."}]}]}]},{"type":"heading","text":"Content blocking extensions","anchor":"Content-blocking-extensions","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Your content blocking extension must implement an object conforming to ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/mecontentblocker","type":"reference"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The content rule lists are specified using the same syntax as "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/safariservices\/creating_a_content_blocker","isActive":true},{"type":"text","text":", e.g.:"}],"type":"paragraph"}]}]},{"type":"codeListing","code":["[","  {","    \"action\": { \"type\": \"block\" },","    \"trigger\": { \"url-filter\": \"*.acme.*\" }","  },","  ...","]"],"syntax":"xml"},{"type":"heading","text":"Message security extensions","anchor":"Message-security-extensions","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your content blocking extension must implement an object conforming to "},{"identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessagesecurityhandler","type":"reference","isActive":true}]}]},{"content":[{"inlineContent":[{"type":"text","text":"each time the sender or recipients change, Mail will call the "},{"code":"getEncodingStatus(for:completionHandler:)","type":"codeVoice"},{"type":"text","text":" method on the extension‚Äôs message security handler"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"when the message is sent, Mail will take the ","type":"text"},{"text":"RFC822","type":"text"},{"text":" message data and pass it to the extension","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"the extension will sign and encrypt the message as needed, and return the signed and encrypted "},{"type":"text","text":"RFC822"},{"type":"text","text":" data back to Mail. Mail will then send this data to the outgoing server"}],"type":"paragraph"}]}]}]}]},{"type":"heading","text":"Written By","anchor":"Written-By","level":2},{"type":"row","numberOfColumns":5,"columns":[{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"zntfdr"}]}],"size":1},{"content":[{"anchor":"Federico-Zanetello","type":"heading","level":3,"text":"Federico Zanetello"},{"type":"paragraph","inlineContent":[{"overridingTitle":"Contributed Notes","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/zntfdr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/zntfdr.dev","type":"reference"}]}],"size":4}]},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}]},{"type":"heading","text":"Related Sessions","anchor":"Related-Sessions","level":2},{"type":"small","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright ¬© 2012 ‚Äì 2025 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}]}],"references":{"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","role":"collection","title":"WWDC Notes","type":"topic","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"url":"\/documentation\/wwdcnotes"},"https://developer.apple.com/documentation/mailkit":{"title":"MailKit framework","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit","type":"link","titleInlineContent":[{"type":"text","text":"MailKit framework"}],"url":"https:\/\/developer.apple.com\/documentation\/mailkit"},"zntfdr":{"alt":"Profile image of Federico Zanetello","type":"image","variants":[{"url":"\/images\/WWDCNotes\/zntfdr.jpeg","traits":["1x","light"]}],"identifier":"zntfdr"},"https://developer.apple.com/documentation/mailkit/memessageactionhandler":{"title":"MEMessageActionHandler","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessageactionhandler","type":"link","url":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessageactionhandler","titleInlineContent":[{"code":"MEMessageActionHandler","type":"codeVoice"}]},"WWDC21-Icon.png":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC21-Icon.png","traits":["1x","light"]}],"identifier":"WWDC21-Icon.png","type":"image","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"type":"topic","images":[{"identifier":"zntfdr.jpeg","type":"card"},{"identifier":"zntfdr.jpeg","type":"icon"}],"abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"url":"\/documentation\/wwdcnotes\/zntfdr","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","role":"sampleCode","kind":"article","title":"Federico Zanetello (332 notes)"},"https://developer.apple.com/documentation/mailkit/mecontentblocker":{"title":"MEContentBlocker","titleInlineContent":[{"type":"codeVoice","code":"MEContentBlocker"}],"type":"link","url":"https:\/\/developer.apple.com\/documentation\/mailkit\/mecontentblocker","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/mecontentblocker"},"WWDC21.jpeg":{"identifier":"WWDC21.jpeg","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC21.jpeg"}],"alt":null},"https://developer.apple.com/documentation/mailkit/memessagesecurityhandler":{"title":"MEMessageSecurityHandler","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessagesecurityhandler","type":"link","titleInlineContent":[{"code":"MEMessageSecurityHandler","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessagesecurityhandler"},"https://developer.apple.com/documentation/mailkit/memessageactionhandler/3783568-decideaction":{"title":"decideAction(for:completionHandler:)","titleInlineContent":[{"type":"codeVoice","code":"decideAction(for:completionHandler:)"}],"type":"link","url":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessageactionhandler\/3783568-decideaction","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/memessageactionhandler\/3783568-decideaction"},"https://developer.apple.com/documentation/safariservices/creating_a_content_blocker":{"title":"Safari content blockers","identifier":"https:\/\/developer.apple.com\/documentation\/safariservices\/creating_a_content_blocker","type":"link","url":"https:\/\/developer.apple.com\/documentation\/safariservices\/creating_a_content_blocker","titleInlineContent":[{"text":"Safari content blockers","type":"text"}]},"https://developer.apple.com/documentation/mailkit/build_mail_app_extensions":{"title":"Sample code","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/build_mail_app_extensions","type":"link","titleInlineContent":[{"type":"text","text":"Sample code"}],"url":"https:\/\/developer.apple.com\/documentation\/mailkit\/build_mail_app_extensions"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21","url":"\/documentation\/wwdcnotes\/wwdc21","kind":"article","type":"topic","title":"WWDC21","abstract":[{"text":"Xcode 13, Swift 5.5, iOS 15, macOS 12 (Monterey), tvOS 15, watchOS 8.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"MusicKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"DocC","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit 2","type":"codeVoice"},{"text":", and more.","type":"text"}],"role":"collectionGroup","images":[{"type":"icon","identifier":"WWDC21-Icon.png"},{"type":"card","identifier":"WWDC21.jpeg"}]},"zntfdr.jpeg":{"alt":null,"type":"image","variants":[{"url":"\/images\/WWDCNotes\/zntfdr.jpeg","traits":["1x","light"]}],"identifier":"zntfdr.jpeg"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"alt":null},"https://developer.apple.com/documentation/mailkit/meextensionviewcontroller":{"title":"MEExtensionViewController","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/meextensionviewcontroller","type":"link","titleInlineContent":[{"code":"MEExtensionViewController","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/documentation\/mailkit\/meextensionviewcontroller"},"https://github.com/zntfdr":{"title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}],"type":"link","url":"https:\/\/github.com\/zntfdr","identifier":"https:\/\/github.com\/zntfdr"},"https://zntfdr.dev":{"title":"Blog","identifier":"https:\/\/zntfdr.dev","type":"link","url":"https:\/\/zntfdr.dev","titleInlineContent":[{"text":"Blog","type":"text"}]},"https://developer.apple.com/documentation/mailkit/meextension":{"title":"MEExtension","identifier":"https:\/\/developer.apple.com\/documentation\/mailkit\/meextension","type":"link","titleInlineContent":[{"code":"MEExtension","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/documentation\/mailkit\/meextension"},"https://developer.apple.com/wwdc21/10168":{"checksum":null,"type":"download","url":"https:\/\/developer.apple.com\/wwdc21\/10168","identifier":"https:\/\/developer.apple.com\/wwdc21\/10168"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]}}}