{"schemaVersion":{"major":0,"minor":3,"patch":0},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10170-Consume-noncopyable-types-in-Swift","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24"]]},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc24-10170-consume-noncopyable-types-in-swift"],"traits":[{"interfaceLanguage":"swift"}]}],"metadata":{"role":"sampleCode","title":"Consume noncopyable types in Swift","roleHeading":"WWDC24","modules":[{"name":"WWDC Notes"}]},"primaryContentSections":[{"kind":"content","content":[{"level":1,"text":"Copying","type":"heading","anchor":"Copying"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"By default, when you copy a variable, you‚Äôre copying its contents","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"For value types, the contents are the actual data that makes up the instance","type":"text"}]}]}]},{"syntax":"swift","type":"codeListing","code":["struct Player { ... }","let player1 = Player(icon: \"üê∏\")","var player2 = player1","player2.icon = \"üöö\" \/\/ player1.icon is still \"üê∏\""]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"For reference types, the contents are a managed reference, so the reference is copied, not the object itself"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Shallow"}],"type":"emphasis"},{"text":" copy by default","type":"text"}]}]}],"type":"unorderedList"}]}]},{"syntax":"swift","type":"codeListing","code":["class PlayerClass { ... }","let player1 = PlayerClass(\"üê∏\")","let player2 = player1","player2.icon = \"üöö\" \/\/ player1.icon is \"üöö\""]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"You can make reference types perform an "},{"type":"emphasis","inlineContent":[{"text":"explicit","type":"text"}]},{"type":"text","text":" deep copy by defining a custom initializer"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Does not control whether Swift can make ","type":"text"},{"inlineContent":[{"type":"text","text":"automatic"}],"type":"emphasis"},{"text":" copies","type":"text"}]}]}],"type":"unorderedList"}]}]},{"level":2,"text":"Copyable","type":"heading","anchor":"Copyable"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"Copyable"},{"type":"text","text":" is a "},{"type":"emphasis","inlineContent":[{"type":"text","text":"marker"}]},{"type":"text","text":" protocol, like "},{"type":"codeVoice","code":"Sendable"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"i.e. it doesn‚Äôt have any associated requirements"}]}]}],"type":"unorderedList"}]},{"content":[{"inlineContent":[{"text":"Describes the ability for a type to be automatically copied by Swift","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Everything is ","type":"text"},{"code":"Copyable","type":"codeVoice"},{"text":" in Swift by default","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Types, generic parameters, protocols and associated types, boxed protocol types, etc.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This is an assumption, since "},{"type":"codeVoice","code":"Copyable"},{"type":"text","text":" types are generally easier to work with"}]}]}]}]}]},{"level":1,"text":"Noncopyable types","type":"heading","anchor":"Noncopyable-types"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"You can suppress the default "},{"type":"codeVoice","code":"Copyable"},{"type":"text","text":" behavior by annotating your types with "},{"type":"codeVoice","code":"~Copyable"},{"type":"text","text":":"}],"type":"paragraph"}]}]},{"syntax":"swift","type":"codeListing","code":["struct FloppyDisk: ~Copyable { ... }"]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"When copying is not supported, Swift will "},{"inlineContent":[{"text":"consume","type":"text"}],"type":"strong"},{"type":"text","text":" the variable instead"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Can ","type":"text"},{"inlineContent":[{"text":"optionally","type":"text"}],"type":"emphasis"},{"text":" annotate variable consumption using the ","type":"text"},{"code":"consume","type":"codeVoice"},{"text":" keyword explicitly","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Reading consumed values after they‚Äôve been consumed is a compile-time error","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]}]},{"syntax":"swift","type":"codeListing","code":["let system = FloppyDisk()","print(system) \/\/ this works","let backup = system \/\/ can also be written as `consume system`","print(system) \/\/ this produces an error: system is used after consume"]},{"level":2,"text":"Ownership","type":"heading","anchor":"Ownership"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"With ","type":"text"},{"code":"Copyable","type":"codeVoice"},{"text":" types by default, you don‚Äôt have to worry about ownership","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Functions you wrote would effectively receive a copy","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"inlineContent":[{"type":"text","text":"With "},{"type":"codeVoice","code":"~Copyable"},{"type":"text","text":", you have to declare what ownership your functions have over the "},{"type":"codeVoice","code":"~Copyable"},{"type":"text","text":" values"}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"There are 3 kinds of ownership, outlined below.","type":"text"}],"type":"paragraph"},{"level":3,"text":"Consuming","type":"heading","anchor":"Consuming"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Your function will ‚Äútake‚Äù the argument from the caller, and will effectively own it","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You can mutate the argument"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Caller has no access to the value anymore"}]}]}]},{"syntax":"swift","type":"codeListing","code":["func format(_ disk: consuming FloppyDisk) { ... }","","let result = FloppyDisk()","format(disk)","return result \/\/ produces an error: result is consumed more than once"]},{"level":3,"text":"Borrowing","type":"heading","anchor":"Borrowing"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Gives you temporary read-only access to the argument","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Similar"}],"type":"emphasis"},{"type":"text","text":" to how parameters already work by default for "},{"code":"Copyable","type":"codeVoice"},{"type":"text","text":" types"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Cannot consume, or mutate, an explicitly borrowed argument","type":"text"}]}]}]},{"syntax":"swift","type":"codeListing","code":["func format(_ disk: borrowing FloppyDisk) {","    var tempDisk = disk \/\/ produces an error: disk is borrowed and cannot be consumed","}"]},{"level":3,"text":"Mutating, or inout","type":"heading","anchor":"Mutating-or-inout"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Provides ","type":"text"},{"inlineContent":[{"text":"temporary","type":"text"}],"type":"emphasis"},{"text":" write access to a caller-owned variable","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Can consume the parameter"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Have to reinitialize the parameter at some point before end of function scope"}]}]}]},{"syntax":"swift","type":"codeListing","code":["func format(_ disk: inout FloppyDisk) {","    var tempDisk = disk","    \/\/ Have to reinitialize the parameter before end of scope:","    disk = tempDisk","}"]},{"level":2,"text":"Consumable resources","type":"heading","anchor":"Consumable-resources"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Can mark functions as ","type":"text"},{"code":"consuming","type":"codeVoice"},{"text":" to take the value for ","type":"text"},{"code":"self","type":"codeVoice"},{"text":" away from callers","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Guarantees function cannot be called more than once on the same instance"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Relationship to "},{"type":"codeVoice","code":"consuming"},{"type":"text","text":" parameters is similar to how "},{"type":"codeVoice","code":"mutating"},{"type":"text","text":" is used to indicate an "},{"type":"codeVoice","code":"inout"},{"type":"text","text":" reference to "},{"type":"codeVoice","code":"self"}],"type":"paragraph"}]}],"type":"unorderedList"}]}]},{"syntax":"swift","type":"codeListing","code":["struct BankTransfer: ~Copyable {","    consuming func run() {","        \/\/ Never called more than once for the same BankTransfer.","    }","}"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"By default, reaching the end of the ","type":"text"},{"code":"consuming","type":"codeVoice"},{"text":" function scope will destroy the instance (and call ","type":"text"},{"code":"deinit","type":"codeVoice"},{"text":")","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Can call ","type":"text"},{"type":"codeVoice","code":"discard self"},{"text":" at end of function scope to destroy without calling ","type":"text"},{"type":"codeVoice","code":"deinit"}]}]}]},{"syntax":"swift","type":"codeListing","code":["consuming func run() {","    ...","    \/\/ Destroy `self` without calling `deinit`:","    discard self","}"]},{"level":1,"text":"Generics","type":"heading","anchor":"Generics"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Core idea: conformance constraints describe generic types"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"Any"},{"type":"text","text":" is "},{"type":"codeVoice","code":"Copyable"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Swift 6 introduces noncopyable generics"}],"type":"paragraph"}]}]},{"level":2,"text":"Noncopyable generics","type":"heading","anchor":"Noncopyable-generics"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Recall: by default, every protocol inherits from ","type":"text"},{"code":"Copyable","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You can now "},{"type":"emphasis","inlineContent":[{"type":"text","text":"remove"}]},{"type":"text","text":" the "},{"type":"codeVoice","code":"Copyable"},{"type":"text","text":" constraint from a protocol explicitly:"}]}]}]},{"syntax":"swift","type":"codeListing","code":["protocol Runnable: ~Copyable {","    consuming func run()","}"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Generics also have a ","type":"text"},{"inlineContent":[{"type":"text","text":"default"}],"type":"emphasis"},{"text":" ","type":"text"},{"code":"Copyable","type":"codeVoice"},{"text":" constraint","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"You can also remove the ","type":"text"},{"type":"codeVoice","code":"Copyable"},{"text":" requirement from a generic constraint:","type":"text"}],"type":"paragraph"}]}]},{"syntax":"swift","type":"codeListing","code":["\/\/\/ This requires T to be *both* `Runnable` and `Copyable`","func execute<T>(_ t: consuming T) where T: Runnable { ... }","","\/\/\/ This requires T to be `Runnable`, but *not necessarily* `Copyable`","func execute<T>(_ t: consuming T) where T: Runnable, T: ~Copyable { ... }"]},{"style":"note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":""},{"type":"text","text":" "},{"type":"text","text":"A "},{"type":"emphasis","inlineContent":[{"type":"text","text":"regular"}]},{"type":"text","text":" constraint is "},{"type":"strong","inlineContent":[{"type":"text","text":"more"}]},{"type":"text","text":" specific and "},{"type":"strong","inlineContent":[{"type":"text","text":"narrows"}]},{"type":"text","text":" the set of permitted types."},{"type":"text","text":" "},{"type":"text","text":"A "},{"type":"emphasis","inlineContent":[{"type":"text","text":"tilde"}]},{"type":"text","text":" constraint is "},{"type":"strong","inlineContent":[{"type":"text","text":"less"}]},{"type":"text","text":" specific and "},{"type":"strong","inlineContent":[{"type":"text","text":"broadens"}]},{"type":"text","text":" the types."}]}],"name":"Key point"},{"level":2,"text":"Nesting ~Copyable values","type":"heading","anchor":"Nesting-~Copyable-values"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"May store "},{"type":"codeVoice","code":"~Copyable"},{"type":"text","text":" values inside a class, since copying only copies a reference"}]}]},{"content":[{"inlineContent":[{"text":"Or, containing type must be ","type":"text"},{"type":"codeVoice","code":"~Copyable"},{"text":" itself","type":"text"}],"type":"paragraph"}]}]},{"level":2,"text":"Conditional Copyable","type":"heading","anchor":"Conditional-Copyable"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"You may define conditional ","type":"text"},{"code":"Copyable","type":"codeVoice"},{"text":" conformance on a ","type":"text"},{"code":"~Copyable","type":"codeVoice"},{"text":" type using an extension","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Since "},{"type":"codeVoice","code":"Copyable"},{"type":"text","text":" is a marker, no additional declarations are necessary inside such an extension"}],"type":"paragraph"}]}]},{"syntax":"swift","type":"codeListing","code":["\/\/\/ Stores a *potentially* `~Copyable` value, so must be a class or suppress `Copyable`","struct Job<Action: Runnable & ~Copyable>: ~Copyable {","    var action: Action?","}","","\/\/\/ Whenever the contained `Action` is `Copyable`, mark `Job` as `Copyable` too:","extension Job: Copyable where Action: Copyable { }"]},{"level":1,"text":"Extensions","type":"heading","anchor":"Extensions"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"By default, generic parameters in scope of the extended type are constrained to ","type":"text"},{"type":"codeVoice","code":"Copyable"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Includes "},{"type":"codeVoice","code":"Self"},{"type":"text","text":" in a protocol"}]}]}],"type":"unorderedList"}]}]},{"syntax":"swift","type":"codeListing","code":["struct Job<Action: Runnable & ~Copyable>: ~Copyable { }","","extension Job { ... }","","\/\/ By default, equivalent to:","extension Job where Action: Copyable { ... }"]},{"level":2,"text":"Written By","type":"heading","anchor":"Written-By"},{"numberOfColumns":5,"type":"row","columns":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"philptr","type":"image"}]}],"size":1},{"content":[{"anchor":"Phil-Zakharchenko","level":3,"text":"Phil Zakharchenko","type":"heading"},{"type":"paragraph","inlineContent":[{"overridingTitle":"Contributed Notes","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/philptr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/philptr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/x.com\/philzet","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/philz.work","type":"reference"}]}],"size":4}]},{"type":"thematicBreak"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"level":2,"text":"Related Sessions","type":"heading","anchor":"Related-Sessions"},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-415-Modern-Swift-API-Design"]},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}],"type":"small"},{"inlineContent":[{"text":"All content copyright ¬© 2012 ‚Äì 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}]}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"identifier":"https:\/\/developer.apple.com\/wwdc24\/10170","isActive":true,"overridingTitle":"Watch Video","type":"reference"}},"abstract":[{"text":"Get started with noncopyable types in Swift. Discover what copying means in Swift, when you might want to use a noncopyable type, and how value ownership lets you state your intentions clearly.","type":"text"}],"sections":[],"kind":"article","references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC24":{"kind":"article","images":[{"type":"icon","identifier":"WWDC24-Icon.png"},{"type":"card","identifier":"WWDC24.jpeg"}],"role":"collectionGroup","url":"\/documentation\/wwdcnotes\/wwdc24","title":"WWDC24","type":"topic","abstract":[{"text":"Xcode 16, Swift 6, iOS 18, macOS 15 (Sequoia), tvOS 18, visionOS 2, watchOS 11.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: Swift Testing, ","type":"text"},{"type":"codeVoice","code":"FinanceKit"},{"text":", ","type":"text"},{"type":"codeVoice","code":"TabletopKit"},{"text":", and more.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24"},"WWDC24-Icon.png":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC24-Icon.png","traits":["1x","light"]}],"type":"image","alt":null,"identifier":"WWDC24-Icon.png"},"https://x.com/philzet":{"identifier":"https:\/\/x.com\/philzet","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"title":"X\/Twitter","type":"link","url":"https:\/\/x.com\/philzet"},"WWDCNotes.png":{"variants":[{"url":"\/images\/WWDCNotes\/WWDCNotes.png","traits":["1x","light"]}],"type":"image","alt":null,"identifier":"WWDCNotes.png"},"https://developer.apple.com/wwdc24/10170":{"type":"download","url":"https:\/\/developer.apple.com\/wwdc24\/10170","checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc24\/10170"},"doc://WWDCNotes/documentation/WWDCNotes/philptr":{"images":[{"identifier":"philptr.jpeg","type":"card"},{"identifier":"philptr.jpeg","type":"icon"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/philptr","url":"\/documentation\/wwdcnotes\/philptr","role":"sampleCode","abstract":[{"type":"text","text":"macOS UI, Frameworks, and Systems. Previously AppKit @ Apple"}],"title":"Phil Zakharchenko (5 notes)","type":"topic","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-415-Modern-Swift-API-Design":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-415-Modern-Swift-API-Design","kind":"article","role":"sampleCode","type":"topic","abstract":[{"type":"text","text":"Every programming language has a set of conventions that people come to expect. Learn about the patterns that are common to Swift API design, with examples from new APIs like SwiftUI, Combine, and RealityKit. Whether you‚Äôre developing an app as part of a team, or you‚Äôre publishing a library for others to use, find out how to use new features of Swift to ensure clarity and correct use of your APIs."}],"title":"Modern Swift API Design","url":"\/documentation\/wwdcnotes\/wwdc19-415-modern-swift-api-design"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"type":"link","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"philptr":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/philptr.jpeg"}],"type":"image","alt":"Profile image of Phil Zakharchenko","identifier":"philptr"},"WWDC24.jpeg":{"type":"image","alt":null,"identifier":"WWDC24.jpeg","variants":[{"url":"\/images\/WWDCNotes\/WWDC24.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection","url":"\/documentation\/wwdcnotes","type":"topic","title":"WWDC Notes","images":[{"type":"icon","identifier":"WWDCNotes.png"}]},"https://github.com/philptr":{"type":"link","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}],"url":"https:\/\/github.com\/philptr","identifier":"https:\/\/github.com\/philptr"},"https://philz.work":{"url":"https:\/\/philz.work","type":"link","title":"Blog","identifier":"https:\/\/philz.work","titleInlineContent":[{"type":"text","text":"Blog"}]},"philptr.jpeg":{"type":"image","alt":null,"identifier":"philptr.jpeg","variants":[{"url":"\/images\/WWDCNotes\/philptr.jpeg","traits":["1x","light"]}]}}}