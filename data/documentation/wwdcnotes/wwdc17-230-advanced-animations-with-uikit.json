{"abstract":[{"text":"So much power has been added to animations on iOS since their inception that it’s time to think about animations in a whole new way! Learn to combine and coordinate between multiple animations, resulting in interactive transitions and learn some tips and tricks along the way.","type":"text"}],"metadata":{"role":"sampleCode","roleHeading":"WWDC17","title":"Advanced Animations with UIKit","modules":[{"name":"WWDC Notes"}]},"primaryContentSections":[{"content":[{"text":"Overview","anchor":"overview","level":2,"type":"heading"},{"content":[{"type":"paragraph","inlineContent":[{"isActive":true,"identifier":"https:\/\/github.com\/cgoldsby\/WWDC-2017-Session-230-Advance-Animations-with-UIKit","type":"reference"}]}],"type":"aside","name":"Note","style":"note"},{"text":"Interactive animations","anchor":"Interactive-animations","level":2,"type":"heading"},{"inlineContent":[{"text":"An interactive animation is one in which the user’s actions interactively drive the progress of your animation.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Example:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["\/\/ Safe the instance of the animator","var animator: UIViewPropertyAnimator!","","func handlePan(recognizer: UIPanGestureRecognizer) {","  switch recognizer.state {","    case .began:","      \/\/ create the animator on touch began","      animator = UIViewPropertyAnimator(","        duration: 1,","        curve: .easeOut,","        animations: {","          circle.frame = circle.frame.offsetBy(dx: 100, dy: 0)","        }","      )","      \/\/ pausing the animator here will produce that animation implicitly (but not trigger it),","      \/\/ we're essentially setting the speed to zero.","      animator.pauseAnimation()","      \/\/ note that while paused, the timing curve is automatically and temporaly converted to linear,","      \/\/ this makes it easy to use the animator for scrubbing","    case .changed:","      let translation = recognizer.translation(in: circle)","      \/\/ here we're scrubbing the animation","      animator.fractionComplete = translation.x \/ 100","    case .ended:","      animator.continueAnimation(withTimingParameters: nil, durationFactor: 0)","      \/\/ The duration factor set to zero means that the animation will pick up the original timing ","      \/\/ curve, that might be different than linear, and continue using the remaining time needed ","      \/\/ for the animation to complete based on its original duration.","  }","}"]},{"anchor":"New-Property-Animator-Properties","type":"heading","text":"New Property Animator Properties","level":2},{"inlineContent":[{"text":"New in iOS 11, ","type":"text"},{"code":"UIViewPropertyAnimator","type":"codeVoice"},{"text":" has two new properties:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewpropertyanimator\/2873966-scrubslinearly","isActive":true},{"text":" \/\/ tells whether, when paused, the animator falls back to a linear timing curve or not (defaults to ","type":"text"},{"type":"codeVoice","code":"true"},{"text":")","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewpropertyanimator\/2909004-pausesoncompletion"},{"type":"text","text":" \/\/ tells whether a completed animation remains in the active state (defaults to "},{"type":"codeVoice","code":"false"},{"type":"text","text":")"}]}]}]},{"inlineContent":[{"text":"The latter is important, because when an animator’s animations finish it will automatically transition into the ","type":"text"},{"code":".inactive","type":"codeVoice"},{"text":" ","type":"text"},{"code":"state","type":"codeVoice"},{"text":". And when it does that, it releases any animations that it was previously tracking which means you cannot manipulate or even reverse them after they’ve finished. Thanks to this property, when set to ","type":"text"},{"code":"true","type":"codeVoice"},{"text":", the animator will pause at 100% ","type":"text"},{"code":"fractionComplete","type":"codeVoice"},{"text":", allowing you to, at any point in the future, reverse those animations.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Note that with ","type":"text"},{"code":"pausesOnCompletion","type":"codeVoice"},{"text":" the completion block will never be called, however you can (KVO) observe the ","type":"text"},{"code":"running","type":"codeVoice"},{"text":" property:","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["animator.addObserver(self, forKeyPath: \"running\", options: [.new], context: nil)"]},{"anchor":"New-Property-Animator-Behaviors","type":"heading","text":"New Property Animator Behaviors","level":2},{"inlineContent":[{"text":"New in iOS 11 ","type":"text"},{"code":"UIViewPropertyAnimator","type":"codeVoice"},{"text":" also has a new behavior, which is starting as ","type":"text"},{"code":".paused","type":"codeVoice"},{"text":" when no animations are provided.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"This will make any animations added later to run immediately without escaping:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let animator = UIViewPropertyAnimator(duration: 1, curve: .easeIn)","animator.startAnimation()","","\/\/ ...","","animator.addAnimations {","  \/\/ will run immediately","  circle.frame = circle.frame.offsetBy(dx: 100, dy: 0)","}"]},{"anchor":"Best-Practices-When-Interrupting-Springs","type":"heading","text":"Best Practices When Interrupting Springs","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"when pausing an animation with springs, stop and create a new property animator (don’t forget to set the current presentation value to model value) - for better fluidity in the animation"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Use critically damped spring without velocity, as these don’t overshoot or oscillate"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Decompose component velocity with multiple animators, for example one for the x-axis and one for the y-axis","type":"text"}]}]}]},{"anchor":"View-Morphing","type":"heading","text":"View Morphing","level":2},{"inlineContent":[{"text":"Scaling, translation, and opacity blending of two views.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Strategy:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":".transform: CGAffineTransform"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Compute ","type":"text"},{"code":"transform.scale","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"transform.translation","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Prepare views and animate ","type":"text"},{"code":".transform","type":"codeVoice"},{"text":" and ","type":"text"},{"code":".alpha","type":"codeVoice"}]}]}]},{"inlineContent":[{"text":"Computing scale: this is a dimensional ratio based on the target dimension and your current dimension.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Computing translation: because of the scale, we cannot just use the delta between the two views, instead pre-apply the target view into the original view, and use that as the delta","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Animate: use three animators:"}],"type":"paragraph"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"critically damped spring for the transform","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":".easeIn for the incoming view .alpha, non linear scrubbing"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":".easeOut for the outgoing view .alpha, non linear scrubbing","type":"text"}]}]}]},{"type":"codeListing","syntax":"swift","code":["func animateTransitionIfNeeded(forState state: State, duration: TimeInterval) { \/\/ ...","  let transformAnimator = UIViewPropertyAnimator(duration: duration, dampingRatio: 1) { ","    inLabel.transform = CGAffineTransform.identity","    outLabel.transform = inLabelScale.concatenating(inLabelTranslation)","  }","  \/\/ ...","  let inLabelAnimator = UIViewPropertyAnimator(duration: duration, curve: .easeIn) {","    inLabel.alpha = 1","  }","  inLabelAnimator.scrubsLinearly = false","  \/\/ ...","  let outLabelAnimator = UIViewPropertyAnimator(duration: duration, curve: .easeOut) {","    outLabel.alpha = 0","  }","  outLabelAnimator.scrubsLinearly = false","  \/\/ ...","}"]},{"anchor":"Tips-and-Tricks","type":"heading","text":"Tips and Tricks","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":"UIView.layer.cornerRadius","type":"codeVoice"},{"text":" is now animatable (iOS 11+):","type":"text"}],"type":"paragraph"}]}]},{"type":"codeListing","syntax":"swift","code":["circle.clipsToBounds = true","UIViewPropertyAnimator(duration: 1, curve: .linear) {","  circle.layer.cornerRadius = 12","}.startAnimation()"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"New ","type":"text"},{"type":"codeVoice","code":"CALayer"},{"text":" ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer\/2877488-maskedcorners","isActive":true,"type":"reference"},{"text":" property, which allows us to selectively choose which corners we want to apply our corner radius mask to","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"When working with multiple animators, it’s important to have the timing in sync, as it would be hard (for example) to scrub if different animators had different durations or start delays. A way to overcome this is to use UIView key frames:","type":"text"}]}]}]},{"type":"codeListing","syntax":"swift","code":["\/\/ in this example buttonAnimator:","\/\/ - starts immediately and ends at 50% the original duration for the collapsed animation","\/\/ - starts at 50% the timing and end at 100% for the expanded animation","func animateTransitionIfNeeded(forState state: State, duration: TimeInterval) { \/\/ ...","  let buttonAnimator = UIViewPropertyAnimator(duration: duration, curve: .linear) { ","    \/\/ setting the duration to zero means that our keyframe animation inherits ","    \/\/ the duration of its outer property animator.","    UIView.animateKeyframes(withDuration: 0.0, delay: 0.0, options: [], animations: {","      switch state { ","        case .Expanded:","          UIView.addKeyframe(withRelativeStartTime: 0.5, relativeDuration: 0.5) { ","            \/\/ Start with delay and finish with rest of animations ","            detailsButton.alpha = 1","          }","        case .Collapsed:","          UIView.addKeyframe(withRelativeStartTime: 0.0, relativeDuration: 0.5) {","            \/\/ Start immediately and finish in half the time ","            detailsButton.alpha = 0","          }","      }","    }, completion: nil)","  }","}"]},{"anchor":"Written-By","type":"heading","text":"Written By","level":2},{"numberOfColumns":5,"type":"row","columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"zntfdr"}]}]},{"size":4,"content":[{"text":"Federico Zanetello","anchor":"Federico-Zanetello","type":"heading","level":3},{"inlineContent":[{"type":"reference","overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}]},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/github.com\/zntfdr","type":"reference","isActive":true},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/zntfdr.dev","type":"reference","isActive":true}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"anchor":"Related-Sessions","type":"heading","text":"Related Sessions","level":2},{"type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC18-233-Adding-Delight-to-your-iOS-App"],"style":"list"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"sections":[],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC17-230-Advanced-Animations-with-UIKit"},"kind":"article","schemaVersion":{"minor":3,"patch":0,"major":0},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC17"]]},"sampleCodeDownload":{"kind":"sampleDownload","action":{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/wwdc17\/230","overridingTitle":"Watch Video (32 min)"}},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc17-230-advanced-animations-with-uikit"],"traits":[{"interfaceLanguage":"swift"}]}],"references":{"https://developer.apple.com/documentation/quartzcore/calayer/2877488-maskedcorners":{"title":"maskedCorners","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer\/2877488-maskedcorners","url":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer\/2877488-maskedcorners","titleInlineContent":[{"code":"maskedCorners","type":"codeVoice"}]},"zntfdr.jpeg":{"identifier":"zntfdr.jpeg","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}],"alt":null},"WWDC17.jpeg":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC17.jpeg"}],"type":"image","identifier":"WWDC17.jpeg"},"https://zntfdr.dev":{"identifier":"https:\/\/zntfdr.dev","url":"https:\/\/zntfdr.dev","titleInlineContent":[{"text":"Blog","type":"text"}],"type":"link","title":"Blog"},"zntfdr":{"alt":"Profile image of Federico Zanetello","variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}],"type":"image","identifier":"zntfdr"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"url":"\/documentation\/wwdcnotes\/zntfdr","role":"sampleCode","kind":"article","title":"Federico Zanetello (332 notes)","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","abstract":[{"text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more.","type":"text"}],"images":[{"identifier":"zntfdr.jpeg","type":"card"},{"identifier":"zntfdr.jpeg","type":"icon"}],"type":"topic"},"WWDC17-Icon.png":{"identifier":"WWDC17-Icon.png","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC17-Icon.png"}],"alt":null},"https://github.com/zntfdr":{"title":"GitHub","type":"link","identifier":"https:\/\/github.com\/zntfdr","url":"https:\/\/github.com\/zntfdr","titleInlineContent":[{"type":"text","text":"GitHub"}]},"https://developer.apple.com/documentation/uikit/uiviewpropertyanimator/2873966-scrubslinearly":{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewpropertyanimator\/2873966-scrubslinearly","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewpropertyanimator\/2873966-scrubslinearly","titleInlineContent":[{"type":"codeVoice","code":"scrubsLinearly: Bool"}],"type":"link","title":"scrubsLinearly: Bool"},"WWDCNotes.png":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image","identifier":"WWDCNotes.png"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"type":"link","title":"Contributions are welcome!"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC18-233-Adding-Delight-to-your-iOS-App":{"title":"Adding Delight to your iOS App","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC18-233-Adding-Delight-to-your-iOS-App","role":"sampleCode","abstract":[{"type":"text","text":"iOS contains powerful technologies you can use to make your app truly delightful. Learn how to take your app to the next level with easy-to-implement features such as Handoff and External Display support. Preserve that feeling of magic in your app with pro-tips that combine animations, gestures and layout, while keeping your scrolling smooth, and your code scalable. Dive into the anatomy of a launch to get your app responsive quickly, and learn some great debugging tricks from the pros!"}],"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc18-233-adding-delight-to-your-ios-app"},"https://github.com/cgoldsby/WWDC-2017-Session-230-Advance-Animations-with-UIKit":{"title":"Sample code","type":"link","identifier":"https:\/\/github.com\/cgoldsby\/WWDC-2017-Session-230-Advance-Animations-with-UIKit","url":"https:\/\/github.com\/cgoldsby\/WWDC-2017-Session-230-Advance-Animations-with-UIKit","titleInlineContent":[{"type":"text","text":"Sample code"}]},"https://developer.apple.com/wwdc17/230":{"identifier":"https:\/\/developer.apple.com\/wwdc17\/230","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc17\/230","type":"download"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC17":{"abstract":[{"type":"text","text":"Xcode 9, Swift 4.0, iOS 11, macOS 10.13 (High Sierra), tvOS 11, watchOS 4."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"Core NFC"},{"type":"text","text":" and more."}],"title":"WWDC17","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC17","role":"collectionGroup","kind":"article","images":[{"identifier":"WWDC17-Icon.png","type":"icon"},{"identifier":"WWDC17.jpeg","type":"card"}],"url":"\/documentation\/wwdcnotes\/wwdc17","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes":{"images":[{"type":"icon","identifier":"WWDCNotes.png"}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","kind":"symbol","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"url":"\/documentation\/wwdcnotes","role":"collection"},"https://developer.apple.com/documentation/uikit/uiviewpropertyanimator/2909004-pausesoncompletion":{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewpropertyanimator\/2909004-pausesoncompletion","title":"pausesOnCompletion: Bool","titleInlineContent":[{"type":"codeVoice","code":"pausesOnCompletion: Bool"}],"url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewpropertyanimator\/2909004-pausesoncompletion","type":"link"}}}