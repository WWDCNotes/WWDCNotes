{"schemaVersion":{"minor":3,"major":0,"patch":0},"kind":"article","metadata":{"modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC22","role":"sampleCode","title":"Bring your driver to iPad with DriverKit"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22"]]},"sampleCodeDownload":{"action":{"identifier":"https:\/\/developer.apple.com\/wwdc22\/110373","isActive":true,"type":"reference","overridingTitle":"Watch Video (18 min)"},"kind":"sampleDownload"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc22-110373-bring-your-driver-to-ipad-with-driverkit"]}],"abstract":[{"text":"Discover how you can easily connect Thunderbolt and USB accessories to iPad with DriverKit. We’ll show you how to convert your existing Mac drivers without any code changes, learn how to add real-time audio support with AudioDriverKit, and provide best practices and tips for developing drivers for iPad.","type":"text"}],"primaryContentSections":[{"content":[{"text":"DriverKit Overview","level":2,"anchor":"DriverKit-Overview","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"replacement for "},{"identifier":"https:\/\/developer.apple.com\/documentation\/iokit","isActive":true,"type":"reference"},{"type":"text","text":" device drivers"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"new way to extend the system that is more reliable and secure, running in userspace (no longer in the kernel)","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"these driver extensions, also known as "},{"type":"text","text":"dexts"},{"type":"text","text":", are bundled in apps, and you can easily distribute your apps and drivers on the Mac App Store"}]}]},{"content":[{"inlineContent":[{"text":"support for:","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Networking"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Block Storage","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Serial"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Audio","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"USB"}]}]},{"content":[{"inlineContent":[{"text":"PCI","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"HID"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"SCSI controllers"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"SCSI Peripherals"}]}]}],"type":"unorderedList"},{"text":"AudioDriverKit updates","level":2,"anchor":"AudioDriverKit-updates","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"register a real-time callback"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"get a callback every time an IO operation happens"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"use for signal processing"}],"type":"paragraph"}]}],"type":"unorderedList"},{"code":["\/\/ Declare a IOOperationHandler block to set on the IOUserAudioDevice.","\/\/ The block will be called from a real time context when a i\/o operation","\/\/ occurs on the IOUserAudioStream buffers for the device.","io_operation = ^kern_return_t(IOUserAudioObjectID in_device,","                IOUserAudioIOOperation in_io_operation,","                uint32_t in_io_buffer_frame_size,","                uint64_t in_sample_time,","                uint64_t in_host_time)","{","  \/\/ Add custom code to make modifications to the buffers as necessary","  if (in_io_operation == IOUserAudioIOOperationWriteEnd) {","    ...","  } else if (in_io_operation == IOUserAudioIOOperationBeginRead) {","    ...","  }","  return kIOReturnSuccess;","};","this->SetIOOperationHandler(io_operation);"],"type":"codeListing","syntax":"c++"},{"text":"New entitlement (from macOS 12.1)","level":3,"anchor":"New-entitlement-from-macOS-121","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"if your base target is earlier, use ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/bundleresources\/entitlements\/com_apple_developer_driverkit_userclient-access","isActive":true}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"if your base target is macOS 12.1 or later, use "},{"type":"codeVoice","code":"com.apple.developer.driverkit.family.audio"}]}]},{"content":[{"inlineContent":[{"text":"use ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/bundleresources\/entitlements\/com_apple_developer_driverkit_userclient-access","isActive":true,"overridingTitleInlineContent":[{"code":"com.apple.developer.driverkit.allow-any-userclient-access","type":"codeVoice"}],"overridingTitle":"com.apple.developer.driverkit.allow-any-userclient-access","type":"reference"},{"text":" if you want any app to be able to communicate with your driver","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"all ","type":"text"},{"code":"com.apple.developer.driverkit.family","type":"codeVoice"},{"text":" entitlements are now public for development: they no longer require you to file a request","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"request for distribution "},{"identifier":"https:\/\/developer.apple.com\/contact\/request\/system-extension","type":"reference","isActive":true}]}]}]}]}],"type":"unorderedList"},{"text":"DriverKit on iPad","level":2,"anchor":"DriverKit-on-iPad","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"no changes required for existing macOS drivers to be ported to iPad"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"USBDriverKit, PCIDriverKit, AudioDriverKit support from iPadOS 16","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"requires M1 iPads","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"automatic discovery on iPadOS (must use "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/SystemExtensions","isActive":true},{"type":"text","text":" framework on macOS)"}],"type":"paragraph"}]}],"type":"unorderedList"},{"text":"Written By","level":2,"anchor":"Written-By","type":"heading"},{"numberOfColumns":5,"type":"row","columns":[{"content":[{"inlineContent":[{"identifier":"zntfdr","type":"image"}],"type":"paragraph"}],"size":1},{"content":[{"type":"heading","text":"Federico Zanetello","level":3,"anchor":"Federico-Zanetello"},{"type":"paragraph","inlineContent":[{"type":"reference","overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","isActive":true,"overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}]},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/zntfdr","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/zntfdr.dev","isActive":true}]}],"size":4}]},{"type":"thematicBreak"},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","isActive":true}],"type":"paragraph"},{"text":"Related Sessions","level":2,"anchor":"Related-Sessions","type":"heading"},{"style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10190-Create-audio-drivers-with-DriverKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10210-Modernize-PCI-and-SCSI-drivers-with-DriverKit"],"type":"links"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2025 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"sections":[],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110373-Bring-your-driver-to-iPad-with-DriverKit"},"references":{"zntfdr":{"identifier":"zntfdr","variants":[{"url":"\/images\/WWDCNotes\/zntfdr.jpeg","traits":["1x","light"]}],"type":"image","alt":"Profile image of Federico Zanetello"},"doc://WWDCNotes/documentation/WWDCNotes":{"images":[{"type":"icon","identifier":"WWDCNotes.png"}],"role":"collection","kind":"symbol","type":"topic","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","url":"\/documentation\/wwdcnotes"},"WWDC22-Icon.png":{"type":"image","identifier":"WWDC22-Icon.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC22-Icon.png"}],"alt":null},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"WWDC22.jpeg":{"identifier":"WWDC22.jpeg","variants":[{"url":"\/images\/WWDCNotes\/WWDC22.jpeg","traits":["1x","light"]}],"type":"image","alt":null},"https://developer.apple.com/documentation/bundleresources/entitlements/com_apple_developer_driverkit_userclient-access":{"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/bundleresources\/entitlements\/com_apple_developer_driverkit_userclient-access","title":"com.apple.developer.driverkit.allow-any-userclient-access","url":"https:\/\/developer.apple.com\/documentation\/bundleresources\/entitlements\/com_apple_developer_driverkit_userclient-access","titleInlineContent":[{"type":"codeVoice","code":"com.apple.developer.driverkit.allow-any-userclient-access"}]},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","kind":"article","role":"sampleCode","title":"Federico Zanetello (332 notes)","images":[{"type":"card","identifier":"zntfdr.jpeg"},{"type":"icon","identifier":"zntfdr.jpeg"}],"abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"type":"topic","url":"\/documentation\/wwdcnotes\/zntfdr"},"zntfdr.jpeg":{"identifier":"zntfdr.jpeg","type":"image","alt":null,"variants":[{"url":"\/images\/WWDCNotes\/zntfdr.jpeg","traits":["1x","light"]}]},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"url":"\/images\/WWDCNotes\/WWDCNotes.png","traits":["1x","light"]}],"type":"image","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22":{"images":[{"type":"icon","identifier":"WWDC22-Icon.png"},{"type":"card","identifier":"WWDC22.jpeg"}],"role":"collectionGroup","abstract":[{"text":"Xcode 14, Swift 5.7, iOS 16, macOS 13 (Ventura), tvOS 16, watchOS 9.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"type":"codeVoice","code":"WeatherKit"},{"text":", ","type":"text"},{"type":"codeVoice","code":"ScreenCaptureKit"},{"text":", ","type":"text"},{"type":"codeVoice","code":"Swift Regex"},{"text":", and more.","type":"text"}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22","kind":"article","title":"WWDC22","url":"\/documentation\/wwdcnotes\/wwdc22"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10190-Create-audio-drivers-with-DriverKit":{"url":"\/documentation\/wwdcnotes\/wwdc21-10190-create-audio-drivers-with-driverkit","type":"topic","title":"Create audio drivers with DriverKit","abstract":[{"type":"text","text":"Discover how to use the AudioDriverKit API to consolidate your Audio Server plug-in and DriverKit extension into a single package. Learn how you can simplify audio driver installation with an app instead of an installer package and distribute your driver through the Mac App Store. And we’ll take you through how the Core Audio HAL interacts with AudioDriverKit and discover best practices for audio device drivers."}],"kind":"article","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10190-Create-audio-drivers-with-DriverKit"},"https://developer.apple.com/contact/request/system-extension":{"identifier":"https:\/\/developer.apple.com\/contact\/request\/system-extension","type":"link","title":"here","titleInlineContent":[{"type":"text","text":"here"}],"url":"https:\/\/developer.apple.com\/contact\/request\/system-extension"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10210-Modernize-PCI-and-SCSI-drivers-with-DriverKit":{"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc20-10210-modernize-pci-and-scsi-drivers-with-driverkit","abstract":[{"type":"text","text":"Keep code out of the kernel and give your customers a more secure and reliable experience with accessories using DriverKit. Discover how to create low-level drivers that support PCI devices or SCSI controllers. And find out how you can achieve great performance with DriverKit on macOS Big Sur."}],"title":"Modernize PCI and SCSI drivers with DriverKit","type":"topic","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10210-Modernize-PCI-and-SCSI-drivers-with-DriverKit"},"https://developer.apple.com/wwdc22/110373":{"identifier":"https:\/\/developer.apple.com\/wwdc22\/110373","type":"download","url":"https:\/\/developer.apple.com\/wwdc22\/110373","checksum":null},"https://github.com/zntfdr":{"type":"link","identifier":"https:\/\/github.com\/zntfdr","title":"GitHub","url":"https:\/\/github.com\/zntfdr","titleInlineContent":[{"type":"text","text":"GitHub"}]},"https://zntfdr.dev":{"identifier":"https:\/\/zntfdr.dev","type":"link","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}],"url":"https:\/\/zntfdr.dev"},"https://developer.apple.com/documentation/SystemExtensions":{"identifier":"https:\/\/developer.apple.com\/documentation\/SystemExtensions","type":"link","title":"SystemExtensions","titleInlineContent":[{"type":"text","text":"SystemExtensions"}],"url":"https:\/\/developer.apple.com\/documentation\/SystemExtensions"},"https://developer.apple.com/documentation/iokit":{"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/iokit","title":"IOKit","url":"https:\/\/developer.apple.com\/documentation\/iokit","titleInlineContent":[{"type":"text","text":"IOKit"}]}}}