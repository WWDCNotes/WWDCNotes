{"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc14-232-advanced-user-interfaces-with-collection-views"]}],"kind":"article","sections":[],"abstract":[{"text":"Building an advanced user interface with collection view requires a great design, careful code architecture, and often times a custom layout. Learn how the iTunes team used UICollectionView to deliver a new version of the iTunes Connect app with an updated user interface incorporating pinning headers, swipe to edit and reorder, and a manageable code-base.","type":"text"}],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC14-232-Advanced-User-Interfaces-with-Collection-Views","interfaceLanguage":"swift"},"sampleCodeDownload":{"action":{"identifier":"http:\/\/developer.apple.com\/wwdc14\/232","isActive":true,"overridingTitle":"Watch Video","type":"reference"},"kind":"sampleDownload"},"schemaVersion":{"minor":3,"major":0,"patch":0},"metadata":{"title":"Advanced User Interfaces with Collection Views","roleHeading":"WWDC14","role":"sampleCode","modules":[{"name":"WWDC Notes"}]},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC14"]]},"primaryContentSections":[{"content":[{"level":2,"anchor":"overview","text":"Overview","type":"heading"},{"name":"Note","style":"note","content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/github.com\/ShawnMoore\/AdvancedCollectionView","isActive":true,"type":"reference"},{"text":".","type":"text"}]}],"type":"aside"},{"inlineContent":[{"type":"text","text":"In this session the AppStoreConnect.app team shares how they manage complexity in their revamped app."}],"type":"paragraph"},{"level":2,"anchor":"Data-Source-minimizing-complexity","text":"Data Source - minimizing complexity","type":"heading"},{"inlineContent":[{"text":"Traditional Data Source Approach:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Implemented in ","type":"text"},{"code":"UlCollectionViewController","type":"codeVoice"}]}]},{"content":[{"inlineContent":[{"text":"Doesn’t encourage code reuse for similar sections","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Either:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"One gigantic controller"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"One controller per content type"}]}]}]}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"Aggregate Data Source:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"implement data sources as separate objects","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"enables code reuse","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"single view controller"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Aggregate data source enables you to avoid implementing the data source in ","type":"text"},{"type":"codeVoice","code":"UlCollectionViewController"},{"text":".","type":"text"}],"type":"paragraph"},{"level":2,"anchor":"Aggregate-Data-Source","text":"Aggregate Data Source","type":"heading"},{"inlineContent":[{"text":"This architecture is composed by four classes\/objects:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"AAPLDataSource"},{"type":"text","text":" - The base data source class, this is where we implement "},{"type":"codeVoice","code":"UICollectionViewDataSource"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AAPLSegmentedDataSource"},{"type":"text","text":" - Can have multiple children\/sections, only one active at a time"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AAPLComposedDataSource"},{"type":"text","text":" - Multiple children\/sections, all active at once, manage the translations between internal index paths and external index paths"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AAPLBasicDataSource"},{"type":"text","text":" - One section, items are stored in an "},{"type":"codeVoice","code":"NSArray"},{"type":"text","text":" (for simple, table-like, representations)"}]}]}],"type":"unorderedList"},{"level":3,"anchor":"An-example","text":"An example","type":"heading"},{"inlineContent":[{"text":"In App store connect, the product detail page is a ","type":"text"},{"code":"AAPLSegmentedDataSource","type":"codeVoice"},{"text":" class, which has four segments (details, episodes, reviews, trends), which correspond to the four items in the segmented control UI component.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The info for each segment come from a different data source:"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC14-232-details","type":"image"}],"type":"paragraph"},{"inlineContent":[{"text":"The Details segment has a separate ","type":"text"},{"code":"AAPLComposedDataSource","type":"codeVoice"},{"text":" that provides data for its sections:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"status","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"information"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"description"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Each section (status, information, description) has its own data source.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC14-232-episodes"}],"type":"paragraph"},{"inlineContent":[{"text":"The Episodes segment has a simple ","type":"text"},{"type":"codeVoice","code":"AAPLBasicDataSource"},{"text":" that provides the list data.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC14-232-reviews"}],"type":"paragraph"},{"inlineContent":[{"text":"The Reviews segment has another ","type":"text"},{"type":"codeVoice","code":"AAPLComposedDataSource"},{"text":" that provides data for its sections:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"ratings","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"reviews"}]}]}],"type":"unorderedList"},{"inlineContent":[{"identifier":"WWDC14-232-trends","type":"image"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Lastly, the Trends segment uses a custom data source derived directly from "},{"code":"AAPLDataSource","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"},{"level":3,"anchor":"Loading-data-in-an-Aggregate-Data-Source","text":"Loading data in an Aggregate Data Source","type":"heading"},{"inlineContent":[{"type":"text","text":"As we have multiple sources for our data, the view controller tells the data source when it’s time to load, but then it’s the source that is responsible to do the actual data loading."}],"type":"paragraph"},{"inlineContent":[{"text":"For example, a ","type":"text"},{"code":"AAPLSegmentedDataSource","type":"codeVoice"},{"text":" will only load the selected data source, while a ","type":"text"},{"code":"AAPLComposedDataSource","type":"codeVoice"},{"text":" will tell all of its children to load.","type":"text"}],"type":"paragraph"},{"level":4,"anchor":"State-machine","text":"State machine","type":"heading"},{"inlineContent":[{"type":"text","text":"To manage the loading process, AppStoreConnect.app uses a "},{"code":"AAPLLoadableContentStateMachine","type":"codeVoice"},{"type":"text","text":" class, here are all the states:"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC14-232-state"}],"type":"paragraph"},{"level":3,"anchor":"Recap","text":"Recap","type":"heading"},{"inlineContent":[{"text":"Aggregate Data Sources:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Reduces view controller complexity"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Promotes code reuse","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Isolates task specific logic","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Enables unified loading indicator","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"anchor":"Custom-UICollectionViewLayout","text":"Custom UICollectionViewLayout","type":"heading"},{"inlineContent":[{"type":"text","text":"Before building your layout, make sure to have gathered all the necessary details such as:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"What information do we need?","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Per section?"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Per header and footer?","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Where does it go?","type":"text"}]}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Examples:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Section Metrics:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":"rowHeight","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"separatorColor"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"separatorInsets"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"backgroundColor","type":"codeVoice"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"selectedBackgroundColor"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"numberOfColumns"}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"showsColumnSeparator"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Header and Footer Metrics:","type":"text"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"height","type":"codeVoice"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"backgroundColor","type":"codeVoice"}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"padding"}],"type":"paragraph"}]}],"type":"unorderedList"}]}],"type":"unorderedList"},{"level":3,"anchor":"Global-Headers","text":"Global Headers","type":"heading"},{"inlineContent":[{"text":"In AppStoreConnect.app they also some global headers, for these they use NSIndexPath with just a single index (no sections), i.e., ","type":"text"},{"type":"codeVoice","code":"[NSIndexPath indexPathWithIndex:0];"}],"type":"paragraph"},{"level":3,"anchor":"Build-the-Layout","text":"Build the Layout","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"If data source changed ➡️ snapshot data source","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"If collection view width changed or data source changed ➡️ regenerate layout attributes & special layout attributes"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If collection view origin changed ➡️ update special layout attributes"}]}]}],"type":"unorderedList"},{"level":3,"anchor":"Optional-Layout-Methods-Critical-to-getting-our-layout-just-right","text":"Optional Layout Methods Critical to getting our layout just right","type":"heading"},{"items":[{"content":[{"inlineContent":[{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617752-preparelayout","type":"reference"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617784-prepare","isActive":true,"type":"reference"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617724-targetcontentoffset"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"initialLayoutAttributes*","type":"codeVoice"},{"type":"text","text":" "},{"code":"finalLayoutAttributes*","type":"codeVoice"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"anchor":"Written-By","text":"Written By","type":"heading"},{"numberOfColumns":5,"columns":[{"size":1,"content":[{"inlineContent":[{"type":"image","identifier":"zntfdr"}],"type":"paragraph"}]},{"size":4,"content":[{"level":3,"text":"Federico Zanetello","anchor":"Federico-Zanetello","type":"heading"},{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","overridingTitle":"Contributed Notes","type":"reference","isActive":true,"overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}]},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/zntfdr","type":"reference","isActive":true},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/zntfdr.dev","type":"reference","isActive":true}]}]}],"type":"row"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"references":{"https://github.com/ShawnMoore/AdvancedCollectionView":{"identifier":"https:\/\/github.com\/ShawnMoore\/AdvancedCollectionView","title":"Code sample","titleInlineContent":[{"text":"Code sample","type":"text"}],"url":"https:\/\/github.com\/ShawnMoore\/AdvancedCollectionView","type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC14":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC14","abstract":[{"text":"Xcode 6, Swift 1.0, iOS 8, macOS 10.10 (Yosemite).","type":"text"}],"images":[{"identifier":"WWDC14-Icon.png","type":"icon"},{"type":"card","identifier":"WWDC14.jpeg"}],"title":"WWDC14","role":"collectionGroup","url":"\/documentation\/wwdcnotes\/wwdc14","type":"topic","kind":"article"},"WWDC14.jpeg":{"identifier":"WWDC14.jpeg","variants":[{"url":"\/images\/WWDC14.jpeg","traits":["1x","light"]}],"alt":null,"type":"image"},"https://zntfdr.dev":{"identifier":"https:\/\/zntfdr.dev","title":"Blog","titleInlineContent":[{"text":"Blog","type":"text"}],"url":"https:\/\/zntfdr.dev","type":"link"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}],"alt":null,"type":"image"},"http://developer.apple.com/wwdc14/232":{"checksum":null,"identifier":"http:\/\/developer.apple.com\/wwdc14\/232","url":"http:\/\/developer.apple.com\/wwdc14\/232","type":"download"},"https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617752-preparelayout":{"title":"prepareLayout","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617752-preparelayout","titleInlineContent":[{"code":"prepareLayout","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617752-preparelayout","type":"link"},"WWDC14-232-state":{"alt":null,"variants":[{"url":"\/images\/WWDC14-232-state.png","traits":["1x","light"]}],"identifier":"WWDC14-232-state","type":"image"},"zntfdr.jpeg":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}],"identifier":"zntfdr.jpeg","type":"image"},"WWDC14-232-episodes":{"alt":null,"variants":[{"url":"\/images\/WWDC14-232-episodes.png","traits":["1x","light"]}],"identifier":"WWDC14-232-episodes","type":"image"},"WWDC14-232-reviews":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC14-232-reviews.png"}],"identifier":"WWDC14-232-reviews","type":"image"},"zntfdr":{"alt":"Profile image of Federico Zanetello","variants":[{"url":"\/images\/zntfdr.jpeg","traits":["1x","light"]}],"identifier":"zntfdr","type":"image"},"https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617724-targetcontentoffset":{"title":"targetContentOffsetForProposedContentOffset:","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617724-targetcontentoffset","titleInlineContent":[{"code":"targetContentOffsetForProposedContentOffset:","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617724-targetcontentoffset","type":"link"},"https://github.com/zntfdr":{"title":"GitHub","url":"https:\/\/github.com\/zntfdr","titleInlineContent":[{"text":"GitHub","type":"text"}],"identifier":"https:\/\/github.com\/zntfdr","type":"link"},"WWDC14-232-trends":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC14-232-trends.png"}],"identifier":"WWDC14-232-trends","type":"image"},"https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617784-prepare":{"title":"prepareForCollectionViewUpdates:","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617784-prepare","titleInlineContent":[{"code":"prepareForCollectionViewUpdates:","type":"codeVoice"}],"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uicollectionviewlayout\/1617784-prepare","type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"abstract":[{"text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more.","type":"text"}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","url":"\/documentation\/wwdcnotes\/zntfdr","title":"Federico Zanetello (332 notes)","kind":"article","images":[{"identifier":"zntfdr.jpeg","type":"card"},{"identifier":"zntfdr.jpeg","type":"icon"}],"role":"sampleCode"},"WWDC14-Icon.png":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC14-Icon.png"}],"identifier":"WWDC14-Icon.png","type":"image"},"WWDC14-232-details":{"alt":null,"variants":[{"url":"\/images\/WWDC14-232-details.png","traits":["1x","light"]}],"identifier":"WWDC14-232-details","type":"image"},"doc://WWDCNotes/documentation/WWDCNotes":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection","type":"topic","url":"\/documentation\/wwdcnotes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"kind":"symbol","title":"WWDC Notes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link"}}}