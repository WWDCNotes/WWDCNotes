{"schemaVersion":{"patch":0,"major":0,"minor":3},"kind":"article","metadata":{"modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC23","title":"Share files with SharePlay","role":"sampleCode"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc23-10241-share-files-with-shareplay"]}],"sections":[],"sampleCodeDownload":{"kind":"sampleDownload","action":{"overridingTitle":"Watch Video (9 min)","type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/wwdc23\/10241"}},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"abstract":[{"type":"text","text":"Discover how to work with files and attachments in a SharePlay activity. We’ll explain how to use the GroupSessionJournal API to sync large amounts of data faster and show you how to adopt it in a demo of the sample app DrawTogether."}],"primaryContentSections":[{"kind":"content","content":[{"anchor":"Limitations-of-GroupSessionManager","type":"heading","level":3,"text":"Limitations of GroupSessionManager"},{"inlineContent":[{"type":"text","text":"Previously, if you were creating a group drawing app and wanted to drop a photo onto the canvas, this wasn’t possible due to the size limitations of "},{"code":"GroupSessionManager","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"},{"inlineContent":[{"text":"New in iOS17, file attachment transfers are not only possible but are very fast and end to end encrypted.","type":"text"}],"type":"paragraph"},{"type":"heading","anchor":"GroupSessionJournal","level":3,"text":"GroupSessionJournal"},{"inlineContent":[{"type":"text","text":"New to iOS17. "},{"code":"GroupSessionJournal","type":"codeVoice"},{"type":"text","text":" an object that stays consistent for everyone across the "},{"code":"GroupSession","type":"codeVoice"},{"type":"text","text":". Actions you take on the journal affect everyone and properties on the journal are similarly synced for everyone."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["public final class GroupSessionJournal {","    public lazy var attachments: Attachments","    public func add‹ItemType: Transferable>(_ item: ItemType) async throws → Attachment","    public func remove(attachment: Attachment) async throws","}"]},{"inlineContent":[{"text":"You can upload any of your custom attachments with the “add” function. Just be sure your type conforms to the ","type":"text"},{"type":"codeVoice","code":"Transferable"},{"text":" protocol.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"When calling "},{"code":"add","type":"codeVoice"},{"type":"text","text":" or"},{"code":"remove","type":"codeVoice"},{"type":"text","text":" everyone in the GroupSession will observe their “attachments” AsyncSequence being updated with the event."}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Attachments are limited to 100MB.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The lifecycle of the attachment is as long as members of the "},{"type":"codeVoice","code":"GroupSession"},{"type":"text","text":" are connected"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"If the person who uploaded the attachment leaves the "},{"code":"GroupSession","type":"codeVoice"},{"type":"text","text":" the attachment remains until everyone disconnects"}],"type":"paragraph"}]}]}]}]},{"type":"heading","anchor":"GroupSessionJournal-Late-Joiners","level":3,"text":"GroupSessionJournal: Late Joiners"},{"inlineContent":[{"type":"text","text":"Another advantage of "},{"type":"codeVoice","code":"GroupSessionJournal"},{"type":"text","text":" over "},{"type":"codeVoice","code":"GroupSessionMessenger"},{"type":"text","text":" is how it handles late joiners."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"In "},{"type":"codeVoice","code":"GroupSessionMessenger"},{"type":"text","text":", late joiners are “caught up” on the session by having each session member re-upload their interactions behind the scenes. Obviously, having each member re-upload 100MB file attachments is not efficient so "},{"type":"codeVoice","code":"GroupSessionJournal"},{"type":"text","text":" ensures that late joiners receive attachments without any re-uploads."}],"type":"paragraph"},{"type":"heading","anchor":"Code-Example-Syncing-an-image-and-its-location-across-devices","level":3,"text":"Code Example: Syncing an image and it’s location across devices"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a struct for the image data and add it to your Canvas model"}]}]}]},{"type":"codeListing","syntax":"swift","code":["struct CanvasImage: Identifiable {","    var id: UUID","    let location: CGPoint","    let imageData: Data","}","","class Canvas: ObservableObject {","    @Published var images = [CanvasImage]()","    \/\/...","}"]},{"type":"orderedList","start":2,"items":[{"content":[{"inlineContent":[{"text":"In your Canvas model, setup your ","type":"text"},{"code":"GroupSessionJournal","type":"codeVoice"},{"text":" and listen for changes to its attachments","type":"text"}],"type":"paragraph"}]}]},{"type":"codeListing","syntax":"swift","code":["func configureGroupSession(_ groupSession: GroupSession<DrawTogether>) {","    self.groupSession = groupSession","    let messenger = GroupSessionMessenger(session: groupSession)","    self.messenger = messenger","    let journal = GroupSessionJournal(session: groupSession)","    self.journal = journal","    ","    \/\/set up groupSession, handle messenger events...","    ","    task = Task {","        for await images in journal.attachments {","            await handle(images)","        }","    }","    tasks.insert(task)","","    \/\/...","}"]},{"type":"orderedList","start":3,"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"In your Canvas model, create the image handler to convert journal attachments to ","type":"text"},{"code":"CanvasImage","type":"codeVoice"}]}]}]},{"type":"codeListing","syntax":"swift","code":["func handle(_ attachments: GroupSessionJournal.Attachments.Element) async {","    \/\/ Now make sure that our canvas always has all the images from this sequence.","    self.images = await withTaskGroup(of: CanvasImage?.self) { group in","        var images = [CanvasImage]()","        attachments.forEach { attachment in","            group.addTask {","                do {","                    let metadata = try await attachment.loadMetadata(","                        of: ImageMetadataMessage.self","                    )","                    let imageData = try await attachment.load(","                        Data.self","                    )","                    return .init(","                        id: attachment.id,","                        location: metadata.location,","                        imageData: imageData","                    )","                } catch { return nil }","            }","            for await image in group {","                if let image {","                    images.append(image)","                }","            }","            return images","        }","    }","}"]},{"type":"orderedList","start":4,"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"At this stage, simply update your UI to reflect Canvas.images"}]}]}]},{"inlineContent":[{"identifier":"WWDC23-10241-example-code-shareplay-attachments","type":"image"}],"type":"paragraph"},{"type":"heading","anchor":"Written-By","level":2,"text":"Written By"},{"columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"identifier":"trav-ma","type":"image"}]}]},{"size":4,"content":[{"level":3,"type":"heading","text":"Travis Ma","anchor":"Travis-Ma"},{"type":"paragraph","inlineContent":[{"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/trav-ma","type":"reference","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}]},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/github.com\/trav-ma","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/www.travisma.me","type":"reference","isActive":true}]}]}],"type":"row","numberOfColumns":5},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"type":"heading","anchor":"Related-Sessions","level":2,"text":"Related Sessions"},{"type":"links","style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10239-Add-SharePlay-to-your-app"]},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}],"type":"small"}]}],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10241-Share-files-with-SharePlay","interfaceLanguage":"swift"},"references":{"doc://WWDCNotes/documentation/WWDCNotes/trav-ma":{"type":"topic","title":"Travis Ma (5 notes)","abstract":[{"type":"text","text":"Software Development Manager for IQVIA’s Mobile team in Arizona."}],"kind":"article","role":"sampleCode","images":[{"identifier":"trav-ma.jpeg","type":"card"},{"identifier":"trav-ma.jpeg","type":"icon"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/trav-ma","url":"\/documentation\/wwdcnotes\/trav-ma"},"https://www.travisma.me":{"url":"https:\/\/www.travisma.me","type":"link","title":"Blog","identifier":"https:\/\/www.travisma.me","titleInlineContent":[{"type":"text","text":"Blog"}]},"WWDC23.jpeg":{"alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC23.jpeg"}],"identifier":"WWDC23.jpeg"},"trav-ma":{"alt":"Profile image of Travis Ma","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/trav-ma.jpeg"}],"identifier":"trav-ma"},"doc://WWDCNotes/documentation/WWDCNotes":{"title":"WWDC Notes","kind":"symbol","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"type":"topic","role":"collection","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","url":"\/documentation\/wwdcnotes"},"WWDC23-Icon.png":{"alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC23-Icon.png"}],"identifier":"WWDC23-Icon.png"},"WWDC23-10241-example-code-shareplay-attachments":{"alt":"Example: Sync image across devices","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC23-10241-example-code-shareplay-attachments.png"}],"identifier":"WWDC23-10241-example-code-shareplay-attachments"},"https://developer.apple.com/wwdc23/10241":{"url":"https:\/\/developer.apple.com\/wwdc23\/10241","type":"download","checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc23\/10241"},"trav-ma.jpeg":{"alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/trav-ma.jpeg"}],"identifier":"trav-ma.jpeg"},"WWDCNotes.png":{"alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"identifier":"WWDCNotes.png"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"role":"collectionGroup","abstract":[{"type":"text","text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10."},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"SwiftData","type":"codeVoice"},{"text":", ","type":"text"},{"code":"Observation","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit","type":"codeVoice"},{"text":" views, and more.","type":"text"}],"type":"topic","title":"WWDC23","url":"\/documentation\/wwdcnotes\/wwdc23","kind":"article","images":[{"identifier":"WWDC23-Icon.png","type":"icon"},{"identifier":"WWDC23.jpeg","type":"card"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10239-Add-SharePlay-to-your-app":{"url":"\/documentation\/wwdcnotes\/wwdc23-10239-add-shareplay-to-your-app","abstract":[{"type":"text","text":"Discover how your app can take advantage of SharePlay to turn any activity into a shareable experience with friends! We’ll share the latest updates to SharePlay, explore the benefits of creating shared activities, dive into some exciting use cases, and take you through best practices to create engaging and fun moments of connection in your app."}],"type":"topic","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10239-Add-SharePlay-to-your-app","title":"Add SharePlay to your app","kind":"article"},"https://github.com/trav-ma":{"url":"https:\/\/github.com\/trav-ma","type":"link","title":"GitHub","identifier":"https:\/\/github.com\/trav-ma","titleInlineContent":[{"type":"text","text":"GitHub"}]}}}