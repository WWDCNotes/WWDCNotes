{"metadata":{"roleHeading":"WWDC20","modules":[{"name":"WWDC Notes"}],"title":"Meet Safari Web Extensions","role":"sampleCode"},"kind":"article","schemaVersion":{"patch":0,"minor":3,"major":0},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10665-Meet-Safari-Web-Extensions","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"When you create a Safari Web Extension, you can help people get common online tasks done more quickly and efficiently. We’ll show you how to build a new Safari Web Extension and host it on the App Store, as well as how to use the safari-web-extension-converter tool to migrate existing extensions from other web browsers like Chrome, Firefox, or Edge with very little effort."}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"primaryContentSections":[{"content":[{"type":"heading","text":"Overview","anchor":"overview","level":2},{"inlineContent":[{"type":"text","text":"Existing extension ecosystem:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"content blockers (iOS & macOS)","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"share extensions - can run JS on the currently opened web page and return data to the extension"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Safari app extensions on macOS"}]}]}]},{"inlineContent":[{"type":"text","text":"If you’re a web developer and don’t want to learn Swift to build an extension, or you have an existing extension for Chrome\/Firefox\/etc., you can now use the new Safari Web Extensions API."}],"type":"paragraph"},{"inlineContent":[{"text":"Safari Web Extensions:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"extensions built primarily using HTML, JS and CSS, like legacy Safari extensions"}]}]},{"content":[{"inlineContent":[{"text":"API compatible with other browsers (the ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Mozilla\/Add-ons\/WebExtensions"},{"text":" standard)","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"improved user privacy controls"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"extensions are sold through the App Store","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"some WebExtensions APIs are missing, so provide feedback if you want something added"}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"Like other extensions, Web Extensions must be packaged inside a native Mac app. Xcode 12 is required to build them.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"A command-line tool is provided which wraps an exising web extension (e.g. for Chrome\/Firefox) into a new app:"}],"type":"paragraph"},{"code":["xcrun safari-web-extension-converter […] \/path"],"type":"codeListing","syntax":null},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"lets you know if any features are not available"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"the largest icon in the manifest is used as the app icon (it’s recommended to include 512×512 and 1024×1024 icons)","type":"text"}]}]}]},{"inlineContent":[{"text":"To create a new extension from scratch, create a “Safari Extension App” project or add a “Safari Extension” target, and choose Type = Safari Web Extension.","type":"text"}],"type":"paragraph"},{"type":"heading","text":"Extension privacy","anchor":"Extension-privacy","level":2},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If your extension needs access to specific sites, the user will be asked for permission to run it on that site for one day or always"}]}]},{"content":[{"inlineContent":[{"text":"Optional permissions: you can include the URL pattern under ","type":"text"},{"type":"codeVoice","code":"optional_permissions"},{"text":" key and then ask for access using ","type":"text"},{"type":"codeVoice","code":"browser.permissions.request(…)"},{"text":" at the moment when you require access","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The Safari preferences window page of your extension shows information about what kind of access was granted to the extension"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"It’s best to use the "},{"type":"codeVoice","code":"activeTab"},{"type":"text","text":" permission, which grants access to the currently open page when the user interacts with your extension in some way"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"The hostname of the extension changes every time Safari is launched in order to prevent fingerprinting","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"use ","type":"text"},{"code":"browser.runtime.getURL(\"\/path\/to\/resource\")","type":"codeVoice"},{"text":" to create URLs to assets","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]}]},{"type":"heading","text":"Debugging","anchor":"Debugging","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Access the background page through the Develop menu"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Content scripts are visible in the Sources tab for the page","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"to run JS in the console in the context of a content script, choose the script from the pulldown menu in the corner","type":"text"}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Don’t rely on code being executed when the page loads, since the extension may not have permission to run yet at this point","type":"text"}]}]}]},{"type":"heading","text":"Communicating between components","anchor":"Communicating-between-components","level":2},{"inlineContent":[{"text":"Content script ⭢ background page:","type":"text"}],"type":"paragraph"},{"code":["browser.runtime.sendMessage()","browser.runtime.onMessage.addListener()"],"type":"codeListing","syntax":"js"},{"inlineContent":[{"text":"Background page ⭢ extension:","type":"text"}],"type":"paragraph"},{"code":["browser.runtime.sendNativeMessage()"],"type":"codeListing","syntax":"js"},{"inlineContent":[{"text":"The message is handled by the ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensionrequesthandling\/1413395-beginrequest","type":"reference"},{"text":" delegate method (requires the ","type":"text"},{"code":"nativeMessaging","type":"codeVoice"},{"text":" permission).","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Extension ⭢ background page:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Use completion handler from ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensioncontext","isActive":true,"type":"reference"},{"text":" object in ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensionrequesthandling\/1413395-beginrequest","overridingTitle":"beginRequest(with context:)","isActive":true,"overridingTitleInlineContent":[{"type":"codeVoice","code":"beginRequest(with context:)"}],"type":"reference"},{"text":" to send back a response","type":"text"}]}]}]},{"inlineContent":[{"text":"App ⭢ background page:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/safariservices\/sfsafariapplication\/2823941-dispatchmessage"},{"type":"text","text":" (check that the extension is turned on first)"}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"App ⭤ extension:","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Shared "},{"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsuserdefaults","isActive":true,"type":"reference"},{"type":"text","text":" from an app group, or "},{"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsxpcconnection","isActive":true,"type":"reference"}],"type":"paragraph"},{"type":"heading","text":"Written By","anchor":"Written-By","level":2},{"type":"row","columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"identifier":"mackuba","type":"image"}]}]},{"size":4,"content":[{"anchor":"Kuba-Suder","type":"heading","text":"Kuba Suder","level":3},{"type":"paragraph","inlineContent":[{"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"isActive":true,"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/mackuba","type":"reference","overridingTitle":"Contributed Notes"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/mackuba","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/mackuba.eu","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/x.com\/kuba_suder","type":"reference"}]}]}],"numberOfColumns":5},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"reference","isActive":true}],"type":"paragraph"},{"type":"heading","text":"Related Sessions","anchor":"Related-Sessions","level":2},{"type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10646-Whats-new-in-Web-Inspector","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10663-Whats-new-for-web-developers","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10676-Build-trust-through-better-privacy"],"style":"list"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc20-10665-meet-safari-web-extensions"],"traits":[{"interfaceLanguage":"swift"}]}],"sections":[],"sampleCodeDownload":{"kind":"sampleDownload","action":{"isActive":true,"type":"reference","overridingTitle":"Watch Video (27 min)","identifier":"https:\/\/developer.apple.com\/wwdc20\/10665"}},"references":{"https://mackuba.eu":{"type":"link","url":"https:\/\/mackuba.eu","identifier":"https:\/\/mackuba.eu","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}]},"https://x.com/kuba_suder":{"type":"link","url":"https:\/\/x.com\/kuba_suder","identifier":"https:\/\/x.com\/kuba_suder","title":"X\/Twitter","titleInlineContent":[{"type":"text","text":"X\/Twitter"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10663-Whats-new-for-web-developers":{"role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10663-Whats-new-for-web-developers","abstract":[{"text":"Explore the latest features and improvements for Safari and WebKit. We’ll walk you through updated web APIs, CSS and media features, JavaScript syntax, and more to help you build great experiences for people when they use your website, home screen web apps, or embedded WebKit views.","type":"text"}],"type":"topic","kind":"article","title":"What’s new for web developers","url":"\/documentation\/wwdcnotes\/wwdc20-10663-whats-new-for-web-developers"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10027-Explore-Safari-Web-Extension-improvements":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements","kind":"article","role":"sampleCode","type":"topic","abstract":[{"type":"text","text":"Learn how you can extend Safari’s functionality with Safari Web Extensions. We’ll introduce you to the latest WebExtension APIs, explore non-persistent background page support — a particularly relevant topic if you’re developing for iOS — and discover how you can use the Declarative Net Request WebExtensions API to block content on the web. Finally, we’ll show you how to customize tabs in Safari 15."}],"url":"\/documentation\/wwdcnotes\/wwdc21-10027-explore-safari-web-extension-improvements","title":"Explore Safari Web Extension improvements"},"https://developer.apple.com/documentation/foundation/nsextensionrequesthandling/1413395-beginrequest":{"type":"link","url":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensionrequesthandling\/1413395-beginrequest","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensionrequesthandling\/1413395-beginrequest","title":"SafariWebExtensionHandler.beginRequest(with context:)","titleInlineContent":[{"type":"codeVoice","code":"SafariWebExtensionHandler.beginRequest(with context:)"}]},"WWDC20.jpeg":{"alt":null,"type":"image","identifier":"WWDC20.jpeg","variants":[{"url":"\/images\/WWDC20.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10676-Build-trust-through-better-privacy":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10676-Build-trust-through-better-privacy","title":"Build trust through better privacy","url":"\/documentation\/wwdcnotes\/wwdc20-10676-build-trust-through-better-privacy","type":"topic","kind":"article","abstract":[{"type":"text","text":"Privacy is a more important issue than ever. Learn about Apple’s privacy pillars, our approach to privacy, and how to adopt the latest features on our platforms that can help you earn customer trust, create more personal experiences, and improve engagement. Explore the transparency iOS provides when your app is recording using the microphone or camera, control over location with approximate location, tracking transparency and permissions, and much more."}],"role":"sampleCode"},"https://developer.apple.com/wwdc20/10665":{"type":"download","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc20\/10665","identifier":"https:\/\/developer.apple.com\/wwdc20\/10665"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS","url":"\/documentation\/wwdcnotes\/wwdc21-10104-meet-safari-web-extensions-on-ios","title":"Meet Safari Web Extensions on iOS","type":"topic","abstract":[{"type":"text","text":"Safari Web Extensions use HTML, CSS, and JavaScript to offer people powerful browser customizations — and you can now create them for every device that supports Safari. Learn how to build a Safari Web Extension that works for all devices, and discover how you can convert an existing extension to Safari through Xcode and the Safari Web Extension Converter."}],"kind":"article","role":"sampleCode"},"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions":{"type":"link","url":"https:\/\/developer.mozilla.org\/en-US\/docs\/Mozilla\/Add-ons\/WebExtensions","identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Mozilla\/Add-ons\/WebExtensions","title":"WebExtensions","titleInlineContent":[{"type":"text","text":"WebExtensions"}]},"mackuba.jpeg":{"alt":null,"type":"image","identifier":"mackuba.jpeg","variants":[{"url":"\/images\/mackuba.jpeg","traits":["1x","light"]}]},"WWDC20-Icon.png":{"alt":null,"type":"image","identifier":"WWDC20-Icon.png","variants":[{"url":"\/images\/WWDC20-Icon.png","traits":["1x","light"]}]},"https://developer.apple.com/documentation/safariservices/sfsafariapplication/2823941-dispatchmessage":{"type":"link","url":"https:\/\/developer.apple.com\/documentation\/safariservices\/sfsafariapplication\/2823941-dispatchmessage","identifier":"https:\/\/developer.apple.com\/documentation\/safariservices\/sfsafariapplication\/2823941-dispatchmessage","title":"SFSafariApplication.dispatchMessage(...)","titleInlineContent":[{"type":"codeVoice","code":"SFSafariApplication.dispatchMessage(...)"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","kind":"article","abstract":[{"type":"text","text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"WidgetKit"},{"type":"text","text":", "},{"type":"codeVoice","code":"StoreKit Testing"},{"type":"text","text":", and more."}],"title":"WWDC20","images":[{"type":"icon","identifier":"WWDC20-Icon.png"},{"type":"card","identifier":"WWDC20.jpeg"}],"type":"topic","url":"\/documentation\/wwdcnotes\/wwdc20","role":"collectionGroup"},"doc://WWDCNotes/documentation/WWDCNotes":{"title":"WWDC Notes","type":"topic","url":"\/documentation\/wwdcnotes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","kind":"symbol","role":"collection","images":[{"type":"icon","identifier":"WWDCNotes.png"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10646-Whats-new-in-Web-Inspector":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10646-Whats-new-in-Web-Inspector","title":"What’s new in Web Inspector","url":"\/documentation\/wwdcnotes\/wwdc20-10646-whats-new-in-web-inspector","kind":"article","abstract":[{"type":"text","text":"The Web Inspector makes introspection and debugging simpler than ever. Discover how you can use debugger stepping, editing cookies, and overriding network loaded resources to provide you with powerful development capabilities and help you create faster, more efficient websites."}],"role":"sampleCode"},"https://developer.apple.com/documentation/foundation/nsxpcconnection":{"type":"link","url":"https:\/\/developer.apple.com\/documentation\/foundation\/nsxpcconnection","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsxpcconnection","title":"NSXPCConnection","titleInlineContent":[{"type":"codeVoice","code":"NSXPCConnection"}]},"WWDCNotes.png":{"alt":null,"type":"image","identifier":"WWDCNotes.png","variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}]},"https://developer.apple.com/documentation/foundation/nsextensioncontext":{"type":"link","url":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensioncontext","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsextensioncontext","title":"NSExtensionContext","titleInlineContent":[{"type":"codeVoice","code":"NSExtensionContext"}]},"https://developer.apple.com/documentation/foundation/nsuserdefaults":{"type":"link","url":"https:\/\/developer.apple.com\/documentation\/foundation\/nsuserdefaults","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsuserdefaults","title":"NSUserDefaults","titleInlineContent":[{"type":"codeVoice","code":"NSUserDefaults"}]},"doc://WWDCNotes/documentation/WWDCNotes/mackuba":{"type":"topic","title":"Kuba Suder (16 notes)","images":[{"type":"card","identifier":"mackuba.jpeg"},{"type":"icon","identifier":"mackuba.jpeg"}],"role":"sampleCode","abstract":[{"text":"Independent Mac & iOS developer. Sometimes freelancing, mostly working on my own stuff these days.","type":"text"}],"url":"\/documentation\/wwdcnotes\/mackuba","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/mackuba"},"mackuba":{"alt":"Profile image of Kuba Suder","type":"image","identifier":"mackuba","variants":[{"url":"\/images\/mackuba.jpeg","traits":["1x","light"]}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"type":"link","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"https://github.com/mackuba":{"type":"link","url":"https:\/\/github.com\/mackuba","identifier":"https:\/\/github.com\/mackuba","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}]}}}