{"kind":"article","metadata":{"title":"Explore Safari Web Extension improvements","modules":[{"name":"WWDC Notes"}],"role":"sampleCode","roleHeading":"WWDC21"},"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","anchor":"overview","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"Three new extensions API:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"non-persistent background pages - new way to structure your extension for better performance.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"declarative content blocking","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"customizing new tabs","type":"text"}]}]}],"type":"unorderedList"},{"text":"Non-persistent background pages","anchor":"Non-persistent-background-pages","level":2,"type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"introduction:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Some extensions have a script that run in the background of the browser called a background page"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"a background page doesn’t have any visible UI, but it can react to events like a tab opening or a message from another part of the extension"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"a persistent background page never closes"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"persistent background pages are like these invisible tabs that a user can never close, and they eat up memory and increase CPU usage"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"inlineContent":[{"text":"New this year: non-persistent background","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"mandatory in iOS (because of resource constraints)"}]}]},{"content":[{"inlineContent":[{"text":"event driven (the page registers event listeners)","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"loaded as needed (by incoming events)","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"unloaded when idle for a certain amount of time"}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"add this in your extension manifest file:","type":"text"}]}]}],"type":"unorderedList"},{"code":["\"background\" : { ","  \"scripts\": [\"background.js\"],","  \"persistent\": false","}"],"syntax":"json","type":"codeListing"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"use "},{"type":"codeVoice","code":"browser.storage"},{"type":"text","text":" to maintain information across the lifetime of your background page"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"register listeners at top level"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"use ","type":"text"},{"type":"codeVoice","code":"browser.alarms"},{"text":" instead of timers (timers won’t trigger if the page has been unloaded)","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"don’t use "},{"code":"getBackgroundPage()","type":"codeVoice"},{"type":"text","text":", it won’t wake up the background page if it’s already been unloaded"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"remove all ","type":"text"},{"code":"webRequest","type":"codeVoice"},{"text":" listeners, as it’s incompatible with non-persistent background pages","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"you can check if a background page has been unloaded in Safari: go to ","type":"text"},{"code":"Develop > Web Extension Background Pages","type":"codeVoice"}],"type":"paragraph"}]}],"type":"unorderedList"},{"text":"declarative content blocking","anchor":"declarative-content-blocking","level":2,"type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"new content-blocking API"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Expressed in JSON"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"grouped into rulesets"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"javascript API to toggle rulesets on and off"}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"specify a ruleset in your manifest file:","type":"text"}]}]}],"type":"unorderedList"},{"code":["\"declarative_net_request\": {","  \"rule_resources\": [{ ","    \"id\": \"my_ruleset\",","    \"enabled\": true,","    \"path\": \"rules.json\" ","  }]","},","\"permissions\" [ \"declarativeNetRequest\" ]"],"syntax":"json","type":"codeListing"},{"inlineContent":[{"text":"Every rule file has four pieces:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"an unique id","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"a priority - which determines the order in which the rules are applied"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"an action - lets you block, allow, or upgrade the scheme of a resource","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"condition - where you tell Safari where and under what conditions to run this rule"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"regexFilter"},{"type":"text","text":" is matched against the resource URL"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"resourceTypes"},{"type":"text","text":" specifies the types of resources that will be blocked (supported types: "},{"type":"codeVoice","code":"main_frame"},{"type":"text","text":", "},{"type":"codeVoice","code":"sub_frame"},{"type":"text","text":", "},{"type":"codeVoice","code":"stylesheet"},{"type":"text","text":", "},{"type":"codeVoice","code":"script"},{"type":"text","text":", "},{"type":"codeVoice","code":"image"},{"type":"text","text":", "},{"type":"codeVoice","code":"font"},{"type":"text","text":", "},{"type":"codeVoice","code":"xmlhttprequest"},{"type":"text","text":", "},{"type":"codeVoice","code":"ping"},{"type":"text","text":", "},{"type":"codeVoice","code":"media"},{"type":"text","text":", "},{"type":"codeVoice","code":"websocket"},{"type":"text","text":", and "},{"type":"codeVoice","code":"other"},{"type":"text","text":")"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"excludedResourceTypes"},{"type":"text","text":" lets you specify the types that you don’t want to match against"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"domainType key","type":"codeVoice"},{"text":" allows you to block a resource based on the relation of the domain of the resource being loaded and the domain of the document ( ","type":"text"},{"code":"first-party","type":"codeVoice"},{"text":" load is any load where the URL has the same security origin as the document. Every other case is ","type":"text"},{"code":"thirdParty","type":"codeVoice"},{"text":")","type":"text"}]}]},{"content":[{"inlineContent":[{"code":"isUrlFilterCaseSensitive","type":"codeVoice"},{"text":" allows you to control whether the ","type":"text"},{"code":"regexFilter","type":"codeVoice"},{"text":" is case sensitive or not (","type":"text"},{"code":"true","type":"codeVoice"},{"text":" by default)","type":"text"}],"type":"paragraph"}]}]}]}],"type":"unorderedList"},{"code":["{","  \"id\": 1, ","  \"priority\": 1, ","  \"action\": { \"type\": \"block\" },","  \"condition\": { ","    \"regexFilter\": \"example.com\",","    \"resourceTypes\": [ \"script\" ]","  }","}"],"syntax":"json","type":"codeListing"},{"text":"Customizing new tabs","anchor":"Customizing-new-tabs","level":2,"type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"from iOS 14.1"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"declared in manifest:"}],"type":"paragraph"}]}],"type":"unorderedList"},{"code":["\"browser_url_overrides\": {","  \"newtab\" : \"fun_page.html\" ","}"],"syntax":"json","type":"codeListing"},{"text":"Written By","anchor":"Written-By","level":2,"type":"heading"},{"columns":[{"content":[{"inlineContent":[{"type":"image","identifier":"zntfdr"}],"type":"paragraph"}],"size":1},{"content":[{"anchor":"Federico-Zanetello","level":3,"text":"Federico Zanetello","type":"heading"},{"type":"paragraph","inlineContent":[{"overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"isActive":true,"type":"reference","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/zntfdr"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/zntfdr.dev"}]}],"size":4}],"numberOfColumns":5,"type":"row"},{"type":"thematicBreak"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"text":"Related Sessions","anchor":"Related-Sessions","level":2,"type":"heading"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10099-Whats-new-in-Safari-Web-Extensions","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10029-Design-for-Safari-15","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10030-Develop-advanced-web-content","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10031-Discover-Web-Inspector-improvements","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10032-Explore-WKWebView-additions","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10033-Meet-privacypreserving-ad-attribution","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10665-Meet-Safari-Web-Extensions"],"style":"list","type":"links"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2025 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}],"type":"small"}]}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc21-10027-explore-safari-web-extension-improvements"]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"abstract":[{"type":"text","text":"Learn how you can extend Safari’s functionality with Safari Web Extensions. We’ll introduce you to the latest WebExtension APIs, explore non-persistent background page support — a particularly relevant topic if you’re developing for iOS — and discover how you can use the Declarative Net Request WebExtensions API to block content on the web. Finally, we’ll show you how to customize tabs in Safari 15."}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"isActive":true,"overridingTitle":"Watch Video (16 min)","type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc21\/10027"}},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements","interfaceLanguage":"swift"},"sections":[],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21"]]},"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10032-Explore-WKWebView-additions":{"type":"topic","role":"sampleCode","title":"Explore WKWebView additions","url":"\/documentation\/wwdcnotes\/wwdc21-10032-explore-wkwebview-additions","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10032-Explore-WKWebView-additions","abstract":[{"text":"Explore the latest updates to WKWebView. We’ll show you how to use APIs to manipulate web content without JavaScript, explore delegates that can help with WebRTC and Downloads, and share how you can easily create a richer web experience within your app.","type":"text"}]},"WWDC21.jpeg":{"identifier":"WWDC21.jpeg","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC21.jpeg"}],"alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10031-Discover-Web-Inspector-improvements":{"abstract":[{"type":"text","text":"Web Inspector provides the tools for you to understand and debug your web pages on macOS, iOS, and iPadOS. We’ll take you through the latest features and improvements to Web Inspector, including a new overlay for inspecting CSS Grid containers on your pages, even more configurable breakpoints to make debugging simpler, and the ability to create and edit Audits."}],"type":"topic","kind":"article","title":"Discover Web Inspector improvements","url":"\/documentation\/wwdcnotes\/wwdc21-10031-discover-web-inspector-improvements","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10031-Discover-Web-Inspector-improvements"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10099-Whats-new-in-Safari-Web-Extensions":{"url":"\/documentation\/wwdcnotes\/wwdc22-10099-whats-new-in-safari-web-extensions","role":"sampleCode","abstract":[{"text":"Learn how you can use the latest improvements to Safari Web Extensions to create even better experiences for people browsing the web. We’ll show you how to upgrade to manifest version 3, adopt the latest APIs for Web Extensions, and sync extensions across devices.","type":"text"}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10099-Whats-new-in-Safari-Web-Extensions","type":"topic","title":"What’s new in Safari Web Extensions"},"https://zntfdr.dev":{"type":"link","identifier":"https:\/\/zntfdr.dev","url":"https:\/\/zntfdr.dev","title":"Blog","titleInlineContent":[{"text":"Blog","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21","url":"\/documentation\/wwdcnotes\/wwdc21","kind":"article","type":"topic","title":"WWDC21","abstract":[{"text":"Xcode 13, Swift 5.5, iOS 15, macOS 12 (Monterey), tvOS 15, watchOS 8.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"MusicKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"DocC","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit 2","type":"codeVoice"},{"text":", and more.","type":"text"}],"role":"collectionGroup","images":[{"type":"icon","identifier":"WWDC21-Icon.png"},{"type":"card","identifier":"WWDC21.jpeg"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10665-Meet-Safari-Web-Extensions":{"type":"topic","role":"sampleCode","title":"Meet Safari Web Extensions","url":"\/documentation\/wwdcnotes\/wwdc20-10665-meet-safari-web-extensions","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10665-Meet-Safari-Web-Extensions","abstract":[{"type":"text","text":"When you create a Safari Web Extension, you can help people get common online tasks done more quickly and efficiently. We’ll show you how to build a new Safari Web Extension and host it on the App Store, as well as how to use the safari-web-extension-converter tool to migrate existing extensions from other web browsers like Chrome, Firefox, or Edge with very little effort."}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10029-Design-for-Safari-15":{"title":"Design for Safari 15","url":"\/documentation\/wwdcnotes\/wwdc21-10029-design-for-safari-15","kind":"article","abstract":[{"type":"text","text":"Meet Safari 15: redesigned and ready to help people explore the web. Discover how you can approach designing websites and apps for Safari, and learn how to incorporate the tab bar in your designs. We’ll also take you through features like Live Text and accessibility best practices, explore the latest updates to CSS and Form Controls, and learn how to use the aspect-ratio property in CSS to create incredible websites."}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10029-Design-for-Safari-15","role":"sampleCode"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10030-Develop-advanced-web-content":{"title":"Develop advanced web content","url":"\/documentation\/wwdcnotes\/wwdc21-10030-develop-advanced-web-content","kind":"article","abstract":[{"type":"text","text":"Develop in JavaScript, WebGL, or WebAssembly? Learn how the latest updates to Safari and WebKit — including language changes to class syntax — can help simplify your development process, enhance performance, and improve security. We’ll explore several web APIs that can help provide better interoperability and bring new capabilities to your web content."}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10030-Develop-advanced-web-content","role":"sampleCode"},"zntfdr":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/zntfdr.jpeg"}],"type":"image","identifier":"zntfdr","alt":"Profile image of Federico Zanetello"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS":{"url":"\/documentation\/wwdcnotes\/wwdc21-10104-meet-safari-web-extensions-on-ios","role":"sampleCode","abstract":[{"type":"text","text":"Safari Web Extensions use HTML, CSS, and JavaScript to offer people powerful browser customizations — and you can now create them for every device that supports Safari. Learn how to build a Safari Web Extension that works for all devices, and discover how you can convert an existing extension to Safari through Xcode and the Safari Web Extension Converter."}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS","type":"topic","title":"Meet Safari Web Extensions on iOS"},"https://github.com/zntfdr":{"type":"link","identifier":"https:\/\/github.com\/zntfdr","url":"https:\/\/github.com\/zntfdr","title":"GitHub","titleInlineContent":[{"text":"GitHub","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10033-Meet-privacypreserving-ad-attribution":{"type":"topic","title":"Meet privacy-preserving ad attribution","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10033-Meet-privacypreserving-ad-attribution","url":"\/documentation\/wwdcnotes\/wwdc21-10033-meet-privacypreserving-ad-attribution","abstract":[{"text":"Discover how you can measure your ad campaigns in apps and on the web without compromising privacy. We’ll introduce you to Private Click Measurement and explore SKAdNetwork, which provides you with a more secure, private, and useful way to measure your app installs.","type":"text"}],"role":"sampleCode","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","role":"collection","title":"WWDC Notes","type":"topic","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"url":"\/documentation\/wwdcnotes"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","type":"link","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"type":"topic","images":[{"identifier":"zntfdr.jpeg","type":"card"},{"identifier":"zntfdr.jpeg","type":"icon"}],"abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"url":"\/documentation\/wwdcnotes\/zntfdr","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","role":"sampleCode","kind":"article","title":"Federico Zanetello (332 notes)"},"https://developer.apple.com/wwdc21/10027":{"identifier":"https:\/\/developer.apple.com\/wwdc21\/10027","type":"download","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc21\/10027"},"WWDC21-Icon.png":{"type":"image","identifier":"WWDC21-Icon.png","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC21-Icon.png"}]},"zntfdr.jpeg":{"identifier":"zntfdr.jpeg","type":"image","variants":[{"url":"\/images\/WWDCNotes\/zntfdr.jpeg","traits":["1x","light"]}],"alt":null}}}