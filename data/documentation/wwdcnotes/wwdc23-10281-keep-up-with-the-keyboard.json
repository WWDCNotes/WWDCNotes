{"kind":"article","variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc23-10281-keep-up-with-the-keyboard"]}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"type":"reference","overridingTitle":"Watch Video (15 min)","identifier":"https:\/\/developer.apple.com\/wwdc23\/10281","isActive":true}},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10281-Keep-up-with-the-keyboard","interfaceLanguage":"swift"},"metadata":{"role":"sampleCode","title":"Keep up with the keyboard","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC23"},"primaryContentSections":[{"kind":"content","content":[{"level":2,"text":"Overview","anchor":"overview","type":"heading"},{"inlineContent":[{"text":"Speaker: Spencer Lewson, Keyboard Engineer","type":"text"}],"type":"paragraph"},{"level":2,"text":"Out of process keyboard","anchor":"Out-of-process-keyboard","type":"heading"},{"inlineContent":[{"type":"text","text":"Taking the keyboard out of the app process:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"improves privacy and security"}]}]},{"content":[{"inlineContent":[{"text":"improves memory management as there is now only one keyboard","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"allows for new exciting functionality in the future","type":"text"}],"type":"paragraph"}]}]},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Prior to iOS 17, the keyboard’s views and logic were executing within your apps process. But new on iPhone on iOS 17, the keyboard has been moved to its own process, running almost completely outside your app."}]}],"style":"note","type":"aside"},{"name":"Note","content":[{"inlineContent":[{"text":"For the majority of apps, these changes are completely transparent and require no adoption from you. Though, aspects of this new asynchronous approach now exist throughout the entire keyboard and can introduce some slight differences in timing.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"So if your app is especially sensitive to the timing of text entry, selection changes, or any other text related operations, you should keep this new architecture in mind."}],"type":"paragraph"}],"style":"note","type":"aside"},{"level":2,"text":"Design for the keyboard","anchor":"Design-for-the-keyboard","type":"heading"},{"inlineContent":[{"text":"With Stage Manager, now you can always just move up your views, the height of the keyboard.","type":"text"}],"type":"paragraph"},{"level":3,"text":"Keyboard Layout Guide","anchor":"Keyboard-Layout-Guide","type":"heading"},{"inlineContent":[{"type":"text","text":"Align to the "},{"code":"keyboardLayoutGuide","type":"codeVoice"},{"type":"text","text":" to automatically adjust for the keyboard:"}],"type":"paragraph"},{"code":["view.keyboardLayoutGuide.topAnchor.constraint(equalTo: textView.bottomAnchor).isActive = true"],"type":"codeListing","syntax":"swift"},{"level":4,"text":"Default behaviors","anchor":"Default-behaviors","type":"heading"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Follows the keyboard when onscreen and docked"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Uses bottom safe area when offscreen or undocked","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Follows ","type":"text"},{"inlineContent":[{"type":"text","text":"dismiss"}],"type":"emphasis"},{"text":" gesture when it intersects","type":"text"}]}]}]},{"inlineContent":[{"inlineContent":[{"type":"text","text":"See more in the session “Your Guide to Keyboard Layout” from WWDC21."}],"type":"emphasis"}],"type":"paragraph"},{"level":4,"text":"Customizing the guide","anchor":"Customizing-the-guide","type":"heading"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"followsUndockedKeyboard","type":"codeVoice"},{"type":"text","text":" (defaults to false): Set to "},{"code":"true","type":"codeVoice"},{"type":"text","text":" to always follow the keyboard when undocked from the bottom."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"NEW","type":"text"}],"type":"strong"},{"text":" ","type":"text"},{"type":"codeVoice","code":"usesBottomSafeArea"},{"text":" (defaults to true): Set to ","type":"text"},{"type":"codeVoice","code":"false"},{"text":" to avoid using the bottom safe area when undocked or offscreen.","type":"text"}]}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"NEW","type":"text"}],"type":"strong"},{"text":" ","type":"text"},{"code":"keyboardDismissPadding","type":"codeVoice"},{"text":": Used to add padding above the keyboard for the ","type":"text"},{"inlineContent":[{"type":"text","text":"scroll to dismiss"}],"type":"emphasis"},{"text":" gesture.","type":"text"}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"Example of using ","type":"text"},{"type":"codeVoice","code":"usesBottomSafeArea"},{"text":" to create keyboard and text view aligned with safe area:","type":"text"}],"type":"paragraph"},{"code":["view.keyboardLayoutGuide.usesBottomSafeArea = false","textField.topAnchor.constraint(equalToSystemSpacingBelow: backdrop.topAnchor, multiplier: 1.0).isActive = true","view.keyboardLayoutGuide.topAnchor.constraint(greaterThanOrEqualToSystemSpacingBelow: textField.bottomAnchor, multiplier: 1.0).isActive = true","view.keyboardLayoutGuide.topAnchor.constraint(equalTo: backdrop.bottomAnchor).isActive = true","view.safeAreaLayoutGuide.bottomAnchor.constraint(greaterThanOrEqualTo: textField.bottomAnchor).isActive = true"],"type":"codeListing","syntax":"swift"},{"inlineContent":[{"type":"text","text":"Example of using "},{"type":"codeVoice","code":"keyboardDismissPadding"},{"type":"text","text":" to start the "},{"inlineContent":[{"type":"text","text":"keyboard dismiss gesture"}],"type":"emphasis"},{"type":"text","text":" when the touch intersects with the textfield:"}],"type":"paragraph"},{"code":["var dismissPadding = aboveKeyboardView.bounds.size.height","view.keyboardLayoutGuide.keyboardDismissPadding = dismissPadding"],"type":"codeListing","syntax":"swift"},{"level":3,"text":"SwiftUI","anchor":"SwiftUI","type":"heading"},{"inlineContent":[{"text":"Most of the stuff around keyboards are automatically handled by SwiftUI.","type":"text"}],"type":"paragraph"},{"level":3,"text":"Notifications","anchor":"Notifications","type":"heading"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Before SwiftUI and keyboard layout guide, the only way to integrate your keyboard into your application was to listen for a set of keyboard notifications– willShow, didShow, willHide, didHide– and then manually adjust your layout based on the frame and animation information in the notification."}]}],"style":"note","type":"aside"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Can still be used"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"With Stage Manager it doesn’t always work 100 % of the time","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"With the new out of process keyboard, the timings can be different and notifications can be delayed","type":"text"}],"type":"paragraph"}]}]},{"code":["func handleWillShowOrHideKeyboardNotification(notification: NSNotification) {","    \/\/ Retrieve the UIScreen object from the notification (Added iOS 16.1)","    guard let screen = notification.object as? UIScreen else { return }","","    \/\/ Determine if the notification’s screen corresponds to your view’s screen","    guard(screen.isEqual(view.window?.screen)) else { return }","","    \/\/ Calculate intersection with keyboard","    let endFrameKey = UIResponder.keyboardFrameEndUserInfoKey","","    \/\/ Get the ending screen position of the keyboard","    guard let keyboardFrameEnd = userInfo[endFrameKey] as? CGRect else { return }","","    let fromCoordinateSpace: UICoordinateSpace = screen.coordinateSpace","    let toCoordinateSpace: UICoordinateSpace = view","","    \/\/ Convert from the screen coordinate space to your local coordinate space","    let convertedKeyboardFrameEnd = fromCoordinateSpace.convert(keyboardFrameEnd, to: toCoordinateSpace)","","    \/\/ Calculate offset for view adjustment","    var bottomOffset = view.safeAreaInsets.bottom","            ","    \/\/ Get the intersection between the keyboard's frame and the view's bounds","    let viewIntersection = view.bounds.intersection(convertedKeyboardFrameEnd)","            ","    \/\/ Check whether the keyboard intersects your view before adjusting your offset.","    if !viewIntersection.isEmpty {","        \/\/ Set the offset to the height of the intersection","        bottomOffset = viewIntersection.size.height","    }","","    \/\/ Use the new offset to adjust your UI","    movingBottomConstraint.constant = bottomOffset","  ","    \/\/ Adjust view layouts and animate using information in notification","    ...","}"],"type":"codeListing","syntax":"swift"},{"level":2,"text":"New text entry APIs","anchor":"New-text-entry-APIs","type":"heading"},{"level":3,"text":"Inline predictions (new in iOS 17)","anchor":"Inline-predictions-new-in-iOS-17","type":"heading"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"English langugage keyboard will suggest text inline"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Generated using contextual information in the text field"}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"emphasis","inlineContent":[{"type":"text","text":"See more in the session “What’s new in text and text interactions”."}]}],"type":"paragraph"},{"code":["@MainActor public protocol UITextInputTraits : NSObjectProtocol {","    \/\/ Controls whether inline text prediction is enabled or disabled during typing","    @available(iOS, introduced: 17.0)","    optional var inlinePredictionType: UITextInlinePredictionType { get set }","}","","public enum UITextInlinePredictionType : Int, @unchecked Sendable {","    case `default` = 0","    case no = 1","    case yes = 2","}","","let textView = UITextView(frame: frame)","textView.inlinePredictionType = .yes"],"type":"codeListing","syntax":"swift"},{"level":2,"text":"Written By","anchor":"Written-By","type":"heading"},{"type":"row","columns":[{"size":1,"content":[{"inlineContent":[{"identifier":"https:\/\/avatars.githubusercontent.com\/u\/759680?v=4","type":"image"}],"type":"paragraph"}]},{"size":4,"content":[{"anchor":"Morten-Bjerg-Gregersen","type":"heading","text":"Morten Bjerg Gregersen","level":3},{"type":"paragraph","inlineContent":[{"overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"isActive":true,"type":"reference","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/MortenGregersen"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/MortenGregersen"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"http:\/\/atterdagapps.com"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/x.com\/mortengregersen"}]}]}],"numberOfColumns":5},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"isActive":true,"identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","type":"reference"}],"type":"paragraph"},{"level":2,"text":"Related Sessions","anchor":"Related-Sessions","type":"heading"},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10058-Whats-new-with-text-and-text-interactions","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10259-Your-guide-to-keyboard-layout"]},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}],"type":"small"}]}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"schemaVersion":{"minor":3,"major":0,"patch":0},"abstract":[{"type":"text","text":"Each year, the keyboard evolves to support an increasing range of languages, sizes, and features. Discover how you can design your app to keep up with the keyboard, regardless of how it appears on a device. We’ll show you how to create frictionless text entry and share important architectural changes to help you understand how the keyboard works within the system."}],"sections":[],"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"images":[{"type":"icon","identifier":"WWDCNotes.png"}],"kind":"article","abstract":[{"text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"SwiftData","type":"codeVoice"},{"text":", ","type":"text"},{"code":"Observation","type":"codeVoice"},{"text":", ","type":"text"},{"type":"codeVoice","code":"StoreKit"},{"type":"text","text":" views, and more."}],"type":"topic","role":"collectionGroup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","title":"WWDC23","url":"\/documentation\/wwdcnotes\/wwdc23"},"https://x.com/mortengregersen":{"titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"type":"link","title":"X\/Twitter","identifier":"https:\/\/x.com\/mortengregersen","url":"https:\/\/x.com\/mortengregersen"},"https://avatars.githubusercontent.com/u/759680?v=4":{"type":"image","variants":[{"url":"https:\/\/avatars.githubusercontent.com\/u\/759680?v=4","traits":["1x","light"]}],"identifier":"https:\/\/avatars.githubusercontent.com\/u\/759680?v=4","alt":"Profile image of Morten Bjerg Gregersen"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10259-Your-guide-to-keyboard-layout":{"abstract":[{"type":"text","text":"Discover how you can use the Keyboard Layout Guide to manage how keyboards work within your iOS or iPadOS app. Learn how you can avoid writing lengthy code blocks when you use UIKeyboardLayoutGuide and UITrackingLayoutGuide to integrate the keyboard into your interface, helping people have a smoother, more enjoyable experience whenever they use the on-screen keyboard within your app."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10259-Your-guide-to-keyboard-layout","role":"sampleCode","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21-10259-your-guide-to-keyboard-layout","title":"Your guide to keyboard layout","type":"topic"},"https://developer.apple.com/wwdc23/10281":{"type":"download","checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc23\/10281","url":"https:\/\/developer.apple.com\/wwdc23\/10281"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10058-Whats-new-with-text-and-text-interactions":{"url":"\/documentation\/wwdcnotes\/wwdc23-10058-whats-new-with-text-and-text-interactions","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10058-Whats-new-with-text-and-text-interactions","role":"sampleCode","title":"What’s new with text and text interactions","abstract":[{"text":"Text is an absolutely critical component of every app. Discover the latest features and enhancements for creating rich text experiences on Apple platforms. We’ll show you how to take advantage of common text elements and create entirely custom interactions for your app. Learn about updates to dictation, text loupe, and text selection, and explore improvements to text clipping, line wrapping, and hyphenation.","type":"text"}],"kind":"article","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/MortenGregersen":{"role":"sampleCode","kind":"article","title":"Morten Bjerg Gregersen (21 notes)","type":"topic","url":"\/documentation\/wwdcnotes\/mortengregersen","abstract":[{"type":"text","text":"Hi 👋 I am Morten - I live in Denmark 🇩🇰"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/MortenGregersen"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","kind":"symbol","role":"collection","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}]},"WWDCNotes.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image","identifier":"WWDCNotes.png","alt":null},"http://atterdagapps.com":{"url":"http:\/\/atterdagapps.com","type":"link","identifier":"http:\/\/atterdagapps.com","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}]},"https://github.com/MortenGregersen":{"url":"https:\/\/github.com\/MortenGregersen","type":"link","identifier":"https:\/\/github.com\/MortenGregersen","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}]},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","type":"link","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]}}}