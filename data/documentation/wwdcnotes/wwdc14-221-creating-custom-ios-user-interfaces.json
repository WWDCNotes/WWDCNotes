{"kind":"article","metadata":{"role":"sampleCode","roleHeading":"WWDC14","title":"Creating Custom iOS User Interfaces","modules":[{"name":"WWDC Notes"}]},"sections":[],"abstract":[{"text":"Make your app stand out from the competition with a compelling, yet familiar, user interface, and custom controls that match your app’s personality and effectively reveal it’s key features. Learn advanced Core Animation techniques such as spring view animations, and see new visual effects such as blur and vibrancy and how they can give your apps a visual edge.","type":"text"}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC14"]]},"schemaVersion":{"patch":0,"minor":3,"major":0},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC14-221-Creating-Custom-iOS-User-Interfaces"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc14-221-creating-custom-ios-user-interfaces"]}],"primaryContentSections":[{"content":[{"anchor":"1-Spring-animations","type":"heading","level":2,"text":"1. Spring animations"},{"type":"paragraph","inlineContent":[{"text":"Spring Animation is the base of almost every animation in the iOS 8 system, which means almost all of the animations in iOS 8 are using spring animation. It was introduced in iOS 7 via ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/UIKit\/Reference\/UIView_Class\/index.html#\/\/apple_ref\/occ\/clm\/UIView\/animateWithDuration:delay:usingSpringWithDamping:initialSpringVelocity:options:animations:completion:"},{"text":":","type":"text"}]},{"type":"codeListing","code":["+animateWithDuration:delay:usingSpringWithDamping:initialSpringVelocity:options:animations:completion:"],"syntax":"objc"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This function is very similar with ordinary animation functions we used to using a lot. The only difference here is two additional parameters: Damping Ratio and Initial Spring Velocity."}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"The damping ratio defines how much the oscillation oscillate at the end state of the animation, ranging from ","type":"text"},{"code":"0.0","type":"codeVoice"},{"text":" to ","type":"text"},{"code":"1.0","type":"codeVoice"},{"text":". ","type":"text"},{"code":"0.0","type":"codeVoice"},{"text":" defines high frequency oscillation, while ","type":"text"},{"code":"1.0","type":"codeVoice"},{"text":" defines no oscillation at all. This is place where can help us make a bouncing effect.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The initial spring velocity defines how fast the animation starts. The smaller the volecity is, the sooner the animation object will move to the end state, verse vice."}]}]}]},{"type":"paragraph","inlineContent":[{"text":"The following demo code imitates the Animation of Opening Folder on iOS Home Screen:","type":"text"}]},{"type":"codeListing","code":["const static CGFloat BOXSIZE = 100.f;","- (void)tapped:(UITapGestureRecognizer *)gesture","{","[self initBox];","[UIView animateWithDuration:1.f","delay:0.f","usingSpringWithDamping:.75f","initialSpringVelocity:.5f","options:0","animations:^{","[self endBox];","} completion:^(BOOL finished) {","\/\/","}];","}","","- (void)initBox","{","self.movingBox.frame = CGRectMake(0.f, self.view.bounds.size.height - BOXSIZE, BOXSIZE, BOXSIZE);","}","","- (void)endBox","{","self.movingBox.frame = CGRectMake(CGRectGetMidX(self.view.bounds) - BOXSIZE * 3.f \/ 2.f, CGRectGetMidY(self.view.bounds) - BOXSIZE * 3.f \/ 2.f, BOXSIZE * 3.f, BOXSIZE * 3.f);","}"],"syntax":"objc"},{"anchor":"2-Vibrancy-and-blur","type":"heading","level":2,"text":"2. Vibrancy and blur"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In iOS 8, "},{"identifier":"https:\/\/developer.apple.com\/library\/prerelease\/ios\/documentation\/UIKit\/Reference\/UIBlurEffect_Ref\/index.html#\/\/apple_ref\/occ\/cl\/UIBlurEffect","isActive":true,"type":"reference"},{"type":"text","text":" and "},{"identifier":"https:\/\/developer.apple.com\/library\/prerelease\/ios\/documentation\/UIKit\/Reference\/UIVibrancyEffect\/index.html#\/apple_ref\/occ\/cl\/UIVibrancyEffect","isActive":true,"type":"reference"},{"type":"text","text":" are introduced for developers have Dynamic Blur Effect more easily. In the talk, Apple still recommends using static blur effect code if dynamic blur effect views are not actually what you need, since dynamic blur effect takes a lot of computing power."}]},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"UIBlurEffect","type":"codeVoice"},{"text":" gives blur effect to an associated ","type":"text"},{"code":"UIView","type":"codeVoice"},{"text":", while ","type":"text"},{"code":"UIVibrancyEffect","type":"codeVoice"},{"text":" gives the clear part which is not blurred on the blurred view. So, this is a three layer structure. ","type":"text"},{"code":"UIView","type":"codeVoice"},{"text":" at the bottom, then comes the ","type":"text"},{"code":"UIBlurEffect","type":"codeVoice"},{"text":", at last the ","type":"text"},{"code":"UIVibrancyEffect","type":"codeVoice"},{"text":" comes. The ","type":"text"},{"code":"UIVibrancyEffect","type":"codeVoice"},{"text":" consumes the most computing power. The ","type":"text"},{"code":"UIBlurEffect","type":"codeVoice"},{"text":" gives three styles for the developer to use, ","type":"text"},{"code":"UIBlurEffectStyleExtraLight","type":"codeVoice"},{"text":", ","type":"text"},{"code":"UIBlurEffectStyleLight","type":"codeVoice"},{"text":", ","type":"text"},{"code":"UIBlurEffectStyleDark","type":"codeVoice"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"The example could be found at Siri User Interface, where user could clearly see the app icons on the Home Screen of the iPhone.","type":"text"}]},{"anchor":"3-Shape-layers","type":"heading","level":2,"text":"3. Shape layers"},{"type":"paragraph","inlineContent":[{"text":"This section covers ","type":"text"},{"code":"CAShapeLayer","type":"codeVoice"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"How to use ","type":"text"},{"type":"codeVoice","code":"CAShapeLayer"},{"text":" back up the ","type":"text"},{"type":"codeVoice","code":"UIView"},{"text":" as the base layer. In ","type":"text"},{"type":"codeVoice","code":"UIView"},{"text":" subclass,","type":"text"}]},{"type":"codeListing","code":["+ (Class)layerClass {","return [CAShapeLayer Class];","}","","- (void)awakeFromNib {","CAShapeLayer *layer = (CAShapeLayer *)self.layer;","\/\/ init layer properties here.","\/\/ Also, everytime to update layer property, convert it to CAShaperLayer and use a local variable for it.","}"],"syntax":"objc"},{"type":"paragraph","inlineContent":[{"text":"How to draw part of the path for ","type":"text"},{"code":"CAShapeLayer","type":"codeVoice"},{"text":", by setting ","type":"text"},{"code":"strokeStart","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"strokeEnd","type":"codeVoice"},{"text":".","type":"text"}]},{"anchor":"4-Dynamic-Core-Animation-behaviors","type":"heading","level":2,"text":"4. Dynamic Core Animation behaviors"},{"type":"paragraph","inlineContent":[{"text":"This is probably the most challenging part for me, so many sample code on ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/GraphicsImaging\/Reference\/CABasicAnimation_class\/index.html","type":"reference"},{"text":". I think have a good use of ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/GraphicsImaging\/Reference\/CAAction_protocol\/index.html","type":"reference"},{"text":" Protocol and ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/QuartzCore\/Reference\/CALayerDelegate_protocol\/","type":"reference"},{"text":" method could greatly help your custom ","type":"text"},{"code":"UIView","type":"codeVoice"},{"text":" subclass have great animation effect when ","type":"text"},{"code":"UIView","type":"codeVoice"},{"text":"’s properties are changed. Also, the developer could define customized property, which could be very powerful. By using this technique, developers could not only customize animation behavior, but also disable system’s default animation behaviors.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here is a simple piece of demo:"}]},{"type":"codeListing","code":["#import \"CustomAnimationView.h\"","","@interface CustomAnimationAction : NSObject <CAAction>","@end","","@implementation CustomAnimationAction","","- (void)runActionForKey:(NSString *)event object:(id)anObject arguments:(NSDictionary *)dict","{","if ([event isEqualToString:@\"opacity\"]) {","CALayer *layer = (CALayer *)anObject;","CFTimeInterval duration = .75;","","CABasicAnimation *bgAnimation = [CABasicAnimation animationWithKeyPath:@\"backgroundColor\"];","bgAnimation.duration = duration;","bgAnimation.fromValue = (id)[layer.presentationLayer backgroundColor];","bgAnimation.toValue = (id)([UIColor colorWithHue:layer.opacity saturation:1.f brightness:1.f alpha:1.f].CGColor);","bgAnimation.fillMode = kCAFillModeForwards;","bgAnimation.removedOnCompletion = NO;","[layer addAnimation:bgAnimation forKey:@\"bgColorAnim\"];","","CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@\"opacity\"];","animation.duration = duration;","animation.fromValue = @([layer.presentationLayer opacity]);","animation.toValue = @(layer.opacity);","animation.removedOnCompletion = NO;","[layer addAnimation:animation forKey:@\"customKey\"];","}","}","","@end","","@implementation CustomAnimationView","","+ (Class)layerClass","{","return [CAShapeLayer class];","}","","- (void)awakeFromNib","{","[self setup];","}","","- (instancetype)initWithFrame:(CGRect)frame","{","if (self = [super initWithFrame:frame]) {","[self setup];","}","return self;","}","","- (void)setup","{","CAShapeLayer *layer = (CAShapeLayer *)self.layer;","","UIBezierPath *path = [UIBezierPath bezierPathWithRect:self.bounds];","","[layer setPath:path.CGPath];","[layer setStrokeColor:[UIColor purpleColor].CGColor];","[layer setLineWidth:6];","[layer setFillColor:nil];","[layer setLineCap:kCALineCapRound];","[layer setLineJoin:kCALineJoinBevel];","","UITapGestureRecognizer *gesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapped:)];","[self addGestureRecognizer:gesture];","}","","- (void)tapped:(UITapGestureRecognizer *)gesture","{","[UIView animateWithDuration:1.0 animations:^{","[self setAlpha:(CGFloat)(arc4random() % 10) \/ 10.f];","}];","}","","- (id<CAAction>)actionForLayer:(CALayer *)layer","forKey:(NSString *)key","{","if ([key isEqualToString:@\"opacity\"]) {","return [[CustomAnimationAction alloc] init];","}","return [super actionForLayer:layer forKey:key];","}","","@end"],"syntax":"objc"},{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"Worth to mention","type":"text"}]},{"type":"text","text":" here: when Custom View’s frame origin changed, the Key for the change will be "},{"type":"strong","inlineContent":[{"type":"text","text":"“Position”"}]},{"type":"text","text":", rather than "},{"type":"strong","inlineContent":[{"text":"“Frame”","type":"text"}]},{"type":"text","text":". This is because "},{"code":"UIView","type":"codeVoice"},{"type":"text","text":" is backed by "},{"code":"CALayer","type":"codeVoice"},{"type":"text","text":", where essentially all the animations added to. My guess would be: any animation of changing property of "},{"code":"UIView","type":"codeVoice"},{"type":"text","text":" will be “mirrored” to some action of changing property of "},{"code":"CALayer","type":"codeVoice"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"text":"For more information, here is a link to the ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/Cocoa\/Conceptual\/CoreAnimation_guide\/ReactingtoLayerChanges\/ReactingtoLayerChanges.html","type":"reference"},{"text":".","type":"text"}]},{"anchor":"Written-By","type":"heading","level":2,"text":"Written By"},{"numberOfColumns":5,"type":"row","columns":[{"size":1,"content":[{"inlineContent":[{"type":"image","identifier":"antonio081014"}],"type":"paragraph"}]},{"size":4,"content":[{"level":3,"text":"Yi","anchor":"Yi","type":"heading"},{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/antonio081014","isActive":true,"type":"reference","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}]},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/antonio081014","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/medium.com\/@antonio081014","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/x.com\/antonio081014","isActive":true,"type":"reference"}]}]}]},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","isActive":true,"type":"reference"}]},{"type":"small","inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}]},{"type":"small","inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}]}],"kind":"content"}],"sampleCodeDownload":{"action":{"identifier":"http:\/\/developer.apple.com\/wwdc14\/221","overridingTitle":"Watch Video","isActive":true,"type":"reference"},"kind":"sampleDownload"},"references":{"WWDCNotes.png":{"type":"image","identifier":"WWDCNotes.png","alt":null,"variants":[{"url":"\/images\/WWDCNotes\/WWDCNotes.png","traits":["1x","light"]}]},"antonio081014.jpeg":{"identifier":"antonio081014.jpeg","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/antonio081014.jpeg"}],"alt":null},"https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CABasicAnimation_class/index.html":{"url":"https:\/\/developer.apple.com\/library\/ios\/documentation\/GraphicsImaging\/Reference\/CABasicAnimation_class\/index.html","titleInlineContent":[{"type":"codeVoice","code":"CABasicAnimation"}],"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/GraphicsImaging\/Reference\/CABasicAnimation_class\/index.html","type":"link","title":"CABasicAnimation"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC14":{"url":"\/documentation\/wwdcnotes\/wwdc14","type":"topic","role":"collectionGroup","abstract":[{"text":"Xcode 6, Swift 1.0, iOS 8, macOS 10.10 (Yosemite).","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC14","images":[{"type":"icon","identifier":"WWDC14-Icon.png"},{"type":"card","identifier":"WWDC14.jpeg"}],"kind":"article","title":"WWDC14"},"https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/ReactingtoLayerChanges/ReactingtoLayerChanges.html":{"type":"link","title":"Apple Developer Official Page","url":"https:\/\/developer.apple.com\/library\/ios\/documentation\/Cocoa\/Conceptual\/CoreAnimation_guide\/ReactingtoLayerChanges\/ReactingtoLayerChanges.html","identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/Cocoa\/Conceptual\/CoreAnimation_guide\/ReactingtoLayerChanges\/ReactingtoLayerChanges.html","titleInlineContent":[{"type":"text","text":"Apple Developer Official Page"}]},"WWDC14.jpeg":{"identifier":"WWDC14.jpeg","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC14.jpeg"}],"alt":null},"https://x.com/antonio081014":{"url":"https:\/\/x.com\/antonio081014","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"identifier":"https:\/\/x.com\/antonio081014","type":"link","title":"X\/Twitter"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"type":"link","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIVibrancyEffect/index.html#/apple_ref/occ/cl/UIVibrancyEffect":{"identifier":"https:\/\/developer.apple.com\/library\/prerelease\/ios\/documentation\/UIKit\/Reference\/UIVibrancyEffect\/index.html#\/apple_ref\/occ\/cl\/UIVibrancyEffect","title":"UIVibrancyEffect","type":"link","titleInlineContent":[{"code":"UIVibrancyEffect","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/library\/prerelease\/ios\/documentation\/UIKit\/Reference\/UIVibrancyEffect\/index.html#\/apple_ref\/occ\/cl\/UIVibrancyEffect"},"https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/occ/clm/UIView/animateWithDuration:delay:usingSpringWithDamping:initialSpringVelocity:options:animations:completion:":{"url":"https:\/\/developer.apple.com\/library\/ios\/documentation\/UIKit\/Reference\/UIView_Class\/index.html#\/\/apple_ref\/occ\/clm\/UIView\/animateWithDuration:delay:usingSpringWithDamping:initialSpringVelocity:options:animations:completion:","titleInlineContent":[{"type":"text","text":"one single function"}],"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/UIKit\/Reference\/UIView_Class\/index.html#\/\/apple_ref\/occ\/clm\/UIView\/animateWithDuration:delay:usingSpringWithDamping:initialSpringVelocity:options:animations:completion:","type":"link","title":"one single function"},"doc://WWDCNotes/documentation/WWDCNotes/antonio081014":{"images":[{"identifier":"antonio081014.jpeg","type":"card"},{"identifier":"antonio081014.jpeg","type":"icon"}],"url":"\/documentation\/wwdcnotes\/antonio081014","abstract":[{"type":"text","text":"Reveal a brilliant idea in a very mobile engineer way."}],"kind":"article","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/antonio081014","title":"Yi (16 notes)","role":"sampleCode"},"https://github.com/antonio081014":{"type":"link","title":"GitHub","url":"https:\/\/github.com\/antonio081014","identifier":"https:\/\/github.com\/antonio081014","titleInlineContent":[{"type":"text","text":"GitHub"}]},"https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIBlurEffect_Ref/index.html#//apple_ref/occ/cl/UIBlurEffect":{"identifier":"https:\/\/developer.apple.com\/library\/prerelease\/ios\/documentation\/UIKit\/Reference\/UIBlurEffect_Ref\/index.html#\/\/apple_ref\/occ\/cl\/UIBlurEffect","title":"UIBlurEffect","type":"link","titleInlineContent":[{"code":"UIBlurEffect","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/library\/prerelease\/ios\/documentation\/UIKit\/Reference\/UIBlurEffect_Ref\/index.html#\/\/apple_ref\/occ\/cl\/UIBlurEffect"},"http://developer.apple.com/wwdc14/221":{"url":"http:\/\/developer.apple.com\/wwdc14\/221","identifier":"http:\/\/developer.apple.com\/wwdc14\/221","type":"download","checksum":null},"https://medium.com/@antonio081014":{"type":"link","title":"Blog","url":"https:\/\/medium.com\/@antonio081014","identifier":"https:\/\/medium.com\/@antonio081014","titleInlineContent":[{"text":"Blog","type":"text"}]},"https://developer.apple.com/library/ios/documentation/QuartzCore/Reference/CALayerDelegate_protocol/":{"url":"https:\/\/developer.apple.com\/library\/ios\/documentation\/QuartzCore\/Reference\/CALayerDelegate_protocol\/","titleInlineContent":[{"type":"codeVoice","code":"CALayerDelegate"}],"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/QuartzCore\/Reference\/CALayerDelegate_protocol\/","type":"link","title":"CALayerDelegate"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","role":"collection","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","kind":"symbol"},"WWDC14-Icon.png":{"identifier":"WWDC14-Icon.png","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC14-Icon.png"}],"alt":null},"antonio081014":{"type":"image","identifier":"antonio081014","alt":"Profile image of Yi","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/antonio081014.jpeg"}]},"https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAAction_protocol/index.html":{"url":"https:\/\/developer.apple.com\/library\/ios\/documentation\/GraphicsImaging\/Reference\/CAAction_protocol\/index.html","titleInlineContent":[{"type":"codeVoice","code":"CAAction"}],"identifier":"https:\/\/developer.apple.com\/library\/ios\/documentation\/GraphicsImaging\/Reference\/CAAction_protocol\/index.html","type":"link","title":"CAAction"}}}