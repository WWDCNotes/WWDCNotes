{"kind":"article","sections":[],"metadata":{"title":"Create Swift Package plugins","roleHeading":"WWDC22","role":"sampleCode","modules":[{"name":"WWDC Notes"}]},"abstract":[{"text":"Tailor your development workflow and learn how to write your own package plugins in Swift. We’ll show you how you can extend Xcode’s functionality by using the PackagePlugin API to generate source code or automate release tasks and share best practices for creating great plugins.","type":"text"}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22"]]},"schemaVersion":{"major":0,"patch":0,"minor":3},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110401-Create-Swift-Package-plugins","interfaceLanguage":"swift"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc22-110401-create-swift-package-plugins"]}],"primaryContentSections":[{"kind":"content","content":[{"level":2,"text":"What is a package plugin?","type":"heading","anchor":"What-is-a-package-plugin"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Xcode runs plugins, plugins can communicate back"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Can be used for custom build tasks"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Also custom commands to SwiftPM CLI can be added"}]}]}],"type":"unorderedList"},{"level":2,"text":"Custom commands","type":"heading","anchor":"Custom-commands"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"First, create a new folder in package called "},{"type":"codeVoice","code":"Plugins"}]}]},{"content":[{"inlineContent":[{"text":"Create another nested folder for plugin target, e.g. ","type":"text"},{"code":"GenerateContributors","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Create a Swift file inside, e.g. ","type":"text"},{"code":"plugin.swift","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Make sure to bump the package tools version to 5.6 (or higher)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Insert "},{"type":"codeVoice","code":".plugin"},{"type":"text","text":" in the "},{"type":"codeVoice","code":"targets"},{"type":"text","text":" in your package manifest file:"}]}]}],"type":"unorderedList"},{"syntax":"swift","type":"codeListing","code":[".plugin(","  name: \"GenerateContributors\",","  capability: .command(","    intent: .custom(","      verb: \"regenerate-contributors-list\",","      description: \"Generates the CONTRIBUTORS.txt file based on Git logs\"","    ),","    permissions: [","      .writeToPackageDirectory(reason: \"This command write the new CONTRIBUTORS.txt to the source root.\")","    ]","  )","),"]},{"items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"intent"},{"text":" can define a verb for the SwiftPM command line for ","type":"text"},{"type":"codeVoice","code":"command"},{"text":" capability plugins","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"permissions"},{"text":" is used if you need to write into a directory (Sandbox)","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement by "},{"type":"codeVoice","code":"import PackagePlugin"},{"type":"text","text":" and conforming to "},{"type":"codeVoice","code":"CommandPlugin"},{"type":"text","text":" protocol"}]}]},{"content":[{"inlineContent":[{"text":"To shell out to other tools, ","type":"text"},{"code":"import Foundation","type":"codeVoice"},{"text":" and then call ","type":"text"},{"code":"Process().executableURL","type":"codeVoice"},{"text":" and ","type":"text"},{"code":".arguments","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Define a "},{"code":"Pipe","type":"codeVoice"},{"type":"text","text":" to read output so you can use it in your logic"}]}]}],"type":"unorderedList"},{"syntax":"swift","type":"codeListing","code":["import PackagePlugin","import Foundation","","@main","struct GenerateContributors: CommandPlugin {","","  func performCommand(","    context: PluginContext,","    arguments: [String]","  ) async throws {","    let process = Process()","    process.executableURL = URL(fileURLWithPath: \"\/usr\/bin\/git\")","    process.arguments = [\"log\", \"--pretty=format:- %an <%ae>%n\"]","","    let outputPipe = Pipe()","    process.standardOutput = outputPipe","    try process.run()","    process.waitUntilExit()","","    let outputData = outputPipe.fileHandleForReading.readDataToEndOfFile()","    let output = String(decoding: outputData, as: UTF8.self)","","    let contributors = Set(output.components(separatedBy: CharacterSet.newlines)).sorted().filter { !$0.isEmpty }","    try contributors.joined(separator: \"\\n\").write(toFile: \"CONTRIBUTORS.txt\", atomically: true, encoding: .utf8)","  }","}"]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"New command available in right-click context-menu of package"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Xcode will ask for permission showing the text in ","type":"text"},{"type":"codeVoice","code":"permissions"},{"text":" from manifest file","type":"text"}]}]}],"type":"unorderedList"},{"level":2,"text":"Plugins in detail","type":"heading","anchor":"Plugins-in-detail"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Package plugins run in a Sandbox, access to work directory only"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"To wrap another tool, make sure it only writes in work directory"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Build Tool Plugins structure (similar to run script phases in Xcode)","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Executables"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Inputs"}]}]},{"content":[{"inlineContent":[{"text":"Outputs","type":"text"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Types of Build Tool Plugins"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"In-build command (if you have a clear set of outputs)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Pre-build command (if no clear outputs, but make sure to be performant!)"}],"type":"paragraph"}]}]}]}],"type":"unorderedList"},{"level":2,"text":"In-build commands","type":"heading","anchor":"In-build-commands"},{"items":[{"content":[{"inlineContent":[{"text":"Plugins get run at the start of the build process","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Use ","type":"text"},{"type":"codeVoice","code":"ProcessInfo().arguments"},{"text":" to read arguments in your own tool","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"To create an executable, create new folder in ","type":"text"},{"code":"Sources","type":"codeVoice"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Then add a "},{"type":"codeVoice","code":"main.swift"},{"type":"text","text":" file"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Declare it in the "},{"code":"Package.manifest","type":"codeVoice"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Put the tool target into the "},{"type":"codeVoice","code":"dependencies"},{"type":"text","text":" of your plugin to use it"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Extend "},{"type":"codeVoice","code":"BuildToolPlugin"},{"type":"text","text":" instead of "},{"type":"codeVoice","code":"CommandPlugin"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Pre-build commands","type":"heading","anchor":"Pre-build-commands"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"To make a plugin available to clients of a package, add it to "},{"type":"codeVoice","code":"products"},{"type":"text","text":" in "},{"type":"codeVoice","code":"Package.swift"},{"type":"text","text":" manifest file"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Written By","type":"heading","anchor":"Written-By"},{"columns":[{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"Jeehut"}]}],"size":1},{"content":[{"level":3,"text":"Cihat Gündüz","anchor":"Cihat-G%C3%BCnd%C3%BCz","type":"heading"},{"inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Jeehut","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/Jeehut","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/fline.dev","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/x.com\/Jeehut","isActive":true,"type":"reference"}],"type":"paragraph"}],"size":4}],"numberOfColumns":5,"type":"row"},{"type":"thematicBreak"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","isActive":true,"type":"reference"}],"type":"paragraph"},{"level":2,"text":"Related Sessions","type":"heading","anchor":"Related-Sessions"},{"style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110354-Whats-new-in-Swift","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110359-Meet-Swift-Package-plugins","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110427-Whats-new-in-Xcode","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10220-Localize-your-SwiftUI-app","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10169-Swift-packages-Resources-and-localization","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-410-Creating-Swift-Packages"],"type":"links"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}]}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc22\/110401","overridingTitle":"Watch Video (24 min)","isActive":true}},"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110427-Whats-new-in-Xcode":{"role":"sampleCode","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110427-Whats-new-in-Xcode","url":"\/documentation\/wwdcnotes\/wwdc22-110427-whats-new-in-xcode","type":"topic","abstract":[{"type":"text","text":"Discover the latest productivity and performance advancements in Xcode 14. We’ll introduce you to the fully redesigned SwiftUI canvas experience, explore enhancements to code completion and navigation, and take you through performance improvements we’ve made throughout the entire development process. We’ll also show you how you can now read and respond to feedback on your TestFlight builds without ever leaving Xcode."}],"title":"What’s new in Xcode"},"Jeehut.jpeg":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/Jeehut.jpeg","traits":["1x","light"]}],"alt":null,"identifier":"Jeehut.jpeg"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10169-Swift-packages-Resources-and-localization":{"url":"\/documentation\/wwdcnotes\/wwdc20-10169-swift-packages-resources-and-localization","role":"sampleCode","title":"Swift packages: Resources and localization","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10169-Swift-packages-Resources-and-localization","type":"topic","kind":"article","abstract":[{"type":"text","text":"Bring your resources along for the ride when you organize and share code using Swift packages. Discover how to include assets like images and storyboards in a package and how to access them from code. And learn how to add localized strings to make your code accessible to people around the world."}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-410-Creating-Swift-Packages":{"type":"topic","role":"sampleCode","abstract":[{"text":"Whether you want to publish code to share with the community, or you just want a convenient way to organize the code in your apps, Swift packages are here to help. Learn how to create local packages for your own development, how to customize your package via the manifest file, and how to go about publishing a package for others to use.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc19-410-creating-swift-packages","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-410-Creating-Swift-Packages","title":"Creating Swift Packages","kind":"article"},"https://github.com/Jeehut":{"url":"https:\/\/github.com\/Jeehut","type":"link","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}],"identifier":"https:\/\/github.com\/Jeehut"},"https://x.com/Jeehut":{"title":"X\/Twitter","type":"link","identifier":"https:\/\/x.com\/Jeehut","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"url":"https:\/\/x.com\/Jeehut"},"https://fline.dev":{"type":"link","titleInlineContent":[{"text":"Blog","type":"text"}],"identifier":"https:\/\/fline.dev","title":"Blog","url":"https:\/\/fline.dev"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22","kind":"article","type":"topic","images":[{"identifier":"WWDC22-Icon.png","type":"icon"},{"identifier":"WWDC22.jpeg","type":"card"}],"role":"collectionGroup","abstract":[{"type":"text","text":"Xcode 14, Swift 5.7, iOS 16, macOS 13 (Ventura), tvOS 16, watchOS 9."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"WeatherKit"},{"type":"text","text":", "},{"type":"codeVoice","code":"ScreenCaptureKit"},{"type":"text","text":", "},{"type":"codeVoice","code":"Swift Regex"},{"type":"text","text":", and more."}],"url":"\/documentation\/wwdcnotes\/wwdc22","title":"WWDC22"},"WWDC22.jpeg":{"type":"image","identifier":"WWDC22.jpeg","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC22.jpeg"}]},"WWDC22-Icon.png":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC22-Icon.png","traits":["1x","light"]}],"alt":null,"identifier":"WWDC22-Icon.png"},"doc://WWDCNotes/documentation/WWDCNotes/Jeehut":{"url":"\/documentation\/wwdcnotes\/jeehut","type":"topic","role":"sampleCode","abstract":[{"type":"text","text":"Spatial-first Indie Developer for  Platforms. Actively contributing to Open Source since 2011!"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Jeehut","images":[{"identifier":"Jeehut.jpeg","type":"card"},{"identifier":"Jeehut.jpeg","type":"icon"}],"kind":"article","title":"Cihat Gündüz (61 notes)"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10220-Localize-your-SwiftUI-app":{"type":"topic","kind":"article","abstract":[{"type":"text","text":"Learn how to localize your SwiftUI app and make it available to a global audience. Explore how you can localize strings in SwiftUI, including those with styles and formatting. We’ll demonstrate how you can save time by having SwiftUI automatically handle tasks such as layout and keyboard shortcuts, and take you through the localization workflow in Xcode 13."}],"role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10220-Localize-your-SwiftUI-app","title":"Localize your SwiftUI app","url":"\/documentation\/wwdcnotes\/wwdc21-10220-localize-your-swiftui-app"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","role":"collection","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","kind":"symbol"},"https://developer.apple.com/wwdc22/110401":{"url":"https:\/\/developer.apple.com\/wwdc22\/110401","type":"download","checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc22\/110401"},"Jeehut":{"type":"image","identifier":"Jeehut","alt":"Profile image of Cihat Gündüz","variants":[{"url":"\/images\/WWDCNotes\/Jeehut.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110354-Whats-new-in-Swift":{"abstract":[{"type":"text","text":"Join us for an update on Swift. We’ll take you through performance improvements, explore more secure and extensible Swift packages, and share advancements in Swift concurrency. We’ll also introduce you to Swift Regex, better generics, and other tools built into the language to help you write more flexible & expressive code."}],"kind":"article","type":"topic","role":"sampleCode","title":"What’s new in Swift","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110354-Whats-new-in-Swift","url":"\/documentation\/wwdcnotes\/wwdc22-110354-whats-new-in-swift"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110359-Meet-Swift-Package-plugins":{"type":"topic","kind":"article","title":"Meet Swift Package plugins","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110359-Meet-Swift-Package-plugins","url":"\/documentation\/wwdcnotes\/wwdc22-110359-meet-swift-package-plugins","abstract":[{"type":"text","text":"Discover how you can perform actions on Swift packages and Xcode projects with Swift package plugins. We’ll go over how these plugins work and explore how you can use them to generate source code and automate your development workflow."}],"role":"sampleCode"},"WWDCNotes.png":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"alt":null,"identifier":"WWDCNotes.png"}}}