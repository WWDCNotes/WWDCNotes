{"kind":"article","abstract":[{"text":"Swift is a great language for writing your server applications, and powers critical services across Appleâ€™s cloud products. Weâ€™ll explore tooling, delve into the Swift server package ecosystem, and demonstrate how to interact with databases and add observability to applications.","type":"text"}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc24-10216-explore-the-swift-on-server-ecosystem"],"traits":[{"interfaceLanguage":"swift"}]}],"sections":[],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24"]]},"sampleCodeDownload":{"kind":"sampleDownload","action":{"overridingTitle":"Watch Video","type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/wwdc24\/10216"}},"metadata":{"roleHeading":"WWDC24","modules":[{"name":"WWDC Notes"}],"title":"Explore the Swift on Server ecosystem","role":"sampleCode"},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10216-Explore-the-Swift-on-Server-ecosystem"},"primaryContentSections":[{"kind":"content","content":[{"anchor":"Presenter","level":2,"text":"Presenter","type":"heading"},{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Franz Busch, Swift on Server Team","type":"text"}],"type":"emphasis"}]},{"anchor":"Key-takeaways","level":2,"text":"Key takeaways","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"âš¡ï¸ C-like performance","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"ðŸ¤“ Low memory footprint"}]}]},{"content":[{"inlineContent":[{"text":"ðŸ¤ž Safe and expressive - strong-typing, optionals, and memory safety","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"ðŸ§® First-class concurrency features"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"SSWG","level":2,"text":"SSWG","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"isActive":true,"identifier":"https:\/\/www.swift.org\/sswg\/","type":"reference"},{"text":" was founded in 2016 is the oldest of the workgroups.","type":"text"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Defining and prioritizing efforts to address the needs of the server community"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Reducing duplication by incubating packages"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Increase Compatibility","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Promote best practices"}]}]}],"type":"unorderedList"},{"anchor":"Server-Package-IDEs","level":2,"text":"Server Package IDEâ€™s","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Xcode","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"VSCode (Example)"}]}]},{"content":[{"inlineContent":[{"text":"Neovim","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Any editor supporting Language Server Protocol","type":"text"}]}]}],"type":"unorderedList"},{"anchor":"Example-Package","level":2,"text":"Example Package","type":"heading"},{"code":["\/\/ swift-tools-version:5.9","import PackageDescription","","let package = Package(","    name: \"EventService\",","    platforms: [.macOS(.v14)],","    dependencies: [","        .package(","            url: \"https:\/\/github.com\/apple\/swift-openapi-generator\",","            from: \"1.2.1\"","        ),","        .package(","            url: \"https:\/\/github.com\/apple\/swift-openapi-runtime\",","            from: \"1.4.0\"","        ),","        .package(","            url: \"https:\/\/github.com\/vapor\/vapor\",","            from: \"4.99.2\"","        ),","        .package(","            url: \"https:\/\/github.com\/swift-server\/swift-openapi-vapor\",","            from: \"1.0.1\"","        ),","    ],  ","    targets: [","        .target(","            name: \"EventAPI\",","            dependencies: [","                .product(","                    name: \"OpenAPIRuntime\",","                    package: \"swift-openapi-runtime\"","                ),","            ],","            plugins: [","                .plugin(","                    name: \"OpenAPIGenerator\",","                    package: \"swift-openapi-generator\"","                )","            ]","        ),","        .executableTarget(","            name: \"EventService\",","            dependencies: [","                \"EventAPI\",","                .product(","                    name: \"OpenAPIRuntime\",","                    package: \"swift-openapi-runtime\"","                ),","                .product(","                    name: \"OpenAPIVapor\",","                    package: \"swift-openapi-vapor\"","                ),","                .product(","                    name: \"Vapor\",","                    package: \"vapor\"","                ),","            ]  ","        ),","    ]",")"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The two targets of the Package are the "},{"type":"codeVoice","code":"EventAPI"},{"type":"text","text":" which has the OpenAPIGenerator plugin configured and the "},{"type":"codeVoice","code":"EventService"},{"type":"text","text":" executableTarget."}]},{"anchor":"Swift-OpenAPI-Generator","level":3,"text":"Swift OpenAPI Generator","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"service documentation in YAML"}]},{"code":["openapi: \"3.1.0\"","info:","    title: \"EventService\"","    version: \"1.0.0\"","servers:","    - url: \"https:\/\/localhost:8080\/api\"","        description: \"Example service deployment.\"","paths:","    \/events:","        get:","            operationId: \"listEvents\"","            responses:","                \"200\":","                    description: \"A success response with all events.\"","                    content:","                        application\/json:","                            schema:","                                type: \"array\"","                                items:","                                    $ref: \"#\/components\/schemas\/Event\"","        post:","            operationId: \"createEvent\"","            requestBody:","                description: \"The event to create.\"","                required: true","                content:","                    application\/json:","                        schema:","                            $ref: '#\/components\/schemas\/Event'","            responses:","                '201':","                    description: \"A success indicating the event was created.\"","                '400':","                    description: \"A failure indicating the event wasn't created.\"","components:","    schemas:","        Event:","            type: \"object\"","            description: \"An event.\"","            properties:","                name:","                    type: \"string\"","                    description: \"The event's name.\"","                date:","                    type: \"string\"","                    format: \"date\"","                    description: \"The day of the event.\"","                attendee:","                    type: \"string\"","                    description: \"The name of the person attending the event.\"","            required:","                - \"name\"","                - \"date\"","                - \"attendee\""],"type":"codeListing","syntax":"yaml"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Defined are both operations in the events path."}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"The first operation is a get method called "},{"type":"codeVoice","code":"listEvents"},{"type":"text","text":". The operation returns a success response containing an array of events."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The second operation is a post method called ","type":"text"},{"code":"createEvent","type":"codeVoice"},{"text":". This operation takes a JSON body of an event and depending if the creation was successful the operation returns a 201 or a 400 status code.","type":"text"}]}]}],"type":"unorderedList"},{"anchor":"Main-Entry-Point","level":2,"text":"Main Entry Point","type":"heading"},{"code":["import OpenAPIRuntime","import OpenAPIVapor","import Vapor","import EventAPI","","@main","struct Service {","    static func main() async throws {","        let application = try await Vapor.Application.make()","        let transport = VaporTransport(routesBuilder: application)","","        let service = Service()","        try service.registerHandlers(","            on: transport,","            serverURL: URL(string: \"\/api\")!","        )","","        try await application.execute()","    }","}"],"type":"codeListing","syntax":"swift"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Vapor application"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"OpenAPI ","type":"text"},{"code":"VaporTransport","type":"codeVoice"}]}]},{"content":[{"inlineContent":[{"text":"Instance of Service","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Register Service with Trasport"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Execute Vapor application - starting an HTTP server listening for incomming connections"}],"type":"paragraph"}]}],"type":"orderedList"},{"code":["extension Service: APIProtocol {","    func listEvents(","        _ input: Operations.listEvents.Input","    ) async throws -> Operations.listEvents.Output {","        let events: [Components.Schemas.Event] = [","            .init(name: \"Server-Side Swift Conference\", date: \"26.09.2024\", attendee: \"Gus\"),","            .init(name: \"Oktoberfest\", date: \"21.09.2024\", attendee: \"Werner\"),","        ]","","        return .ok(.init(body: .json(events)))","    }","","    func createEvent(","        _ input: Operations.createEvent.Input","    ) async throws -> Operations.createEvent.Output {","        return .undocumented(statusCode: 501, .init())","    }","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"Service implements generated APIProtocol","type":"text"},{"text":" ","type":"text"},{"text":"Array of Events returned by ","type":"text"},{"code":"listEvents","type":"codeVoice"},{"text":" method","type":"text"},{"text":" ","type":"text"},{"text":"â€œNot Implementedâ€ status code returned by ","type":"text"},{"code":"createEvent","type":"codeVoice"}]},{"anchor":"Running-Server","level":2,"text":"Running Server","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Upon running server your terminal will display"}]},{"type":"paragraph","inlineContent":[{"identifier":"WWDC24-10216-server-start-vscode","type":"image"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"List all events by querying service in another terminal using curl"}]},{"code":["curl -X GET \"localhost:8080\/api\/events\""],"type":"codeListing","syntax":"bash"},{"type":"paragraph","inlineContent":[{"text":"Returning","type":"text"}]},{"code":["[","    {","        \"attendee\" : \"Gus\"","        \"date\" : \"26.09.2024\"","        \"name\" : \"Server-Side Swift Conference\"","    },","    {","        \"attendee\" : \"Werner\"","        \"date\" : \"21.09.2024\"","        \"name\" : \"Oktoberfest\"","    }","]"],"type":"codeListing","syntax":"json"},{"anchor":"Database-Drivers","level":2,"text":"Database Drivers","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"PostgreSQL"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"MySQL","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Cassandra","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"MongoDB"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Etc."}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"PostgresNIO-121","level":3,"text":"PostgresNIO 1.21","type":"heading"},{"type":"paragraph","inlineContent":[{"code":"PostgresClient","type":"codeVoice"},{"text":" provides a completely new asynchronous interface and comes with a built-in connection pool which leverages structured concurrency, making it resilient against intermittent networking failures to the database. Additionally, the connection pool improves throughput by distributing queries over multiple connections and prewarming connections for faster query execution.","type":"text"}]},{"anchor":"Add-Dependency-to-Package","level":2,"text":"Add Dependency to Package","type":"heading"},{"code":["\/\/ swift-tools-version:5.9","import PackageDescription","","let package = Package(","    name: \"EventService\",","    platforms: [.macOS(.v14)],","    dependencies: [","        ...","        Other Dependencies","        ...","        .package(","            url: \"https:\/\/github.com\/vapor\/postgres-nio\",","            from: \"1.19.1\"","        ),","    ],","    targets: [","        .target(","            name: \"EventAPI\",","            dependencies: [","                .product(","                    name: \"OpenAPIRuntime\",","                    package: \"swift-openapi-runtime\"","                ),","            ],","            plugins: [","                .plugin(","                    name: \"OpenAPIGenerator\",","                    package: \"swift-openapi-generator\"","                )","            ]","        ),","        .executableTarget(","            name: \"EventService\",","            dependencies: [","                \"EventAPI\",","                ...","                Other Dependencies","                ...","                .product(","                    name: \"PostgresNIO\",","                    package: \"postgres-nio\"","                ),","            ]","        ),","    ]",")"],"type":"codeListing","syntax":"swift"},{"anchor":"Add-property-to-service","level":2,"text":"Add property to service","type":"heading"},{"code":["...","Other imported frameworks","...","import PostgresNIO","","@main","struct Service {","    let postgresClient: PostgresClient","","    static func main() async throws {","        let application = try await Vapor.Application.make()","        let transport = VaporTransport(routesBuilder: application)","","        let postgresClient = PostgresClient(","            configuration: .init(","                host: \"localhost\",","                username: \"postgres\",","                password: nil,","                database: nil,","                tls: .disable","            )","        )","        let service = Service(postgresClient: postgresClient)","        try service.registerHandlers(","            on: transport,","            serverURL: URL(string: \"\/api\")!","        )","","        try await withThrowingDiscardingTaskGroup { group in","            group.addTask {","                await postgresClient.run()","            }","","            group.addTask {","                try await application.execute()","            }","        }","    }","}","","extension Service: APIProtocol {","    func listEvents(","        _ input: Operations.listEvents.Input","    ) async throws -> Operations.listEvents.Output {","        let rows = try await self.postgresClient.query(\"SELECT name, date, attendee FROM events\")","","        var events = [Components.Schemas.Event]()","        for try await (name, date, attendee) in rows.decode((String, String, String).self) {","            events.append(.init(name: name, date: date, attendee: attendee))","        }","","        return .ok(.init(body: .json(events)))","    }","","    func createEvent(","        _ input: Operations.createEvent.Input","    ) async throws -> Operations.createEvent.Output {","        return .undocumented(statusCode: 501, .init())","    }","}"],"type":"codeListing","syntax":"swift"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Import PostgresNIO"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Add "},{"type":"codeVoice","code":"PostgresClient"},{"type":"text","text":" property"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Return an AsyncSequence of rows by using the client to query the database in the listEvents method"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Replace the hard coded list of events by"}]},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"text":"Iterating over the rows","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Decoding the fields"}]}]},{"content":[{"inlineContent":[{"text":"Creating an event for each row","type":"text"}],"type":"paragraph"}]}]}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"text":"The AsyncSequence returned by the query method will automatically prefetch rows from the database speeding up performance.","type":"text"}]},{"start":5,"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a PostgresClient"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Pass database to Service"}]}]},{"content":[{"inlineContent":[{"text":"Create discarding task group","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add child task that runs PostgresClient"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Move Vapor application execution into separate child task","type":"text"}]}]}],"type":"orderedList"},{"anchor":"Create-Event-Method","level":2,"text":"Create Event Method","type":"heading"},{"code":["func createEvent(","    _ input: Operations.createEvent.Input",") async throws -> Operations.createEvent.Output {","    switch input.body {","    case .json(let event):","        try await self.postgresClient.query(","            \"\"\"","            INSERT INTO events (name, date, attendee)","            VALUES (\\(event.name), \\(event.date), \\(event.attendee))","            \"\"\"","        )","        return .created(.init())","    }","}"],"type":"codeListing","syntax":"swift"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"switch over the input"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"extract the JSON event","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"query the database inserting new event"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"return created event","type":"text"}]}]}],"type":"orderedList"},{"anchor":"Mitigating-SQL-injection","level":2,"text":"Mitigating SQL injection","type":"heading"},{"code":["var query = PostgresQuery(","    \"\"\"","    INSERT INTO events (name, date, attendee)","    VALUES ($0, $1, $2)","    \"\"\"",")","","query.binds.append(event.name)","query.binds.append(event.date)","query.binds.append(event.attendee)"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"Note: Even though this looks like a string it isnâ€™t a string, but uses Swiftâ€™s String interpolation feature to transform the string query into a parameterised query with value binding. Making it completely safe from SQL injection attacks.","type":"text"}]},{"anchor":"Restarting","level":2,"text":"Restarting","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"WWDC24-10216-server-start-vscode"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Again use curl to create two events"}]},{"code":["curl -X POST \"localhost:8080\/api\/events\" \\","-H \"Content-Type: application\/json\" \\","-d '{\"name\": \"Oktoberfest\", \"date\": \"21.09.2024\", \"attendee\": \"Werner\"}'"],"type":"codeListing","syntax":"bash"},{"code":["curl -X POST \"localhost:8080\/api\/events\" \\","-H \"Content-Type: application\/json\" \\","-d '{\"name\": \"Server-Side Swift Conference\", \"date\": \"26.09.2024\", \"attendee\": \"Gus\"}'"],"type":"codeListing","syntax":"bash"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Then view events"},{"type":"text","text":" "},{"type":"text","text":"List all events by querying service in another terminal using curl"}]},{"code":["curl -X GET \"localhost:8080\/api\/events\""],"type":"codeListing","syntax":"bash"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Returning"}]},{"code":["[","    {","        \"attendee\" : \"Gus\"","        \"date\" : \"26.09.2024\"","        \"name\" : \"Server-Side Swift Conference\"","    },","    {","        \"attendee\" : \"Werner\"","        \"date\" : \"21.09.2024\"","        \"name\" : \"Oktoberfest\"","    }","]"],"type":"codeListing","syntax":"json"},{"anchor":"Adding-Duplicate-Entry","level":1,"text":"Adding Duplicate Entry","type":"heading"},{"code":["curl -X POST \"localhost:8080\/api\/events\" \\","-H \"Content-Type: application\/json\" \\","-d '{\"name\": \"Server-Side Swift Conference\", \"date\": \"26.09.2024\", \"attendee\": \"Gus\"}'"],"type":"codeListing","syntax":"bash"},{"type":"paragraph","inlineContent":[{"text":"When entered the database returns an error","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"WWDC24-10216-server-ambiguous-error","type":"image"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The description of PSQLError intentionally omits detailed information to prevent accidental leakage of database information such as the schemas of your table. Use observability to assist troubleshooting."}]},{"anchor":"Observability","level":2,"text":"Observability","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Logging"}],"type":"strong"},{"text":" - Helps understanding exactly what a service did and allows digging into the detail","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Metrics"}]},{"text":" - Allow a high level overview of service health at a glance","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Tracing"}]},{"type":"text","text":" - Helps understanding what path a single request took through system"}]}]}],"type":"unorderedList"},{"anchor":"Troubleshooting","level":2,"text":"Troubleshooting","type":"heading"},{"code":["func listEvents(","    _ input: Operations.listEvents.Input",") async throws -> Operations.listEvents.Output {","    let logger = Logger(label: \"ListEvents\")","    logger.info(\"Handling request\", metadata: [\"operation\": \"\\(Operations.listEvents.id)\"])","","    Counter(label: \"list.events.counter\").increment()","","    return try await withSpan(\"database query\") { span in","        let rows = try await postgresClient.query(\"SELECT name, date, attendee FROM events\")","        return try await .ok(.init(body: .json(decodeEvents(rows))))","    }","}"],"type":"codeListing","syntax":"swift"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use "},{"type":"codeVoice","code":"swift-log"},{"type":"text","text":" to emit a log when handling a new listEvents request. "},{"type":"codeVoice","code":"swift-log"},{"type":"text","text":" supports structured logging by adding metadata to log messages providing additional context when troubleshooting problems."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Add a counter from "},{"code":"swift-metrics","type":"codeVoice"},{"type":"text","text":" that increments on each request to track how many requests the service has processed."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add "},{"code":"swift-distributed-tracing","type":"codeVoice"},{"type":"text","text":" creating a span around database query, which helps while troubleshooting a request end to end through system."}]}]}],"type":"orderedList"},{"anchor":"Bootstrapping","level":2,"text":"Bootstrapping","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"The Swift on Server ecosystem contains many different backends for logging, metrics and distributed tracing. Choosing the backends is done by calling the bootstrapping methods of the three libraries. Bootstrapping should only be done in executables and should happen as early as possible (","type":"text"},{"code":"main()","type":"codeVoice"},{"text":") to ensure no observability event is lost.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"LoggingSystem","type":"text"}]},{"code":["LoggingSystem.bootstrap(StreamLogHandler.standardError)"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"MetricSystem - "},{"type":"reference","identifier":"https:\/\/github.com\/swift-server\/swift-prometheus","isActive":true}]},{"code":["let registry = PrometheusCollectiorRegistry()","MetricSystem.bootstrap(PrometheusMetricsFactory(registry: registry))"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"InstrumentationSystem - "},{"isActive":true,"identifier":"https:\/\/github.com\/open-telemetry\/opentelemetry-swift","type":"reference"}]},{"code":["let otelTracer = Otel.Tracer(...)","InstrmentationSystem.bootstrap(otelTracer)"],"type":"codeListing","syntax":"swift"},{"anchor":"Logging-Methods","level":2,"text":"Logging Methods","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Add Logging"}]},{"code":[".package(","    url: \"https:\/\/github.com\/apple\/swift-log\",","    from: \"1.5.4\"","),"],"type":"codeListing","syntax":"swift"},{"code":[".product(","    name: \"Logging\",","    package: \"swift-log\"","),"],"type":"codeListing","syntax":"swift"},{"code":["func createEvent(","    _ input: Operations.createEvent.Input",") async throws -> Operations.createEvent.Output {","    switch input.body {","    case .json(let event):","        do {","        try await self.postgresClient.query(","            \"\"\"","            INSERT INTO events (name, date, attendee)","            VALUES (\\(event.name), \\(event.date), \\(event.attendee))","            \"\"\"","            )","            return .created(.init())","        } catch let error as PSQLError {","            let logger = Logger(label: \"CreateEvent\")","","            if let message = error.serverInfo?[.message] {","                logger.info(","                    \"Failed to create event\",","                    metadata: [\"error.message\": \"\\(message)\"]","                )","            }","","            return .badRequest(.init())","        }","    }","}"],"type":"codeListing","syntax":"swift"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Import the Logging module","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Catch the errors thrown by the query method - The query method throws a PSQLError in the case something went wrong when executing the query.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Create a logger"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Extract the error message"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Emit the log","type":"text"},{"text":" ","type":"text"},{"text":"The PSQLError contains detailed information about what went wrong in the serverInfo property.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Return a badRequest response","type":"text"}]}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"text":"New Error","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"WWDC24-10216-server-duplicate-key-error","type":"image"}]},{"anchor":"Swift-on-Server-Example-Libraries","level":2,"text":"Swift on Server Example Libraries","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Metrics"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"PostgresNIO"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Vapor"}]}]},{"content":[{"inlineContent":[{"text":"StatsClient","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Hummingbird","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"AsyncHTTPClient","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"MongoKitten"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"OTel"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Smoke","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"SQLiteNIO"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"GraphQL"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"DataDogLog"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Tracing","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"StackdriverLogging"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Puppy"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"MQTTNIO","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Crypto","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"X509"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Protobuf","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"BSON"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"MySQLNIO"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"NIO"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"ASN1"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"OpenAPI Generator"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"CassandraClient"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Prometheus","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"OracleNIO"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Soto"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"DiscordBM","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"GRPC","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"RediStack"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"KafkaClient","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"DistributedCluster","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Logging","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"MongoSwift","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"APNSwift","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Citadel"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Graphiti","type":"text"}]}]}],"type":"unorderedList"},{"anchor":"Package-Locations","level":2,"text":"Package Locations","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Swift.org ","type":"text"},{"isActive":true,"identifier":"https:\/\/www.swift.org\/packages\/","type":"reference"}]}]},{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"https:\/\/swiftpackageindex.com"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"SSWG Incubation "},{"identifier":"https:\/\/www.swift.org\/sswg\/#projects","type":"reference","isActive":true}]}]}],"type":"unorderedList"},{"anchor":"Written-By","level":2,"text":"Written By","type":"heading"},{"numberOfColumns":5,"columns":[{"size":1,"content":[{"inlineContent":[{"type":"image","identifier":"dl-alexandre"}],"type":"paragraph"}]},{"size":4,"content":[{"level":3,"anchor":"Dalton-Alexandre","type":"heading","text":"Dalton Alexandre"},{"type":"paragraph","inlineContent":[{"type":"reference","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/dl-alexandre","overridingTitle":"Contributed Notes"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/dl-alexandre"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/daltonalexandre.carrd.co"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/x.com\/d_creatio"}]}]}],"type":"row"},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}]},{"anchor":"Related-Sessions","level":2,"text":"Related Sessions","type":"heading"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10171-Meet-Swift-OpenAPI-Generator","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10170-Beyond-the-basics-of-structured-concurrency"],"style":"list","type":"links"},{"type":"small","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright Â© 2012 â€“ 2025 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"references":{"doc://WWDCNotes/documentation/WWDCNotes":{"abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"type":"topic","title":"WWDC Notes","kind":"symbol","url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"role":"collection"},"https://x.com/d_creatio":{"title":"X\/Twitter","titleInlineContent":[{"text":"X\/Twitter","type":"text"}],"type":"link","identifier":"https:\/\/x.com\/d_creatio","url":"https:\/\/x.com\/d_creatio"},"WWDC24-10216-server-duplicate-key-error":{"identifier":"WWDC24-10216-server-duplicate-key-error","alt":null,"variants":[{"url":"\/images\/WWDCNotes\/WWDC24-10216-server-duplicate-key-error.jpeg","traits":["1x","light"]}],"type":"image"},"https://github.com/open-telemetry/opentelemetry-swift":{"type":"link","identifier":"https:\/\/github.com\/open-telemetry\/opentelemetry-swift","url":"https:\/\/github.com\/open-telemetry\/opentelemetry-swift","titleInlineContent":[{"text":"OpenTelemetry","type":"text"}],"title":"OpenTelemetry"},"WWDC24-Icon.png":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC24-Icon.png","traits":["1x","light"]}],"identifier":"WWDC24-Icon.png","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/dl-alexandre":{"title":"Dalton Alexandre (5 notes)","type":"topic","abstract":[{"type":"text","text":"Software Developer"}],"url":"\/documentation\/wwdcnotes\/dl-alexandre","kind":"article","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/dl-alexandre","images":[{"identifier":"dl-alexandre.jpeg","type":"card"},{"identifier":"dl-alexandre.jpeg","type":"icon"}]},"https://daltonalexandre.carrd.co":{"identifier":"https:\/\/daltonalexandre.carrd.co","title":"Blog","url":"https:\/\/daltonalexandre.carrd.co","titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link"},"WWDC24.jpeg":{"type":"image","alt":null,"identifier":"WWDC24.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC24.jpeg"}]},"dl-alexandre.jpeg":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/dl-alexandre.jpeg","traits":["1x","light"]}],"identifier":"dl-alexandre.jpeg","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10170-Beyond-the-basics-of-structured-concurrency":{"title":"Beyond the basics of structured concurrency","url":"\/documentation\/wwdcnotes\/wwdc23-10170-beyond-the-basics-of-structured-concurrency","abstract":[{"type":"text","text":"Itâ€™s all about the task tree: Find out how structured concurrency can help your apps manage automatic task cancellation, task priority propagation, and useful task-local value patterns. Learn how to manage resources in your app with useful patterns and the latest task group APIs. Weâ€™ll show you how you can leverage the power of the task tree and task-local values to gain insight into distributed systems."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10170-Beyond-the-basics-of-structured-concurrency","role":"sampleCode","kind":"article","type":"topic"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link"},"dl-alexandre":{"type":"image","alt":"Profile image of Dalton Alexandre","identifier":"dl-alexandre","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/dl-alexandre.jpeg"}]},"https://www.swift.org/sswg/#projects":{"title":"List","titleInlineContent":[{"text":"List","type":"text"}],"type":"link","identifier":"https:\/\/www.swift.org\/sswg\/#projects","url":"https:\/\/www.swift.org\/sswg\/#projects"},"https://developer.apple.com/wwdc24/10216":{"identifier":"https:\/\/developer.apple.com\/wwdc24\/10216","url":"https:\/\/developer.apple.com\/wwdc24\/10216","checksum":null,"type":"download"},"WWDC24-10216-server-start-vscode":{"type":"image","alt":null,"identifier":"WWDC24-10216-server-start-vscode","variants":[{"url":"\/images\/WWDCNotes\/WWDC24-10216-server-start-vscode.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC24":{"abstract":[{"text":"Xcode 16, Swift 6, iOS 18, macOS 15 (Sequoia), tvOS 18, visionOS 2, watchOS 11.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: Swift Testing, ","type":"text"},{"code":"FinanceKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"TabletopKit","type":"codeVoice"},{"text":", and more.","type":"text"}],"type":"topic","title":"WWDC24","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc24","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24","images":[{"type":"icon","identifier":"WWDC24-Icon.png"},{"type":"card","identifier":"WWDC24.jpeg"}],"role":"collectionGroup"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"type":"image"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10171-Meet-Swift-OpenAPI-Generator":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10171-Meet-Swift-OpenAPI-Generator","url":"\/documentation\/wwdcnotes\/wwdc23-10171-meet-swift-openapi-generator","role":"sampleCode","abstract":[{"type":"text","text":"Discover how Swift OpenAPI Generator can help you work with HTTP server APIs whether youâ€™re extending an iOS app or writing a server in Swift. Weâ€™ll show you how this package plugin can streamline your workflow and simplify your codebase by generating code from an OpenAPI document."}],"type":"topic","kind":"article","title":"Meet Swift OpenAPI Generator"},"https://github.com/swift-server/swift-prometheus":{"title":"Prometheus","titleInlineContent":[{"type":"text","text":"Prometheus"}],"type":"link","identifier":"https:\/\/github.com\/swift-server\/swift-prometheus","url":"https:\/\/github.com\/swift-server\/swift-prometheus"},"https://www.swift.org/sswg/":{"type":"link","identifier":"https:\/\/www.swift.org\/sswg\/","url":"https:\/\/www.swift.org\/sswg\/","titleInlineContent":[{"text":"Swift Server Workgroup","type":"text"}],"title":"Swift Server Workgroup"},"https://www.swift.org/packages/":{"identifier":"https:\/\/www.swift.org\/packages\/","title":"packages","url":"https:\/\/www.swift.org\/packages\/","titleInlineContent":[{"text":"packages","type":"text"}],"type":"link"},"WWDC24-10216-server-ambiguous-error":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC24-10216-server-ambiguous-error.jpeg","traits":["1x","light"]}],"identifier":"WWDC24-10216-server-ambiguous-error","alt":null},"https://swiftpackageindex.com":{"type":"link","identifier":"https:\/\/swiftpackageindex.com","url":"https:\/\/swiftpackageindex.com","titleInlineContent":[{"text":"Swift Package Index","type":"text"}],"title":"Swift Package Index"},"https://github.com/dl-alexandre":{"identifier":"https:\/\/github.com\/dl-alexandre","title":"GitHub","url":"https:\/\/github.com\/dl-alexandre","titleInlineContent":[{"text":"GitHub","type":"text"}],"type":"link"}}}