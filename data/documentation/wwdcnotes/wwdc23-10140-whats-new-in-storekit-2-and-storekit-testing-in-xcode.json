{"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10140-Whats-new-in-StoreKit-2-and-StoreKit-Testing-in-Xcode"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"abstract":[{"type":"text","text":"Get to know the latest enhancements to StoreKit 2 and StoreKit Testing in Xcode. Discover API updates for promoted in-app purchases, StoreKit messages, the Transaction model, the RenewalInfo model, and the App Store sheet for managing subscriptions. Learn how to upgrade to SHA-256 for on-device receipt validation and use APIs to create SwiftUI views."}],"metadata":{"roleHeading":"WWDC23","title":"What’s new in StoreKit 2 and StoreKit Testing in Xcode","role":"sampleCode","modules":[{"name":"WWDC Notes"}]},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc23-10140-whats-new-in-storekit-2-and-storekit-testing-in-xcode"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"major":0,"patch":0,"minor":3},"sampleCodeDownload":{"kind":"sampleDownload","action":{"overridingTitle":"Watch Video (24 min)","isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc23\/10140"}},"sections":[],"primaryContentSections":[{"content":[{"anchor":"API-Updates","type":"heading","level":2,"text":"API Updates"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Promoting of In App Purchases possible in Connect"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Receive promotion purchases with ","type":"text"},{"type":"codeVoice","code":"PurchaseIntent.intents"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Need to call "},{"type":"codeVoice","code":".purchase"},{"type":"text","text":" after checking "},{"type":"codeVoice","code":".canProcessPurchase"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You can chang eorder of promotions locally"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"You can also change visibility in App Store","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"New fields "},{"type":"codeVoice","code":".storefront"},{"type":"text","text":", "},{"type":"codeVoice","code":".storeFrontCountryCode"},{"type":"text","text":", and "},{"type":"codeVoice","code":"reason"},{"text":" (customer purchase vs. recurring) field in ","type":"text"},{"type":"codeVoice","code":"Transaction"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"New field "},{"type":"codeVoice","code":"renewalDate"},{"type":"text","text":" on "},{"type":"codeVoice","code":"RenewalInfo"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"New fields above are back-deployed to iOS 15!","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"New message reason “billingIssue” added in Messages API","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Signing receipts migrates from SHA1 to SHA256 starting June 20, migration complete by August 24","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"If you’re using StoreKit, nothing to do, StoreKit uses SHA256 already"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Build-SwiftUI-apps","type":"heading","level":2,"text":"Build SwiftUI apps"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"New "},{"code":"ProductView","type":"codeVoice"},{"type":"text","text":" for showing exactly 1 "},{"code":"productID","type":"codeVoice"},{"type":"text","text":" (like non-consumable)"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"New "},{"code":"StoreView","type":"codeVoice"},{"type":"text","text":" for showing many ids in a list"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"New "},{"code":"SubsriptionStoreView","type":"codeVoice"},{"type":"text","text":" for showing all subsriptions in a subscription group in a list"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Many customization options for these views","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use `.manageSubscriptionSheet(isPresented:groupID:)"}]}]}],"type":"unorderedList"},{"anchor":"StoreKit-Testing-in-Xcode","type":"heading","level":2,"text":"StoreKit Testing in Xcode"},{"items":[{"content":[{"inlineContent":[{"text":"Transaction manager shows all apps and devices now","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Open manager via “Debug” menu in Xcode"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Purchases can be created directly on the Mac in transaction manager via + button"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Lots of customizability when creating purchases, supoprts offers\/promotions\/reneweable or not\/purchase date etc.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"No debug session required"}]}]},{"content":[{"inlineContent":[{"text":"New “Configuration Settings” in StoreKit configuration file: Change Storefront\/Localization, pass Options, simulate Failures","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Set also a “renewal rate” with from 15 minutes down to just 2 seconds"}]}]},{"content":[{"inlineContent":[{"code":"SKTestSession","type":"codeVoice"},{"text":" with purchase APIs allows the same adjustments as listed above in unit tests via ","type":"text"},{"code":".setSimulatedError","type":"codeVoice"},{"text":", ","type":"text"},{"code":".timeRate","type":"codeVoice"},{"text":", etc.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Written-By","type":"heading","level":2,"text":"Written By"},{"numberOfColumns":5,"type":"row","columns":[{"size":1,"content":[{"inlineContent":[{"type":"image","identifier":"Jeehut"}],"type":"paragraph"}]},{"size":4,"content":[{"text":"Cihat Gündüz","anchor":"Cihat-Gündüz","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"type":"reference","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Jeehut","isActive":true,"overridingTitle":"Contributed Notes"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/Jeehut","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/x.com\/Jeehut","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/fline.dev","isActive":true}]}]}]},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","isActive":true,"type":"reference"}],"type":"paragraph"},{"anchor":"Related-Sessions","type":"heading","level":2,"text":"Related Sessions"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10013-Meet-StoreKit-for-SwiftUI","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10117-Whats-new-in-App-Store-Connect","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10142-Explore-testing-inapp-purchases","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10007-Whats-new-with-inapp-purchase","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10039-Whats-new-in-StoreKit-testing","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10114-Meet-StoreKit-2"],"style":"list","type":"links"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10013-Meet-StoreKit-for-SwiftUI":{"type":"topic","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc23-10013-meet-storekit-for-swiftui","kind":"article","title":"Meet StoreKit for SwiftUI","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10013-Meet-StoreKit-for-SwiftUI","abstract":[{"text":"Discover how you can use App Store product metadata and Xcode Previews to add in-app purchases to your app with just a few lines of code. Explore a new collection of UI components in StoreKit and learn how you can easily merchandise your products, present subscriptions in a way that helps users make informed decisions, and more.","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10007-Whats-new-with-inapp-purchase":{"title":"What’s new with in-app purchase","abstract":[{"text":"Learn how you can make your in-app purchase experience even better on iPhone, iPad, Mac, and Apple Watch. We’ll take you through enhancements to StoreKit 2 and App Store Server API, and explore improvements to App Store Server Notifications. Discover how you can verify app purchases with App Transaction API, add properties to your StoreKit models, incorporate SwiftUI-friendly APIs and StoreKit Messages, and preserve applicationUsername in transactions. For those working server-side, we’ll show you how to make the most of App Store Server Notifications, additional ways to retrieve user transaction history, and recovery steps when your server experiences an outage.","type":"text"}],"type":"topic","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc22-10007-whats-new-with-inapp-purchase","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10007-Whats-new-with-inapp-purchase","role":"sampleCode"},"Jeehut":{"alt":"Profile image of Cihat Gündüz","identifier":"Jeehut","variants":[{"traits":["1x","light"],"url":"\/images\/Jeehut.jpeg"}],"type":"image"},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10114-Meet-StoreKit-2":{"title":"Meet StoreKit 2","abstract":[{"text":"StoreKit 2 delivers powerful, Swift-native APIs for in-app purchases and auto-renewable subscriptions. Learn how you can easily implement in-app purchases and subscriptions, and discover APIs for retrieving product information, handling transactions, determining product entitlements and customer status, as well as comprehensive testing support in Xcode.","type":"text"}],"type":"topic","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21-10114-meet-storekit-2","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10114-Meet-StoreKit-2","role":"sampleCode"},"https://github.com/Jeehut":{"url":"https:\/\/github.com\/Jeehut","identifier":"https:\/\/github.com\/Jeehut","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}],"type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"abstract":[{"type":"text","text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"SwiftData"},{"type":"text","text":", "},{"type":"codeVoice","code":"Observation"},{"text":", ","type":"text"},{"type":"codeVoice","code":"StoreKit"},{"text":" views, and more.","type":"text"}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","type":"topic","title":"WWDC23","url":"\/documentation\/wwdcnotes\/wwdc23","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"role":"collectionGroup"},"WWDCNotes.png":{"alt":null,"identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10039-Whats-new-in-StoreKit-testing":{"role":"sampleCode","type":"topic","title":"What’s new in StoreKit testing","abstract":[{"text":"Discover the latest tools to help you test your in-app purchases and subscriptions. We’ll show you how to bring your products from App Store Connect into StoreKit Testing in Xcode, learn about improvements to the transaction manager, and explore your in-app purchase flow in Xcode Previews. We’ll also take you through best practices when setting up an Apple ID for the sandbox environment, and show you how to create tests for refund requests, price increase consent, billing retry, and much more.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc22-10039-whats-new-in-storekit-testing","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10039-Whats-new-in-StoreKit-testing"},"doc://WWDCNotes/documentation/WWDCNotes/Jeehut":{"title":"Cihat Gündüz (56 notes)","abstract":[{"type":"text","text":"Spatial-first Indie Developer for  Platforms. Actively contributing to Open Source since 2011!"}],"role":"sampleCode","url":"\/documentation\/wwdcnotes\/jeehut","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Jeehut","kind":"article","type":"topic","images":[{"identifier":"Jeehut.jpeg","type":"card"},{"identifier":"Jeehut.jpeg","type":"icon"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10117-Whats-new-in-App-Store-Connect":{"role":"sampleCode","type":"topic","title":"What’s new in App Store Connect","abstract":[{"text":"Discover the latest updates to App Store Connect, the suite of tools used to manage and submit apps to the App Store. Explore how you can use the latest features to test, price, promote, and automate the management of your app more easily. We’ll also share enhancements to tools like TestFlight and the App Store Connect API.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc23-10117-whats-new-in-app-store-connect","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10117-Whats-new-in-App-Store-Connect"},"Jeehut.jpeg":{"alt":null,"identifier":"Jeehut.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/Jeehut.jpeg"}],"type":"image"},"https://x.com/Jeehut":{"url":"https:\/\/x.com\/Jeehut","identifier":"https:\/\/x.com\/Jeehut","title":"X\/Twitter","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"type":"link"},"https://fline.dev":{"url":"https:\/\/fline.dev","identifier":"https:\/\/fline.dev","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link"},"https://developer.apple.com/wwdc23/10140":{"url":"https:\/\/developer.apple.com\/wwdc23\/10140","identifier":"https:\/\/developer.apple.com\/wwdc23\/10140","checksum":null,"type":"download"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10142-Explore-testing-inapp-purchases":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10142-Explore-testing-inapp-purchases","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc23-10142-explore-testing-inapp-purchases","kind":"article","title":"Explore testing in-app purchases","role":"sampleCode","abstract":[{"type":"text","text":"Learn how you can test in-app purchases throughout development with StoreKit Testing in Xcode, App Store sandbox, and TestFlight. Explore how each tool functions and how you can combine them to build the right workflow for testing your apps and games. We’ll also share a sneak preview of how you can test Family Sharing for in-app purchases & subscriptions in the App Store sandbox."}]},"doc://WWDCNotes/documentation/WWDCNotes":{"abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"kind":"symbol","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","type":"topic","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"role":"collection"}}}