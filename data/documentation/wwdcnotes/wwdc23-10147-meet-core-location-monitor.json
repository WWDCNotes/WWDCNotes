{"metadata":{"role":"sampleCode","roleHeading":"WWDC23","title":"Meet Core Location Monitor","modules":[{"name":"WWDC Notes"}]},"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10147-Meet-Core-Location-Monitor"},"sections":[],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"abstract":[{"text":"Discover how Core Location Monitor can help you better understand location and beacon events in your app. Learn how to use Core Location Conditions to describe and track the state of events in your app, and find out how you can better respond to transitions in your apps through Swift semantics and improved reliability.","type":"text"}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10147","type":"reference","overridingTitle":"Watch Video (16 min)","isActive":true}},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc23-10147-meet-core-location-monitor"]}],"schemaVersion":{"patch":0,"minor":3,"major":0},"primaryContentSections":[{"kind":"content","content":[{"anchor":"overview","type":"heading","level":2,"text":"Overview"},{"type":"codeListing","code":["let self.monitor = await CLMonitor(\"iHeartMonitor\")","","\/\/Add a condition for monitoring","await self.monitor.add(aCondition, identifier: \"Work\")","","\/\/Receive and respond to events","Task {","  for try await event in self.monitor.events {","    takeAction(on: event)","  }","}"],"syntax":"swift"},{"anchor":"Monitor-Overview","type":"heading","level":3,"text":"Monitor Overview"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"When creating a ","type":"text"},{"type":"codeVoice","code":"CLMonitor"},{"text":", only one instance with a given name can be opened at a time","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"let self.monitor = await CLMonitor(\"iHeartMonitor\")"},{"text":" will either return existing instance or generate a new one","type":"text"}],"type":"paragraph"}]}]}]}]},{"anchor":"Supported-Conditions","type":"heading","level":3,"text":"Supported Conditions"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Add a condition to a CLMonitor instance for monitoring and associate it with an identifier using the "},{"type":"codeVoice","code":"add"},{"type":"text","text":" method"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Example: “Work” uniquely identifies the record of a condition that is satisfied when the user is at work. The record object and its contents will be accessible by this identifier and the condition will be monitored until it is removed."}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"You can remove the monitoring condition and corresponding record by calling ","type":"text"},{"code":"remove","type":"codeVoice"},{"text":" with the same identifier","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Two types of conditions supported on iOS:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"CircularGeographicCondition","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Defined by a center and a radius. Only events reported inside of the circle condition are considered “satisfied”","type":"text"}],"type":"paragraph"}]}]}]}]}]}]},{"type":"codeListing","code":["    \/\/ Circular geographic condition","    let center = CLLocationCoordinate2D(latitude: 37.33467, longitude: -122.00898)","    let appleParkCondition = CLMonitor.CircularGeographicCondition(","      center: center,","      radius: 100.0","    )"],"syntax":"swift"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"BeaconIdentityCondition","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Condition satisfied if someone approaches a site of interest","type":"text"},{"text":" ","type":"text"},{"text":"Definedby a UUID, major number and minor number","type":"text"},{"text":" ","type":"text"},{"text":"Can use wildcards or ommitting numbers to filter beacons","type":"text"},{"text":" ","type":"text"},{"text":"Example conditions for:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"If you want to determine is someone is near any of your sites, all sites can simply use the same UUID"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"If you want to know if someone is near a specific site, all sites can use the same UUID, but you can give each site a different major number for identification"}],"type":"paragraph"}]}],"type":"unorderedList"}]}]}]}]},{"type":"codeListing","code":["        let condition1 = CLMonitor.BeaconIdentityCondition(","        uuid: myDevCentersUUID,","        major: texasDevCenter","        )","        let condition1 = CLMonitor.BeaconIdentityCondition(","        uuid: myDevCentersUUID,","        major: arizonaDevCenter","        )"],"syntax":"swift"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"If you want to know if someone is near a specific area of a site","type":"text"}],"type":"paragraph"}]}]},{"type":"codeListing","code":["let condition1 = CLMonitor.BeaconIdentityCondition(","  uuid: myDevCentersUUID,","  major: texasDevCenter,","  minor: cafeteria",")","let condition1 = CLMonitor.BeaconIdentityCondition(","  uuid: myDevCentersUUID,","  major: texasDevCenter,","  minor: parkingLot",")"],"syntax":"swift"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Optionally, you can add a condition with a default state (","type":"text"},{"code":".satisfied","type":"codeVoice"},{"text":", ","type":"text"},{"code":".unsatisfied","type":"codeVoice"},{"text":") if you know where most common usage will occur. CLMonitor will override the state if it’s incorrect during usage.","type":"text"}],"type":"paragraph"}]}]},{"type":"codeListing","code":["await self.monitor.add(","  appleParkCondition,","  identifier: \"appleParkCondition\",","  assuming: .unsatisfied",")"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"For more information on how Beacons work, please refer to "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/corelocation\/ranging_for_beacons","isActive":true}],"type":"emphasis"}]},{"anchor":"Inspecting-Records","type":"heading","level":3,"text":"Inspecting Records"},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"WWDC23-10147-CLMonitorInspectingRecords"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"After fetching the record for a condition you’ll receive the ","type":"text"},{"code":"lastEvent","type":"codeVoice"},{"text":" and the ","type":"text"},{"code":"state","type":"codeVoice"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Why is a "},{"type":"codeVoice","code":"Condition?"},{"type":"text","text":" also returned inside of the event record for a Condition?"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"This is called a “refinement” for BeaconIdentityCondition. If a condition with major and minor wildcarded becomes satisfied, that event will be delivered with the refinement populated. That refinement condition will carry the UUID but also the major and minor information of the observed beacon."}],"type":"paragraph"}]}]}]}]},{"type":"codeListing","code":["\/\/ Inspecting a record and its contents","\/\/ Get record","let monitoredRecord = await self.monitor.record(for: \"appleParkCondition\")","\/\/ Monitored condition","let condition = monitoredRecord?.condition","\/\/ Get last event","let lastEvent = monitoredRecord?.lastEvent","\/\/ Get last state","let lastState = lastEvent?.state"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"To check all monitored conditions:","type":"text"}]},{"type":"codeListing","code":["\/\/ Get all monitored identifiers","for anIdentifier in await self.monitor.identifiers {","  \/\/ Get record","  if let monitoredRecord = await self.monitor.record(for: anIdentifier) {","    ...","  }","}"],"syntax":"swift"},{"anchor":"Handling-Events","type":"heading","level":3,"text":"Handling Events"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When Core Location observes a state for a monitored condition which differs from the state reported in the lastEvent, then Core Location will deliver a new event through the events async sequence property on your monitor which resumes the awaiting loop."}]},{"type":"codeListing","code":["\/\/ Receiving events","Task{","  for try await event in self.monitor.events {","    switch (event.state){","    case satisfied:","      print (\"\\(event.identifier) is satisfied\" )","    case unsatisfied:","      print (\"\\(event.identifier) is unsatisfied\")","    case unknown:","      print(\"\\(event.identifier) is unknown\")","    }","  }","}"],"syntax":"swift"},{"anchor":"Best-Practices","type":"heading","level":3,"text":"Best Practices"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Keep CLMonitor instances unique, don’t try to create duplicates with the same name"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Task and await your events"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Core Location will launch your app in the background (if it was terminated) as long as it is authorized to receive user location. That means your app needs to reinit monitor and await events whenever it is launched."}]}]},{"content":[{"inlineContent":[{"text":"Using duplicate CLMonitors in widgets and plug-ins will launch your app and cause issues in states and conditions","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Try not to maintain condition states in your own data store, instead act on them as they arrive from CLMonitor to avoid them getting out of sync"}],"type":"paragraph"}]}]},{"anchor":"Written-By","type":"heading","level":2,"text":"Written By"},{"numberOfColumns":5,"type":"row","columns":[{"content":[{"inlineContent":[{"identifier":"trav-ma","type":"image"}],"type":"paragraph"}],"size":1},{"content":[{"text":"Travis Ma","level":3,"type":"heading","anchor":"Travis-Ma"},{"inlineContent":[{"isActive":true,"overridingTitle":"Contributed Notes","type":"reference","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/trav-ma","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}]},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/github.com\/trav-ma"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/www.travisma.me"}],"type":"paragraph"}],"size":4}]},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}]},{"anchor":"Related-Sessions","type":"heading","level":2,"text":"Related Sessions"},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10146-Meet-Core-Location-for-spatial-computing","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10180-Discover-streamlined-location-updates"]},{"type":"small","inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}]},{"type":"small","inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}]}]}],"references":{"https://developer.apple.com/documentation/corelocation/ranging_for_beacons":{"titleInlineContent":[{"type":"text","text":"Ranging for Beacons"}],"title":"Ranging for Beacons","type":"link","url":"https:\/\/developer.apple.com\/documentation\/corelocation\/ranging_for_beacons","identifier":"https:\/\/developer.apple.com\/documentation\/corelocation\/ranging_for_beacons"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10180-Discover-streamlined-location-updates":{"url":"\/documentation\/wwdcnotes\/wwdc23-10180-discover-streamlined-location-updates","abstract":[{"type":"text","text":"Move into the future with Core Location! Meet the CLLocationUpdate class, designed for modern Swift concurrency, and learn how it simplifies getting location updates. We’ll show you how this class works with your apps when they run in the foreground or background and share some best practices."}],"kind":"article","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10180-Discover-streamlined-location-updates","title":"Discover streamlined location updates","role":"sampleCode"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}]},"trav-ma.jpeg":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/trav-ma.jpeg"}],"alt":null,"type":"image","identifier":"trav-ma.jpeg"},"https://www.travisma.me":{"titleInlineContent":[{"type":"text","text":"Blog"}],"title":"Blog","type":"link","url":"https:\/\/www.travisma.me","identifier":"https:\/\/www.travisma.me"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"title":"WWDC23","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc23","role":"collectionGroup","type":"topic","abstract":[{"text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"type":"codeVoice","code":"SwiftData"},{"text":", ","type":"text"},{"type":"codeVoice","code":"Observation"},{"text":", ","type":"text"},{"type":"codeVoice","code":"StoreKit"},{"text":" views, and more.","type":"text"}],"images":[{"identifier":"WWDC23-Icon.png","type":"icon"},{"identifier":"WWDC23.jpeg","type":"card"}]},"trav-ma":{"identifier":"trav-ma","type":"image","alt":"Profile image of Travis Ma","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/trav-ma.jpeg"}]},"https://github.com/trav-ma":{"type":"link","title":"GitHub","url":"https:\/\/github.com\/trav-ma","identifier":"https:\/\/github.com\/trav-ma","titleInlineContent":[{"type":"text","text":"GitHub"}]},"doc://WWDCNotes/documentation/WWDCNotes/trav-ma":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/trav-ma","kind":"article","type":"topic","images":[{"type":"card","identifier":"trav-ma.jpeg"},{"type":"icon","identifier":"trav-ma.jpeg"}],"role":"sampleCode","abstract":[{"text":"Software Development Manager for IQVIA’s Mobile team in Arizona.","type":"text"}],"url":"\/documentation\/wwdcnotes\/trav-ma","title":"Travis Ma (5 notes)"},"https://developer.apple.com/wwdc23/10147":{"checksum":null,"type":"download","url":"https:\/\/developer.apple.com\/wwdc23\/10147","identifier":"https:\/\/developer.apple.com\/wwdc23\/10147"},"WWDC23-10147-CLMonitorInspectingRecords":{"identifier":"WWDC23-10147-CLMonitorInspectingRecords","type":"image","alt":"CLMonitor Inspecting Records","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC23-10147-CLMonitorInspectingRecords.jpg"}]},"WWDC23.jpeg":{"alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC23.jpeg"}],"identifier":"WWDC23.jpeg"},"WWDC23-Icon.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC23-Icon.png"}],"alt":null,"type":"image","identifier":"WWDC23-Icon.png"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","role":"collection","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","kind":"symbol"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10146-Meet-Core-Location-for-spatial-computing":{"url":"\/documentation\/wwdcnotes\/wwdc23-10146-meet-core-location-for-spatial-computing","type":"topic","kind":"article","role":"sampleCode","abstract":[{"type":"text","text":"Discover how Core Location helps your app find its place in the world — literally. We’ll share how you can build a spatial computing app that uses a person’s location while respecting their privacy. You’ll also learn how your app can request location access and how Core Location adapts requests from compatible iPad and iPhone apps."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10146-Meet-Core-Location-for-spatial-computing","title":"Meet Core Location for spatial computing"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","type":"image","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}]}}}