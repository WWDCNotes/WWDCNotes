{"kind":"article","schemaVersion":{"patch":0,"minor":3,"major":0},"metadata":{"role":"sampleCode","modules":[{"name":"WWDC Notes"}],"title":"Explore testing in-app purchases","roleHeading":"WWDC23"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc23-10142-explore-testing-inapp-purchases"]}],"abstract":[{"type":"text","text":"Learn how you can test in-app purchases throughout development with StoreKit Testing in Xcode, App Store sandbox, and TestFlight. Explore how each tool functions and how you can combine them to build the right workflow for testing your apps and games. We’ll also share a sneak preview of how you can test Family Sharing for in-app purchases & subscriptions in the App Store sandbox."}],"primaryContentSections":[{"content":[{"level":2,"type":"heading","text":"Overview","anchor":"overview"},{"inlineContent":[{"type":"text","text":"Speaker: Hemant Sawle, Commerce Developer Advocate"}],"type":"paragraph"},{"level":2,"type":"heading","text":"StoreKit Testing in Xcode","anchor":"StoreKit-Testing-in-Xcode"},{"inlineContent":[{"type":"text","text":"StoreKit Testing in Xcode allows local testing. Added in WWDC20."}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"StoreKit configuration file to create and manage IAPs."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Perform local testing of in app purchases"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Use simulator or device to test.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Leverage StoreKitTest framework to automate testing IAPs.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Sync products from AppStore Connect to Xcode: so configuration file doesn’t need to be created manually."}]}]},{"content":[{"inlineContent":[{"text":"Supports advance subscription use cases, like offer code redemption, price increase sheet, and subscriptions entering and exiting billing retry.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Flexible subscription renewal rate, from real-time to every 2 seconds."}]}]}]},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"New in Xcode 15:","type":"text"}]}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Static renewal rates, independent of subscription duration."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Simulate StoreKit errors to build better error handling.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"If running multiple instances of your app, the transaction manager will display transactions for each app instance."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Transactions manager also allows buying IAPs directly, to test external transactions."}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"Learn more in the session ","type":"text"},{"inlineContent":[{"text":"“What’s new in StoreKit 2 and StoreKit Testing in Xcode”","type":"text"}],"type":"emphasis"},{"text":" from WWDC23","type":"text"}],"type":"paragraph"},{"level":2,"type":"heading","text":"App Store Sandbox","anchor":"App-Store-Sandbox"},{"inlineContent":[{"type":"text","text":"App Store Sandbox allows testing products set up in App Store Connect on client and server."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Prerequisites:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Accept Paid Applications agreement"}]}]},{"content":[{"inlineContent":[{"text":"Registered device with your developer account","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Create Sandbox Apple ID to make purchases in App Store Connect > Users & Access","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Enable developer mode on device, in Privacy Settings","type":"text"}]}]}]},{"inlineContent":[{"type":"text","text":"Sandbox enables testing production-like scenarios like purchases, restores, and subscription offers. Distribute the app directly to the device from Xcode, or using a distribution method like Release Testing, Debugging, or Custom (to generate an IPA file)."}],"type":"paragraph"},{"level":3,"type":"heading","text":"Billing Problem message simulation (new)","anchor":"Billing-Problem-message-simulation-new"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Available in sandbox, it will be available for customers in production when they enter billing retry."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Uses StoreKit 2 message API with reason ","type":"text"},{"code":"billingIssue","type":"codeVoice"},{"text":".","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement a message listener in views to defer or suppress the message"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Simulate "},{"type":"codeVoice","code":"billingIssue"},{"type":"text","text":" message in sandbox to test how your app handles the message presentation."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"To trigger this, the sandbox Apple ID needs to be subscribed to an auto-renewable subscription. In the device, go to App Store Settings > Account Settings and disable “Allow Purchases & Renewals”. Then, go back to your app and the billing issue message will appear.","type":"text"}]}]}]},{"inlineContent":[{"text":"Learn more about implementing StoreKit 2 Message API in ","type":"text"},{"inlineContent":[{"type":"text","text":"“What’s new with in-app purchase”"}],"type":"emphasis"},{"text":" from WWDC22","type":"text"}],"type":"paragraph"},{"level":3,"type":"heading","text":"Billing Grace Period (new)","anchor":"Billing-Grace-Period-new"},{"inlineContent":[{"text":"Grace period allows users to maintain access to paid features while payment is being collected, without interruption.","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Go to App Store Connect > App > Subscriptions > Billing Grace Period."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The durations shown only apply to production; in testing, the sandbox account’s renewal rate is used."}],"type":"paragraph"}]}]},{"level":3,"type":"heading","text":"Family Sharing (new)","anchor":"Family-Sharing-new"},{"inlineContent":[{"type":"text","text":"Allow customers to share digital purposes with their family members."}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Go to App Store Connect > App > Subscriptions \/ Non-Consumable Products > enable Family Sharing"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Organize Sandbox Family Sharing in App Store Connect","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Make a purchase with sandbox Apple ID","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Go to App Store Connect > Users and access > Family Sharing"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"To stop sharing, go to the device’s settings, Account Settings > Family Sharing > Stop sharing"}]}]}]},{"inlineContent":[{"type":"text","text":"Family Sharing in Sandbox allows validating:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Merchandise family-shareable products using StoreKit’s ","type":"text"},{"type":"codeVoice","code":"isFamilyShareable"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Validate app logic to entitle service for family members","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Revoke access for family members, validate with ","type":"text"},{"code":"revocationDate","type":"codeVoice"},{"text":" available in JWSTransactions","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Receive App Store Server Notifications for family members","type":"text"}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"Learn more in the Tech Talk session ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"“Explore Family Sharing for in-app purchases.”"}]}],"type":"paragraph"},{"level":3,"type":"heading","text":"iOS sandbox Account Settings (new)","anchor":"iOS-sandbox-Account-Settings-new"},{"inlineContent":[{"text":"Options only available in App Store Connect are now available on-device for testing. Go to App Store settings > Sandbox Account > Manage, to find Renewal Rate, Test Interrupted Purchases, and Clear Purchase History.","type":"text"}],"type":"paragraph"},{"level":2,"type":"heading","text":"TestFlight","anchor":"TestFlight"},{"inlineContent":[{"type":"text","text":"TestFlight allows end to end beta testing and feedback from testers. Overview:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Distribute app across all platforms"}]}]},{"content":[{"inlineContent":[{"text":"Add internal and external testers","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Automatic updates"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Builds valid for 90 days","type":"text"}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"text","text":"Learn more in the Tech Talk session "},{"type":"emphasis","inlineContent":[{"text":"“Get started with TestFlight”","type":"text"}]}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"When testing in-app purchases:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Builds are downloaded using TestFlight app","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Uses Apple ID signed into Media & Purchases","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"In-app purchases are free","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Subscription renewal rates are accelerated, equivalent to Sandbox"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"If the app has implemented StoreKit’s "},{"code":"showManageSubscription","type":"codeVoice"},{"type":"text","text":", you can test subscription cancellation or change subscription."}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"New:"}]}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Manage TestFlight testers: filter tester data like status, sessions, and bulk selection.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Internal Only distribution makes the build only available to internal testers, and it cannot be submitted to App Store.","type":"text"},{"text":" ","type":"text"},{"text":"Learn more in the sessions ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"“What’s new in App Store Connect”"}]},{"text":" and ","type":"text"},{"type":"emphasis","inlineContent":[{"type":"text","text":"“Simplify distribution in Xcode and Xcode Cloud”"}]},{"text":" from WWDC23.","type":"text"}],"type":"paragraph"}]}]},{"level":2,"type":"heading","text":"Written By","anchor":"Written-By"},{"type":"row","numberOfColumns":5,"columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"identifier":"Cecile-Lebleu","type":"image"}]}]},{"size":4,"content":[{"level":3,"text":"Cécile Lebleu","type":"heading","anchor":"Cécile-Lebleu"},{"type":"paragraph","inlineContent":[{"isActive":true,"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Cecile-Lebleu","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/Cecile-Lebleu","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/cecilelebleu.com","type":"reference"}]}]}]},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","isActive":true}],"type":"paragraph"},{"level":2,"type":"heading","text":"Related Sessions","anchor":"Related-Sessions"},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10117-Whats-new-in-App-Store-Connect","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10140-Whats-new-in-StoreKit-2-and-StoreKit-Testing-in-Xcode","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10007-Whats-new-with-inapp-purchase","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10039-Whats-new-in-StoreKit-testing"]},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Legal Notice"}]}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"sampleCodeDownload":{"action":{"type":"reference","overridingTitle":"Watch Video (19 min)","isActive":true,"identifier":"https:\/\/developer.apple.com\/wwdc23\/10142"},"kind":"sampleDownload"},"sections":[],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10142-Explore-testing-inapp-purchases"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"references":{"WWDC23.jpeg":{"identifier":"WWDC23.jpeg","type":"image","alt":null,"variants":[{"url":"\/images\/WWDC23.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10007-Whats-new-with-inapp-purchase":{"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10007-Whats-new-with-inapp-purchase","role":"sampleCode","title":"What’s new with in-app purchase","abstract":[{"text":"Learn how you can make your in-app purchase experience even better on iPhone, iPad, Mac, and Apple Watch. We’ll take you through enhancements to StoreKit 2 and App Store Server API, and explore improvements to App Store Server Notifications. Discover how you can verify app purchases with App Transaction API, add properties to your StoreKit models, incorporate SwiftUI-friendly APIs and StoreKit Messages, and preserve applicationUsername in transactions. For those working server-side, we’ll show you how to make the most of App Store Server Notifications, additional ways to retrieve user transaction history, and recovery steps when your server experiences an outage.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc22-10007-whats-new-with-inapp-purchase","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","role":"collectionGroup","title":"WWDC23","abstract":[{"text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"type":"codeVoice","code":"SwiftData"},{"text":", ","type":"text"},{"type":"codeVoice","code":"Observation"},{"text":", ","type":"text"},{"type":"codeVoice","code":"StoreKit"},{"text":" views, and more.","type":"text"}],"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc23","images":[{"identifier":"WWDC23-Icon.png","type":"icon"},{"identifier":"WWDC23.jpeg","type":"card"}],"type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10140-Whats-new-in-StoreKit-2-and-StoreKit-Testing-in-Xcode":{"url":"\/documentation\/wwdcnotes\/wwdc23-10140-whats-new-in-storekit-2-and-storekit-testing-in-xcode","role":"sampleCode","type":"topic","title":"What’s new in StoreKit 2 and StoreKit Testing in Xcode","abstract":[{"text":"Get to know the latest enhancements to StoreKit 2 and StoreKit Testing in Xcode. Discover API updates for promoted in-app purchases, StoreKit messages, the Transaction model, the RenewalInfo model, and the App Store sheet for managing subscriptions. Learn how to upgrade to SHA-256 for on-device receipt validation and use APIs to create SwiftUI views.","type":"text"}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10140-Whats-new-in-StoreKit-2-and-StoreKit-Testing-in-Xcode"},"https://cecilelebleu.com":{"identifier":"https:\/\/cecilelebleu.com","type":"link","titleInlineContent":[{"type":"text","text":"Blog"}],"title":"Blog","url":"https:\/\/cecilelebleu.com"},"Cecile-Lebleu.jpeg":{"identifier":"Cecile-Lebleu.jpeg","type":"image","alt":null,"variants":[{"url":"\/images\/Cecile-Lebleu.jpeg","traits":["1x","light"]}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10117-Whats-new-in-App-Store-Connect":{"type":"topic","url":"\/documentation\/wwdcnotes\/wwdc23-10117-whats-new-in-app-store-connect","kind":"article","title":"What’s new in App Store Connect","abstract":[{"text":"Discover the latest updates to App Store Connect, the suite of tools used to manage and submit apps to the App Store. Explore how you can use the latest features to test, price, promote, and automate the management of your app more easily. We’ll also share enhancements to tools like TestFlight and the App Store Connect API.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10117-Whats-new-in-App-Store-Connect","role":"sampleCode"},"https://developer.apple.com/wwdc23/10142":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10142","type":"download","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc23\/10142"},"WWDC23-Icon.png":{"identifier":"WWDC23-Icon.png","type":"image","alt":null,"variants":[{"url":"\/images\/WWDC23-Icon.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10039-Whats-new-in-StoreKit-testing":{"role":"sampleCode","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10039-Whats-new-in-StoreKit-testing","abstract":[{"text":"Discover the latest tools to help you test your in-app purchases and subscriptions. We’ll show you how to bring your products from App Store Connect into StoreKit Testing in Xcode, learn about improvements to the transaction manager, and explore your in-app purchase flow in Xcode Previews. We’ll also take you through best practices when setting up an Apple ID for the sandbox environment, and show you how to create tests for refund requests, price increase consent, billing retry, and much more.","type":"text"}],"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc22-10039-whats-new-in-storekit-testing","title":"What’s new in StoreKit testing"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","type":"image","alt":null,"variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/Cecile-Lebleu":{"role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/Cecile-Lebleu","type":"topic","images":[{"type":"card","identifier":"Cecile-Lebleu.jpeg"},{"type":"icon","identifier":"Cecile-Lebleu.jpeg"}],"title":"Cécile Lebleu (3 notes)","abstract":[{"type":"text","text":"Designer turned developer."}],"kind":"article","url":"\/documentation\/wwdcnotes\/cecile-lebleu"},"https://github.com/Cecile-Lebleu":{"identifier":"https:\/\/github.com\/Cecile-Lebleu","type":"link","titleInlineContent":[{"type":"text","text":"GitHub"}],"title":"GitHub","url":"https:\/\/github.com\/Cecile-Lebleu"},"Cecile-Lebleu":{"identifier":"Cecile-Lebleu","type":"image","alt":"Profile image of Cécile Lebleu","variants":[{"url":"\/images\/Cecile-Lebleu.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","kind":"symbol","url":"\/documentation\/wwdcnotes","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"title":"WWDC Notes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"role":"collection"}}}