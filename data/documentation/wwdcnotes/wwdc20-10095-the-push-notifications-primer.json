{"metadata":{"title":"The Push Notifications primer","role":"sampleCode","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC20"},"sections":[],"kind":"article","schemaVersion":{"patch":0,"minor":3,"major":0},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10095-The-Push-Notifications-primer","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"sampleCodeDownload":{"action":{"overridingTitle":"Watch Video (11 min)","type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/wwdc20\/10095"},"kind":"sampleDownload"},"primaryContentSections":[{"content":[{"type":"heading","level":2,"anchor":"Types-of-Notifications","text":"Types of Notifications"},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Alert notifications: Visible alerts, delivered in a way that allows customer to interact with it"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Background notifications: Received while your app is not running, in order to keep the application content updated","type":"text"}]}]}]},{"type":"heading","level":2,"anchor":"Alert-Notifications","text":"Alert Notifications"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Visible alerts"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Display new information"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Can be interactive"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Foreground or background app state"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Customizable"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To implement the notifications:"}]},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Register for remote notifications in your "},{"code":"didFinishLaunchingWithOptions","type":"codeVoice"},{"type":"text","text":" using:"}],"type":"paragraph"}]}]},{"code":["UIApplication.shared.registerForRemoteNotifications()"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"This allows the app to register for a remote notification and sends back a device token to be used to interact with the app through the user notification delegate","type":"text"}]},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Implement "},{"type":"codeVoice","code":"UNUserNotificationCenterDelegate"},{"type":"text","text":" and assign the "},{"type":"codeVoice","code":"AppDelegate"},{"type":"text","text":" as the "},{"type":"codeVoice","code":"UNUserNotificationCenter.current"},{"type":"text","text":" delegate"}],"type":"paragraph"}]}],"start":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Example of previous two steps implemented in "},{"code":"AppDelegate","type":"codeVoice"},{"type":"text","text":":"}]},{"code":["class AppDelegate: UIResponder, UIApplicationDelegate, UNUserNotificationCenterDelegate {","","    func application(_ application: UIApplication,","                     didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {","        UIApplication.shared.registerForRemoteNotifications()","        UNUserNotificationCenter.current().delegate = self","        return true","    }","\t...","}"],"type":"codeListing","syntax":"swift"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"When registering for remote notifications, you’ll receive a callback on one of two delegate methods:","type":"text"}]}]}],"start":3},{"code":["func application(_ application: UIApplication,","                   didFailToRegisterForRemoteNotificationsWithError error: Error) {","    \/\/ The token is not currently available.","    print(\"Remote notification is unavailable: \\(error.localizedDescription)\")","}","","func application(_ application: UIApplication,","                   didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {","     \/\/ Forward the token to your provider, using a custom method.","     self.forwardTokenToServer(token: deviceToken)","}"],"type":"codeListing","syntax":"swift"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"If retrieving a device token has failed, you will receive a callback in "},{"code":"didFailToRegisterForRemoteNotificationsWithError","type":"codeVoice"},{"type":"text","text":" letting you know what went wrong. If it succeeds, you will receive the device token in "},{"code":"didRegisterForRemoteNotificationsWithDeviceToken","type":"codeVoice"},{"type":"text","text":", which you will need to send your backend to be used later to send notifications to the app."}],"type":"paragraph"}]}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Forwarding device token can be done in a way similar to this:","type":"text"}]}]}],"start":4},{"code":["func forwardTokenToServer(token: Data) {","    let tokenComponents = token.map { data in String(format: \"%02.2hhx\", data) }","    let deviceTokenString = tokenComponents.joined()","    let queryItems = [URLQueryItem(name: \"deviceToken\", value: deviceTokenString)]","    var urlComps = URLComponents(string: \"www.example.com\/register\")!","    urlComps.queryItems = queryItems","    guard let url = urlComps.url else {","        return","    }","","    let task = URLSession.shared.dataTask(with: url) { data, response, error in","        \/\/ Handle data","    }","","    task.resume()","}"],"type":"codeListing","syntax":"swift"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Lastly, you need to ask for the user’s permission to send push notifications before doing so, this can be done using ","type":"text"},{"type":"codeVoice","code":"UNUserNotificationCenter"},{"text":":","type":"text"}]}]}],"start":5},{"code":["let userNotificationCenter = UNUserNotificationCenter.current()","userNotificationCenter.requestAuthorization(options: [.alert, .sound, .badge]) { (granted, error) in","    print(\"Permission granted: \\(granted)\")","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"And that’s it. Now you just have to send the notifications from your backend to the previously saved device token. Here is a notification payload example of a restaurant app that wants to promote a daily special:","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"WWDC20-10095-notification_example","type":"image"}]},{"code":["{","    \"aps\" : {","       \"alert\" : {","            \"title\" : \"Check out our new special!\",","            \"body\" : \"Avocado Bacon Burger on sale\"","        },","        \"sound\" : \"default\",","        \"badge\" : 1,","   },","    \"special\" : \"avocado_bacon_burger\",","    \"price\" : \"9.99\"","}"],"type":"codeListing","syntax":"js"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"The "},{"code":"aps","type":"codeVoice"},{"type":"text","text":" dictionary is a standard Apple Push Notification Service object that contains information about how the notification should be rendered. Inside we have:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"alert","type":"codeVoice"},{"type":"text","text":" object, this tells the system what text to use inside the notification"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"sound"},{"type":"text","text":" is an optional field which should be included if you want the device to play a sound upon delivering the notification, other values can be provided for custom sounds"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"badge"},{"type":"text","text":" is also optional field that’s used to modify the badge of your app icon, this is an absolute value which will be displayed on the app icon, also this value can be modified by the app programmatically"}]}]}]}]},{"content":[{"inlineContent":[{"code":"special","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"price","type":"codeVoice"},{"text":" are examples of custom data that you can provide to your application","type":"text"}],"type":"paragraph"}]}]},{"type":"heading","level":2,"anchor":"Parsing-The-Notification-Payload","text":"Parsing The Notification Payload"},{"type":"paragraph","inlineContent":[{"text":"Here is how you can parse the previous sample notification payload:","type":"text"}]},{"code":["func userNotificationCenter(_ center: UNUserNotificationCenter,","                            didReceive response: UNNotificationResponse,","                            withCompletionHandler completionHandler: @escaping () -> Void) {","    let userInfo = response.notification.request.content.userInfo","    guard let specialName = userInfo[\"special\"] as? String,","          let specialPriceString = userInfo[\"price\"] as? String,","          let specialPrice = Float(specialPriceString) else {","        \/\/ Always call the completion handler when done.","        completionHandler()","        return","    }","","    let item = Item(name: specialName, price: specialPrice)","\t\taddItemToCart(item)","  \tshowCartViewController()","    completionHandler()"," }"],"type":"codeListing","syntax":"swift"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"It is important to call "},{"code":"completionHandler","type":"codeVoice"},{"type":"text","text":" before returning from the function."}]}],"style":"note","name":"Note","type":"aside"},{"type":"heading","level":2,"anchor":"Background-Notifications","text":"Background Notifications"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Fetch data in background","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Keep application up to date","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Will launch the application if needed"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Managed by the system","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"To implement Background Notifications:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"you just have to follow the same steps 1, 3, and 4 from Alert Notifications steps.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"implementing the delegate in step 2 isn’t required because there won’t be any user response to those notifications","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Background Notifications don’t require asking for user’s permission as in step 5 of Alert Notifications.","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"An example of a Background Notification payload is this:"}]},{"code":["{","    \"aps\" : {","       \"content-available\" : 1","    },","    \"myCustomKey\" : \"myCustomData\"","}"],"type":"codeListing","syntax":"js"},{"type":"paragraph","inlineContent":[{"text":"It’s a much simpler version of Alert Notifications payload, where you only have to provide the ","type":"text"},{"code":"content-available: 1","type":"codeVoice"},{"text":" key-value pairs inside the ","type":"text"},{"code":"aps","type":"codeVoice"},{"text":" dictionary, which tells the system that this is a Background Notification.","type":"text"},{"text":"\n","type":"text"},{"text":"As in Alert Notification, you can also send custom data inside your payload.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Handling a Background Notification is done by implementing the application delegate function ","type":"text"},{"type":"codeVoice","code":"application(_ :didReceiveRemoteNotification:fetchCompletionHandler"},{"text":":","type":"text"}]},{"code":["func application(_ application: UIApplication,","                     didReceiveRemoteNotification userInfo: [AnyHashable : Any],","                     fetchCompletionHandler completionHandler:","                     @escaping (UIBackgroundFetchResult) -> Void) {","    guard let url = URL(string: \"www.example.com\/todays-menu\") else {","        completionHandler(.failed)","        return","    }","","    let task = URLSession.shared.dataTask(with: url) { data, response, error in","        guard let data = data else {","            completionHandler(.noData)","            return","        }","  ","        updateMenu(withData: data)","        completionHandler(.newData)","    }","}"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This function also requires calling the "},{"code":"completionHandler","type":"codeVoice"},{"type":"text","text":", but you will have sometime before the application is terminated by the system. Call the "},{"code":"complettionHandler","type":"codeVoice"},{"type":"text","text":" with the result of your background process. This helps the system determines when it’s the best time to delivery your next Background Notifications."}]},{"type":"paragraph","inlineContent":[{"text":"Here are sample apps that shows implementing ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/usernotifications\/implementing_alert_push_notifications"},{"type":"text","text":" and "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/usernotifications\/implementing_background_push_notifications"},{"type":"text","text":" notifications."}]},{"type":"heading","level":2,"anchor":"Written-By","text":"Written By"},{"numberOfColumns":5,"type":"row","columns":[{"content":[{"inlineContent":[{"type":"image","identifier":"ATahhan"}],"type":"paragraph"}],"size":1},{"content":[{"text":"Ammar AlTahhan","anchor":"Ammar-AlTahhan","level":3,"type":"heading"},{"inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/ATahhan","isActive":true,"type":"reference","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"overridingTitle":"Contributed Notes"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/ATahhan","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/","isActive":true,"type":"reference"}],"type":"paragraph"}],"size":4}]},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","isActive":true,"type":"reference"}]},{"type":"heading","level":2,"anchor":"Related-Sessions","text":"Related Sessions"},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10025-Meet-Push-Notifications-Console","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC18-806-Designing-Notifications"]},{"type":"small","inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}],"kind":"content"}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc20-10095-the-push-notifications-primer"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"text":"Help people get the most out of your app with push notifications for important events and updates — and by delivering up-to-date data in the background, so that it is ready when they open your app. Discover how you can use notifications and alert people to timely and relevant information. Learn the differences between alert and background notifications, how to adopt them in your apps, and avoid mistakes by using the right APIs for the job.","type":"text"}],"references":{"https://developer.apple.com/wwdc20/10095":{"url":"https:\/\/developer.apple.com\/wwdc20\/10095","identifier":"https:\/\/developer.apple.com\/wwdc20\/10095","checksum":null,"type":"download"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10025-Meet-Push-Notifications-Console":{"title":"Meet Push Notifications Console","url":"\/documentation\/wwdcnotes\/wwdc23-10025-meet-push-notifications-console","role":"sampleCode","type":"topic","abstract":[{"type":"text","text":"The Push Notifications Console is the best way to quickly test user notifications in your app. Learn how you can iterate on new ideas quickly by sending notifications directly from the console and analyze delivery logs to learn more about your pushes. We’ll also show you how to generate and validate tokens to successfully authenticate with Apple Push Notification service (APNs)."}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10025-Meet-Push-Notifications-Console"},"WWDC20-10095-notification_example":{"identifier":"WWDC20-10095-notification_example","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-10095-notification_example.png"}],"type":"image","alt":null},"ATahhan.jpeg":{"identifier":"ATahhan.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/ATahhan.jpeg"}],"type":"image","alt":null},"https://developer.apple.com/documentation/usernotifications/implementing_alert_push_notifications":{"title":"Alert","identifier":"https:\/\/developer.apple.com\/documentation\/usernotifications\/implementing_alert_push_notifications","titleInlineContent":[{"type":"text","text":"Alert"}],"type":"link","url":"https:\/\/developer.apple.com\/documentation\/usernotifications\/implementing_alert_push_notifications"},"ATahhan":{"identifier":"ATahhan","variants":[{"traits":["1x","light"],"url":"\/images\/ATahhan.jpeg"}],"type":"image","alt":"Profile image of Ammar AlTahhan"},"https://":{"title":"Blog","identifier":"https:\/\/","titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link","url":"https:\/\/"},"doc://WWDCNotes/documentation/WWDCNotes/ATahhan":{"abstract":[{"text":"Software Engineer","type":"text"}],"kind":"article","role":"sampleCode","images":[{"identifier":"ATahhan.jpeg","type":"card"},{"identifier":"ATahhan.jpeg","type":"icon"}],"url":"\/documentation\/wwdcnotes\/atahhan","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/ATahhan","title":"Ammar AlTahhan (12 notes)","type":"topic"},"WWDC20.jpeg":{"identifier":"WWDC20.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20.jpeg"}],"type":"image","alt":null},"https://github.com/ATahhan":{"title":"GitHub","identifier":"https:\/\/github.com\/ATahhan","titleInlineContent":[{"type":"text","text":"GitHub"}],"type":"link","url":"https:\/\/github.com\/ATahhan"},"https://developer.apple.com/documentation/usernotifications/implementing_background_push_notifications":{"title":"Background","identifier":"https:\/\/developer.apple.com\/documentation\/usernotifications\/implementing_background_push_notifications","titleInlineContent":[{"type":"text","text":"Background"}],"type":"link","url":"https:\/\/developer.apple.com\/documentation\/usernotifications\/implementing_background_push_notifications"},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link","url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC18-806-Designing-Notifications":{"title":"Designing Notifications","abstract":[{"text":"Thoughtfully designed notifications are a powerful way to communicate timely information to people that they will find valuable and useful. Learn how you can design notifications people want to receive by making them beautiful, helpful, actionable, and respectful of their valuable time and attention.","type":"text"}],"role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC18-806-Designing-Notifications","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc18-806-designing-notifications","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc20","images":[{"type":"icon","identifier":"WWDC20-Icon.png"},{"type":"card","identifier":"WWDC20.jpeg"}],"type":"topic","title":"WWDC20","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","abstract":[{"text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"type":"codeVoice","code":"WidgetKit"},{"text":", ","type":"text"},{"code":"StoreKit Testing","type":"codeVoice"},{"type":"text","text":", and more."}],"role":"collectionGroup"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","title":"WWDC Notes","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"kind":"symbol","url":"\/documentation\/wwdcnotes","role":"collection"},"WWDC20-Icon.png":{"identifier":"WWDC20-Icon.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-Icon.png"}],"type":"image","alt":null}}}