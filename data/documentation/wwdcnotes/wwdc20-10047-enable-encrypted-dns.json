{"sampleCodeDownload":{"kind":"sampleDownload","action":{"identifier":"https:\/\/developer.apple.com\/wwdc20\/10047","isActive":true,"overridingTitle":"Watch Video (13 min)","type":"reference"}},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10047-Enable-encrypted-DNS"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"abstract":[{"text":"When people access the web within your app, their privacy is paramount. Safeguard that information by leveraging encrypted DNS across our platforms to deliver private and secure connectivity within your app. Discover how you can use system DNS settings to connect to encrypted servers or enable encrypted DNS within an app using standard networking APIs.","type":"text"}],"sections":[],"kind":"article","metadata":{"roleHeading":"WWDC20","modules":[{"name":"WWDC Notes"}],"role":"sampleCode","title":"Enable encrypted DNS"},"schemaVersion":{"major":0,"patch":0,"minor":3},"primaryContentSections":[{"kind":"content","content":[{"level":2,"type":"heading","anchor":"overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"DNS is short for Domain Name Server, it converts the webpage address you’re writing in the browser to actual IP addresses of servers on the internet, these questions are usually unencrypted and can be listened to or even interfered with."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"New in all Apple Platforms the support for encrypted DNS:"}]},{"items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"DoT"},{"type":"text","text":": DNS over TLS"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"DoH"},{"type":"text","text":": DNS over HTTPS"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"Both uses TLS to encrypt messages, but "},{"type":"codeVoice","code":"DoH"},{"text":" additionally uses HTTP to improve performance.","type":"text"},{"text":" ","type":"text"},{"text":"You can configure encrypted DNS in two ways:","type":"text"}],"type":"paragraph"},{"text":"1. System-wide configurations:","type":"heading","anchor":"1-System-wide-configurations","level":2},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Selects a single DNS server as the single resolver for all apps on the system"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"This can be done by writing a network extension app (or using a profile in case of MDM for enterprises) that configures the system to only use this single DNS server"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"This is an example of creating a network extension app to add a system-wide DNS configuration:"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"codeListing","code":["\/\/ Create a DNS configuration","","import NetworkExtension","","NEDNSSettingsManager.shared().loadFromPreferences { loadError in","\tif let loadError = loadError {","    \t\/\/ ...handle error...","    \treturn","\t}","\tlet dohSettings = NEDNSOverHTTPSSettings(servers: [ \"2001:db8::2\" ])","\tdohSettings.serverURL = URL(string: \"https:\/\/dnsserver.example.net\/dns-query\")","\tNEDNSSettingsManager.shared().dnsSettings = dohSettings","\tNEDNSSettingsManager.shared().saveToPreferences { saveError in","    \tif let saveError = saveError {","        \t\/\/ ...handle error...","        \treturn","    \t}","\t}","}"],"syntax":"swift"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Some compatibility rules that are applied by default when using a system-wide DNS settings:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Captive network detection (like when someone logs into a café network) is automatically granted an exception from your DNS configuration"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"When using VPNs, the DNS settings within the VPN tunnel is used over the configured DNS system settings","type":"text"}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"However, there are other rules you will have to setup yourself. For example, here is how you’d define a rule if you want to only grant an exception to a specific domain when using the work WiFi network:"}]}]}],"type":"unorderedList"},{"type":"codeListing","code":["\/\/ Apply network rules","","let workWiFi = NEOnDemandRuleEvaluateConnection()","workWiFi.interfaceTypeMatch = .wiFi","workWiFi.ssidMatch = [\"MyWorkWiFi\"]","workWiFi.connectionRules =","\t[ NEEvaluateConnectionRule(matchDomains: [\"enterprise.example.net\"],","                    \t\t   andAction: .neverConnect) ]","","let disableOnCell = NEOnDemandRuleDisconnect()","disableOnCell.interfaceTypeMatch = .cellular","","let enableByDefault = NEOnDemandRuleConnect()","","NEDNSSettingsManager.shared().onDemandRules = [","\tworkWiFi,","\tdisableOnCell,","\tenableByDefault","]"],"syntax":"swift"},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"There is a demo that shows a sample project on how you can fully implement a system-wide encrypted DNS"}]}],"name":"Note"},{"text":"2. Application opt-in configurations:","type":"heading","anchor":"2-Application-opt-in-configurations","level":2},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"You can configure your app only to use a single DNS resolver for some all of your app connections"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This works regardless of the way your app is accessing the network, "},{"type":"codeVoice","code":"URLSession"},{"type":"text","text":" tasks, "},{"type":"codeVoice","code":"Network.framework"},{"type":"text","text":" connections, or even POSIX APIs like "},{"type":"codeVoice","code":"getaddrinfo"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"This is an example of how you’d do it with "},{"type":"codeVoice","code":"Network.framework"},{"type":"text","text":":"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"codeListing","code":["\/\/ Use encrypted DNS with NWConnection","","import Network","","let privacyContext = NWParameters.PrivacyContext(description: \"EncryptedDNS\")","if let url = URL(string: \"https:\/\/dnsserver.example.net\/dns-query\") {","\tlet address = NWEndpoint.hostPort(host: \"2001:db8::2\", port: 443)","\tprivacyContext.requireEncryptedNameResolution(true,","    \tfallbackResolver: .https(url, serverAddresses: [ address ]))","}","","let tlsParams = NWParameters.tls","tlsParams.setPrivacyContext(privacyContext)","","let conn = NWConnection(host: \"www.example.com\", port: 443, using: tlsParams)","conn.start(queue: .main)"],"syntax":"swift"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Here is how to opt-in all of your application connections using other APIs:","type":"text"}]}]}],"type":"unorderedList"},{"type":"codeListing","code":["\/\/ Use encrypted DNS for other APIs","","import Network","","if let url = URL(string: \"https:\/\/dnsserver.example.net\/dns-query\") {","\tlet address = NWEndpoint.hostPort(host: \"2001:db8::2\", port: 443)","\tNWParameters.PrivacyContext.default.requireEncryptedNameResolution(true,","    \tfallbackResolver: .https(url, serverAddresses: [ address ]))","}","","let task = URLSession.shared.dataTask(with: ...)","task.resume()","","getaddrinfo(...)  "],"syntax":"swift"},{"type":"aside","style":"note","content":[{"inlineContent":[{"type":"text","text":"System-wide DNS configurations will take precedence over application specific ones"}],"type":"paragraph"}],"name":"Note"},{"text":"Written By","type":"heading","anchor":"Written-By","level":2},{"numberOfColumns":5,"type":"row","columns":[{"size":1,"content":[{"inlineContent":[{"type":"image","identifier":"ATahhan"}],"type":"paragraph"}]},{"size":4,"content":[{"type":"heading","level":3,"anchor":"Ammar-AlTahhan","text":"Ammar AlTahhan"},{"inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/ATahhan","isActive":true,"overridingTitle":"Contributed Notes","type":"reference","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}]},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/ATahhan","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/","isActive":true,"type":"reference"}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","isActive":true}],"type":"paragraph"},{"text":"Related Sessions","type":"heading","anchor":"Related-Sessions","level":2},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10053-Whats-new-in-privacy","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10079-Improve-DNS-security-for-apps-and-servers","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10111-Boost-performance-and-security-with-modern-networking","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10676-Build-trust-through-better-privacy"],"type":"links","style":"list"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}]}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc20-10047-enable-encrypted-dns"],"traits":[{"interfaceLanguage":"swift"}]}],"references":{"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"type":"link","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10676-Build-trust-through-better-privacy":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10676-Build-trust-through-better-privacy","abstract":[{"type":"text","text":"Privacy is a more important issue than ever. Learn about Apple’s privacy pillars, our approach to privacy, and how to adopt the latest features on our platforms that can help you earn customer trust, create more personal experiences, and improve engagement. Explore the transparency iOS provides when your app is recording using the microphone or camera, control over location with approximate location, tracking transparency and permissions, and much more."}],"title":"Build trust through better privacy","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc20-10676-build-trust-through-better-privacy","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10053-Whats-new-in-privacy":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10053-Whats-new-in-privacy","abstract":[{"type":"text","text":"At Apple, we believe that privacy is a fundamental human right. Learn about new technologies on Apple platforms that make it easier for you to implement essential privacy patterns that build customer trust in your app. Discover privacy improvements for Apple’s platforms, as well as a study of how privacy shaped the software architecture and design for the input model on visionOS."}],"title":"What’s new in privacy","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc23-10053-whats-new-in-privacy","kind":"article"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","type":"image","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}]},"https://github.com/ATahhan":{"identifier":"https:\/\/github.com\/ATahhan","type":"link","titleInlineContent":[{"type":"text","text":"GitHub"}],"url":"https:\/\/github.com\/ATahhan","title":"GitHub"},"doc://WWDCNotes/documentation/WWDCNotes":{"abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"kind":"symbol","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","type":"topic","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"role":"collection"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10079-Improve-DNS-security-for-apps-and-servers":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10079-Improve-DNS-security-for-apps-and-servers","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc22-10079-improve-dns-security-for-apps-and-servers","abstract":[{"type":"text","text":"Discover the latest ways to ensure that DNS — the foundation of internet addressing — is secure within your app. Learn how to authenticate DNS responses in your app with DNSSEC and enable DNS encryption automatically with Discovery of Designated Resolvers (DDR)."}],"kind":"article","role":"sampleCode","title":"Improve DNS security for apps and servers"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"role":"collectionGroup","kind":"article","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc20","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"title":"WWDC20","abstract":[{"type":"text","text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"WidgetKit"},{"type":"text","text":", "},{"type":"codeVoice","code":"StoreKit Testing"},{"text":", and more.","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10111-Boost-performance-and-security-with-modern-networking":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10111-Boost-performance-and-security-with-modern-networking","abstract":[{"type":"text","text":"Speed up your app and make it more nimble, private and secure with modern networking APIs. Learn about networking protocols like IPv6, HTTP\/2, TLS 1.3 and Encrypted DNS, and how incorporating these within your app and server can provide faster performance and reduce both your power consumption and thermal impact. In addition, discover how adopting the latest security protocols can help you better protect privacy within your app."}],"title":"Boost performance and security with modern networking","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc20-10111-boost-performance-and-security-with-modern-networking","kind":"article"},"https://developer.apple.com/wwdc20/10047":{"identifier":"https:\/\/developer.apple.com\/wwdc20\/10047","type":"download","url":"https:\/\/developer.apple.com\/wwdc20\/10047","checksum":null},"https://":{"identifier":"https:\/\/","type":"link","titleInlineContent":[{"type":"text","text":"Blog"}],"url":"https:\/\/","title":"Blog"},"ATahhan.jpeg":{"identifier":"ATahhan.jpeg","type":"image","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/ATahhan.jpeg"}]},"ATahhan":{"identifier":"ATahhan","type":"image","alt":"Profile image of Ammar AlTahhan","variants":[{"traits":["1x","light"],"url":"\/images\/ATahhan.jpeg"}]},"doc://WWDCNotes/documentation/WWDCNotes/ATahhan":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/ATahhan","images":[{"type":"card","identifier":"ATahhan.jpeg"},{"type":"icon","identifier":"ATahhan.jpeg"}],"type":"topic","url":"\/documentation\/wwdcnotes\/atahhan","abstract":[{"type":"text","text":"Software Engineer"}],"kind":"article","role":"sampleCode","title":"Ammar AlTahhan (12 notes)"}}}