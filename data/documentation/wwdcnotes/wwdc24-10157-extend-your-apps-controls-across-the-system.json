{"metadata":{"title":"Extend your app’s controls across the system","role":"sampleCode","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC24"},"sampleCodeDownload":{"action":{"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc24\/10157","isActive":true,"overridingTitle":"Watch Video"},"kind":"sampleDownload"},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10157-Extend-your-apps-controls-across-the-system","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24"]]},"abstract":[{"text":"Bring your app’s controls to Control Center, the Lock Screen, and beyond. Learn how you can use WidgetKit to extend your app’s controls to the system experience. We’ll cover how you can to build a control, tailor its appearance, and make it configurable.","type":"text"}],"primaryContentSections":[{"content":[{"anchor":"Key-takeaways","level":2,"text":"Key takeaways","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Controls provide quick access to an app’s key actions in system spaces."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"App Intents are used to handle state updates from Control Center, the Lock Screen and the Action button."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Use ValueProviders to synchronise state changes across multiple devices."}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Presenter","level":2,"text":"Presenter","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Cliff Panos, System Experience Engineer"}]}]}],"type":"unorderedList"},{"anchor":"New-widget-in-WidgetKit","level":2,"text":"New widget in WidgetKit","type":"heading"},{"inlineContent":[{"text":"Controls are a new widget available on iOS and iPadOS 18 that enable you to extend functionality from your app into Control Center, the Lock Screen and the Action button.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"They should be used to handle discrete actions and succinct information ie. turning on a flashlight or deep linking into the Clock app."}],"type":"paragraph"},{"anchor":"Control-types","level":2,"text":"Control types","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Buttons: perform discrete actions ie. launch the app"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Toggles: change a boolean state ie. turn light off","type":"text"}]}]}],"type":"unorderedList"},{"anchor":"Control-display","level":2,"text":"Control display","type":"heading"},{"inlineContent":[{"type":"text","text":"A control can include:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Symbol","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Title"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Tint colour","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Additional values"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Restrictions:"}]},{"type":"text","text":" "},{"type":"emphasis","inlineContent":[{"text":"Control Center:","type":"text"}]},{"type":"text","text":" you can’t rely on the title or value text always being visible since the control can be dynamically displayed at 3 different sizes."},{"type":"text","text":" "},{"type":"emphasis","inlineContent":[{"type":"text","text":"Lock screen:"}]},{"type":"text","text":" value text is never visible."}],"type":"paragraph"},{"anchor":"Build-a-control-Add-to-WidgetBundle","level":2,"text":"Build a control: Add to WidgetBundle","type":"heading"},{"inlineContent":[{"text":"Add the control to the WidgetBundle:","type":"text"}],"type":"paragraph"},{"syntax":"@main","code":["struct ProductivityExtensionBundle: WidgetBundle {","    var body: some Widget {","        TimerToggle()","    }","}"],"type":"codeListing"},{"anchor":"Build-a-control-Basic-ControlWidget-template","level":2,"text":"Build a control: Basic ControlWidget template","type":"heading"},{"inlineContent":[{"text":"Declare and define the control by:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"conforming to "},{"code":"ControlWidget","type":"codeVoice"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"setting a configuration type such as "},{"code":"StaticControlConfiguration","type":"codeVoice"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"setting the title and state","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"defining the action to be performed and","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"adding the symbol image","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"syntax":"struct TimerToggle: ControlWidget {","code":["    var body: some ControlWidgetConfiguration {","        StaticControlConfiguration(","            kind: \"com.apple.Productivity.TimerToggle\"","        ) {","            ControlWidgetToggle(","                \"Work Timer\",","                isOn: TimerManager.shared.isRunning,","                action: ToggleTimerIntent()","            ) { _ in","                Image(systemName:","                      \"hourglass.bottomhalf.filled\")","            }","        }","    }","}"],"type":"codeListing"},{"anchor":"Stateful-updates","level":2,"text":"Stateful updates","type":"heading"},{"inlineContent":[{"text":"Dynamically change control text and symbols according to control state:","type":"text"}],"type":"paragraph"},{"syntax":"Label(isOn ? \"Running\" : \"Stopped\",","code":["                      systemImage: isOn","                      ? \"hourglass\"","                      : \"hourglass.bottomhalf.filled\")```","","","## Stateful updates","","A control's data comes from a shared group container with your iOS app and the state is synchronously fetched.","","Control state is updated when:","* An action is performed on the control","    - The reload occurs after the App Intent `perform()` function returns so ensure all updates are made before it returns.","* Your app requests a reload of the control","* A push notification invalidates the control","","## App Intents handle the control's state","","App intents are the underlying mechanism which controls use to perform their actions:","","```struct ToggleTimerIntent: SetValueIntent, LiveActivityIntent {","    static let title: LocalizedStringResource = \"Productivity Timer\"","    ","    @Parameter(title: \"Running\")","    var value: Bool","    ","    func perform() throws -> some IntentResult {","        TimerManager.shared.setTimerRunning(value)","        return .result()","    }","}"],"type":"codeListing"},{"anchor":"Updating-the-controls-state-from-your-app","level":2,"text":"Updating the control’s state from your app","type":"heading"},{"inlineContent":[{"type":"text","text":"Controls use the same refresh mechanisms as widgets and live activities:"}],"type":"paragraph"},{"syntax":"func timerManager(_ manager: TimerManager,","code":["                  timerDidChange timer: ProductivityTimer) {","    ControlCenter.shared.reloadControls(","        ofKind: \"com.apple.Productivity.TimerToggle\"","    )","}"],"type":"codeListing"},{"anchor":"Sharing-state-across-multiple-devices","level":2,"text":"Sharing state across multiple devices","type":"heading"},{"inlineContent":[{"type":"text","text":"When sharing state across multiple devices use ValueProvider to fetch the control state asynchronously:"}],"type":"paragraph"},{"syntax":"struct TimerValueProvider: ControlValueProvider {","code":["    ","    func currentValue() async throws -> Bool {","        try await TimerManager.shared.fetchRunningState()","    }","    ","    let previewValue: Bool = false","}"],"type":"codeListing"},{"inlineContent":[{"text":"Use ","type":"text"},{"type":"codeVoice","code":"ControlPushHandler"},{"text":" to update state changes across devices.","type":"text"}],"type":"paragraph"},{"anchor":"User-configurable-controls","level":2,"text":"User-configurable controls","type":"heading"},{"inlineContent":[{"text":"Conform to ","type":"text"},{"code":"AppIntentControlValueProvider","type":"codeVoice"},{"text":" and return a custom struct of the control and its state, then access the state in ControlWidget:","type":"text"}],"type":"paragraph"},{"syntax":"struct TimerToggle: ControlWidget {","code":["    var body: some ControlWidgetConfiguration {","        AppIntentControlConfiguration(","            kind: \"com.apple.Productivity.TimerToggle\",","            provider: ConfigurableTimerValueProvider()","        ) { timerState in","            ControlWidgetToggle(","                timerState.timer.name,","                isOn: timerState.isRunning,","                action: ToggleTimerIntent(timer: timerState.timer)","            ) { isOn in","                Label(isOn ? \"Running\" : \"Stopped\",","                      systemImage: isOn","                      ? \"hourglass\"","                      : \"hourglass.bottomhalf.filled\")","            }","            .tint(.purple)","        }","    }","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"Use the "},{"type":"codeVoice","code":".promptsForUserConfiguration()"},{"type":"text","text":" modifier when the control requires user configuration to work."}],"type":"paragraph"},{"anchor":"Further-configuration-options","level":2,"text":"Further configuration options","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Hints can be displayed by the Action button using the ","type":"text"},{"code":".controlWidgetActionHint","type":"codeVoice"},{"text":" modifier.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Controls can display a brief status in Control Center after an action is performed using the "},{"type":"codeVoice","code":".controlWidgetStatus"},{"type":"text","text":" modifier."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"A control’s default name is the name of the app, customise it using the "},{"code":".displayName","type":"codeVoice"},{"type":"text","text":" modifier."}]}]}],"type":"unorderedList"},{"anchor":"Written-By","level":2,"text":"Written By","type":"heading"},{"inlineContent":[{"text":"@Row(numberOfColumns: 5) {","type":"text"},{"text":" ","type":"text"},{"text":"@Column {","type":"text"},{"text":" ","type":"text"},{"text":"@Image(source: “teacup”, alt: “Profile image of teacup”)","type":"text"},{"text":" ","type":"text"},{"text":"}","type":"text"},{"text":" ","type":"text"},{"text":"@Column(size: 4) {","type":"text"},{"text":" ","type":"text"},{"text":"### ","type":"text"},{"overridingTitleInlineContent":[{"text":"teacup","type":"text"}],"isActive":true,"overridingTitle":"teacup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/teacup","type":"reference"}],"type":"paragraph"},{"syntax":"swift","code":["  [Contributed Notes](<doc:teacup>)","  |","  [GitHub](https:\/\/github.com\/teacup)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"}"},{"type":"text","text":" "},{"type":"text","text":"}"}],"type":"paragraph"},{"type":"thematicBreak"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"reference"}],"type":"paragraph"},{"anchor":"Related-Sessions","level":2,"text":"Related Sessions","type":"heading"},{"inlineContent":[{"text":"@Links(visualStyle: list) {","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"isActive":true,"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10204-Build-a-great-Lock-Screen-camera-capture-experience","type":"reference"},{"type":"text","text":" "},{"type":"text","text":"}"}]}]}],"type":"unorderedList"},{"inlineContent":[{"text":"@Small {","type":"text"},{"text":" ","type":"text"},{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}],"type":"paragraph"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"},{"text":" ","type":"text"},{"text":"}","type":"text"}],"type":"paragraph"}],"kind":"content"}],"kind":"article","variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc24-10157-extend-your-apps-controls-across-the-system"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"minor":3,"major":0,"patch":0},"sections":[],"references":{"WWDCNotes.png":{"variants":[{"url":"\/images\/WWDCNotes\/WWDCNotes.png","traits":["1x","light"]}],"alt":null,"identifier":"WWDCNotes.png","type":"image"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC24":{"kind":"article","images":[{"type":"icon","identifier":"WWDC24-Icon.png"},{"type":"card","identifier":"WWDC24.jpeg"}],"role":"collectionGroup","url":"\/documentation\/wwdcnotes\/wwdc24","title":"WWDC24","type":"topic","abstract":[{"text":"Xcode 16, Swift 6, iOS 18, macOS 15 (Sequoia), tvOS 18, visionOS 2, watchOS 11.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: Swift Testing, ","type":"text"},{"type":"codeVoice","code":"FinanceKit"},{"text":", ","type":"text"},{"type":"codeVoice","code":"TabletopKit"},{"text":", and more.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24"},"WWDC24-Icon.png":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC24-Icon.png","traits":["1x","light"]}],"identifier":"WWDC24-Icon.png","alt":null},"teacup.jpeg":{"type":"image","identifier":"teacup.jpeg","alt":null,"variants":[{"url":"\/images\/WWDCNotes\/teacup.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection","url":"\/documentation\/wwdcnotes","type":"topic","title":"WWDC Notes","images":[{"type":"icon","identifier":"WWDCNotes.png"}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","type":"link","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}]},"WWDC24.jpeg":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC24.jpeg","traits":["1x","light"]}],"identifier":"WWDC24.jpeg","alt":null},"https://":{"type":"link","identifier":"https:\/\/","titleInlineContent":[{"text":"Blog","type":"text"}],"url":"https:\/\/","title":"Blog"},"https://developer.apple.com/wwdc24/10157":{"checksum":null,"url":"https:\/\/developer.apple.com\/wwdc24\/10157","identifier":"https:\/\/developer.apple.com\/wwdc24\/10157","type":"download"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC24-10204-Build-a-great-Lock-Screen-camera-capture-experience":{"url":"\/documentation\/wwdcnotes\/wwdc24-10204-build-a-great-lock-screen-camera-capture-experience","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10204-Build-a-great-Lock-Screen-camera-capture-experience","title":"Build a great Lock Screen camera capture experience","role":"sampleCode","abstract":[{"text":"Find out how the LockedCameraCapture API can help you bring your capture application’s most useful information directly to the Lock Screen. Examine the API’s features and functionality, learn how to get started creating a capture extension, and find out how that extension behaves when the device is locked.","type":"text"}],"kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/teacup":{"abstract":[{"text":"No Bio on GitHub","type":"text"}],"role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/teacup","url":"\/documentation\/wwdcnotes\/teacup","title":"teacup (1 note)","type":"topic","kind":"article","images":[{"type":"card","identifier":"teacup.jpeg"},{"type":"icon","identifier":"teacup.jpeg"}]}}}