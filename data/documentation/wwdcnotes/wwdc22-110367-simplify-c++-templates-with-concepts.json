{"metadata":{"title":"Simplify C++ templates with concepts","modules":[{"name":"WWDC Notes"}],"role":"sampleCode","roleHeading":"WWDC22"},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc22-110367-simplify-c++-templates-with-concepts"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110367-Simplify-C++-templates-with-concepts","interfaceLanguage":"swift"},"kind":"article","sections":[],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22"]]},"abstract":[{"text":"Discover how C++20 features can take your C++ code to the next level. We’ll introduce concepts and explore how you can use it to find errors faster in your generic C++ code. We’ll also discuss the latest enhancements to the constexpr feature and show how you can leverage it to improve your app’s performance by evaluating code at compile time.","type":"text"}],"primaryContentSections":[{"content":[{"level":2,"text":"Overview","anchor":"overview","type":"heading"},{"inlineContent":[{"type":"text","text":"Speaker: Alex Lorenz, Developer Tools Engineer"}],"type":"paragraph"},{"level":2,"text":"C++ Templates","anchor":"C++-Templates","type":"heading"},{"inlineContent":[{"type":"text","text":"Prior to C++20, C++ programmers did not have a good way to specify template requirements when writing generic C++ code."}],"type":"paragraph"},{"inlineContent":[{"text":"For example","type":"text"}],"type":"paragraph"},{"syntax":"cpp","code":["template<class T>","bool isOdd(T x) {","   return (x % 2) == 1;","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"While this looks good, the requirements for what types are allowed into ‘isOdd’ are not specified explicitly. So…"}],"type":"paragraph"},{"syntax":"cpp","code":["\/\/ Passing a double into a function that implies that 'T' specialization is an integer type","assert(isOdd(1.1));"],"type":"codeListing"},{"inlineContent":[{"text":"… causes a compiler error (“Invalid operands to binary expression (","type":"text"},{"code":"double","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"int","type":"codeVoice"},{"text":")”) in the ","type":"text"},{"inlineContent":[{"code":"isOdd","type":"codeVoice"}],"type":"strong"},{"text":" function, which can be very hard to track down ","type":"text"},{"inlineContent":[{"type":"text","text":"why"}],"type":"emphasis"},{"text":".","type":"text"}],"type":"paragraph"},{"level":2,"text":"Using concepts","anchor":"Using-concepts","type":"heading"},{"inlineContent":[{"text":"This is where ","type":"text"},{"inlineContent":[{"text":"C++20 concepts","type":"text"}],"type":"strong"},{"text":" comes in. You can use concepts to validate template requirements in your generic C++ code.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"C++20 allows us to replace the ","type":"text"},{"type":"codeVoice","code":"class"},{"text":" specifier in the template definition with a ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"concept"}]},{"text":" to restrict the set of types that this template can be used with.","type":"text"}],"type":"paragraph"},{"syntax":"cpp","code":["#include <concepts>","template<std::integral T>","bool isOdd(T x) {","   return (x % 2) == 1;","}"],"type":"codeListing"},{"inlineContent":[{"text":"The compiler will not even try to specialize this function template when T does not satisfy this concept and give us useful information as to why and where the ","type":"text"},{"inlineContent":[{"text":"actual","type":"text"}],"type":"emphasis"},{"text":" error occurred.","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Concepts are used to define the ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"intent"}]},{"text":" of your template code.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"The standard library provides a set of ","type":"text"},{"inlineContent":[{"type":"text","text":"core concepts"}],"type":"strong"},{"text":" which are accessed through the ","type":"text"},{"code":"concepts","type":"codeVoice"},{"text":" header file and validated during compile time.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":3,"text":"Built-in Concept Examples","anchor":"Built-in-Concept-Examples","type":"heading"},{"rows":[[[{"inlineContent":[{"type":"text","text":"Concept"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Description","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"std::floating_point<double>","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Is ‘double’ a floating point?"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"std::convertible_to<long, int>"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Can ‘long’ be converted to ‘int’","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"std::move_constructible<std::vector<int>>"}],"type":"paragraph"}],[{"inlineContent":[{"text":"satisfied by types that can be constructed directly from another value of the same type","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"std::equality_comparable","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Does the types have a valid ‘==’ operator that works with a value of the same type."}],"type":"paragraph"}]]],"header":"row","type":"table"},{"inlineContent":[{"text":"Other type examples :-","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Can a type be moved or copied?"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Check if a type is a callable object.","type":"text"}]}]}],"type":"unorderedList"},{"level":3,"text":"The requires keyword","anchor":"The-requires-keyword","type":"heading"},{"inlineContent":[{"type":"text","text":"Instead of replacing "},{"code":"class","type":"codeVoice"},{"type":"text","text":" with a concept, you can use the "},{"code":"requires","type":"codeVoice"},{"type":"text","text":" keyword to restrict multiple concepts"}],"type":"paragraph"},{"syntax":"cpp","code":["template<class T>","requires std::equality_comparable<T> && std::default_constructible<T>","bool isDefaultValue(const T &value) {","   return value == T();","}"],"type":"codeListing"},{"level":2,"text":"Create concepts","anchor":"Create-concepts","type":"heading"},{"inlineContent":[{"type":"text","text":"You can create your own concepts. These run at compile time, and are completely discarded after the validation occurs."}],"type":"paragraph"},{"syntax":"cpp","code":["template<class T>","Color computePixelColor(const T &shape, float x, float y) {","   float dist = shape.getDistanceFrom(x, y);","   if (dist <= 0.0) {","      return Color::white();","   }","   return Color::transparent();","}"],"type":"codeListing"},{"level":3,"text":"Create a ‘shape’ concept to validate the shape.","anchor":"Create-a-shape-concept-to-validate-the-shape","type":"heading"},{"inlineContent":[{"type":"text","text":"We create a concept that validates that the shape type has a "},{"type":"codeVoice","code":"getDistanceFrom"},{"type":"text","text":" function which takes two float parameters."}],"type":"paragraph"},{"syntax":"cpp","code":["template<class T>","concept Shape = requires(const T &shape) {","  shape.getDistanceFrom(0.0f, 0.0f)","}"],"type":"codeListing"},{"items":[{"content":[{"inlineContent":[{"text":"The argument list in the ","type":"text"},{"code":"requires","type":"codeVoice"},{"text":" expression can declare values of any time. You can then use these values within the ","type":"text"},{"code":"requires","type":"codeVoice"},{"text":" body.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The body contains a set of requirements that must pass in order for the concept to be satisfied. "},{"type":"strong","inlineContent":[{"type":"text","text":"This is only needed at compile time to validate, and is discarded after validation."}]}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"We can further extend this concept to check that the function returns the expected type."}],"type":"paragraph"},{"syntax":"cpp","code":["template<class T>","concept Shape = requires(const T &shape) {","  { shape.getDistanceFrom(0.0f, 0.0f) } -> std::same_as<float>;","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"So, this shape concept now validates :-"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"shape","type":"codeVoice"},{"text":" has a ","type":"text"},{"code":"getDistanceFrom","type":"codeVoice"},{"text":" function, which takes two float values.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"getDistanceFrom","type":"codeVoice"},{"text":" function returns a value which is the same as a float.","type":"text"}]}]}],"type":"orderedList"},{"inlineContent":[{"type":"text","text":"Now, I can create functions that only accept valid ‘Shape’ types"}],"type":"paragraph"},{"syntax":"cpp","code":["template<Shape T>","Color computePixelColor(const T &shape, float x, float y) { … }"],"type":"codeListing"},{"level":3,"text":"Multiple variants of a function template","anchor":"Multiple-variants-of-a-function-template","type":"heading"},{"inlineContent":[{"type":"text","text":"You can create multiple variants of function template using different concepts"}],"type":"paragraph"},{"syntax":"cpp","code":["template<class T>","concept GradientShape = Shape<T> && requires(const T &shape) {","  { shape,getGradientColor(0,0f, 0,0f) } -> std::same_as<Color>;","}","","template<GradientShape T>","Color computePixelColor(const T &shape, float x, float y) { … }"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"Thus, calling "},{"type":"codeVoice","code":"computePixelColor"},{"type":"text","text":" with a "},{"type":"codeVoice","code":"GradientShape"},{"type":"text","text":" object will call the correct function."}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The compiler will choose the "},{"type":"strong","inlineContent":[{"type":"text","text":"most specific"}]},{"type":"text","text":" template function available, so even though a "},{"code":"GradientShape","type":"codeVoice"},{"type":"text","text":" works with both variants it will choose the most specific overload."}]}]}],"type":"unorderedList"},{"level":3,"text":"Creating concepts","anchor":"Creating-concepts","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Create concepts by identifying requirements in generic code","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Use ","type":"text"},{"type":"codeVoice","code":"requires"},{"text":" expression(s) to validate behviour of types","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Use concepts to provide overloaded variants for generic functions","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Additional C++20 improvements in Xcode 14","anchor":"Additional-C++20-improvements-in-Xcode-14","type":"heading"},{"level":3,"text":"Compile time evaluation (constexpr)","anchor":"Compile-time-evaluation-constexpr","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Reduce the cost of initialization for variables","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Verify constants at compile time","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"Mark your functions\/declaractions "},{"type":"codeVoice","code":"constexpr"},{"type":"text","text":" if you want them to be run at compile time."}],"type":"paragraph"},{"syntax":"cpp","code":["constexpr Color Color::fromHexCode(std::string_view hexcode) { … }","constexpr const std::array<Color, 3> colorPalette = {","   Color::fromHexCode(\"#FF5733\"),","   Color::fromHexCode(\"#5640FE\"),","   Color::fromHexCode(\"#55FFCC\")","};"],"type":"codeListing"},{"inlineContent":[{"text":"This way, the ","type":"text"},{"type":"codeVoice","code":"colorPalette"},{"text":" is guaranteed to be initialized with the contant values at compile time, significantly reducing startup time.","type":"text"}],"type":"paragraph"},{"level":3,"text":"New Supported C++20 Features","anchor":"New-Supported-C++20-Features","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"std::bind_front","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Concepts"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Template Constraints","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Safe Mixed-Type","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Integral Comparisons","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"constexpr std::sort"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"constexpr std::tuple"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"std::to_underlying","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"constexpr std::pair","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"constexpr std::reverse"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"constexpr std::swap"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"constexpr Default Constructor for std::atomic","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"using enum"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Iterator Concepts"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Core Concepts Library"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Atomic Synchronization Library"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Contains Method For Associative Containers","type":"text"}]}]}],"type":"unorderedList"},{"level":3,"text":"You should switch to C++20 today if you haven’t already done so","anchor":"You-should-switch-to-C++20-today-if-you-havent-already-done-so","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"You can use the “C++ Language Dialect” setting in your Xcode project to upgrade to C++20"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"C++20 does not require a minimum deployment target"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Written By","anchor":"Written-By","type":"heading"},{"columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"identifier":"dagronf","type":"image"}]}]},{"size":4,"content":[{"text":"Darren Ford","anchor":"Darren-Ford","level":3,"type":"heading"},{"inlineContent":[{"type":"reference","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/dagronf","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/dagronf","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/www.linkedin.com\/in\/darren-ford-dev","isActive":true}],"type":"paragraph"}]}],"numberOfColumns":5,"type":"row"},{"type":"thematicBreak"},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"level":2,"text":"Related Sessions","anchor":"Related-Sessions","type":"heading"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110362-Link-fast-Improve-build-and-launch-times"],"style":"list","type":"links"},{"inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"sampleCodeDownload":{"action":{"identifier":"https:\/\/developer.apple.com\/wwdc22\/110367","type":"reference","overridingTitle":"Watch Video (27 min)","isActive":true},"kind":"sampleDownload"},"schemaVersion":{"major":0,"patch":0,"minor":3},"references":{"doc://WWDCNotes/documentation/WWDCNotes/dagronf":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/dagronf","images":[{"type":"card","identifier":"dagronf.jpeg"},{"type":"icon","identifier":"dagronf.jpeg"}],"url":"\/documentation\/wwdcnotes\/dagronf","type":"topic","abstract":[{"type":"text","text":"No Bio on GitHub"}],"role":"sampleCode","title":"Darren Ford (6 notes)","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"url":"\/documentation\/wwdcnotes","type":"topic","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"role":"collection","title":"WWDC Notes","kind":"symbol"},"https://www.linkedin.com/in/darren-ford-dev":{"titleInlineContent":[{"text":"Blog","type":"text"}],"url":"https:\/\/www.linkedin.com\/in\/darren-ford-dev","type":"link","identifier":"https:\/\/www.linkedin.com\/in\/darren-ford-dev","title":"Blog"},"https://developer.apple.com/wwdc22/110367":{"identifier":"https:\/\/developer.apple.com\/wwdc22\/110367","url":"https:\/\/developer.apple.com\/wwdc22\/110367","checksum":null,"type":"download"},"WWDC22-Icon.png":{"alt":null,"type":"image","identifier":"WWDC22-Icon.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC22-Icon.png"}]},"dagronf":{"identifier":"dagronf","alt":"Profile image of Darren Ford","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/dagronf.jpeg"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110362-Link-fast-Improve-build-and-launch-times":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110362-Link-fast-Improve-build-and-launch-times","title":"Link fast: Improve build and launch times","kind":"article","role":"sampleCode","type":"topic","abstract":[{"type":"text","text":"Discover how to improve your app’s build and runtime linking performance. We’ll take you behind the scenes to learn more about linking, your options, and the latest updates that improve the link performance of your app."}],"url":"\/documentation\/wwdcnotes\/wwdc22-110362-link-fast-improve-build-and-launch-times"},"https://github.com/dagronf":{"titleInlineContent":[{"text":"GitHub","type":"text"}],"url":"https:\/\/github.com\/dagronf","type":"link","identifier":"https:\/\/github.com\/dagronf","title":"GitHub"},"WWDCNotes.png":{"alt":null,"type":"image","identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22","images":[{"identifier":"WWDC22-Icon.png","type":"icon"},{"identifier":"WWDC22.jpeg","type":"card"}],"url":"\/documentation\/wwdcnotes\/wwdc22","abstract":[{"type":"text","text":"Xcode 14, Swift 5.7, iOS 16, macOS 13 (Ventura), tvOS 16, watchOS 9."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"code":"WeatherKit","type":"codeVoice"},{"type":"text","text":", "},{"code":"ScreenCaptureKit","type":"codeVoice"},{"type":"text","text":", "},{"code":"Swift Regex","type":"codeVoice"},{"type":"text","text":", and more."}],"type":"topic","role":"collectionGroup","title":"WWDC22","kind":"article"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link"},"dagronf.jpeg":{"alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/dagronf.jpeg"}],"type":"image","identifier":"dagronf.jpeg"},"WWDC22.jpeg":{"alt":null,"type":"image","identifier":"WWDC22.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC22.jpeg"}]}}}