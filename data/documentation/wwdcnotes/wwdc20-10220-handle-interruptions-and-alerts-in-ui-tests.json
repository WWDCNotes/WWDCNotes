{"metadata":{"title":"Handle interruptions and alerts in UI tests","modules":[{"name":"WWDC Notes"}],"role":"sampleCode","roleHeading":"WWDC20"},"kind":"article","hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc20-10220-handle-interruptions-and-alerts-in-ui-tests"]}],"abstract":[{"type":"text","text":"Learn how to anticipate potential interruptions to your app’s interface and build smart tests to identify them. UI interruptions often appear indeterminately, typically during onboarding or first launch, which can make them hard to track down. Learn how to understand interruptions, write stronger tests with UI interruption handlers, and manage expected alerts."}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10220-Handle-interruptions-and-alerts-in-UI-tests"},"primaryContentSections":[{"content":[{"text":"What an UI interruption?","level":2,"type":"heading","anchor":"What-an-UI-interruption"},{"inlineContent":[{"type":"text","text":"An element that:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"appears unexpectedly"}]}]},{"content":[{"inlineContent":[{"text":"blocks access to another element (which an UI test is trying to interact with)","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Common interruptions:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"banner notifications"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"alerts\/dialogs"}]}]}],"type":"unorderedList"},{"text":"What are UI interruptions handlers?","level":2,"type":"heading","anchor":"What-are-UI-interruptions-handlers"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"closures","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"XCTest maintains a stack of handlers","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"XCTest uses LIFO: the last handler registered is the first to be invoked","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"the stack resets between tests","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"If an interruption handler successfully handled an interruption, it returns "},{"code":"true","type":"codeVoice"},{"type":"text","text":" and the UI test continues. If it was not able to handle the interruption, it returns "},{"code":"false","type":"codeVoice"},{"type":"text","text":" and the next handler is invoked."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"iOS has built-in interruption handlers for alerts:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"taps cancel button if any, falls back to the default button otherwise","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"(New in Xcode 12) iOS has built-in interruption handlers for banners:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"swipe to dismiss persistent banners"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"wait for temporary banners to auto-dismiss"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"macOS has built-in interruption handlers for:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"permission dialogs: chooses ","type":"text"},{"type":"codeVoice","code":"Don't Allow"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Bluetooth Setup Assistant: closes window","type":"text"}]}]}],"type":"unorderedList"},{"text":"When UI interruptions handlers are not triggered","level":2,"type":"heading","anchor":"When-UI-interruptions-handlers-are-not-triggered"},{"inlineContent":[{"text":"Not all alerts will trigger UI interruptions handlers:","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC20-10220-alertChart","type":"image"}],"type":"paragraph"},{"text":"How to interact with expected alerts","level":2,"type":"heading","anchor":"How-to-interact-with-expected-alerts"},{"inlineContent":[{"text":"Use ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/xctest\/xctestcase\/1496273-adduiinterruptionmonitor"},{"text":" to add a new interruption monitor. The system will automatically invoke the interruption handler stack when the UI test tries to interact with something that is blocked by an interruption.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The following example tries to tap the "},{"type":"codeVoice","code":"Retry"},{"type":"text","text":" button on an alert (if interrupted by it):"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["addUIInterruptionMonitor(withDescription: \"Handle recipe update failures\") { element -> Bool in","    let retryButton = element.buttons[\"Retry\"].firstMatch","    if element.elementType == .alert && retryButton.exists {","        retryButton.tap()","        return true","    } else {","        return false","    }","}"]},{"text":"Protected resources","level":2,"type":"heading","anchor":"Protected-resources"},{"inlineContent":[{"text":"From Xcode 11.4, iOS and tvOS 13.4, and macOS 10.15.4, we have a new ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/xctest\/xcuiapplication\/3526066-resetauthorizationstatus","isActive":true,"type":"reference"},{"text":" API to reset the authorization status for a protected resource (it will be like it was never asked before).","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Note that the app will be killed when this api is called, therefore a way to use this API is the following:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["func testAddingPhotosFirstTime() throws {","    let app = XCUIApplication()","    app.resetAuthorizationStatus(for: .photos)","","    app.launch()","","    \/\/ Test code…","}"]},{"text":"Written By","level":2,"type":"heading","anchor":"Written-By"},{"columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"zntfdr"}]}]},{"size":4,"content":[{"text":"Federico Zanetello","anchor":"Federico-Zanetello","type":"heading","level":3},{"inlineContent":[{"type":"reference","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","overridingTitle":"Contributed Notes","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/github.com\/zntfdr","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","identifier":"https:\/\/zntfdr.dev","isActive":true}],"type":"paragraph"}]}],"numberOfColumns":5,"type":"row"},{"inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"reference"}],"type":"paragraph"},{"text":"Related Sessions","level":2,"type":"heading","anchor":"Related-Sessions"},{"style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10077-Eliminate-animation-hitches-with-XCTest","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10091-Write-tests-to-fail","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10164-XCTSkip-your-tests","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10221-Get-your-test-results-faster","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10687-Triage-test-failures-with-XCTIssue","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC18-702-Your-Apps-and-the-Future-of-macOS-Security"],"type":"links"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}],"type":"small"}],"kind":"content"}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sampleCodeDownload":{"action":{"identifier":"https:\/\/developer.apple.com\/wwdc20\/10220","type":"reference","overridingTitle":"Watch Video (11 min)","isActive":true},"kind":"sampleDownload"},"sections":[],"references":{"WWDCNotes.png":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"alt":null,"identifier":"WWDCNotes.png"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10077-Eliminate-animation-hitches-with-XCTest":{"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10077-Eliminate-animation-hitches-with-XCTest","type":"topic","title":"Eliminate animation hitches with XCTest","abstract":[{"type":"text","text":"Animations can dramatically enhance the user experience of your app, provide a sense of direct manipulation, and help people to better understand the results of their actions. Animation hitches can break that experience. Discover how to use XCTest to detect interruptions to smooth scrolling and animations, and learn how to catch regressions before they affect the people relying on your app."}],"url":"\/documentation\/wwdcnotes\/wwdc20-10077-eliminate-animation-hitches-with-xctest","role":"sampleCode"},"https://github.com/zntfdr":{"type":"link","identifier":"https:\/\/github.com\/zntfdr","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}],"url":"https:\/\/github.com\/zntfdr"},"zntfdr.jpeg":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}],"alt":null,"identifier":"zntfdr.jpeg"},"https://developer.apple.com/documentation/xctest/xctestcase/1496273-adduiinterruptionmonitor":{"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/xctest\/xctestcase\/1496273-adduiinterruptionmonitor","title":"addUIInterruptionMonitor(withDescription:handler:)","titleInlineContent":[{"code":"addUIInterruptionMonitor(withDescription:handler:)","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/documentation\/xctest\/xctestcase\/1496273-adduiinterruptionmonitor"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"title":"WWDC20","url":"\/documentation\/wwdcnotes\/wwdc20","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","role":"collectionGroup","kind":"article","images":[{"identifier":"WWDC20-Icon.png","type":"icon"},{"identifier":"WWDC20.jpeg","type":"card"}],"type":"topic","abstract":[{"text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"WidgetKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit Testing","type":"codeVoice"},{"text":", and more.","type":"text"}]},"zntfdr":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}],"alt":"Profile image of Federico Zanetello","identifier":"zntfdr"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"type":"link","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"https://developer.apple.com/documentation/xctest/xcuiapplication/3526066-resetauthorizationstatus":{"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/xctest\/xcuiapplication\/3526066-resetauthorizationstatus","title":"resetAuthorizationStatus(for:)","titleInlineContent":[{"code":"resetAuthorizationStatus(for:)","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/documentation\/xctest\/xcuiapplication\/3526066-resetauthorizationstatus"},"https://zntfdr.dev":{"type":"link","identifier":"https:\/\/zntfdr.dev","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}],"url":"https:\/\/zntfdr.dev"},"WWDC20-10220-alertChart":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-10220-alertChart.png"}],"alt":null,"identifier":"WWDC20-10220-alertChart"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10164-XCTSkip-your-tests":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10164-XCTSkip-your-tests","url":"\/documentation\/wwdcnotes\/wwdc20-10164-xctskip-your-tests","kind":"article","abstract":[{"type":"text","text":"Get the test results that matter — and skip the ones that don’t. Discover how you can implement XCTSkip to conditionally avoid tests at runtime. We’ll take you through how to return this new test result and better document tests beyond pass and fail within your test bundle."}],"role":"sampleCode","title":"XCTSkip your tests"},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","role":"collection","title":"WWDC Notes","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","url":"\/documentation\/wwdcnotes"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10091-Write-tests-to-fail":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10091-Write-tests-to-fail","url":"\/documentation\/wwdcnotes\/wwdc20-10091-write-tests-to-fail","kind":"article","abstract":[{"type":"text","text":"Plan for failure: Design great tests to help you find and diagnose even the toughest bugs. Learn how to improve your automated tests with XCTest to find hidden issues in even the best code. We’ll explain how to prepare your tests for failure to make triaging issues easier, letting you solve interface issues and deliver fixes quickly."}],"role":"sampleCode","title":"Write tests to fail"},"https://developer.apple.com/wwdc20/10220":{"type":"download","identifier":"https:\/\/developer.apple.com\/wwdc20\/10220","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc20\/10220"},"WWDC20-Icon.png":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-Icon.png"}],"type":"image","alt":null,"identifier":"WWDC20-Icon.png"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"title":"Federico Zanetello (332 notes)","images":[{"identifier":"zntfdr.jpeg","type":"card"},{"identifier":"zntfdr.jpeg","type":"icon"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","url":"\/documentation\/wwdcnotes\/zntfdr","role":"sampleCode","type":"topic","kind":"article","abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10221-Get-your-test-results-faster":{"role":"sampleCode","abstract":[{"type":"text","text":"Improve your testing suite to speed up your feedback loop and get fixes in faster. Learn more about the latest improvements to testing in Xcode, including how to leverage test plans, Xcodebuild updates, and APIs to eliminate never-ending and badly-behaved tests. We’ll explore Test Timeouts and Execution Time Allowances in XCTest, examine device parallelization, and detail recommended practices for balancing performance with clear fault localization."}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10221-Get-your-test-results-faster","title":"Get your test results faster","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc20-10221-get-your-test-results-faster"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC18-702-Your-Apps-and-the-Future-of-macOS-Security":{"role":"sampleCode","abstract":[{"type":"text","text":"Apple is on a mission to advance the state of Mac security, and we want your apps to be there with us. Learn about new protections for user data, new capabilities with Developer ID, and how you can best secure your apps."}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC18-702-Your-Apps-and-the-Future-of-macOS-Security","title":"Your Apps and the Future of macOS Security","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc18-702-your-apps-and-the-future-of-macos-security"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10687-Triage-test-failures-with-XCTIssue":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10687-Triage-test-failures-with-XCTIssue","url":"\/documentation\/wwdcnotes\/wwdc20-10687-triage-test-failures-with-xctissue","kind":"article","abstract":[{"type":"text","text":"Put your test failures to work: Learn how to triage and diagnose uncaught issues in your app using the latest testing APIs in Xcode. We’ll show you how to help ease your testing workflow and put failures into context to help you deliver the best quality product."}],"role":"sampleCode","title":"Triage test failures with XCTIssue"},"WWDC20.jpeg":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20.jpeg"}],"type":"image","alt":null,"identifier":"WWDC20.jpeg"}}}