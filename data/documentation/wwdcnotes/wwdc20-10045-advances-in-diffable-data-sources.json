{"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10045-Advances-in-diffable-data-sources","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Diffable data sources dramatically simplify the work involved in managing and updating collection and table views to create dynamic and responsive experiences in your apps. Discover how you can use section snapshots to efficiently build lists and outline collection views for iOS and iPadOS and provide support for implementing the sidebar in an iPad app. We’ll also show you how to simplify cell reordering using UICollectionViewDiffableDataSource to help you streamline your code and build app interfaces more quickly."}],"sampleCodeDownload":{"action":{"isActive":true,"type":"reference","overridingTitle":"Watch Video (11 min)","identifier":"https:\/\/developer.apple.com\/wwdc20\/10045"},"kind":"sampleDownload"},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc20-10045-advances-in-diffable-data-sources"],"traits":[{"interfaceLanguage":"swift"}]}],"sections":[],"metadata":{"role":"sampleCode","title":"Advances in diffable data sources","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC20"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"primaryContentSections":[{"kind":"content","content":[{"type":"heading","text":"Sample Code","level":2,"anchor":"Sample-Code"},{"inlineContent":[{"type":"text","text":"Download the "},{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/views_and_controls\/collection_views\/implementing_modern_collection_views","type":"reference","isActive":true},{"type":"text","text":" to learn more about Modern Collection Views."}],"type":"paragraph"},{"level":2,"anchor":"Diffable-Data-Source","type":"heading","text":"Diffable Data Source"},{"level":3,"anchor":"Recap","type":"heading","text":"Recap"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Introduced in iOS 13."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Simplifies UI State.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Automatic animations.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"No more batch updates."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"For more, refer to the "},{"type":"reference","identifier":"..\/..\/wwdc19\/220","isActive":true},{"type":"text","text":"."}]}]}]},{"anchor":"Section-Snapshots","type":"heading","text":"Section Snapshots","level":3},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Encapsulate the data for a single section in a ","type":"text"},{"code":"UICollectionView","type":"codeVoice"},{"text":".","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Allow data sources to be more composable into section-sized chunks of data."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Can present the same data with different layout in different sections."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Allow modeling of hierarchical data, which is needed to support rendering outline-style UIs.","type":"text"}],"type":"paragraph"}]}]},{"anchor":"Examples","type":"heading","text":"Examples","level":4},{"type":"paragraph","inlineContent":[{"identifier":"WWDC20-10045-section_snapshots","type":"image"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Top: Horizontally scrolling section.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Middle: Outline style section."}]}]},{"content":[{"inlineContent":[{"text":"Bottom: List section.","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"It composes Diffable Data Source from three distinct section snapshots, each representing a single section’s content.","type":"text"}]},{"anchor":"APIs","type":"heading","text":"APIs","level":4},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Use "},{"code":"append(:parent:)","type":"codeVoice"},{"type":"text","text":" API to add content into a section snapshot."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The optional "},{"type":"codeVoice","code":"parent"},{"type":"text","text":" parameter allows us to create parent-child relationships in the section snapshot."}]}]}]},{"syntax":"swift","type":"codeListing","code":["\/\/ UICollectionViewDiffableDataSource additions for iOS 14","","extension UICollectionViewDiffableDataSource<Item, Section> {","","    func apply(_ snapshot: NSDiffableDataSourceSectionSnapshot<Item>, ","               to section: Section, ","               animatingDifferences: Bool = true, ","               completion: (() -> Void)? = nil)","","    func snapshot(for section: Section) ->   ","                  NSDiffableDataSourceSectionSnapshot<Item>","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Code example:"}]},{"syntax":"swift","type":"codeListing","code":["\/\/ Example of using snapshots and section snapshots together","","func update(animated: Bool=true) {","","   \/\/ Add our sections in a specific order","   let sections: [Section] = [.recent, .top, .suggested]","   var snapshot = NSDiffableDataSourceSnapshot<Section, Item>()","   snapshot.appendSections(sections)","   dataSource.apply(snapshot, animatingDifferences: animated)","","   \/\/ update each section's data via section snapshots in the existing position","   for section in sections {","      let sectionItems = items(for: section)","      var sectionSnapshot = NSDiffableDataSourceSectionSnapshot<Item>()","      sectionSnapshot.append(sectionItems)","      dataSource.apply(sectionSnapshot, to: section, animatingDifferences:animated)","   }","}"]},{"anchor":"Child-snapshots","type":"heading","text":"Child snapshots","level":4},{"syntax":"swift","type":"codeListing","code":["let childSnapshot = sectionSnapshot.snapshot(for: parent, includingParent: false)"]},{"anchor":"Expanding-and-Collapsing-Items","type":"heading","text":"Expanding and Collapsing Items","level":4},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Expansion state is persisted."}]}]},{"content":[{"inlineContent":[{"text":"Expansion state is managed as part of a section snapshot’s state.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Call ","type":"text"},{"type":"codeVoice","code":"apply(_:to)"},{"text":" to commit changes.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Automatic animations."}]}]}]},{"syntax":"swift","type":"codeListing","code":["struct NSDiffableDataSourceSectionSnapshot<Item: Hashable> {","   func expand(_ items: [Item])","   func collapse(_ items: [Item])","   func isExpanded(_ item: Item) -> Bool","}"]},{"anchor":"Section-snapshot-handlers","type":"heading","text":"Section snapshot handlers","level":4},{"type":"paragraph","inlineContent":[{"type":"text","text":"To be notified about expansion state changes caused by these user interactions."}]},{"syntax":"swift","type":"codeListing","code":["\/\/ Section Snapshot Handlers: handling user interactions for expand \/ collapse state changes","","extension UICollectionViewDiffableDataSource {","","  struct SectionSnapshotHandlers<Item> {","    var shouldExpandItem: ((Item) -> Bool)?","    var willExpandItem: ((Item) -> Void)?","\t","    var shouldCollapseItem: ((Item) -> Bool)?","    var willCollapseItem: ((Item) -> Void)?","    ","    var snapshotForExpandingParent: ((Item, NSDiffableDataSourceSectionSnapshot<Item>) -> NSDiffableDataSourceSectionSnapshot<Item>)?","  }","  ","  var sectionSnapshotHandlers: SectionSnapshotHandlers<Item>"," ","}"]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":"SectionSnapshotHandlers","type":"codeVoice"},{"text":" is a generic struct which contains five optional closures.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"snapshotForExpandingParent","type":"codeVoice"},{"text":" is used for lazy loading when the content is expensive.","type":"text"}],"type":"paragraph"}]}]},{"anchor":"Reordering-Support","type":"heading","text":"Reordering Support","level":3},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Automatic snapshot updates.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Transactions."}]}]}]},{"anchor":"Reordering-Handlers","type":"heading","text":"Reordering Handlers","level":4},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Used to be notified when a user-initiated reordering interaction took place.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Once notified, it can persist the new visual order to the application’s backing store, which is its final source of truth."}]}]}]},{"syntax":"swift","type":"codeListing","code":["\/\/ Diffable Data Source Reordering Handlers","","extension UICollectionViewDiffableDataSource {","","  struct ReorderingHandlers {","    var canReorderItem: ((Item) -> Bool)?","    var willReorder: ((NSDiffableDataSourceTransaction<Section, Item>) -> Void)?","    var didReorder: ((NSDiffableDataSourceTransaction<Section, Item>) -> Void)?","  }","","  var reorderingHandlers: ReorderingHandlers","}"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Automatic reordering.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"When the user is done with the reordering interaction, the "},{"code":"didReorder","type":"codeVoice"},{"type":"text","text":" closure is called."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Must provide both the "},{"code":"canReorderItem","type":"codeVoice"},{"type":"text","text":" and "},{"code":"didReorder","type":"codeVoice"},{"type":"text","text":" closure to enable the reordering feature."}],"type":"paragraph"}]}]},{"anchor":"Reordering-Transactions","type":"heading","text":"Reordering Transactions","level":4},{"type":"paragraph","inlineContent":[{"type":"text","text":"A transaction that describes the changes after reordering the items in the view."}]},{"syntax":"swift","type":"codeListing","code":["struct NSDiffableDataSourceTransaction<Section, Item> {","   var initialSnapshot: NSDiffableDataSourceSnapshot<Section, Item> { get }","   var finalSnapshot: NSDiffableDataSourceSnapshot<Section, Item> { get }","   var difference: CollectionDifference<Item> { get }","   var sectionTransactions: [NSDiffableDataSourceSectionTransaction<Section, Item>] { get }","}"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"initialSnapshot"},{"type":"text","text":" is the state of the Diffable Data Source before the update is applied."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"finalSnapshot"},{"type":"text","text":" is the state of the Diffable Data Source after the update is applied."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Apply the data directly to "},{"code":"difference","type":"codeVoice"},{"type":"text","text":", if use a data type such as "},{"code":"Array","type":"codeVoice"},{"type":"text","text":" for the source of truth."}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"sectionTransactions"},{"type":"text","text":" provides per-section details about all the sections involved in this reordering update."}],"type":"paragraph"}]}]},{"anchor":"Section-Transactions","type":"heading","text":"Section Transactions","level":4},{"syntax":"swift","type":"codeListing","code":["struct NSDiffableDataSourceSectionTransaction<Section, Item> {","   var sectionIdentifier: Section { get }","   var initialSnapshot: NSDiffableDataSourceSectionSnapshot<Item> { get }","   var finalSnapshot: NSDiffableDataSourceSectionSnapshot<Item> { get }","   var difference: CollectionDifference<Item> { get }","}"]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"sectionIdentifier"},{"text":" for inspecting which section this ","type":"text"},{"type":"codeVoice","code":"sectionTransaction"},{"text":" has been applied to.","type":"text"}],"type":"paragraph"}]}]},{"anchor":"Example","type":"heading","text":"Example","level":4},{"syntax":"swift","type":"codeListing","code":["dataSource.reorderingHandlers.didReorder = { [weak self] transaction in ","   guard let self = self else { return }","","   if let updateBackingStore = self.backingStore.applying(transaction.difference) {","      self.backingStore = updatedBackingStore","   }","}"]},{"anchor":"Written-By","type":"heading","text":"Written By","level":2},{"type":"row","columns":[{"size":1,"content":[{"inlineContent":[{"type":"image","identifier":"dasautoooo"}],"type":"paragraph"}]},{"size":4,"content":[{"anchor":"DasAuto","type":"heading","level":3,"text":"DasAuto"},{"type":"paragraph","inlineContent":[{"overridingTitle":"Contributed Notes","isActive":true,"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/dasautoooo","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/dasautoooo","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/x.com\/DasAutoooo","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/wut.im","type":"reference"}]}]}],"numberOfColumns":5},{"type":"paragraph","inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}]},{"anchor":"Related-Sessions","type":"heading","text":"Related Sessions","level":2},{"style":"list","type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10252-Make-blazing-fast-lists-and-collection-views","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10026-Lists-in-UICollectionView","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10027-Modern-cell-configuration","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-220-Advances-in-UI-Data-Sources"]},{"type":"small","inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}]}],"schemaVersion":{"patch":0,"major":0,"minor":3},"kind":"article","references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-220-Advances-in-UI-Data-Sources":{"kind":"article","role":"sampleCode","title":"Advances in UI Data Sources","url":"\/documentation\/wwdcnotes\/wwdc19-220-advances-in-ui-data-sources","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-220-Advances-in-UI-Data-Sources","abstract":[{"text":"Use UI Data Sources to simplify updating your table view and collection view items using automatic diffing. High fidelity, quality animations of set changes are automatic and require no extra code! This improved data source mechanism completely avoids synchronization bugs, exceptions, and crashes! Learn about this simplified data model that uses on identifiers and snapshots so that you can focus on your app’s dynamic data and content instead of the minutia of UI data synchronization.","type":"text"}],"type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10026-Lists-in-UICollectionView":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10026-Lists-in-UICollectionView","role":"sampleCode","title":"Lists in UICollectionView","url":"\/documentation\/wwdcnotes\/wwdc20-10026-lists-in-uicollectionview","abstract":[{"text":"Learn how to build lists and sidebars in your app with UICollectionView. Replace table view appearance while taking advantage of the full flexibility of compositional layout. Explore modular layout options and find out how they can unlock more design options for your apps than ever before. Find out how to combine table view-like lists with custom compositional layouts inside of a single UICollectionView. Discover how to work with lists, create richer cells, and customize your layout to create a well-designed presentation of information within your app.","type":"text"}],"type":"topic","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","title":"WWDC20","abstract":[{"text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"type":"codeVoice","code":"WidgetKit"},{"text":", ","type":"text"},{"type":"codeVoice","code":"StoreKit Testing"},{"text":", and more.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc20","kind":"article","role":"collectionGroup","type":"topic","images":[{"type":"icon","identifier":"WWDC20-Icon.png"},{"type":"card","identifier":"WWDC20.jpeg"}]},"https://developer.apple.com/wwdc20/10045":{"identifier":"https:\/\/developer.apple.com\/wwdc20\/10045","url":"https:\/\/developer.apple.com\/wwdc20\/10045","type":"download","checksum":null},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image","alt":null},"WWDC20-10045-section_snapshots":{"identifier":"WWDC20-10045-section_snapshots","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-10045-section_snapshots.png"}],"type":"image","alt":null},"dasautoooo.jpeg":{"identifier":"dasautoooo.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/dasautoooo.jpeg"}],"type":"image","alt":null},"../../wwdc19/220":{"identifier":"..\/..\/wwdc19\/220","url":"..\/..\/wwdc19\/220","type":"link","titleInlineContent":[{"type":"codeVoice","code":"Advances in UI Data Sources"},{"type":"text","text":" session"}],"title":"Advances in UI Data Sources session"},"https://x.com/DasAutoooo":{"identifier":"https:\/\/x.com\/DasAutoooo","url":"https:\/\/x.com\/DasAutoooo","type":"link","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"title":"X\/Twitter"},"dasautoooo":{"identifier":"dasautoooo","variants":[{"traits":["1x","light"],"url":"\/images\/dasautoooo.jpeg"}],"type":"image","alt":"Profile image of DasAuto"},"doc://WWDCNotes/documentation/WWDCNotes":{"url":"\/documentation\/wwdcnotes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"title":"WWDC Notes","type":"topic","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"kind":"symbol","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection"},"https://developer.apple.com/documentation/uikit/views_and_controls/collection_views/implementing_modern_collection_views":{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/views_and_controls\/collection_views\/implementing_modern_collection_views","url":"https:\/\/developer.apple.com\/documentation\/uikit\/views_and_controls\/collection_views\/implementing_modern_collection_views","type":"link","titleInlineContent":[{"type":"text","text":"sample code"}],"title":"sample code"},"doc://WWDCNotes/documentation/WWDCNotes/dasautoooo":{"images":[{"identifier":"dasautoooo.jpeg","type":"card"},{"identifier":"dasautoooo.jpeg","type":"icon"}],"type":"topic","role":"sampleCode","url":"\/documentation\/wwdcnotes\/dasautoooo","abstract":[{"type":"text","text":"💻 Programmer | 🕹 Lifetime Gamer"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/dasautoooo","title":"DasAuto (6 notes)","kind":"article"},"WWDC20.jpeg":{"identifier":"WWDC20.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20.jpeg"}],"type":"image","alt":null},"https://wut.im":{"identifier":"https:\/\/wut.im","url":"https:\/\/wut.im","type":"link","titleInlineContent":[{"type":"text","text":"Blog"}],"title":"Blog"},"https://github.com/dasautoooo":{"identifier":"https:\/\/github.com\/dasautoooo","url":"https:\/\/github.com\/dasautoooo","type":"link","titleInlineContent":[{"type":"text","text":"GitHub"}],"title":"GitHub"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10252-Make-blazing-fast-lists-and-collection-views":{"kind":"article","role":"sampleCode","title":"Make blazing fast lists and collection views","url":"\/documentation\/wwdcnotes\/wwdc21-10252-make-blazing-fast-lists-and-collection-views","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10252-Make-blazing-fast-lists-and-collection-views","abstract":[{"type":"text","text":"Build consistently smooth scrolling list and collection views: Explore the lifecycle of a cell and learn how to apply that knowledge to eliminate rough scrolling and missed frames. We’ll also show you how to improve your overall scrolling experience and avoid costly hitches, with optimized image loading and automatic cell prefetching."}],"type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10027-Modern-cell-configuration":{"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc20-10027-modern-cell-configuration","abstract":[{"type":"text","text":"Discover new techniques for configuring collection view and table view cells to quickly build dynamic interfaces in your app. Explore configuration types you can use to easily populate cells with content and apply common styles. Take advantage of powerful APIs to customize the appearance of cells for different states. Find out about patterns and best practices that simplify your code, eliminate bugs, and improve performance."}],"type":"topic","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10027-Modern-cell-configuration","title":"Modern cell configuration"},"WWDC20-Icon.png":{"identifier":"WWDC20-Icon.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-Icon.png"}],"type":"image","alt":null},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"title":"Contributions are welcome!"}}}