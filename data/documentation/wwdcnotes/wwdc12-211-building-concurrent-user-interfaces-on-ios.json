{"metadata":{"title":"Building Concurrent User Interfaces on iOS","roleHeading":"WWDC12","role":"sampleCode","modules":[{"name":"WWDC Notes"}]},"abstract":[{"type":"text","text":"For a great user experience, it’s essential to keep your application responsive while it renders complex UI elements and processes data. Learn how to use concurrency at the UIKit layer to perform drawing and other common operations without blocking user interaction."}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC12-211-Building-Concurrent-User-Interfaces-on-iOS"},"sections":[],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC12"]]},"schemaVersion":{"major":0,"minor":3,"patch":0},"primaryContentSections":[{"content":[{"type":"heading","text":"Overview","anchor":"overview","level":2},{"type":"paragraph","inlineContent":[{"text":"In this session, Andy presents how to implement the following 3 features to make app UI more concurrent.","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Concurrent Processing of Data intended using UI"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Concurrent Drawing for UI Graphics"}],"type":"strong"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Canceling Concurrent Operations","type":"text"}],"type":"strong"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"Bonus Part: present how to use Xcode Instrument Profile to identify the Problems.","type":"text"}]},{"type":"heading","text":"1. Concurrent Processing of Data intended using UI","anchor":"1-Concurrent-Processing-of-Data-intended-using-UI","level":3},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"WWDC12-211-p1"}]},{"type":"codeListing","code":["\/\/1st, System events on the main queue","NSOperationQueue *queue = [[NSOperationQueue alloc] init];","\/\/2nd, Separate expensive processing with NSOperationQueue","[queue setName:@”Data Processing Queue”];","[queue addOperationWithBlock:^{ processStock(someStock); }];","[queue addOperationWithBlock:^{","    \/\/3rd, Update data UIKit accesses on the main queue","    [[NSOperationQueue mainQueue] addOperationWithBlock:^{","        updateUI(someStock);","}]; }];"],"syntax":null},{"type":"paragraph","inlineContent":[{"identifier":"WWDC12-211-p2","type":"image"},{"type":"text","text":" "},{"identifier":"WWDC12-211-p3","type":"image"}]},{"type":"heading","text":"2. Concurrent Drawing for UI Graphics","anchor":"2-Concurrent-Drawing-for-UI-Graphics","level":3},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"UIKit calls "},{"code":"-drawRect:","type":"codeVoice"},{"type":"text","text":" on the main queue"}]}]},{"content":[{"inlineContent":[{"text":"You can draw an image for your view on another queue","type":"text"}],"type":"paragraph"}]}]},{"type":"codeListing","code":["- (UIImage *)renderInImageOfSize:(CGSize)size {","    UIGraphicsBeginImageContextWithOptions(size, NO, 0);","    [[UIColor greenColor] set];","    UIRectFill([self bounds]);","    [anImage drawAtPoint:CGPointZero];","    UIImage *i = UIGraphicsGetImageFromCurrentImageContext();","    UIGraphicsEndImageContext();","    return i;","}"],"syntax":null},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Drawing APIs are safe to use from any queue"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"if they begin and end in the same operation!"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Must call ","type":"text"},{"type":"codeVoice","code":"-[UIImageView setImage:]"},{"text":" on the main queue","type":"text"}]}]}]},{"type":"heading","text":"3. Canceling Concurrent Operations","anchor":"3-Canceling-Concurrent-Operations","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Cancel Operation is necessary when user does not need operation to be done anymore, it is reasonable to cancel it before it took too much computing power of battery."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"One way to cancel operations is calling: "},{"code":"-[NSOperationQueue cancelAllOperations]","type":"codeVoice"},{"type":"text","text":", but  canceling all the operations is not always the case. The other way is "},{"code":"[operation cancel]","type":"codeVoice"},{"type":"text","text":". In the demo, Andy created an "},{"code":"NSDictionary","type":"codeVoice"},{"type":"text","text":" to keep the operation for each renderer. When user screen in, then add corresponding operations, while if the user screen out, remove it from the "},{"code":"NSDictionary","type":"codeVoice"},{"type":"text","text":" and cancel it."}]},{"type":"codeListing","code":["\/\/ 1st, Creating an NSOperationQueue","NSOperationQueue *queue = [[NSOperationQueue alloc] init];","\/\/ 2nd, Creating an NSOperation concrete class object.","\/\/ NSBlockOperation is a subclass of NSOperation(abstract class)","NSBlockOperation *op = [[NSBlockOperation alloc] init];","\/\/ 3rd, Create Weak Reference to the operation","__weak NSBlockOperation *weakOp = op;","\/\/ 4th, Adding work to the operation.","[op addExecutionBlock:^{","    for (int i = 0; i < 10000; i++) {","      \/\/ 5th, for each step, check if operation is canceled.","        if ([weakOp isCancelled]) break;","        processData(data[i]);","    }","}];","\/\/ 6th, Add the operation to the queue.","[queue addOperation:op];"],"syntax":null},{"type":"paragraph","inlineContent":[{"type":"text","text":"It’s important to avoid retain strong reference cycle, by using a weak reference to the operation and used in the operation block."},{"type":"text","text":" "},{"identifier":"WWDC12-211-p4","type":"image"}]},{"type":"heading","text":"Written By","anchor":"Written-By","level":2},{"numberOfColumns":5,"type":"row","columns":[{"size":1,"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"https:\/\/avatars.githubusercontent.com\/u\/777705?v=4"}]}]},{"size":4,"content":[{"anchor":"Yi","type":"heading","level":3,"text":"Yi"},{"type":"paragraph","inlineContent":[{"isActive":true,"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/antonio081014","type":"reference","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}]},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/antonio081014","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/medium.com\/@antonio081014","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/x.com\/antonio081014","type":"reference"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing"}]},{"type":"small","inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}]},{"type":"small","inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}]}],"kind":"content"}],"kind":"article","sampleCodeDownload":{"action":{"overridingTitle":"Watch Video","type":"reference","isActive":true,"identifier":"http:\/\/developer.apple.com\/wwdc12\/211"},"kind":"sampleDownload"},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc12-211-building-concurrent-user-interfaces-on-ios"],"traits":[{"interfaceLanguage":"swift"}]}],"references":{"https://medium.com/@antonio081014":{"identifier":"https:\/\/medium.com\/@antonio081014","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link","url":"https:\/\/medium.com\/@antonio081014"},"https://x.com/antonio081014":{"identifier":"https:\/\/x.com\/antonio081014","title":"X\/Twitter","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"type":"link","url":"https:\/\/x.com\/antonio081014"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","kind":"symbol","role":"collection","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}]},"WWDC12-211-p2":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC12-211-p2.png"}],"identifier":"WWDC12-211-p2","type":"image","alt":"Step 1 & 2"},"WWDCNotes.png":{"variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}],"identifier":"WWDCNotes.png","type":"image","alt":null},"WWDC12-211-p3":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDC12-211-p3.png"}],"identifier":"WWDC12-211-p3","type":"image","alt":"Step 3"},"http://developer.apple.com/wwdc12/211":{"identifier":"http:\/\/developer.apple.com\/wwdc12\/211","checksum":null,"type":"download","url":"http:\/\/developer.apple.com\/wwdc12\/211"},"https://github.com/antonio081014":{"titleInlineContent":[{"text":"GitHub","type":"text"}],"type":"link","title":"GitHub","identifier":"https:\/\/github.com\/antonio081014","url":"https:\/\/github.com\/antonio081014"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC12":{"abstract":[{"text":"iOS 6, macOS 10.8 (Mountain Lion).","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC12","kind":"article","role":"collectionGroup","title":"WWDC12","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"type":"topic","url":"\/documentation\/wwdcnotes\/wwdc12"},"https://avatars.githubusercontent.com/u/777705?v=4":{"type":"image","identifier":"https:\/\/avatars.githubusercontent.com\/u\/777705?v=4","variants":[{"url":"https:\/\/avatars.githubusercontent.com\/u\/777705?v=4","traits":["1x","light"]}],"alt":"Profile image of Yi"},"doc://WWDCNotes/documentation/WWDCNotes/antonio081014":{"role":"sampleCode","url":"\/documentation\/wwdcnotes\/antonio081014","title":"Yi (16 notes)","abstract":[{"type":"text","text":"Reveal a brilliant idea in a very mobile engineer way."}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/antonio081014","kind":"article","type":"topic"},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"type":"link","title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing"},"WWDC12-211-p1":{"type":"image","identifier":"WWDC12-211-p1","variants":[{"url":"\/images\/WWDC12-211-p1.png","traits":["1x","light"]}],"alt":"Data Flow Overview"},"WWDC12-211-p4":{"type":"image","identifier":"WWDC12-211-p4","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC12-211-p4.png"}],"alt":"Step 3, Weak Reference to the operation"}}}