{"sections":[],"metadata":{"role":"sampleCode","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC21","title":"Accelerate networking with HTTP\/3 and QUIC"},"kind":"article","hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21"]]},"primaryContentSections":[{"content":[{"type":"heading","anchor":"Evolution-of-HTTP","text":"Evolution of HTTP","level":2},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"HTTP\/1.1","type":"text"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"initially we had to make a new connection for every resource that we wanted from the server"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"when doing so, a lot of time is spent on connection setup instead of resource transmission","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"we reuse a single HTTP\/1 connection for multiple data transfers, a.k.a. ","type":"text"},{"type":"reference","identifier":"https:\/\/en.wikipedia.org\/wiki\/Head-of-line_blocking","isActive":true},{"text":", but a request can only be sent after the previous response has ended","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"to over come this, in the past, HTTP implementations used many parallel connections, however this brings inefficient networking behaviors for both client and server","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"HTTP\/2 solves head-of-line blocking by multiplexing multiple streams on a single connection","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"requests are sent earlier, and data from different streams can be interleaved"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"this allows more efficient use of a single TCP connection, as idle waiting time is drastically reduced"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"HTTP\/3","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"connections are set up much faster","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"streams are independent (in HTTP\/2, all streams shared a single TCP connection) - packet loss only affect one stream but not others"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"uses "},{"type":"reference","isActive":true,"identifier":"https:\/\/en.wikipedia.org\/wiki\/QUIC"},{"type":"text","text":" instead of TCP"}],"type":"paragraph"}]}]}]}],"type":"unorderedList"},{"text":"QUIC","type":"heading","level":3,"anchor":"QUIC"},{"items":[{"content":[{"inlineContent":[{"text":"new transport protocol","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"faster connection setup","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"connection migration support - allows connections to move seamlessly across different network interfaces without reestablishing a session"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"https:\/\/en.wikipedia.org\/wiki\/Transport_Layer_Security#TLS_1.3","isActive":true},{"type":"text","text":" security"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"standardized by the ","type":"text"},{"isActive":true,"identifier":"https:\/\/www.ietf.org","type":"reference"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"based on the same concepts of TCP"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"provides:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"end-to-end encryption"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"multiplexed streams","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"authentication","type":"text"}]}]}],"type":"unorderedList"}]}],"type":"unorderedList"},{"text":"Using HTTP\/3","type":"heading","level":2,"anchor":"Using-HTTP3"},{"items":[{"content":[{"inlineContent":[{"text":"enabled by default in ","type":"text"},{"type":"codeVoice","code":"URLSession"},{"text":" - you only need to enable HTTP\/3 on your server","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"supports HTTP\/3 RFC and Draft 29"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can use Instruments to verify that your app uses HTTP\/3 - use the "},{"type":"text","text":"networking profiling template"},{"type":"text","text":" to inspect HTTP Traffic"}]},{"text":"Using QUIC","type":"heading","level":2,"anchor":"Using-QUIC"},{"type":"paragraph","inlineContent":[{"text":"When to use QUIC directly:","type":"text"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Non-request\/response pair","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Benefits from multiplexed streams"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Custom protocols"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"Using QUIC in your app:","type":"text"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"new "},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/network\/nwprotocolquic"},{"type":"text","text":" built-in in Network.framework"}]}]}],"type":"unorderedList"},{"code":["\/\/ Create a connection using QUIC","let connection = NWConnection(","  host: \"example.com\", ","  port: 443, ","  using: .quic(alpn: [\"myproto\"]) \/\/ üëàüèª",")","","\/\/ Set the state update handler to be notified when the connection is ready","connection.stateUpdateHandler = { newState in","  switch newState {","  case .ready:","    print(\"Connected using QUIC!\")","  default:","    break","  }","}","","\/\/ Start the connection with callback queue","connection.start(queue: queue)"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Using QUIC streams to send and receive data","type":"text"}]},{"code":["\/\/ Send data on a stream","connection.send(content: data, completion: .contentProcessed { error in","  \/\/ Handle error, if any","  \/\/ Schedule next send","})","","\/\/ Receive incoming data","connection.receive(minimumIncompleteLength: 1, maximumLength: desiredLength) { ","  receivedcontent, context, isComplete, receivedError in","  \/\/ Handle data, error","  \/\/ Schedule next receive","}"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Use "},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/network\/nwmultiplexgroup","isActive":true},{"type":"text","text":" to refer to the underlying transport shared by the group of streams."}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"A Connection Group follows a lifecycle similar to that of the other Network.framework objects and allows you to reason about the state of the underlying QUIC tunnel shared by your QUIC streams","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"It also allows you to create new outgoing streams from a specific QUIC tunnel as well as receive new incoming streams initiated by the remote endpoint","type":"text"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"Establish a tunnel with NWMultiplexGroup:","type":"text"}]},{"code":["\/\/ Create a group","let descriptor = NWMultiplexGroup(to: .hostPort(host: \"example.com\", port: 443))","let group = NWConnectionGroup(with: descriptor, using: .quic(alpn: [\"myproto\"]))","","\/\/ Set the state update handler to be notified when the group is ready","group.stateUpdateHandler = { newState in","  switch newState {","  case .ready:","    print(\"Connected using QUIC!\")","  default:","    break","  }","}","","\/\/ Start the group with callback queue","group.start(queue: queue)"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Manage streams with ","type":"text"},{"code":"NWConnectionGroup","type":"codeVoice"},{"text":":","type":"text"}]},{"code":["\/\/ Create a new outgoing stream","let connection = NWConnection(from: group)","","\/\/ Receive new incoming streams initiated by the remote endpoint","group.newConnectionHandler = { newConnection in","","  \/\/ Set state update handler on incoming stream","  newConnection.stateUpdateHandler = { newState in","    \/\/ Handle stream states","  }","","  \/\/ Start the incoming stream","  newConnection.start(queue: queue)","","}"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Receive incoming QUIC tunnels from ","type":"text"},{"code":"NWListener","type":"codeVoice"},{"text":":","type":"text"}]},{"code":["\/\/ Set the new connection group handler","listener.newConnectionGroupHandler = { group in","","  group.stateUpdateHandler = { newState in","    \/\/ Handle tunnel states","  }","","  group.newConnectionHandler = { stream in","    \/\/ Set up and start new incoming streams","  }","","  group.start(queue: queue)","","}"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Access QUIC metadata to learn about and modify streams:"}]},{"code":["\/\/ Find the stream ID of a particular QUIC stream","if let metadata = connection.metadata(definition: NWProtocolQUIC.definition)","               as? NWProtocolQUIC.Metadata {","  print(\"QUIC Stream ID is \\(metadata.streamIdentifier)\")","","  \/\/ Some time later...","","  \/\/ Set the application error, if appropriate, before cancelling the stream","  metadata.applicationError = 0x100","  connection.cancel()","}"],"syntax":"swift","type":"codeListing"},{"text":"Written By","type":"heading","level":2,"anchor":"Written-By"},{"numberOfColumns":5,"columns":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"zntfdr","type":"image"}]}],"size":1},{"content":[{"level":3,"type":"heading","anchor":"Federico-Zanetello","text":"Federico Zanetello"},{"inlineContent":[{"type":"reference","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"overridingTitle":"Contributed Notes","isActive":true,"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/zntfdr"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/zntfdr.dev"}],"type":"paragraph"}],"size":4}],"type":"row"},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","isActive":true,"type":"reference"}]},{"text":"Related Sessions","type":"heading","level":2,"anchor":"Related-Sessions"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10078-Reduce-networking-delays-for-a-more-responsive-app","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110403-Meet-Background-Assets","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10095-Use-asyncawait-with-URLSession","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10239-Reduce-network-delays-for-your-app"],"type":"links","style":"list"},{"type":"small","inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright ¬© 2012 ‚Äì 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}],"kind":"content"}],"abstract":[{"type":"text","text":"The web is changing, and the next major version of HTTP is here. Learn how HTTP\/3 reduces latency and improves reliability for your app and discover how its underlying transport, QUIC, unlocks new innovations in your own custom protocols using new transport functionality and multi-streaming connection groups."}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc21-10094-accelerate-networking-with-http3-and-quic"]}],"schemaVersion":{"minor":3,"major":0,"patch":0},"sampleCodeDownload":{"action":{"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc21\/10094","overridingTitle":"Watch Video (19 min)","isActive":true},"kind":"sampleDownload"},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10094-Accelerate-networking-with-HTTP3-and-QUIC","interfaceLanguage":"swift"},"references":{"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10095-Use-asyncawait-with-URLSession":{"role":"sampleCode","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10095-Use-asyncawait-with-URLSession","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc21-10095-use-asyncawait-with-urlsession","title":"Use async\/await with URLSession","abstract":[{"type":"text","text":"Discover how you can adopt Swift concurrency in URLSession using async\/await and AsyncSequence, and how you can apply Swift concurrency concepts to improve your networking code."}]},"zntfdr.jpeg":{"identifier":"zntfdr.jpeg","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}],"type":"image"},"https://github.com/zntfdr":{"identifier":"https:\/\/github.com\/zntfdr","title":"GitHub","titleInlineContent":[{"text":"GitHub","type":"text"}],"url":"https:\/\/github.com\/zntfdr","type":"link"},"https://en.wikipedia.org/wiki/Head-of-line_blocking":{"identifier":"https:\/\/en.wikipedia.org\/wiki\/Head-of-line_blocking","title":"head-of-line blocking","titleInlineContent":[{"type":"text","text":"head-of-line blocking"}],"url":"https:\/\/en.wikipedia.org\/wiki\/Head-of-line_blocking","type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10239-Reduce-network-delays-for-your-app":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10239-Reduce-network-delays-for-your-app","type":"topic","role":"sampleCode","abstract":[{"type":"text","text":"CPU performance and network throughput rates keep improving, but the speed of light is one limit that isn‚Äôt going any higher. Learn the APIs and best practices to maximize your app‚Äôs responsiveness and efficiency by keeping network round-trip times low and minimizing the number of round trips when performing network operations."}],"kind":"article","title":"Reduce network delays for your app","url":"\/documentation\/wwdcnotes\/wwdc21-10239-reduce-network-delays-for-your-app"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"abstract":[{"text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more.","type":"text"}],"images":[{"identifier":"zntfdr.jpeg","type":"card"},{"identifier":"zntfdr.jpeg","type":"icon"}],"url":"\/documentation\/wwdcnotes\/zntfdr","type":"topic","role":"sampleCode","title":"Federico Zanetello (332 notes)","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr"},"https://zntfdr.dev":{"identifier":"https:\/\/zntfdr.dev","title":"Blog","titleInlineContent":[{"text":"Blog","type":"text"}],"url":"https:\/\/zntfdr.dev","type":"link"},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"url":"\/documentation\/wwdcnotes","role":"collection","title":"WWDC Notes"},"https://en.wikipedia.org/wiki/QUIC":{"identifier":"https:\/\/en.wikipedia.org\/wiki\/QUIC","title":"QUIC","titleInlineContent":[{"type":"text","text":"QUIC"}],"url":"https:\/\/en.wikipedia.org\/wiki\/QUIC","type":"link"},"https://developer.apple.com/wwdc21/10094":{"identifier":"https:\/\/developer.apple.com\/wwdc21\/10094","checksum":null,"url":"https:\/\/developer.apple.com\/wwdc21\/10094","type":"download"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21":{"title":"WWDC21","role":"collectionGroup","abstract":[{"text":"Xcode 13, Swift 5.5, iOS 15, macOS 12 (Monterey), tvOS 15, watchOS 8.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"MusicKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"DocC","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit 2","type":"codeVoice"},{"text":", and more.","type":"text"}],"images":[{"type":"icon","identifier":"WWDC21-Icon.png"},{"type":"card","identifier":"WWDC21.jpeg"}],"url":"\/documentation\/wwdcnotes\/wwdc21","type":"topic","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21"},"https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_1.3":{"identifier":"https:\/\/en.wikipedia.org\/wiki\/Transport_Layer_Security#TLS_1.3","url":"https:\/\/en.wikipedia.org\/wiki\/Transport_Layer_Security#TLS_1.3","titleInlineContent":[{"text":"TLS 1.3","type":"text"}],"title":"TLS 1.3","type":"link"},"https://developer.apple.com/documentation/network/nwprotocolquic":{"identifier":"https:\/\/developer.apple.com\/documentation\/network\/nwprotocolquic","url":"https:\/\/developer.apple.com\/documentation\/network\/nwprotocolquic","titleInlineContent":[{"code":"NWProtocolQUIC","type":"codeVoice"}],"title":"NWProtocolQUIC","type":"link"},"WWDC21-Icon.png":{"identifier":"WWDC21-Icon.png","alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC21-Icon.png"}]},"https://developer.apple.com/documentation/network/nwmultiplexgroup":{"identifier":"https:\/\/developer.apple.com\/documentation\/network\/nwmultiplexgroup","url":"https:\/\/developer.apple.com\/documentation\/network\/nwmultiplexgroup","titleInlineContent":[{"code":"NWMultiplexGroup","type":"codeVoice"}],"title":"NWMultiplexGroup","type":"link"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","alt":null,"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-110403-Meet-Background-Assets":{"kind":"article","role":"sampleCode","type":"topic","title":"Meet Background Assets","abstract":[{"text":"Discover how you can use the Background Assets framework to download large files directly from your CDN and improve the initial launch experience of your apps and games. We‚Äôll show you how to schedule background downloads during initial app install, app updates, and periodically as someone uses the app. We‚Äôll also explore how you can manage scheduled downloads to make sure people have the content they want, when they want it.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-110403-Meet-Background-Assets","url":"\/documentation\/wwdcnotes\/wwdc22-110403-meet-background-assets"},"https://www.ietf.org":{"identifier":"https:\/\/www.ietf.org","url":"https:\/\/www.ietf.org","titleInlineContent":[{"text":"Internet Engineering Task Force (IETF)","type":"text"}],"title":"Internet Engineering Task Force (IETF)","type":"link"},"zntfdr":{"identifier":"zntfdr","alt":"Profile image of Federico Zanetello","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/zntfdr.jpeg"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10078-Reduce-networking-delays-for-a-more-responsive-app":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10078-Reduce-networking-delays-for-a-more-responsive-app","url":"\/documentation\/wwdcnotes\/wwdc22-10078-reduce-networking-delays-for-a-more-responsive-app","type":"topic","kind":"article","abstract":[{"type":"text","text":"Find out how network latency can affect your apps when trying to get full benefit out of modern network throughput rates. Learn about changes you can make in your app and on your server to boost responsiveness, and prepare your app for improvements coming to the Internet that will offer even lower end-to-end delays."}],"title":"Reduce networking delays for a more responsive app","role":"sampleCode"},"WWDC21.jpeg":{"identifier":"WWDC21.jpeg","alt":null,"type":"image","variants":[{"url":"\/images\/WWDC21.jpeg","traits":["1x","light"]}]}}}