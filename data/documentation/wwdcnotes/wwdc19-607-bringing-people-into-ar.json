{"metadata":{"role":"sampleCode","title":"Bringing People into AR","roleHeading":"WWDC19","modules":[{"name":"WWDC Notes"}]},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-607-Bringing-People-into-AR","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"ARKit 3 enables a revolutionary capability for robust integration of real people into AR scenes. Learn how apps can use live motion capture to animate virtual characters or be applied to 2D and 3D simulation. See how People Occlusion enables even more immersive AR experiences by enabling virtual content to pass behind people in the real world."}],"primaryContentSections":[{"content":[{"level":2,"anchor":"Overview","type":"heading","text":"Overview"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"People Occlusion"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Motion Capture"}],"type":"paragraph"}]}],"type":"orderedList"},{"level":2,"anchor":"1-People-Occlusion","type":"heading","text":"1. People Occlusion"},{"level":3,"anchor":"Overview","type":"heading","text":"Overview"},{"inlineContent":[{"text":"In ARKit today, we can place objects in the real world.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-before_occlusion"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"We would expect items to be hidden, or occluded, by a person closer to the camera."}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-after_occlusion"}],"type":"paragraph"},{"inlineContent":[{"text":"ARKit3 enables us to provide this functionality.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Explanation","type":"heading","text":"Explanation"},{"inlineContent":[{"type":"text","text":"In ARKit2, the AR object would simply be overlayed on top of the camera scene."}],"type":"paragraph"},{"inlineContent":[{"text":"Now, we need to have different things in different “depth frames”. This is a “depth ordering problem”.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-depth_frames"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The graphics pipeline already knows where the rendered object will be using the depth buffer, but we need to understand where people are in the scene. ARKit3 introduces the Segmentation and People buffers, which are generated using the A12 chip and machine learning."}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-depth_buffers"}],"type":"paragraph"},{"inlineContent":[{"text":"These two new buffers are exposed on the ","type":"text"},{"code":"ARFrame","type":"codeVoice"},{"text":" as two new properties:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["var segmentationBuffer: CVPixelBuffer? { get }","var estimatedDepthData: CVPixelBuffer? { get }"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"These are generated in real-time at the same cadence as the camera frame, i.e. 60 fps."}],"type":"paragraph"},{"inlineContent":[{"text":"We would also like these to be at the same resolution as the camera image, but the neural network only sees a smaller image that is missing a lot of detail.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"To compensate for that missing detail, ARKit3 does some additional processing called ","type":"text"},{"inlineContent":[{"type":"text","text":"matting"}],"type":"strong"},{"text":". Matting uses the ","type":"text"},{"code":"segmentationBuffer","type":"codeVoice"},{"text":" as a guide to look at the camera image and figure out what the missing detail was.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"There’s a lot that goes on behind the scenes, but they’re making it as easy as possible to adopt this. It’s available in RealityKit, but it’s also added in SceneKit’s ","type":"text"},{"code":"ARSCNView","type":"codeVoice"},{"text":". And, in case you have your own renderer or you’re working with third-party rendering, you can incorporate it into your own app using Metal.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Implementation-in-RealityKit","type":"heading","text":"Implementation in RealityKit"},{"inlineContent":[{"text":"RealityKit has a new UI element called the ","type":"text"},{"code":"ARView","type":"codeVoice"},{"text":", which provides an easy to use API for AR photorealism. This is the recommended way for new apps because it has a deep renderer integration, meaning that the entire pipeline expects people occlusion and works with transparent objects, so it is built for optimal performance.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"codeVoice","code":"ARView"},{"text":" also has built-in support for people occlusion:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["override func viewDidLoad() {","  super.viewDidLoad()","","  \/\/ Check if people occlusion is supported.","  guard","    let config = arView.session.config as? ARWorldTrackingConfiguration,","    ARWorldTrackingConfiguration.supportsFrameSemantics(.personSegmentationWithDepth)","  else {","    return","  }","","  \/\/ Enable frame semantics.","  config.frameSemantics = .personSegmentationWithDepth","","  \/\/ You can also use `.personSegmentation` in case you want to enable a \"green-screen\" experience.","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"Now, when the ARView starts running, people occlusion will automatically happen."}],"type":"paragraph"},{"inlineContent":[{"text":"As an example for what you can build now, see SwiftStrike at timestamp 8:15.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"What-if-youve-been-using-SceneKit","type":"heading","text":"What if you’ve been using SceneKit?"},{"inlineContent":[{"text":"All you have to do is enable frame semantics. However, composition is done as a post-process, so it may not work as well with transparent objects.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"What-if-you-have-your-ownthird-party-rendering-engine","type":"heading","text":"What if you have your own\/third-party rendering engine?"},{"inlineContent":[{"text":"You can use Metal for complete control of composition. Metal provides a new class for generating matte.","type":"text"}],"type":"paragraph"},{"level":4,"anchor":"Generating-matte","type":"heading","text":"Generating matte"},{"inlineContent":[{"type":"text","text":"To review, matting is the process of finding details that the ML engine missed:"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC19-607-matting","type":"image"}],"type":"paragraph"},{"inlineContent":[{"text":"Let’s look at some code.","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["func compositeFrame(_ frame: ARFrame!, commandBuffer: MTLCommandBuffer!) {","  \/\/ Ensure people occlusion is supported.","  guard ARWorldTrackingConfiguration.supportsFrameSemantics(.personSegmentationWithDepth) else {","    return","  }","","  \/\/ Create Metal texture using new API.","  let matte = matteGenerator.generateMatte(from: frame, commandBuffer: commandBuffer)","","  \/\/ Custom composition code using texture...","","  \/\/ Schedule everything to GPU.","  commandBuffer.commit()","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"The new object for "},{"type":"codeVoice","code":"matteGenerator"},{"type":"text","text":" is here:"}],"type":"paragraph"},{"syntax":"swift","code":["class ARMatteGenerator: NSObject {","  func generateMatte(from: ARFrame, commandBuffer: MTLCommandBuffer) -> MTLTexture","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"But we’re not done yet. Just like the "},{"type":"codeVoice","code":"segmentationBuffer"},{"type":"text","text":" was of a lower resolution, the "},{"type":"codeVoice","code":"estimatedDepthData"},{"type":"text","text":" is also lower. If we simply magnify it and overlay it on our matted image, there might be a mismatch. We can have depth values where there’s no alpha value in the matte, and more importantly, we can have alpha values in the matte where there’s no corresponding depth value."}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC19-607-magnify_depth_data","type":"image"}],"type":"paragraph"},{"level":4,"anchor":"Modifying-the-depth-buffer","type":"heading","text":"Modifying the depth buffer"},{"inlineContent":[{"text":"Because the matte has already recaptured some missing detail, we can’t modify the alpha itself. Instead, we need to modify the depth buffer.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Going back to the previous example:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["\/\/ Create Metal texture using new API.","let matte = matteGenerator.generateMatte(from: frame, commandBuffer: commandBuffer)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"Add a function call underneath from the same "},{"type":"codeVoice","code":"ARMatteGenerator"},{"type":"text","text":" class:"}],"type":"paragraph"},{"syntax":"swift","code":["\/\/ Create Metal texture using new API.","let matte = matteGenerator.generateMatte(from: frame, commandBuffer: commandBuffer)","let dilatedDepth = matteGenerator.generateDilatedDepth(from: frame, commandBuffer: commandBuffer)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"This function ensures that for every alpha value we find in the matte, we have a corresponding depth value that we can use when we do our final composition."}],"type":"paragraph"},{"level":4,"anchor":"Composition","type":"heading","text":"Composition"},{"inlineContent":[{"type":"text","text":"Now let’s move on to composition. Composition is usually done on the GPU in the fragment shader."}],"type":"paragraph"},{"syntax":"cpp","code":["fragment half4 customComposition(...) {","  \/\/ Sample the camera image and texture.","  \/\/ Also sample rendered depth because we're doing people occlusion.","  half4 camera = cameraTexture.sample(s, in.uv);","  half4 rendered = renderedTexture.sample(s, in.uv);","  float renderedDepth = renderedDepthTexture.sample(s, in.uv);","","  \/\/ Do what we would usually do in AR: simply overlay rendered content on the","  \/\/ real image given the rendered alpha.","  half4 scene = mix(rendered, camera, rendered.a);","","  \/\/ The new part to enable people occlusion: also sample matte and dilated depth.","  half matte = matteTexture.sample(s, in.uv);","  float dilatedDepth = dilatedDepthTexture.sample(s, in.uv);","","  \/\/ If there's people in front of rendered, mix the camera back. Otherwise,","  \/\/ do what we always do and overlay rendered content.","  if (dilatedDepth < renderedDepth) {","    return mix(scene, camera, matte);","  } else {","    return scene;","  }","}"],"type":"codeListing"},{"level":4,"anchor":"Best-practices-for-people-occlusion","type":"heading","text":"Best practices for people occlusion"},{"items":[{"content":[{"inlineContent":[{"text":"Supported on A12 devices and later","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Works best in indoor environments"}]}]},{"content":[{"inlineContent":[{"text":"Works on people, hands and feet, and multiple people in a scene.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"anchor":"2-Motion-Capture","type":"heading","text":"2. Motion Capture"},{"inlineContent":[{"type":"text","text":"A way to animate a virtual character that performs the same set of actions as the person you’re looking at."}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-motion_capture_intro"}],"type":"paragraph"},{"level":3,"anchor":"Virtual-Character-Overview","type":"heading","text":"Virtual Character Overview"},{"inlineContent":[{"type":"text","text":"Has 2 main components: An outer coating (mesh), and the bony structure inside (skeleton)."}],"type":"paragraph"},{"inlineContent":[{"text":"The skeleton is the driving force behind the entire character, so we need to animate the skeleton and the mesh will follow.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC19-607-skeleton_capture","type":"image"}],"type":"paragraph"},{"inlineContent":[{"text":"Machine Learning estimates the pose of the person in the image, which builds a high-fidelity skeleton. The mesh is overlayed to give a final character and is presented with ARKit3 + RealityKit. This is available on A12 devices and later.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Use-Cases","type":"heading","text":"Use Cases"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Animate virtual characters (puppets). This is enabled out-of-the-box."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Action\/Activity recognition.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Sports and fitness analysis.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Interacting with virtual objects.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Since ARKit also provides a 2D version of the skeleton in image space, you can use it to build editing tools or for semantic image understanding."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Remote use cases?","type":"text"}]}]}],"type":"unorderedList"},{"level":3,"anchor":"How-to-Use-It","type":"heading","text":"How to Use It"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Motion Capture in RealityKit:"}]},{"type":"text","text":" If you just want to quickly animate a character, this high-level API will help you get there."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Extracting data from skeleton in 3D"}],"type":"strong"},{"text":": Activity recognition\/analysis, or interaction with 3D objects in a scene.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Extracting data from skeleton in 2D"}]},{"type":"text","text":": For semantic image analysis or editing tools."}]}]}],"type":"orderedList"},{"level":3,"anchor":"1-Motion-Capture-in-RealityKit","type":"heading","text":"1. Motion Capture in RealityKit"},{"level":4,"anchor":"Overview","type":"heading","text":"Overview"},{"inlineContent":[{"text":"You can quickly animate characters with a simple API. You can add your custom characters with your own meshes.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"The tracked person is easy to access using ","type":"text"},{"code":"AnchorEntity","type":"codeVoice"},{"text":" objects that automatically capture the required transforms for motion capture.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC19-607-realitykit_motion_capture","type":"image"}],"type":"paragraph"},{"inlineContent":[{"text":"As an overview, the ","type":"text"},{"type":"codeVoice","code":"bodyTrackedEntity"},{"text":" represents 1 person. It contains the underlying skeleton and its position. It’s tracked in real time and gets updated every frame. It combines the skeleton to give an automatic mesh and the full character in a ","type":"text"},{"type":"codeVoice","code":".usdz"},{"text":" model.","type":"text"}],"type":"paragraph"},{"level":4,"anchor":"Code","type":"heading","text":"Code"},{"syntax":"swift","code":["\/\/ Step 1: Load skeleton + mesh for character using \"robot.usdz\".","Entity.loadBodyTrackedAsync(named: \"robot\")","  .sink(","    receiveCompletion: {","      \/\/ Catch any failures\/errors.","    },","    receiveValue: { character in","      guard let character = character as? BodyTrackedEntity else { return }","","      \/\/ Step 2: Get the location where you want to put your character.","      \/\/ You can put it anywhere you want, just provide an anchor at a different location.","      let personAnchor = AnchorEntity(.body)","      arView.scene.addAnchor(personAnchor)","","      \/\/ Step 3: Add the character to that location.","      personAnchor.addChild(character)","    }","  )"],"type":"codeListing"},{"inlineContent":[{"text":"You can use your own characters as long as they follow the skeleton naming scheme. The skeleton has 91 joints.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"2-Extracting-Data-from-Skeleton-in-3D","type":"heading","text":"2. Extracting Data from Skeleton in 3D"},{"inlineContent":[{"text":"You can access data using a new type of anchor called ","type":"text"},{"code":"ARBodyAnchor","type":"codeVoice"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-ar_body_anchor"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Let’s walk through this structure."}],"type":"paragraph"},{"syntax":"swift","code":["class ARBodyAnchor: ARAnchor"],"type":"codeListing"},{"inlineContent":[{"type":"codeVoice","code":"ARBodyAnchor"},{"type":"text","text":" is just a regular anchor that contains a geometry (the skeleton). The skeleton consists of nodes and  edges, just like any other geometry."}],"type":"paragraph"},{"syntax":"swift","code":["class ARSkeleton"],"type":"codeListing"},{"inlineContent":[{"text":"The transform is just the location of the anchor in rotation and translation matrix form.","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["var transform: matrix_float4x4"],"type":"codeListing"},{"level":4,"anchor":"Skeleton-Overview","type":"heading","text":"Skeleton Overview"},{"inlineContent":[{"text":"We’re mainly interested in accessing the skeleton. The nodes represent the joints, and the edges represent the bones.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"You can access the skeleton using the "},{"type":"codeVoice","code":"skeleton"},{"type":"text","text":" property of "},{"type":"codeVoice","code":"ARBodyAnchor"},{"type":"text","text":". Note that the root node of the skeleton is the right hip joint."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"definition"},{"type":"text","text":" property contains 2 components:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The names of all the joints in the skeleton, like “left shoulder”."}]}]},{"content":[{"inlineContent":[{"text":"The connections between them, which tell you how to connect those joints together. So, the “right hand” is a child of “right elbow”, which is a child of “right shoulder”, all the way down to the root node, “hip”. Note that fingers, etc. aren’t tracked, they simply follow the general motion of their closest parent.","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"level":4,"anchor":"Accessing-Joint-Locations","type":"heading","text":"Accessing Joint Locations"},{"inlineContent":[{"type":"text","text":"There are two ways to access joint locations."}],"type":"paragraph"},{"inlineContent":[{"text":"The first one is relative to its parent. If you want the location of the right hand relative to the elbow, you use this these functions on the ","type":"text"},{"code":"ARSkeleton3D","type":"codeVoice"},{"text":" object:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["func localTransform(for: ARSkeleton.JointName) -> simd_float4x4?","","let rightHandRelativeTransforms = localTransform(for: .rightHand)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"If you want the transform relative to the root (hip), you use:"}],"type":"paragraph"},{"syntax":"swift","code":["func modelTransform(for: ARSkeleton.JointName) -> simd_float4x4?","","let rightHandModelTransforms = modelTransform(for: .rightHand)"],"type":"codeListing"},{"inlineContent":[{"text":"If you want a list of transforms for all the joints you can get them with the following properties:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["var jointLocalTransforms: [simd_float4x4]","var jointModelTransforms: [simd_float4x4]"],"type":"codeListing"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-transforms"}],"type":"paragraph"},{"level":4,"anchor":"Drawing-the-Skeleton","type":"heading","text":"Drawing the Skeleton"},{"inlineContent":[{"type":"emphasis","inlineContent":[{"text":"Note that there are many code updates with visualizations. If you would like to watch all of them in the video, see 29:43","type":"text"}]}],"type":"paragraph"},{"syntax":"swift","code":["\/\/ Look for the bodyAnchor","for anchor in anchors {","  guard let bodyAnchor = anchor as? ARBodyAnchor else { return }","","  \/\/ Access the position of the root node.","  let hipWorldPosition = bodyAnchor.transform","","  \/\/ Access the skeleton geometry.","  let skeleton = bodyAnchor.skeleton","","  \/\/ Access the list of transforms of all joints relative to the root.","  let jointTransforms = skeleton.jointModelTransforms","","  \/\/ Iterate over all the joints.","  for (i, jointTransform) in jointTransforms.enumerated() {","    \/\/ Extract parent index from definition.","    let parentIndex = skeleton.definition.parentIndices[i]","","    \/\/ Check if it's not root (the root doesn't have a parent).","    guard parentIndex != -1 else { continue }","","    \/\/ Find position of parent joint","    let parentJointTransform = jointTransforms[parentIndex.intValue]","","    \/\/ Use this however you want...","  }","}"],"type":"codeListing"},{"level":2,"anchor":"3-Extracting-Data-from-Skeleton-in-2D","type":"heading","text":"3. Extracting Data from Skeleton in 2D"},{"inlineContent":[{"identifier":"WWDC19-607-ar_body_2d","type":"image"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC19-607-2d_structure","type":"image"}],"type":"paragraph"},{"level":3,"anchor":"Accessing-the-Skeleton","type":"heading","text":"Accessing the Skeleton"},{"inlineContent":[{"text":"You can easily access the ","type":"text"},{"code":"ARBody2D","type":"codeVoice"},{"text":" object in 2 different ways.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"If you’re already working in 2D space, you can access it using "},{"type":"codeVoice","code":"ARFrame"},{"type":"text","text":":"}],"type":"paragraph"},{"syntax":"swift","code":["func session(_ session: ARSession, didUpdate frame: ARFrame) {","  let person: ARBody2D = frame.detectedBody","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"If you’re working in 3D space and working with a 3D skeleton, but you also want the corresponding 2D skeleton in image space, you can use the following code:"}],"type":"paragraph"},{"syntax":"swift","code":["guard let bodyAnchor = anchor as? ARBodyAnchor else { continue }","","let body2D = bodyAnchor.referenceBody"],"type":"codeListing"},{"level":3,"anchor":"Skeleton-Image-Space","type":"heading","text":"Skeleton Image Space"},{"inlineContent":[{"text":"Points are in normalized Cartesian coordinate space, as shown below:","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-skeleton_grid"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Note that joints are called joint landmarks because they are pixel locations in an image:"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC19-607-joint_landmarks"}],"type":"paragraph"},{"inlineContent":[{"text":"Just like the 3D version, there is a definition object with joint names and parent-child relationships.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"While the 3D version has 91 joints, the 2D version has only 16 joint landmarks. They also have semantically meaningful names, like “Right Foot” and “Left Shoulder” and “Head”. The root node is still the Hip joint, and parent-child relationships work just as the 3D version.","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Drawing-the-2D-Skeleton","type":"heading","text":"Drawing the 2D Skeleton"},{"inlineContent":[{"text":"The approach is very similar to the 3D version:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["func session(_ session: ARSession, didUpdate frame: ARFrame) {","  \/\/ Access `ARBody2D` object from `ARFrame`.","  let person = frame.detectedBody","","  \/\/ Use `skeleton` property to access the skeleton.","  let skeleton2D = person.skeleton","","  \/\/ Access `definition` object containing structure.","  let definition = skeleton2D.definition","","  \/\/ Get list of joint landmarks.","  let jointLandmarks = skeleton2D.jointLandmarks","","  \/\/ Iterate over landmarks.","  for (i, joint) in jointLandmarks.enumerated() {","    \/\/ Find index of parent.","    let parentIndex = definition.parentIndices[i]","","    \/\/ Check if current joint landmark is not the root.","    guard parentIndex != -1 else { continue }","","    \/\/ Find position of parent index.","    let parentJointLandmark = jointLandmarks[parentIndex.intValue]","","    \/\/ Use this however you want...","  }","}"],"type":"codeListing"},{"level":2,"anchor":"Summary","type":"heading","text":"Summary"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Access to tracked person","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Provides 3D and 2D skeleton","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Enables character animation"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"RealityKit API for quickly animating a character"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"ARKit API for advanced use cases"}]}]}],"type":"unorderedList"},{"level":2,"anchor":"Written-By","type":"heading","text":"Written By"},{"numberOfColumns":5,"columns":[{"size":1,"content":[{"inlineContent":[{"identifier":"skhillon","type":"image"}],"type":"paragraph"}]},{"size":4,"content":[{"anchor":"Sarthak-Khillon","text":"Sarthak Khillon","level":3,"type":"heading"},{"inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/skhillon","isActive":true,"type":"reference","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}]},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/skhillon","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/www.linkedin.com\/in\/sarthakkhillon\/","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/x.com\/SarthakKhillon","isActive":true,"type":"reference"}],"type":"paragraph"}]}],"type":"row"},{"type":"thematicBreak"},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"level":2,"anchor":"Related-Sessions","type":"heading","text":"Related Sessions"},{"items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10073-Explore-ARKit-5","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-603-Introducing-RealityKit-and-Reality-Composer","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-604-Introducing-ARKit-3","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-605-Building-Apps-with-RealityKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-610-Building-Collaborative-AR-Experiences"],"type":"links","style":"list"},{"inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2025 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"kind":"article","sampleCodeDownload":{"kind":"sampleDownload","action":{"isActive":true,"overridingTitle":"Watch Video (39 min)","identifier":"https:\/\/developer.apple.com\/wwdc19\/607","type":"reference"}},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc19-607-bringing-people-into-ar"]}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19"]]},"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"references":{"WWDC19-607-transforms":{"identifier":"WWDC19-607-transforms","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-transforms.png"}],"alt":null,"type":"image"},"WWDC19-607-realitykit_motion_capture":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-realitykit_motion_capture.png"}],"identifier":"WWDC19-607-realitykit_motion_capture","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-604-Introducing-ARKit-3":{"title":"Introducing ARKit 3","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-604-Introducing-ARKit-3","kind":"article","role":"sampleCode","abstract":[{"text":"ARKit is the groundbreaking augmented reality (AR) platform for iOS that can transform how people connect with the world around them. Explore the state-of-the-art capabilities of ARKit 3 and discover the innovative foundation it provides for RealityKit. Learn how ARKit makes AR even more immersive through understanding of body position and movement for motion capture and people occlusion. Check out additions for multiple face tracking, collaborative session building, a coaching UI for on-boarding, and much more.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc19-604-introducing-arkit-3","type":"topic"},"WWDC19-607-ar_body_anchor":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-ar_body_anchor.png"}],"identifier":"WWDC19-607-ar_body_anchor","alt":null},"skhillon.jpeg":{"variants":[{"url":"\/images\/WWDCNotes\/skhillon.jpeg","traits":["1x","light"]}],"identifier":"skhillon.jpeg","alt":null,"type":"image"},"WWDC19-607-matting":{"identifier":"WWDC19-607-matting","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-matting.png"}],"alt":null,"type":"image"},"https://x.com/SarthakKhillon":{"type":"link","title":"X\/Twitter","titleInlineContent":[{"type":"text","text":"X\/Twitter"}],"url":"https:\/\/x.com\/SarthakKhillon","identifier":"https:\/\/x.com\/SarthakKhillon"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-610-Building-Collaborative-AR-Experiences":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-610-Building-Collaborative-AR-Experiences","role":"sampleCode","abstract":[{"text":"With iOS 13, ARKit and RealityKit enable apps to establish shared AR experiences faster and easier than ever. Understand how collaborative sessions allow multiple devices to build a combined world map and share AR anchors and updates in real-time. Learn how to incorporate collaborative sessions into ARKit-based apps, then roll into SwiftStrike, an engaging and immersive multiplayer AR game built using RealityKit and Swift.","type":"text"}],"type":"topic","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc19-610-building-collaborative-ar-experiences","title":"Building Collaborative AR Experiences"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19":{"url":"\/documentation\/wwdcnotes\/wwdc19","abstract":[{"type":"text","text":"Xcode 11, Swift 5.1, iOS 13, macOS 10.15 (Catalina), tvOS 13, watchOS 6."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"Combine"},{"type":"text","text":", "},{"type":"codeVoice","code":"Core Haptics"},{"type":"text","text":", "},{"type":"codeVoice","code":"Create ML"},{"type":"text","text":", and more."}],"kind":"article","title":"WWDC19","images":[{"identifier":"WWDC19-Icon.png","type":"icon"},{"identifier":"WWDC19.jpeg","type":"card"}],"type":"topic","role":"collectionGroup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10073-Explore-ARKit-5":{"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21-10073-explore-arkit-5","type":"topic","abstract":[{"text":"Build the next generation of augmented reality apps with ARKit 5. Explore how you can use Location Anchors in additional regions and more easily onboard people into your location-based AR experience. Learn more about Face Tracking and Motion Capture. And discover best practices for placing your AR content in the real world. We’ll also show you how you can integrate App Clip Codes into your AR app for easy discovery and precise positioning of your virtual content.","type":"text"}],"title":"Explore ARKit 5","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10073-Explore-ARKit-5","role":"sampleCode"},"WWDC19.jpeg":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19.jpeg"}],"identifier":"WWDC19.jpeg","alt":null},"WWDC19-607-after_occlusion":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC19-607-after_occlusion.png","traits":["1x","light"]}],"identifier":"WWDC19-607-after_occlusion","alt":null,"type":"image"},"skhillon":{"identifier":"skhillon","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/skhillon.jpeg"}],"alt":"Profile image of Sarthak Khillon","type":"image"},"https://github.com/skhillon":{"type":"link","title":"GitHub","titleInlineContent":[{"type":"text","text":"GitHub"}],"url":"https:\/\/github.com\/skhillon","identifier":"https:\/\/github.com\/skhillon"},"WWDC19-607-magnify_depth_data":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC19-607-magnify_depth_data.png","traits":["1x","light"]}],"identifier":"WWDC19-607-magnify_depth_data","alt":null,"type":"image"},"WWDC19-607-skeleton_grid":{"identifier":"WWDC19-607-skeleton_grid","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-skeleton_grid.png"}],"alt":null,"type":"image"},"WWDC19-607-depth_frames":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-depth_frames.png"}],"identifier":"WWDC19-607-depth_frames","alt":null},"WWDC19-Icon.png":{"variants":[{"url":"\/images\/WWDCNotes\/WWDC19-Icon.png","traits":["1x","light"]}],"identifier":"WWDC19-Icon.png","alt":null,"type":"image"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"alt":null,"type":"image"},"WWDC19-607-2d_structure":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-2d_structure.png"}],"identifier":"WWDC19-607-2d_structure","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-605-Building-Apps-with-RealityKit":{"title":"Building Apps with RealityKit","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-605-Building-Apps-with-RealityKit","kind":"article","role":"sampleCode","abstract":[{"text":"Gain a practical understanding of RealityKit capabilities by developing a game using its easy-to-learn API. Learn the recommended approach for loading assets, building a scene, applying animations, and handling game input. See how entities and components express the powerful elements of RealityKit while providing flexibility for customization. Find out how to take advantage of built-in networking and get details about extending the game into an immersive muliti-player experience.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc19-605-building-apps-with-realitykit","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-603-Introducing-RealityKit-and-Reality-Composer":{"url":"\/documentation\/wwdcnotes\/wwdc19-603-introducing-realitykit-and-reality-composer","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-603-Introducing-RealityKit-and-Reality-Composer","abstract":[{"type":"text","text":"Architected for AR, RealityKit provides developers access to world-class capabilities for rendering, animation, physics, and spatial audio. See how RealityKit reimagines the traditional 3D engine to make AR development faster and easier for developers than ever before. Understand the building blocks of developing RealityKit based apps and games, and learn about prototyping and producing content for AR experiences with Reality Composer."}],"title":"Introducing RealityKit and Reality Composer","type":"topic","role":"sampleCode"},"doc://WWDCNotes/documentation/WWDCNotes":{"role":"collection","title":"WWDC Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes","kind":"symbol","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"type":"topic"},"WWDC19-607-depth_buffers":{"type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-depth_buffers.png"}],"identifier":"WWDC19-607-depth_buffers","alt":null},"https://developer.apple.com/wwdc19/607":{"identifier":"https:\/\/developer.apple.com\/wwdc19\/607","checksum":null,"type":"download","url":"https:\/\/developer.apple.com\/wwdc19\/607"},"WWDC19-607-motion_capture_intro":{"identifier":"WWDC19-607-motion_capture_intro","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-motion_capture_intro.png"}],"alt":null,"type":"image"},"https://www.linkedin.com/in/sarthakkhillon/":{"identifier":"https:\/\/www.linkedin.com\/in\/sarthakkhillon\/","title":"Blog","type":"link","titleInlineContent":[{"type":"text","text":"Blog"}],"url":"https:\/\/www.linkedin.com\/in\/sarthakkhillon\/"},"doc://WWDCNotes/documentation/WWDCNotes/skhillon":{"role":"sampleCode","title":"Sarthak Khillon (19 notes)","url":"\/documentation\/wwdcnotes\/skhillon","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/skhillon","abstract":[{"text":"No Bio on GitHub","type":"text"}],"kind":"article","images":[{"type":"card","identifier":"skhillon.jpeg"},{"type":"icon","identifier":"skhillon.jpeg"}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"type":"link","title":"Contributions are welcome!","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"WWDC19-607-before_occlusion":{"identifier":"WWDC19-607-before_occlusion","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-before_occlusion.png"}],"alt":null,"type":"image"},"WWDC19-607-ar_body_2d":{"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-ar_body_2d.png"}],"identifier":"WWDC19-607-ar_body_2d","alt":null,"type":"image"},"WWDC19-607-joint_landmarks":{"type":"image","variants":[{"url":"\/images\/WWDCNotes\/WWDC19-607-joint_landmarks.png","traits":["1x","light"]}],"identifier":"WWDC19-607-joint_landmarks","alt":null},"WWDC19-607-skeleton_capture":{"identifier":"WWDC19-607-skeleton_capture","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDC19-607-skeleton_capture.png"}],"alt":null,"type":"image"}}}