{"metadata":{"title":"Background execution demystified","role":"sampleCode","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC20"},"schemaVersion":{"patch":0,"minor":3,"major":0},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10063-Background-execution-demystified"},"primaryContentSections":[{"kind":"content","content":[{"level":2,"text":"Overview","anchor":"overview","type":"heading"},{"inlineContent":[{"type":"text","text":"This talk sets out to explain why when your app is in the background your "},{"type":"codeVoice","code":"BGProgressingTask"},{"type":"text","text":", "},{"type":"codeVoice","code":"BPAppRefreshTask"},{"type":"text","text":", background push, or "},{"type":"codeVoice","code":"URLSession"},{"type":"text","text":" isn’t running as much as you might expect it to. If you are unfamiliar with these, checkout "},{"isActive":true,"type":"reference","identifier":"..\/..\/wwdc19\/707\/"},{"type":"text","text":" from WWDC19."}],"type":"paragraph"},{"level":2,"text":"Factors Affecting Runtime","anchor":"Factors-Affecting-Runtime","type":"heading"},{"inlineContent":[{"type":"text","text":"When your app is running it needs to achieve balance between what the system wants and want the customer wants. In the following diagram on the left side is what the system wants and on the right side is what the customer wants."},{"type":"text","text":" "},{"type":"image","identifier":"WWDC20-10063-bed2"}],"type":"paragraph"},{"level":2,"text":"The Top 7 Factors","anchor":"The-Top-7-Factors","type":"heading"},{"inlineContent":[{"text":"There are many factors that affect the runtime of your app. Here are some examples","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC20-10063-bed5","type":"image"}],"type":"paragraph"},{"inlineContent":[{"text":"The following image lists the top 7 factors you should keep in mind that too keep your app up to date.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"WWDC20-10063-bed","type":"image"}],"type":"paragraph"},{"level":2,"text":"Examples","anchor":"Examples","type":"heading"},{"inlineContent":[{"text":"Now the talk goes through different types of background activities and explains what they do and how they are constrained by the 7 factors.","type":"text"}],"type":"paragraph"},{"level":2,"text":"Background App Refresh","anchor":"Background-App-Refresh","type":"heading"},{"inlineContent":[{"text":"This is a way to ask the system to periodically run your app in the background to keep it up to date. This is the factor the customer has the most control over. They can decide if your app can run in the background by toggling the background app refresh switch in settings.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC20-10063-bed3"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The refreshes are not evenly spread out through out the day, because the device uses machine learning to figure out when you are most likely to use the app, and then it refreshes right before it expects you to use it."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Each app has an energy and data budget which is slowly depleted during the day."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The 7 factors can spread out the refresh rate even more. Here is an example of what the refresh rate could look like."}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"WWDC20-10063-bed4"}],"type":"paragraph"},{"level":2,"text":"System Budgets","anchor":"System-Budgets","type":"heading"},{"inlineContent":[{"type":"text","text":"As a developer this is where you have the most control. There are various things you can do to minimize power consumption. Avoid bringing up unneeded hardware (gps, accelerometer). Do your work as quickly as possible by trying to serialize it as much as possible. Signal completion which allows the system to immediately suspend your app letting it enter a lower power state. Most of the time this involves calling a completion handler. You should also minimize the cellular data used. You can do this by downloading only what is critical. Try to keep your refresh under 100 kilobytes every time your app refreshes."}],"type":"paragraph"},{"anchor":"Background-Pushes","type":"heading","level":2,"text":"Background Pushes"},{"inlineContent":[{"text":"This is a silent alert to the application from the server. Only 6 factors come into play for how often these are done, app usage is excluded. Common question is how does rating limiting apply to background pushes? The system delays the delivery of some pushes. Everything is still delivered, just delayed.","type":"text"}],"type":"paragraph"},{"anchor":"Background-URL-Session","type":"heading","level":2,"text":"Background URL Session"},{"inlineContent":[{"type":"text","text":"They are simple downloads that are done in the background and are managed by the system. You can prevent these from using cellular data and you set it so your app will launch when the download has completed. There are 2 main types, discretionary and nondiscretionary. Discretionary background transfers are transfers you are OK with differing, leaving it up to the system to decide when the best time to transfer the files are. Nondiscretionary are the opposite, you want it now! Only 5 factors come into play for these, app usage and rate limiting are excluded. For discretionary transfers only app switcher and system budgets come into play."}],"type":"paragraph"},{"anchor":"Background-Processing-Tasks","type":"heading","level":2,"text":"Background Processing Tasks"},{"inlineContent":[{"text":"Gives your app several minutes of runtime at system friendly times to do maintenance work on your app. These are ran even if you don’t bring your app to the foreground. 4 of the factors are applied to this mode, they are app usage, app switcher, background app refresh switch, and rate limiting.","type":"text"}],"type":"paragraph"},{"anchor":"Summary","type":"heading","level":2,"text":"Summary"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Consider how top factors affect your app."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Choose the right mode or modes for the job"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Reduce energy and data usage."}]}]}]},{"anchor":"Written-By","type":"heading","level":2,"text":"Written By"},{"columns":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"mike011","type":"image"}]}],"size":1},{"content":[{"level":3,"anchor":"Michael-Charland","text":"Michael Charland","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"reference","isActive":true,"overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/mike011"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/mike011"},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/mike011.github.io"}]}],"size":4}],"numberOfColumns":5,"type":"row"},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","isActive":true}],"type":"paragraph"},{"anchor":"Related-Sessions","type":"heading","level":2,"text":"Related Sessions"},{"type":"links","style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10003-There-and-back-again-Data-transfer-on-Apple-Watch","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10095-The-Push-Notifications-primer","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-707-Advances-in-App-Background-Execution"]},{"inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}]}],"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc20-10063-background-execution-demystified"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"type":"text","text":"Are you mystified about why and when your app gets background processing time? No need for a crystal ball! We’ll show you how to tackle the seven major factors that impact background runtime, and how you can integrate background modes that help your app come back to the foreground faster, run more smoothly, and reduce battery drain."}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20"]]},"kind":"article","sampleCodeDownload":{"action":{"type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc20\/10063","overridingTitle":"Watch Video (17 min)","isActive":true},"kind":"sampleDownload"},"sections":[],"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10095-The-Push-Notifications-primer":{"url":"\/documentation\/wwdcnotes\/wwdc20-10095-the-push-notifications-primer","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10095-The-Push-Notifications-primer","title":"The Push Notifications primer","abstract":[{"type":"text","text":"Help people get the most out of your app with push notifications for important events and updates — and by delivering up-to-date data in the background, so that it is ready when they open your app. Discover how you can use notifications and alert people to timely and relevant information. Learn the differences between alert and background notifications, how to adopt them in your apps, and avoid mistakes by using the right APIs for the job."}],"kind":"article","type":"topic"},"mike011":{"type":"image","identifier":"mike011","variants":[{"url":"\/images\/mike011.jpeg","traits":["1x","light"]}],"alt":"Profile image of Michael Charland"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10003-There-and-back-again-Data-transfer-on-Apple-Watch":{"type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10003-There-and-back-again-Data-transfer-on-Apple-Watch","url":"\/documentation\/wwdcnotes\/wwdc21-10003-there-and-back-again-data-transfer-on-apple-watch","kind":"article","role":"sampleCode","title":"There and back again: Data transfer on Apple Watch","abstract":[{"text":"Advances in Apple Watch give you more ways to communicate to and from your app, and new audiences to consider. Learn what strategies are available for data communication and how to choose the right tool for the job. Compare and contrast the benefits of using technologies such as iCloud Keychain, Watch Connectivity, Core Data, and more.","type":"text"}]},"doc://WWDCNotes/documentation/WWDCNotes/mike011":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/mike011","kind":"article","images":[{"type":"card","identifier":"mike011.jpeg"},{"type":"icon","identifier":"mike011.jpeg"}],"type":"topic","role":"sampleCode","title":"Michael Charland (3 notes)","abstract":[{"type":"text","text":"Swift Developer"}],"url":"\/documentation\/wwdcnotes\/mike011"},"WWDC20-10063-bed5":{"type":"image","identifier":"WWDC20-10063-bed5","variants":[{"url":"\/images\/WWDC20-10063-bed5.png","traits":["1x","light"]}],"alt":null},"WWDC20-Icon.png":{"type":"image","identifier":"WWDC20-Icon.png","variants":[{"url":"\/images\/WWDC20-Icon.png","traits":["1x","light"]}],"alt":null},"WWDC20.jpeg":{"type":"image","identifier":"WWDC20.jpeg","variants":[{"url":"\/images\/WWDC20.jpeg","traits":["1x","light"]}],"alt":null},"doc://WWDCNotes/documentation/WWDCNotes":{"url":"\/documentation\/wwdcnotes","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"title":"WWDC Notes","type":"topic","images":[{"type":"icon","identifier":"WWDCNotes.png"}],"kind":"symbol","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection"},"WWDC20-10063-bed3":{"type":"image","identifier":"WWDC20-10063-bed3","variants":[{"url":"\/images\/WWDC20-10063-bed3.png","traits":["1x","light"]}],"alt":null},"WWDC20-10063-bed4":{"type":"image","identifier":"WWDC20-10063-bed4","variants":[{"url":"\/images\/WWDC20-10063-bed4.png","traits":["1x","light"]}],"alt":null},"WWDC20-10063-bed2":{"type":"image","identifier":"WWDC20-10063-bed2","variants":[{"url":"\/images\/WWDC20-10063-bed2.png","traits":["1x","light"]}],"alt":null},"https://github.com/mike011":{"type":"link","title":"GitHub","titleInlineContent":[{"text":"GitHub","type":"text"}],"identifier":"https:\/\/github.com\/mike011","url":"https:\/\/github.com\/mike011"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20","title":"WWDC20","abstract":[{"text":"Xcode 12, Swift 5.3, iOS 14, macOS 11 (Big Sur), tvOS 14, watchOS 7.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"type":"codeVoice","code":"WidgetKit"},{"text":", ","type":"text"},{"type":"codeVoice","code":"StoreKit Testing"},{"text":", and more.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc20","kind":"article","role":"collectionGroup","type":"topic","images":[{"type":"icon","identifier":"WWDC20-Icon.png"},{"type":"card","identifier":"WWDC20.jpeg"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC19-707-Advances-in-App-Background-Execution":{"abstract":[{"text":"Background execution is a powerful tool your app can leverage to provide a great user experience. Learn about best practices to follow when running in the background, especially if you use VoIP or silent pushes, and an all-new scheduling API that enables long running processing and maintenance tasks.","type":"text"}],"kind":"article","type":"topic","title":"Advances in App Background Execution","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC19-707-Advances-in-App-Background-Execution","url":"\/documentation\/wwdcnotes\/wwdc19-707-advances-in-app-background-execution"},"../../wwdc19/707/":{"identifier":"..\/..\/wwdc19\/707\/","url":"..\/..\/wwdc19\/707\/","title":"Advances in App Background Execution","titleInlineContent":[{"type":"codeVoice","code":"Advances in App Background Execution"}],"type":"link"},"WWDC20-10063-bed":{"identifier":"WWDC20-10063-bed","variants":[{"traits":["1x","light"],"url":"\/images\/WWDC20-10063-bed.png"}],"alt":null,"type":"image"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"alt":null,"type":"image"},"mike011.jpeg":{"identifier":"mike011.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/mike011.jpeg"}],"alt":null,"type":"image"},"https://developer.apple.com/wwdc20/10063":{"identifier":"https:\/\/developer.apple.com\/wwdc20\/10063","url":"https:\/\/developer.apple.com\/wwdc20\/10063","type":"download","checksum":null},"https://mike011.github.io":{"identifier":"https:\/\/mike011.github.io","url":"https:\/\/mike011.github.io","title":"Blog","titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link"}}}