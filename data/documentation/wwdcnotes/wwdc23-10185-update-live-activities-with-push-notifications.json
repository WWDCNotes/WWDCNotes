{"metadata":{"role":"sampleCode","title":"Update Live Activities with push notifications","modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC23"},"schemaVersion":{"minor":3,"major":0,"patch":0},"sampleCodeDownload":{"kind":"sampleDownload","action":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10185","isActive":true,"type":"reference","overridingTitle":"Watch Video (18 min)"}},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc23-10185-update-live-activities-with-push-notifications"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10185-Update-Live-Activities-with-push-notifications","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23"]]},"primaryContentSections":[{"content":[{"anchor":"Update-Live-Activities-with-push-notifications","type":"heading","level":1,"text":"Update Live Activities with push notifications"},{"inlineContent":[{"text":"Update Live Activities remotely in an app when you push content through Apple Push Notification service (APNs). Here will explain how to configure Live Activity and push locally. you should be familiar with ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/ActivityKit","isActive":true,"type":"reference"},{"text":" and Live Activities","type":"text"}],"type":"paragraph"},{"name":"Note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"Assuming that you’ve already know about how an App and server interacts with Apple Push Notifications Services(APNS). When a new Live Activity is started, ActivityKit will obtain a push token from Apple Push Notification service, or APNs for short. This push token is unique for each Live Activity you request. That’s why your app needs to send it to your server before it can start sending push updates. Then, whenever you need to update the Live Activity, your server sends the push request using the token to APNs. Finally, APNs will send the payload to the device, and it will wake your widget extension to render the UI.","type":"text"}]}],"style":"note"},{"anchor":"Acitivity-Framework","type":"heading","level":2,"text":"Acitivity Framework"},{"name":"Note","type":"aside","content":[{"inlineContent":[{"text":"With the ActivityKit framework, you can ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/activitykit\/displaying-live-data-with-live-activities","isActive":true,"type":"reference"},{"text":" from an app Lock Screen. Especially for apps that push the limit of notifications to provide updated information, a Live Activities can offer a richer, interactive and highly glanceable way for people to keep track of an event or activity over a couple of hours.","type":"text"}],"type":"paragraph"}],"style":"note"},{"anchor":"Live-Activity-Type","type":"heading","level":2,"text":"Live Activity Type"},{"inlineContent":[{"text":"Live Activities display your app’s most current data on the iPhone or iPad Lock Screen and in the Dynamic Island, allowing people to see live information at a glance and perform quick actions that are related to the displayed information.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"To support Live Activities:"}],"type":"paragraph"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/developer.apple.com\/documentation\/WidgetKit\/Creating-a-Widget-Extension","isActive":true,"type":"reference"},{"text":" if you haven’t added and make sure to select “Include Live Activity” when you add a widget extension target to your Xcode project.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Add the Supports Live Activities entry in info.plist, and set its Boolean value to YES. Alternatively, open the Info.plist file as source code, add the NSSupportsLiveActivities key, then set the type to Boolean and its value to YES. If your project doesn’t have an Info.plist file, add the Supports Live Activities entry to the list of custom iOS target properties for your iOS app target and set its value to YES.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add code that defines an ActivityAttributes structure to describe the static and dynamic data of your Live Activity."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Use the ActivityAttributes defined to create the ActivityConfiguration."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Add code to configure, start, update, and end your Live Activities."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Make Live Activity interactive with Button or Toggle as described in Adding interactivity to widgets and Live Activities.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Add animations to bring attention to content updates as described in Animating data updates in widgets and Live Activities.","type":"text"}]}]}]},{"anchor":"Construct-the-ActivityKit-push-notification-payload","type":"heading","level":2,"text":"Construct the ActivityKit push notification payload"},{"name":"Note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"To successfully update or end a Live Activity with an ActivityKit push notification, send an HTTP request to APNs that conforms to the following"}]}],"style":"note"},{"inlineContent":[{"text":"Requirements:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Set the value for the apns-push-type header field to liveactivity."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Set the apns-topic header field using the following format: ","type":"text"},{"text":".push-type.liveactivity.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Set the value for the apns-priority header field to 5 or 10.","type":"text"}],"type":"paragraph"}]}]},{"anchor":"Sample-Payload-for-APNS-to-Update-Activity","type":"heading","level":3,"text":"Sample Payload for APNS to Update Activity"},{"syntax":"swift","type":"codeListing","code":["","    \/\/\/ APNS Sample body for updating live activity","","    {","        \"aps\": {","          \"timestamp\": 1685952000,","          \"event\": \"update\",","          \"content-state\": {","            \"currentHealthLevel\": 0.0,","            \"eventDescription\": \"Power Panda has been knocked down!\"","        },","        \"alert\": {","                \"title\": \"Power Panda is knocked down!\",","                \"body\": \"Use a potion to heal Power Panda!\",","                \"sound\": \"default\"","                }","        }","    }","","","    \/\/\/ Sample Curl Command to update live acitivty","","    curl \\","        --header \"apns-topic: com.example.apple-samplecode.Emoji-Rangers.push-type.liveactivity\" \\","        --header \"apns-push-type: liveactivity\" \\","        --header \"apns-priority: 10\" \\","        --header \"authorization: bearer $AUTHENTICATION_TOKEN\" \\","        --data '{","            \"aps\": {","            \"timestamp\": '$(date +%s)',","            \"event\": \"update\",","            \"content-state\": {","                        \"currentHealthLevel\": 0.941,","                        \"eventDescription\": \"Power Panda found a sword!\"","                    }","            }"," }' \\"," --http2 https:\/\/api.sandbox.push.apple.com\/3\/device\/$ACTIVITY_PUSH_TOKEN",""]},{"anchor":"Determine-the-update-frequency","type":"heading","level":2,"text":"Determine the update frequency"},{"inlineContent":[{"type":"text","text":"The system allows for a certain budget of ActivityKit push notifications per hour. Set the HTTP header field apns-priority for your requests to specify the priority of an ActivityKit push notification:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"If you don’t specify the apns-priority value, APNs delivers the ActivityKit push notification immediately with the default priority of 10 and counts it toward the notification budget that the system imposes.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If you exceed the budget, the system may throttle your ActivityKit push notifications."}]}]}]},{"name":"Note","type":"aside","content":[{"inlineContent":[{"text":"To avoid throttling, you can send a low-priority ActivityKit push notification that doesn’t count toward the budget by setting the HTTP header field apns-priority to 5. Consider this lower priority first before using the priority of 10. In many cases, choosing a mix of priority 5 and 10 for updates prevents your Live Activity updates from being throttled.","type":"text"}],"type":"paragraph"}],"style":"note"},{"anchor":"Written-By","type":"heading","level":2,"text":"Written By"},{"type":"row","columns":[{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"srujanc"}]}],"size":1},{"content":[{"text":"Srujan Chitla","type":"heading","level":3,"anchor":"Srujan-Chitla"},{"inlineContent":[{"overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/srujanc","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/github.com\/srujanc","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/","type":"reference","isActive":true}],"type":"paragraph"}],"size":4}],"numberOfColumns":5},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","isActive":true,"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"anchor":"Related-Sessions","type":"heading","level":2,"text":"Related Sessions"},{"type":"links","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10028-Bring-widgets-to-life","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10184-Meet-ActivityKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10069-Broadcast-updates-to-your-Live-Activities"],"style":"list"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}],"type":"small"},{"inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"kind":"article","abstract":[{"text":"Discover how you can remotely update Live Activities in your app when you push content through Apple Push Notification service (APNs). We’ll show you how to configure your first Live Activity push locally so you can quickly iterate on your implementation. Learn best practices for determining your push priority and configuring alerting updates, and explore how to further improve your Live Activities with relevance score and stale date.","type":"text"}],"sections":[],"references":{"https://github.com/srujanc":{"title":"GitHub","identifier":"https:\/\/github.com\/srujanc","type":"link","titleInlineContent":[{"text":"GitHub","type":"text"}],"url":"https:\/\/github.com\/srujanc"},"https://developer.apple.com/wwdc23/10185":{"identifier":"https:\/\/developer.apple.com\/wwdc23\/10185","checksum":null,"type":"download","url":"https:\/\/developer.apple.com\/wwdc23\/10185"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"title":"Contributions are welcome!","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link","titleInlineContent":[{"text":"Contributions are welcome!","type":"text"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"https://":{"title":"Blog","identifier":"https:\/\/","type":"link","titleInlineContent":[{"text":"Blog","type":"text"}],"url":"https:\/\/"},"srujanc":{"identifier":"srujanc","type":"image","alt":"Profile image of Srujan Chitla","variants":[{"url":"\/images\/srujanc.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes":{"abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"type":"topic","kind":"symbol","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"title":"WWDC Notes","role":"collection","url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes"},"srujanc.jpeg":{"identifier":"srujanc.jpeg","type":"image","alt":null,"variants":[{"url":"\/images\/srujanc.jpeg","traits":["1x","light"]}]},"WWDC23.jpeg":{"identifier":"WWDC23.jpeg","type":"image","alt":null,"variants":[{"url":"\/images\/WWDC23.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10184-Meet-ActivityKit":{"url":"\/documentation\/wwdcnotes\/wwdc23-10184-meet-activitykit","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10184-Meet-ActivityKit","abstract":[{"type":"text","text":"Live Activities are a glanceable way for someone to keep track of the progress of a task within your app. We’ll teach you how you can create helpful experiences for the Lock Screen, the Dynamic Island, and StandBy. Learn how to update your app’s Live Activities, monitor activity state, and take advantage of WidgetKit and SwiftUI to build richer experiences."}],"role":"sampleCode","title":"Meet ActivityKit","kind":"article","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23":{"kind":"article","images":[{"identifier":"WWDC23-Icon.png","type":"icon"},{"identifier":"WWDC23.jpeg","type":"card"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23","role":"collectionGroup","abstract":[{"type":"text","text":"Xcode 15, Swift 5.9, iOS 17, macOS 14 (Sonoma), tvOS 17, visionOS 1, watchOS 10."},{"type":"text","text":" "},{"type":"text","text":"New APIs: "},{"type":"codeVoice","code":"SwiftData"},{"type":"text","text":", "},{"type":"codeVoice","code":"Observation"},{"type":"text","text":", "},{"type":"codeVoice","code":"StoreKit"},{"type":"text","text":" views, and more."}],"type":"topic","title":"WWDC23","url":"\/documentation\/wwdcnotes\/wwdc23"},"https://developer.apple.com/documentation/activitykit/displaying-live-data-with-live-activities":{"title":"Display a Live Activity to share live updates","identifier":"https:\/\/developer.apple.com\/documentation\/activitykit\/displaying-live-data-with-live-activities","type":"link","titleInlineContent":[{"text":"Display a Live Activity to share live updates","type":"text"}],"url":"https:\/\/developer.apple.com\/documentation\/activitykit\/displaying-live-data-with-live-activities"},"https://developer.apple.com/documentation/WidgetKit/Creating-a-Widget-Extension":{"title":"Create a widget extension","identifier":"https:\/\/developer.apple.com\/documentation\/WidgetKit\/Creating-a-Widget-Extension","type":"link","titleInlineContent":[{"text":"Create a widget extension","type":"text"}],"url":"https:\/\/developer.apple.com\/documentation\/WidgetKit\/Creating-a-Widget-Extension"},"https://developer.apple.com/documentation/ActivityKit":{"title":"ActivityKit","identifier":"https:\/\/developer.apple.com\/documentation\/ActivityKit","type":"link","titleInlineContent":[{"text":"ActivityKit","type":"text"}],"url":"https:\/\/developer.apple.com\/documentation\/ActivityKit"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC24-10069-Broadcast-updates-to-your-Live-Activities":{"role":"sampleCode","abstract":[{"text":"With broadcast push notifications, your app can send updates to thousands of Live Activities with a single request. We’ll discover how broadcast push notifications work between an app, a server, and the Apple Push Notification service, then we’ll walk through best practices for this capability and how to implement it.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC24-10069-Broadcast-updates-to-your-Live-Activities","url":"\/documentation\/wwdcnotes\/wwdc24-10069-broadcast-updates-to-your-live-activities","title":"Broadcast updates to your Live Activities","kind":"article","type":"topic"},"doc://WWDCNotes/documentation/WWDCNotes/srujanc":{"url":"\/documentation\/wwdcnotes\/srujanc","kind":"article","type":"topic","images":[{"identifier":"srujanc.jpeg","type":"card"},{"identifier":"srujanc.jpeg","type":"icon"}],"abstract":[{"type":"text","text":"Sr Software Engineer at IQVIA"}],"title":"Srujan Chitla (5 notes)","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/srujanc"},"WWDC23-Icon.png":{"identifier":"WWDC23-Icon.png","type":"image","alt":null,"variants":[{"url":"\/images\/WWDC23-Icon.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10028-Bring-widgets-to-life":{"title":"Bring widgets to life","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc23-10028-bring-widgets-to-life","abstract":[{"text":"Learn how to make animated and interactive widgets for your apps and games. We’ll show you how to tweak animations for entry transitions and add interactivity using SwiftUI Button and Toggle so that you can create powerful moments right from the Home Screen and Lock Screen.","type":"text"}],"kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10028-Bring-widgets-to-life","type":"topic"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","type":"image","alt":null,"variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}]}}}