{"metadata":{"roleHeading":"WWDC13","title":"Custom Transitions Using View Controllers","role":"sampleCode","modules":[{"name":"WWDC Notes"}]},"schemaVersion":{"minor":3,"major":0,"patch":0},"sampleCodeDownload":{"action":{"overridingTitle":"Watch Video","type":"reference","identifier":"http:\/\/developer.apple.com\/wwdc13\/218","isActive":true},"kind":"sampleDownload"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc13-218-custom-transitions-using-view-controllers"]}],"primaryContentSections":[{"content":[{"level":2,"type":"heading","text":"Overview","anchor":"overview"},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"https:\/\/github.com\/soleares\/SOLPresentingFun","isActive":true},{"text":", ","type":"text"},{"type":"reference","identifier":"https:\/\/github.com\/robertmryan\/SwiftCustomTransitions\/tree\/noremove","isActive":true}]}],"name":"Note"},{"level":2,"type":"heading","text":"UIView animation APIs Overview","anchor":"UIView-animation-APIs-Overview"},{"level":3,"type":"heading","text":"Basic API","anchor":"Basic-API"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before iOS 4 we had the following APIs:"}]},{"syntax":"objc","type":"codeListing","code":["+ (void) beginAnimations:context:","+ (void) commitAnimations"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"iOS 4 introduced block-based APIs:"}]},{"syntax":"objc","type":"codeListing","code":["+ (void)animateWithDuration:(NSTimeInterval)duration","                      delay:(NSTimeInterval)delay","                    options:(UIViewAnimationOptions)options","                 animations:(void (^)(void))animations","                 completion:(void (^)(BOOL finished))completion;"]},{"type":"paragraph","inlineContent":[{"text":"Relationship to core animation:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiview\/1622515-animatewithduration","isActive":true,"type":"reference"},{"text":" lets us update our view properties within the ","type":"text"},{"code":"animations","type":"codeVoice"},{"text":" block","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"all iOS\/UIkit views are backed by ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer"},{"text":"s, hence changing a ","type":"text"},{"type":"codeVoice","code":"UIView"},{"text":" property is really changing a ","type":"text"},{"type":"codeVoice","code":"CALayer"},{"text":" property","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"when we change something within the ","type":"text"},{"code":"animations","type":"codeVoice"},{"text":" block, ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/caanimation","type":"reference"},{"text":" objects get added to each layer (whose property we’re changing), and that’s actually what’s driving the animations that you see throughout iOS.","type":"text"}],"type":"paragraph"}]}]},{"level":3,"type":"heading","text":"Disabling animations","anchor":"Disabling-animations"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In case we’re somehow within an "},{"type":"codeVoice","code":"animations"},{"type":"text","text":" block or similar, and we don’t want to animate a property change, we have the following API:"}]},{"syntax":"objc","type":"codeListing","code":["(void)setAnimationsEnabled:(BOOL)"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Which we need to remember to set back the value to "},{"code":"true","type":"codeVoice"},{"type":"text","text":" for other properties to animate. From iOS 7 we have a newer and recommended block-based API for this:"}]},{"syntax":"objc","type":"codeListing","code":["(void)performWithoutAnimation:(void ^(void))actions;"]},{"level":3,"type":"heading","text":"Spring animations","anchor":"Spring-animations"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Same as the basic animation, with two extra parameters:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Damping ratio","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Initial Spring Velocity"}],"type":"paragraph"}]}]},{"syntax":"objc","type":"codeListing","code":["+ (void)animateWithDuration:(NSTimeInterval)duration","                      delay:(NSTimeInterval)delay","     usingSpringWithDamping:(CGFloat)dampingRatio","      initialSpringVelocity:(CGFloat)velocity","                    options:(UIViewAnimationOptions)options","                 animations:(void (^)(void))animations","                 completion:(void (^)(BOOL finished))completion;"]},{"level":3,"type":"heading","text":"Key-frame animations","anchor":"Key-frame-animations"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Equivalent to "},{"code":"CAKeyframeAnimation","type":"codeVoice"},{"type":"text","text":". We have two methods."}]},{"type":"paragraph","inlineContent":[{"text":"The first is to create the animation block as usual:","type":"text"}]},{"syntax":"objc","type":"codeListing","code":["+ (void)animateKeyframesWithDuration:(NSTimeInterval)duration","                               delay:(NSTimeInterval)delay","                             options:(UIViewKeyframeAnimationOptions)options","                          animations:(void (^)(void))animations","                          completion:(void (^)(BOOL finished))completion;"]},{"type":"paragraph","inlineContent":[{"text":"The second is to add the actual key frames:","type":"text"}]},{"syntax":"objc","type":"codeListing","code":["+ (void)addKeyframeWithRelativeStartTime:(double)frameStartTime","                        relativeDuration:(double)frameDuration","                              animations:(void (^)(void))animations"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Example usage:"}]},{"syntax":"objc","type":"codeListing","code":["[UIView animateKeyframesWithDuration: .35","                               delay: 0.0","                             options:0","                          animations:^{","                                       [UIView addKeyframe... animations: ^{...}];","                                       [UIView addKeyframe... animations:^{...}];","                                       [UIView addKeyframe... animations:^{","                                         [someView setPosition:...];","                                          \/\/ etc. ","                                        }];","                                      }","                        completion:^(BOOL finished) {...}];"]},{"level":2,"text":"Custom view controller transitions","anchor":"Custom-view-controller-transitions","type":"heading"},{"inlineContent":[{"type":"text","text":"Which transitions can be customized?"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Presentations and dismissals","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"UITabBarController"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"UINavigationController"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"UICollectionViewController","type":"codeVoice"},{"type":"text","text":" layout-to-layout transitions"}]}]}],"type":"unorderedList"},{"level":3,"text":"Presentations and dismissals","anchor":"Presentations-and-dismissals","type":"heading"},{"inlineContent":[{"type":"text","text":"Supported presentation styles:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"UIModalPresentationFullScreen","type":"codeVoice"}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"UIModalPresentationCustom"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"The difference between the two is that in ","type":"text"},{"code":".custom","type":"codeVoice"},{"text":" the ","type":"text"},{"code":"from","type":"codeVoice"},{"text":" view controller is not removed from the window hierarchy after the transition.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"How to:","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["UIViewController *vc = ...;","id <UIViewControllerTransitioningDelegate> transitioningDelegate;","vc.modalPresentationStyle = UIModalPresentationCustom;","[vc setTransitioningDelegate: transitioningDelegate];","[self presentViewController:vc animated: YES completion: nil];"],"type":"codeListing"},{"level":3,"text":"`UITabBarController` & `UINavigationController`","anchor":"UITabBarController--UINavigationController","type":"heading"},{"inlineContent":[{"type":"text","text":"How to: set a delegate that vends the transition object"}],"type":"paragraph"},{"syntax":"objc","code":["\/\/ in your UITabBarController subclass","NSUInteger secondTab = 1;","self.delegate = tabBarControllerDelegate;","[self setSelectedIndex:secondTab]; \/\/ this will use custom transition if `tabBarControllerDelegate` vends it","","\/\/ in your UINavigationController subclass","self.delegate = navigationControllerDelegate;","[self pushViewController:vc animated:YES];"],"type":"codeListing"},{"name":"Note","content":[{"type":"paragraph","inlineContent":[{"text":"Note that you don’t need to subclass like in the example, you can use the default classes and assign the delegate.","type":"text"}]}],"style":"note","type":"aside"},{"level":3,"text":"`UICollectionViewController`","anchor":"UICollectionViewController","type":"heading"},{"inlineContent":[{"text":"Layout-to-layout navigation transitions","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["UICollectionViewLayout *layout1,*layout2,*layout3;","UICollectionViewController *cvc1, *cvc2, *cvc3;","cvc1 = [cvc1 initWithCollectionViewLayout:layout1];","...","[nav pushViewController:cvc1 animated:YES];","cvc2.useLayoutToLayoutNavigationTransitions = YES; \/\/ you must set these to get your transition","cvc3.useLayoutToLayoutNavigationTransitions = YES; \/\/ you must set these to get your transition","[nav pushViewController:cvc2 animated:YES];","[nav pushViewController:cvc3 animated:YES];","[nav popViewControllerAnimated:YES];"],"type":"codeListing"},{"level":2,"text":"Anatomy of a transition","anchor":"Anatomy-of-a-transition","type":"heading"},{"inlineContent":[{"type":"text","text":"In this transition, we replace the "},{"code":"Child A","type":"codeVoice"},{"type":"text","text":" view with a different "},{"code":"Child B","type":"codeVoice"},{"type":"text","text":" view:"}],"type":"paragraph"},{"inlineContent":[{"text":"| ","type":"text"},{"text":" | ","type":"text"},{"text":" |","type":"text"}],"type":"paragraph"},{"name":"Note","content":[{"inlineContent":[{"text":"Blue is the view hierarchy, yellow is the view controller hierarchy","type":"text"}],"type":"paragraph"}],"style":"note","type":"aside"},{"inlineContent":[{"text":"By definition, the start state and end state have both a view controller hierarchy and view hierarchy that are consistent.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"However, during the transition between these states (the actual move from one to the other), we go through an inconsistent phase. For example, at some point we probably have both "},{"code":"Child A","type":"codeVoice"},{"type":"text","text":" and "},{"code":"Child B","type":"codeVoice"},{"type":"text","text":" views in the view hierarchy, maybe with some animations happening etc."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"This can be considered a summary of what happens during a transition:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Start state (consistent view controller hierarchy and view hierarchy)","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"User or programmatic transition commences"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Internal structures are updated, callbacks made, etc."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Container view, and start and final view positions are computed","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Optional animation to end state view hierarchy is run"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Animation completes (internal structures are updated, callbacks made, etc.)","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"End State (consistent view controller hierarchy and view hierarchy)"}],"type":"paragraph"}]}],"type":"orderedList"},{"level":2,"text":"`UIViewControllerContextTransitioning`","anchor":"UIViewControllerContextTransitioning","type":"heading"},{"inlineContent":[{"text":"From iOS 7, we have a new definition that takes care of points ","type":"text"},{"text":"4","type":"text"},{"text":" and ","type":"text"},{"text":"6","type":"text"},{"text":": ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollercontexttransitioning","isActive":true},{"text":".","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["@protocol UIViewControllerContextTransitioning <NSObject>","  \/\/ The view in which the animated transition should take place.","  - (UIView *)containerView;","","  \/\/ Two keys for the  method below are currently defined by the system","  \/\/ UITransitionContextToViewControllerKey, and UITransitionContextFromViewControllerKey.","  - (UIViewController *) viewControllerForKey:(NSString *)key;","  - (CGRect) initialFrameForViewController:(UIViewController *)vc;","  - (CGRect) finalFrameForViewController:(UIViewController *)vc;","  \/\/ 👆🏻 It's important to start and end from where the system wants you to start and end.","","  \/\/ This MUST be called whenever a transition completes (or is cancelled.)","  - (void)completeTransition:(BOOL)didComplete;","  ...","@end"],"type":"codeListing"},{"inlineContent":[{"text":"Note that we do not conform or create objects conforming to this protocol: it’s UIKit that does this for us. Instead, an object conforming to this protocol will be passed to us to create and vend to create your custom transitions.","type":"text"}],"type":"paragraph"},{"level":2,"text":"`UIViewControllerAnimatedTransitioning`","anchor":"UIViewControllerAnimatedTransitioning","type":"heading"},{"inlineContent":[{"text":"One object that we can define and where an ","type":"text"},{"code":"UIViewControllerContextTransitioning","type":"codeVoice"},{"text":" object will be passed to is an object conforming to ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrolleranimatedtransitioning"},{"text":":","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["@protocol UIViewControllerAnimatedTransitioning <NSObject>","  \/\/ Here we tell how long the transition is going to take.","  - (NSTimeInterval)transitionDuration:(id <UIViewControllerContextTransitioning>)ctx;","","  \/\/ This method can only  be a nop if the transition is interactive and not a","  \/\/ percentDriven interactive transition.","  \/\/ Here we define the transition.","  - (void)animateTransition:(id <UIViewControllerContextTransitioning>)ctx;","  \/\/ 👆🏻 when this is called we need to:","  \/\/ 1. add the view into the parent view","  \/\/ 2. do our animation","  \/\/ 3. call `UIViewControllerContextTransitioning`'s completeTransition:","","  @optional","  \/\/ This is a convenience and if implemented will be invoked by the system when the","  \/\/transition context's completeTransition: method is invoked.","  - (void)animationEnded:(BOOL) transitionCompleted;","@end"],"type":"codeListing"},{"inlineContent":[{"text":"Pseudo code for ","type":"text"},{"code":"animateTransition:","type":"codeVoice"},{"text":":","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["- (void)animateTransition:(id <UIViewControllerContextTransitioning>ctx {","  UIView *inView = [ctx containerView];","  UIView *toView = [[ctx viewControllerForKey: ...]  view];","  UIView *fromView = [[ctx viewControllerForKey: ...] view];","  CGSize size = toEndFrame.size;","  ","  if(self.isPresentation) {","    ...","    [inView addSubview: toView];","  } else { ","    ...","    [inView insertSubview:toView belowSubview: [fromVC view]];","  }","","  \/\/ 👇🏻 Do the animation here ","  [UIView animateWithDuration: self.transitionDuration animations: ^ {","    if(self.isPresentation) {","      toView.center = newCenter;","      toView.bounds = newBounds;","    } else {","      ...","    } ","  } completion: ^(BOOL finished) { [ctx completeTransition: YES];}];","}"],"type":"codeListing"},{"level":2,"text":"Wiring it all together","anchor":"Wiring-it-all-together","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Animation and interaction controllers are vended by delegates"}]},{"items":[{"content":[{"inlineContent":[{"code":"UIViewControllerTransitioningDelegate","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"UINavigationControllerDelegate"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"UITabBarControllerDelegate","type":"codeVoice"}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Animation controllers conform to "},{"type":"codeVoice","code":"UIViewControllerAnimatedTransitioning"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Interaction controllers conform to "},{"code":"UIViewControllerInteractiveTransitioning","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"A system object passed to the controllers conforms to "},{"code":"UIViewControllerContextTransitioning","type":"codeVoice"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"text":"Animation and interaction controllers are vended by delegates","anchor":"Animation-and-interaction-controllers-are-vended-by-delegates","type":"heading"},{"level":3,"text":"`UIViewControllerTransitioningDelegate`","anchor":"UIViewControllerTransitioningDelegate","type":"heading"},{"inlineContent":[{"text":"We vend our animated\/interactive transition via this delegate:","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["@protocol UIViewControllerTransitioningDelegate <NSObject>","  \/\/ for animated but not interactive:","  @optional","  - (id <UIViewControllerAnimatedTransitioning>)","      animationControllerForPresentedController:(UIVC *)presented","                            presentingController:(UIVC *)presenting","                                sourceController:(UIVC *)source;","  - (id <UIViewControllerAnimatedTransitioning>)","      animationControllerForDismissedController:(UIVC *)dismissed;","","  \/\/ for animated and interactive:","  - (id <UIViewControllerInteractiveTransitioning>)","      interactionControllerForPresentation:(id <UIViewControllerAnimatedTransitioning>)a;","  - (id <UIViewControllerInteractiveTransitioning>)","      interactionControllerForDismissal:(id <UIViewControllerAnimatedTransitioning>)a;","@end"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"..which we set in the "},{"inlineContent":[{"text":"presented","type":"text"}],"type":"strong"},{"type":"text","text":" view controller (not the presenting view controller):"}],"type":"paragraph"},{"syntax":"objc","code":["@interface UIViewController(CustomTransitioning)","  @property (nonatomic,retain) id <UIViewControllerTransitioningDelegate>transitionDelegate;","@end"],"type":"codeListing"},{"level":3,"text":"`UINavigationControllerDelegate`","anchor":"UINavigationControllerDelegate","type":"heading"},{"inlineContent":[{"text":"Similar to above, here are the new ","type":"text"},{"code":"UINavigationControllerDelegate","type":"codeVoice"},{"text":" extensions:","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["\/\/ animated but not interactive:","- (id <UIViewControllerAnimatedTransitioning>)navigationController:  (UINC *)nc","                                   animationControllerForOperation: (UINavigationControllerOperation)op","                                                fromViewController:(UIViewController *)fromVC","                                                  toViewController:(UIViewController *)toVC;","\/\/ animated and interactive:","- (id <UIViewControllerInteractiveTransitioning>)navigationController: (UINC *)nc","                          interactionControllerForAnimationController: (id <UIViewControllerAnimatedTransitioning>)a;"],"type":"codeListing"},{"level":3,"text":"`UITabBarControllerDelegate`","anchor":"UITabBarControllerDelegate","type":"heading"},{"inlineContent":[{"text":"Here are the new ","type":"text"},{"type":"codeVoice","code":"UITabBarControllerDelegate"},{"text":" extensions:","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["\/\/ animated but not interactive:","- (id <UIViewControllerAnimatedTransitioning>)tabBarController: (UITABC *)tbc","            animationControllerForTransitionFromViewController:(UIVC *)fromVC","                                              toViewController:(UIVC *)toVC;","\/\/ animated and interactive:","- (id <UIViewControllerInteractiveTransitioning>)tabBarController: (UITABC *)tbc","                      interactionControllerForAnimationController: (id <UIViewControllerAnimatedTransitioning>)a;"],"type":"codeListing"},{"level":3,"text":"Responsibilities of the animation controller","anchor":"Responsibilities-of-the-animation-controller","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Implementation of ","type":"text"},{"code":"animateTransition:","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"transitionDuration:","type":"codeVoice"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Insertion of "},{"type":"text","text":"to"},{"type":"text","text":" view controller’s view into the container view"}],"type":"paragraph"}]}]}]},{"content":[{"inlineContent":[{"text":"When the transition animation completes","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"The "},{"type":"text","text":"to"},{"type":"text","text":" and "},{"type":"text","text":"from"},{"type":"text","text":" view controller’s views need to be in their designated positions"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The context’s ","type":"text"},{"code":"completeTransition:","type":"codeVoice"},{"text":" method must be invoked","type":"text"}]}]}]}]}],"type":"unorderedList"},{"level":2,"text":"Interactive View Controller Transitions","anchor":"Interactive-View-Controller-Transitions","type":"heading"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Like before, but interactive"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"If you use a ","type":"text"},{"code":"UIView","type":"codeVoice"},{"text":" animation APIs in your ","type":"text"},{"code":"animateTransition","type":"codeVoice"},{"text":" method, UIKit will take care of reversing the animation, cancelling it, etc.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"UIKit provides a concrete interaction controller class: ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uipercentdriveninteractivetransition"}]}]}],"type":"unorderedList"},{"level":3,"text":"`UIViewControllerInteractiveTransitioning`","anchor":"UIViewControllerInteractiveTransitioning","type":"heading"},{"inlineContent":[{"text":"Equivalent to ","type":"text"},{"code":"UIViewControllerAnimatedTransitioning","type":"codeVoice"},{"text":", but interactive.","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["@protocol UIViewControllerInteractiveTransitioning <NSObject>","  \/\/ fell free to call out to your animation controller's animate transmission here","  - (void)startInteractiveTransition:(id <UIViewControllerContextTransitioning>)ctx;","  ","  \/\/ When the transition stops, you can use these parameters to tell the animation to speed up\/slow down","  \/\/ and also change the animation curve.","  @optional","  - (CGFloat)completionSpeed;","  - (UIViewAnimationCurve)completionCurve;","@end"],"type":"codeListing"},{"level":3,"text":"Interactive Transitioning States","anchor":"Interactive-Transitioning-States","type":"heading"},{"inlineContent":[{"identifier":"WWDC13-218-interactiveTransitioningStates","type":"image"}],"type":"paragraph"},{"level":3,"text":"How-to","anchor":"How-to","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Implement the animation controller","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"animatePresentation:","type":"codeVoice"},{"text":" must be implemented using the ","type":"text"},{"code":"UIView","type":"codeVoice"},{"text":" animation block APIs","type":"text"}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implement the logic that will drive the interaction (e.g. The target of a gesture recognizer)"}]},{"items":[{"content":[{"inlineContent":[{"text":"Often this target is a subclass of ","type":"text"},{"type":"codeVoice","code":"UIViewControllerPercentDrivenTransition"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"The interaction logic will call:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"updateInteractiveTransition:(CGFloat)percent","type":"codeVoice"}]}]},{"content":[{"inlineContent":[{"code":"completeInteractiveTransition","type":"codeVoice"},{"type":"text","text":" or "},{"code":"cancelInteractiveTransition","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"(Note that ","type":"text"},{"type":"codeVoice","code":"startInteractiveTransition"},{"text":" is handled automatically)","type":"text"}],"type":"paragraph"}]}]}]}],"type":"unorderedList"}]}],"type":"unorderedList"},{"level":3,"text":"`UIPercentDrivenInteractiveTransition`","anchor":"UIPercentDrivenInteractiveTransition","type":"heading"},{"syntax":"objc","code":["\/\/ The associated animation controller must animate its transition using UIView animation APIs.","@interface UIPercentDrivenInteractiveTransition : NSObject <UIViewControllerInteractiveTransitioning>","  @property (readonly) CGFloat duration;","  \/\/ The last percentComplete value specified by updateInteractiveTransition:","  @property (readonly) CGFloat percentComplete;","  \/\/ completionSpeed defaults to 1.0 which corresponds to a completion duration of","  \/\/ (1 - percentComplete)*duration.  It must be greater than 0.0.","  @property (nonatomic,assign) CGFloat completionSpeed;","  \/\/ When the interactive part of the transition has completed, this property can","  \/\/ be set to indicate a different animation curve.","  @property (nonatomic,assign) UIViewAnimationCurve completionCurve;"," ","  \/\/👇🏻 These are the three methods that you're going to call.","  \/\/ Used instead of the corresponding context methods.","  - (void)updateInteractiveTransition:(CGFloat)percentComplete;","  - (void)cancelInteractiveTransition;","  - (void)finishInteractiveTransition;","@end"],"type":"codeListing"},{"level":3,"text":"Canceling an interactive transition","anchor":"Canceling-an-interactive-transition","type":"heading"},{"items":[{"content":[{"inlineContent":[{"text":"Don’t assume that ","type":"text"},{"code":"viewDidAppear","type":"codeVoice"},{"text":" follows ","type":"text"},{"code":"viewWillAppear","type":"codeVoice"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"because of interactive transactions, our view controller might jump between appearing ("},{"code":"viewWillAppear","type":"codeVoice"},{"type":"text","text":") and disappearing ("},{"code":"viewWillDisappear","type":"codeVoice"},{"type":"text","text":") without actually appearing and disappearing"}]}]}]}]},{"content":[{"inlineContent":[{"text":"Make sure to undo any side effects","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Any view controller can ask for the transition coordinator (doesn’t matter which view controller, as long as they’re involved in a transition)","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["@interface UIViewController(TransitionCoordinator)","@property (nonatomic,retain) id <UIViewControllerTransitionCoordinator> transitionCoordinator;","@end"],"type":"codeListing"},{"inlineContent":[{"text":"This coordinator conforms to ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollertransitioncoordinator","isActive":true,"type":"reference"},{"text":" which, in turn, conforms to ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollertransitioncoordinatorcontext","isActive":true,"type":"reference"},{"text":":","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["@protocol UIViewControllerTransitionCoordinator","                      <UIViewControllerTransitionCoordinatorContext>","  @optional","  - (BOOL) notifyWhenInteractionEndsUsingBlock:(void (^ (id<UIViewControllerTransitionCoordinatorContext)handler;","  - (BOOL) animatorAlongsideTransition:(void (^) (id <UIViewControllerTransitionCoordinatorContext)a;","                            completion:(void (^)(id<UIViewControllerTransitionCoordinatorContext)c;","  - (BOOL) animatorAlongsideTransitionInView:(UIView *)view","                                   animation: (void (^) (id <UIViewControllerTransitionCoordinatorContext)a;","@end","","@protocol UIViewControllerTransitionCoordinatorContext <NSObject>","  - (UIView *)containerView;","  - (UIViewController *) viewControllerForKey:(NSString *)key;","  - (CGRect) initialFrameForViewController:(UIViewController *)vc;","  - (CGRect) finalFrameForViewController:(UIViewController *)vc;","  - (BOOL) isCancelled;","  - (BOOL) initiallyInteractive;","  - (BOOL) isInteractive;","@end"],"type":"codeListing"},{"inlineContent":[{"text":"Your view controller can use these properties of the coordinator to keep track of its own appearing\/disappearing state. For example:","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["- (void) viewWillAppear: {","  [self doSomeSideEffectsAssumingViewDidAppearIsGoingToBeCalled];","  id <UIViewControllerTransitionCoordinator> coordinator;","  coordinator = [self transitionCoordinator];","  if(coordinator && [coordinator initiallyInteractive]) {","    [transitionCoordinator notifyWhenInteractionEndsUsingBlock:","      ^(id <UIViewControllerTransitionCoordinatorContext> ctx) {","        if(ctx.isCancelled) {","          [self undoSideEffects];","        }","      }];","  }","}"],"type":"codeListing"},{"inlineContent":[{"type":"codeVoice","code":"transitionCoordinator"},{"type":"text","text":" does even more:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Allows completion handlers to be registered for transitions"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Allows other animations to run alongside the transition animation • In addition to custom transitions on iOS 7","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"UINavigationController"},{"text":" transitions have an associated transition coordinator","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Present and Dismiss transitions have an associated coordinator"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Usage example:","type":"text"}],"type":"paragraph"},{"syntax":"objc","code":["UIViewController *vc;","[self pushViewController:vc animated: YES];","id <UIViewControllerTransitionCoordinator>coordinator;","coordinator = [viewController transitionCoordinator];","[coordinator animateAlongsideTransition:","  ^(id <UIViewControllerTransitionCoordinatorContext> c) {","    ;;; some animation","  }","  completion:(id <UIViewControllerTransitionCoordinatorContext> c) {","    ;;; Code to run after your push transition has finished.","}];"],"type":"codeListing"},{"level":2,"text":"Written By","anchor":"Written-By","type":"heading"},{"numberOfColumns":5,"columns":[{"size":1,"content":[{"inlineContent":[{"identifier":"zntfdr","type":"image"}],"type":"paragraph"}]},{"size":4,"content":[{"text":"Federico Zanetello","level":3,"anchor":"Federico-Zanetello","type":"heading"},{"inlineContent":[{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","overridingTitle":"Contributed Notes","overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/github.com\/zntfdr","type":"reference","isActive":true},{"type":"text","text":" "},{"type":"text","text":"|"},{"type":"text","text":" "},{"identifier":"https:\/\/zntfdr.dev","type":"reference","isActive":true}],"type":"paragraph"}]}],"type":"row"},{"inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"isActive":true,"type":"reference","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"}],"type":"paragraph"},{"inlineContent":[{"inlineContent":[{"text":"Legal Notice","type":"text"}],"type":"strong"}],"type":"small"},{"inlineContent":[{"text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved.","type":"text"},{"text":" ","type":"text"},{"text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries.","type":"text"},{"text":" ","type":"text"},{"text":"This website is not made by, affiliated with, nor endorsed by Apple.","type":"text"}],"type":"small"}],"kind":"content"}],"abstract":[{"type":"text","text":"View controllers now allow you to create custom transitions, giving you expanded control over your user interface. Learn how to take advantage of custom transitions by using powerful new animation APIs, explore changes with full screen layouts, and see how to use navigation controllers with collection views to create a truly immersive experience."}],"sections":[],"kind":"article","hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC13"]]},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC13-218-Custom-Transitions-Using-View-Controllers","interfaceLanguage":"swift"},"references":{"https://github.com/robertmryan/SwiftCustomTransitions/tree/noremove":{"titleInlineContent":[{"type":"text","text":"Interactive example"}],"title":"Interactive example","type":"link","url":"https:\/\/github.com\/robertmryan\/SwiftCustomTransitions\/tree\/noremove","identifier":"https:\/\/github.com\/robertmryan\/SwiftCustomTransitions\/tree\/noremove"},"https://developer.apple.com/documentation/uikit/uiviewcontrollercontexttransitioning":{"titleInlineContent":[{"code":"UIViewControllerContextTransitioning","type":"codeVoice"}],"title":"UIViewControllerContextTransitioning","type":"link","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollercontexttransitioning","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollercontexttransitioning"},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"title":"Contributions are welcome!","type":"link","url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing"},"https://zntfdr.dev":{"titleInlineContent":[{"type":"text","text":"Blog"}],"title":"Blog","type":"link","url":"https:\/\/zntfdr.dev","identifier":"https:\/\/zntfdr.dev"},"https://developer.apple.com/documentation/quartzcore/calayer":{"titleInlineContent":[{"code":"CALayer","type":"codeVoice"}],"title":"CALayer","type":"link","url":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer","identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer"},"https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioncoordinator":{"titleInlineContent":[{"code":"UIViewControllerTransitionCoordinator","type":"codeVoice"}],"title":"UIViewControllerTransitionCoordinator","type":"link","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollertransitioncoordinator","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollertransitioncoordinator"},"https://developer.apple.com/documentation/quartzcore/caanimation":{"titleInlineContent":[{"code":"CAAnimation","type":"codeVoice"}],"title":"CAAnimation","type":"link","url":"https:\/\/developer.apple.com\/documentation\/quartzcore\/caanimation","identifier":"https:\/\/developer.apple.com\/documentation\/quartzcore\/caanimation"},"zntfdr":{"variants":[{"url":"\/images\/zntfdr.jpeg","traits":["1x","light"]}],"alt":"Profile image of Federico Zanetello","type":"image","identifier":"zntfdr"},"https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning":{"titleInlineContent":[{"code":"UIViewControllerAnimatedTransitioning","type":"codeVoice"}],"title":"UIViewControllerAnimatedTransitioning","type":"link","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrolleranimatedtransitioning","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrolleranimatedtransitioning"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","role":"sampleCode","images":[{"type":"card","identifier":"zntfdr.jpeg"},{"type":"icon","identifier":"zntfdr.jpeg"}],"kind":"article","type":"topic","abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"url":"\/documentation\/wwdcnotes\/zntfdr","title":"Federico Zanetello (332 notes)"},"WWDC13.jpeg":{"variants":[{"url":"\/images\/WWDC13.jpeg","traits":["1x","light"]}],"alt":null,"type":"image","identifier":"WWDC13.jpeg"},"https://developer.apple.com/documentation/uikit/uiview/1622515-animatewithduration":{"titleInlineContent":[{"code":"animateWithDuration:animations:completion:","type":"codeVoice"}],"title":"animateWithDuration:animations:completion:","type":"link","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiview\/1622515-animatewithduration","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiview\/1622515-animatewithduration"},"https://github.com/soleares/SOLPresentingFun":{"titleInlineContent":[{"type":"text","text":"Sample code"}],"title":"Sample code","type":"link","url":"https:\/\/github.com\/soleares\/SOLPresentingFun","identifier":"https:\/\/github.com\/soleares\/SOLPresentingFun"},"WWDCNotes.png":{"variants":[{"url":"\/images\/WWDCNotes.png","traits":["1x","light"]}],"alt":null,"type":"image","identifier":"WWDCNotes.png"},"https://developer.apple.com/documentation/uikit/uipercentdriveninteractivetransition":{"titleInlineContent":[{"code":"UIPercentDrivenInteractiveTransition","type":"codeVoice"}],"title":"UIPercentDrivenInteractiveTransition","type":"link","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uipercentdriveninteractivetransition","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uipercentdriveninteractivetransition"},"zntfdr.jpeg":{"variants":[{"url":"\/images\/zntfdr.jpeg","traits":["1x","light"]}],"alt":null,"type":"image","identifier":"zntfdr.jpeg"},"https://github.com/zntfdr":{"titleInlineContent":[{"type":"text","text":"GitHub"}],"title":"GitHub","type":"link","url":"https:\/\/github.com\/zntfdr","identifier":"https:\/\/github.com\/zntfdr"},"WWDC13-218-interactiveTransitioningStates":{"variants":[{"url":"\/images\/WWDC13-218-interactiveTransitioningStates.png","traits":["1x","light"]}],"alt":null,"type":"image","identifier":"WWDC13-218-interactiveTransitioningStates"},"http://developer.apple.com/wwdc13/218":{"checksum":null,"type":"download","url":"http:\/\/developer.apple.com\/wwdc13\/218","identifier":"http:\/\/developer.apple.com\/wwdc13\/218"},"WWDC13-Icon.png":{"variants":[{"url":"\/images\/WWDC13-Icon.png","traits":["1x","light"]}],"alt":null,"type":"image","identifier":"WWDC13-Icon.png"},"doc://WWDCNotes/documentation/WWDCNotes":{"title":"WWDC Notes","kind":"symbol","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"type":"topic","role":"collection","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","url":"\/documentation\/wwdcnotes"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC13":{"images":[{"identifier":"WWDC13-Icon.png","type":"icon"},{"identifier":"WWDC13.jpeg","type":"card"}],"abstract":[{"type":"text","text":"Xcode 5, iOS 7, macOS 10.9 (Mavericks)."}],"title":"WWDC13","type":"topic","url":"\/documentation\/wwdcnotes\/wwdc13","kind":"article","role":"collectionGroup","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC13"},"https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioncoordinatorcontext":{"titleInlineContent":[{"code":"UIViewControllerTransitionCoordinatorContext","type":"codeVoice"}],"title":"UIViewControllerTransitionCoordinatorContext","type":"link","url":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollertransitioncoordinatorcontext","identifier":"https:\/\/developer.apple.com\/documentation\/uikit\/uiviewcontrollertransitioncoordinatorcontext"}}}