{"schemaVersion":{"major":0,"minor":3,"patch":0},"metadata":{"modules":[{"name":"WWDC Notes"}],"roleHeading":"WWDC22","title":"Whatâ€™s new in Safari Web Extensions","role":"sampleCode"},"kind":"article","primaryContentSections":[{"kind":"content","content":[{"type":"heading","anchor":"overview","text":"Overview","level":2},{"style":"note","content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/safariservices\/safari_web_extensions\/modernizing_safari_web_extensions"}],"type":"paragraph"}],"name":"Note","type":"aside"},{"type":"heading","anchor":"Manifest-version-3","text":"Manifest version 3","level":2},{"items":[{"content":[{"inlineContent":[{"text":"next iteration of the web extension platform","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"introduces performance and security improvements and consolidates popular extension APIs","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"supported from Safari 15.4 (you can keep using version 2 if your platform target is lower)","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"heading","anchor":"Whats-new","text":"Whatâ€™s new","level":3},{"type":"heading","anchor":"Use-of-service-workers-instead-of-background-pages","text":"Use of service workers instead of background pages","level":4},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"service workers are event driven pages where you can register listeners using the "},{"code":"addEventListener","type":"codeVoice"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"compatible with other browsers"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"substitute with non-persistent background pages"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"heading","anchor":"APIs-for-executing-JavaScript-and-styling-on-a-web-page-have-moved-from-the-tabs-API-to-the-new-scripting-API","text":"APIs for executing JavaScript and styling on a web page have moved from the tabs API to the new scripting API","level":4},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"most functionality stays the same"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"new ways to inject code on a webpage"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"more options for which frames on the page the code should be executed in","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"ability to decide which execution environment the code should run in"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"heading","anchor":"Execute-scripts-on-webpages","text":"Execute scripts on webpages","level":4},{"type":"paragraph","inlineContent":[{"text":"Version 2:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["browser.tabs.executeScript(1, {","  frameId: 1,                                      \/\/ ðŸ‘ˆðŸ» supports only one id","  code: \"document.body.style.background = 'blue';\" \/\/ ðŸ‘ˆðŸ» can only inject code that's contained in a string","});"]},{"type":"paragraph","inlineContent":[{"text":"Version 3:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["function changeBackgroundColor(color) {","  document.body.style.background = color;","};","","browser.scripting.executeScript({","  target: { tabId: 1, frameIds: [ 1 ] }, \/\/ ðŸ‘ˆðŸ» supports multiple ids","  func: changeBackgroundColor,           \/\/ ðŸ‘ˆðŸ» we can pass along a function object containing this code, instead of just a string","  args: [ \"blue\" ]                       \/\/ ðŸ‘ˆðŸ» we can pass arguments to the function","});"]},{"type":"heading","anchor":"Load-scripts-on-webpages","text":"Load scripts on webpages","level":4},{"type":"paragraph","inlineContent":[{"text":"Version 2:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["browser.tabs.executeScript({ 1,","  file: \"file.js\" \/\/ ðŸ‘ˆðŸ» can specify only one file","});"]},{"type":"paragraph","inlineContent":[{"text":"Version 3:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["browser.scripting.executeScript({","  target: { tabId: 1 },","  files: [ \"file.js\", \"file2.js\" ] \/\/ ðŸ‘ˆðŸ» can specify multiple file","});"]},{"type":"heading","anchor":"Changing-styling","text":"Changing styling","level":4},{"type":"paragraph","inlineContent":[{"text":"Like above, we can now add\/remove multiple files:","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Add styling:"}]},{"syntax":"js","type":"codeListing","code":["browser.scripting.insertCSS({","  target: { tabId: 1, frameIds: [ 1, 2, 3 ] },","  files: [ \"file.css\", \"file2.css\" ]","});"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Remove styling:"}]},{"syntax":"js","type":"codeListing","code":["\/\/ Remove styling","browser.scripting.removeCSS({","  target: { tabId: 1, frameIds: [ 1, 2, 3 ] },","  files: [ \"file.css\", \"file2.css\" ]","});"]},{"type":"heading","anchor":"Adding-web-accessible-resources","text":"Adding web accessible resources","level":4},{"type":"paragraph","inlineContent":[{"type":"text","text":"In version 2, every resource you include can be accessed by any website you specify in the Manifest."},{"type":"text","text":" "},{"type":"text","text":"In version 3, you can specify which resource is available in which website:"}]},{"syntax":"json","type":"codeListing","code":["\"web_accessible_resources\": [","  {","    \"resources\": [ \"pie.png\" ],","    \"matches\": [ \"*:\/\/*.apple.com\/*\" ] \/\/ ðŸ‘ˆðŸ»","  },","  {","    \"resources\": [ \"cookie.png\" ],","    \"matches\": [ \"*:\/\/*.webkit.org\/*\" ] \/\/ ðŸ‘ˆðŸ»","  }","]"]},{"type":"heading","anchor":"How-to-migration-to-version-3","text":"How to migration to version 3","level":3},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"set version 3 in "},{"type":"codeVoice","code":"manifest_version"},{"type":"text","text":" in your "},{"type":"text","text":"manifest.json"},{"type":"text","text":" file"}]}]},{"content":[{"inlineContent":[{"text":"manually migrate any of the APIs seen above","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"run your extension and inspect it to get access to the console and see if there are any error messages"}]}]}],"type":"orderedList"},{"type":"heading","anchor":"Updated-APIs","text":"Updated APIs","level":2},{"type":"heading","anchor":"Declarative-Net-Request","text":"Declarative Net Request","level":3},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Declarative net request is a content blocking API that provides web extensions with a fast and privacy preserving way to block or modify network requests using rulesets"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"these rules are defined in the manifest file"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"V2: up to 10 rulesets, V3: up to 50 rulesets"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"only 10 rulesets can be enabled at any given time (you can set "},{"code":"enabled: true","type":"codeVoice"},{"type":"text","text":" in the rules declaration in the manifest)"}]}]}],"type":"unorderedList"},{"type":"heading","anchor":"Dynamically-addremove-rules-Safari-154+","text":"Dynamically add\/remove rules (Safari 15.4+)","level":4},{"syntax":"js","type":"codeListing","code":["\/\/ Rules that won't persist across browser sessions or extension updates","browser.declarativeNetRequest.updateSessionRules({ addRules: [ rule ] });","","\/\/ Rules that will persist across browser sessions or extension updates","browser.declarativeNetRequest.updateDynamicRules({ addRules: [ rule ] });"]},{"type":"heading","anchor":"Message-from-webpage-to-extension-externallyconnectable-Safari-154+","text":"Message from webpage to extension - `externally_connectable` (Safari 15.4+)","level":3},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"allows websites to create custom behavior if the user has your extension enabled"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"you declare match patterns in the Manifest:","type":"text"}]}]}],"type":"unorderedList"},{"syntax":"json","type":"codeListing","code":["{","  ...,","  \"externally_connectable\": {","    \"matches\": [\"*:\/\/*.apple.com\/*\"] \/\/ ðŸ‘ˆðŸ» determines which pages can communicate with your extension","  }","}"]},{"items":[{"content":[{"inlineContent":[{"text":"must use the browser namespace","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"user must grant permission"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"In the website:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["\/\/ ðŸ‘‡ðŸ» you must use this id format \"app.extension.id (appstore.team.id)\"","let extensionID = \"com.apple.Sea-Creator.Extension (GJT7Q2TVD9)\";","\/\/ ðŸ‘†ðŸ» you will have different IDs for other browsers","","browser.runtime.sendMessage(","  extensionID, ","  { greeting: \"Hello!\" }, \/\/ ðŸ‘ˆðŸ» sent message ","  function(response) {    \/\/ ðŸ‘ˆðŸ» callback to handle response","    console.log(\"Received response from the background page:\");","    console.log(response.farewell);","  }",");"]},{"type":"paragraph","inlineContent":[{"text":"In the extension (background page\/session):","type":"text"}]},{"syntax":"js","type":"codeListing","code":["\/\/                  ðŸ‘‡ðŸ» listen for messages","browser.runtime.onMessageExternal.addListener(function(message, sender, sendResponse) {","  console.log(\"Received message from the sender:\");","  console.log(message.greeting);","  sendResponse({ farewell: \"Goodbye!\" }); \/\/ ðŸ‘ˆðŸ» send a message back","});"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Because your extension will have a different id in different browsers, in the browser your website can use an helper function to determine which id to use:"}]},{"syntax":"js","type":"codeListing","code":["\/\/ Determining the correct identifier","","function determineExtensionID(extensionID) {","  return new Promise((resolve) => {","  try {","    browser.runtime.sendMessage(extensionID, { action: 'determineID' }, function(response) {","    if (response)","      resolve({ extensionID: extensionID, isInstalled: true, response: response });","    else ","      resolve({ extensionID: extensionID, isInstalled: false });","    });","  }","  });","};"]},{"type":"paragraph","inlineContent":[{"text":"In the extension:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["browser.runtime.onMessageExternal.addListener(function(message, sender, sendResponse) {","  if (message.action == \"determineID\") {","  sendResponse({ \"Installed\" });","  }","});"]},{"type":"heading","anchor":"Unlimited-storage-154+","text":"Unlimited storage (15.4+)","level":2},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"no longer 10 MB quota per extension"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"you can use as much data as you see fit"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"users can clear extension data at any given time"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"add the following permission in your manifest:"}]}]}],"type":"unorderedList"},{"syntax":"js","type":"codeListing","code":["\"permissions\": [ \"storage\", \"unlimitedStorage\" ]"]},{"type":"heading","anchor":"Syncing-extensions","text":"Syncing extensions","level":2},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"if a user turns on your extension on one of their devices, itâ€™ll be turned on on all of their devices"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"easier extension download (in the settings.app, you can enable to automatically download\/enable extensions)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"automatic if your extension is an universal purchase (available on all platforms)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"if you donâ€™t use universal purchase, you can manually link your apps:","type":"text"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"Associate iOS extension to mac app:","type":"text"}]},{"syntax":"js","type":"codeListing","code":["\/\/ Info.plist for macOS App","SFSafariCorrespondingIOSAppBundleIdentifier","","\/\/ Info.plist for macOS Extension","SFSafariCorrespondingIOSExtensionBundleIdentifier"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Associate mac extension to iOS app:"}]},{"syntax":"js","type":"codeListing","code":["\/\/ Info.plist for i0S App","SFSafariCorrespondingMacOSAppBundleIdentifier","","\/\/ Info.plist for iOS Extension","SFSafariCorrespondingMacOSExtensionBundleIdentifier"]},{"type":"heading","anchor":"Written-By","text":"Written By","level":2},{"numberOfColumns":5,"type":"row","columns":[{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4"}]}],"size":1},{"content":[{"level":3,"anchor":"Federico-Zanetello","type":"heading","text":"Federico Zanetello"},{"inlineContent":[{"overridingTitleInlineContent":[{"text":"Contributed Notes","type":"text"}],"isActive":true,"overridingTitle":"Contributed Notes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/github.com\/zntfdr","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"https:\/\/zntfdr.dev","type":"reference"}],"type":"paragraph"}],"size":4}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Missing anything? Corrections? "},{"type":"reference","identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","isActive":true}]},{"type":"heading","anchor":"Related-Sessions","text":"Related Sessions","level":2},{"style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10119-Whats-new-in-Safari-extensions","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10048-Whats-new-in-Safari-and-WebKit","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10100-Create-Safari-Web-Inspector-Extensions","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements"],"type":"links"},{"type":"small","inlineContent":[{"type":"strong","inlineContent":[{"text":"Legal Notice","type":"text"}]}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright Â© 2012 â€“ 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}]}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22"]]},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10099-Whats-new-in-Safari-Web-Extensions"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/wwdcnotes\/wwdc22-10099-whats-new-in-safari-web-extensions"]}],"abstract":[{"text":"Learn how you can use the latest improvements to Safari Web Extensions to create even better experiences for people browsing the web. Weâ€™ll show you how to upgrade to manifest version 3, adopt the latest APIs for Web Extensions, and sync extensions across devices.","type":"text"}],"sections":[],"sampleCodeDownload":{"action":{"type":"reference","overridingTitle":"Watch Video (23 min)","identifier":"https:\/\/developer.apple.com\/wwdc22\/10099","isActive":true},"kind":"sampleDownload"},"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10048-Whats-new-in-Safari-and-WebKit":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10048-Whats-new-in-Safari-and-WebKit","title":"Whatâ€™s new in Safari and WebKit","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc22-10048-whats-new-in-safari-and-webkit","abstract":[{"type":"text","text":"Explore the latest features in Safari and WebKit and learn how you can make better and more powerful websites. Weâ€™ll take you on a tour through the latest updates to HTML, CSS enhancements, Web Inspector tooling, Web APIs, and more."}],"type":"topic","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC23-10119-Whats-new-in-Safari-extensions":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC23-10119-Whats-new-in-Safari-extensions","title":"Whatâ€™s new in Safari extensions","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc23-10119-whats-new-in-safari-extensions","abstract":[{"type":"text","text":"Learn about the latest improvements to Safari extensions. Weâ€™ll take you through new APIs, explore per-site permissions for Safari app extensions, and share how you can make sure your extensions work great in both Private Browsing and Profiles."}],"type":"topic","kind":"article"},"https://github.com/zntfdr":{"identifier":"https:\/\/github.com\/zntfdr","title":"GitHub","url":"https:\/\/github.com\/zntfdr","titleInlineContent":[{"type":"text","text":"GitHub"}],"type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22-10100-Create-Safari-Web-Inspector-Extensions":{"role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22-10100-Create-Safari-Web-Inspector-Extensions","title":"Create Safari Web Inspector Extensions","abstract":[{"type":"text","text":"Learn how to add your own tools directly into Web Inspector using the latest Web Extensions APIs. Weâ€™ll show you how to create your own tab in Web Inspector, evaluate JavaScript in the inspected page, and use the result to help you troubleshoot and identify potential problems."}],"type":"topic","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc22-10100-create-safari-web-inspector-extensions"},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"kind":"article","title":"Federico Zanetello (330 notes)","url":"\/documentation\/wwdcnotes\/zntfdr","type":"topic","abstract":[{"text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","role":"sampleCode"},"doc://WWDCNotes/documentation/WWDCNotes":{"kind":"symbol","title":"WWDC Notes","url":"\/documentation\/wwdcnotes","type":"topic","abstract":[{"text":"Session notes shared by the community for the community.","type":"text"}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","role":"collection"},"https://developer.apple.com/documentation/safariservices/safari_web_extensions/modernizing_safari_web_extensions":{"identifier":"https:\/\/developer.apple.com\/documentation\/safariservices\/safari_web_extensions\/modernizing_safari_web_extensions","title":"Sample app","url":"https:\/\/developer.apple.com\/documentation\/safariservices\/safari_web_extensions\/modernizing_safari_web_extensions","titleInlineContent":[{"type":"text","text":"Sample app"}],"type":"link"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10027-Explore-Safari-Web-Extension-improvements":{"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements","title":"Explore Safari Web Extension improvements","role":"sampleCode","url":"\/documentation\/wwdcnotes\/wwdc21-10027-explore-safari-web-extension-improvements","abstract":[{"type":"text","text":"Learn how you can extend Safariâ€™s functionality with Safari Web Extensions. Weâ€™ll introduce you to the latest WebExtension APIs, explore non-persistent background page support â€” a particularly relevant topic if youâ€™re developing for iOS â€” and discover how you can use the Declarative Net Request WebExtensions API to block content on the web. Finally, weâ€™ll show you how to customize tabs in Safari 15."}],"type":"topic","kind":"article"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC22":{"kind":"article","type":"topic","role":"collectionGroup","images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes\/wwdc22","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC22","title":"WWDC22","abstract":[{"type":"text","text":"Xcode 14, Swift 5.7, iOS 16, macOS 13 (Ventura), tvOS 16, watchOS 9."},{"type":"text","text":" "},{"text":"New APIs: ","type":"text"},{"code":"WeatherKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"ScreenCaptureKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"Swift Regex","type":"codeVoice"},{"text":", and more.","type":"text"}]},"https://wwdcnotes.github.io/WWDCNotes/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","url":"https:\/\/wwdcnotes.github.io\/WWDCNotes\/documentation\/wwdcnotes\/contributing","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"type":"link"},"https://avatars.githubusercontent.com/u/5277837?v=4":{"identifier":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4","alt":"Profile image of Federico Zanetello","variants":[{"traits":["1x","light"],"url":"https:\/\/avatars.githubusercontent.com\/u\/5277837?v=4"}],"type":"image"},"https://zntfdr.dev":{"identifier":"https:\/\/zntfdr.dev","title":"Blog","url":"https:\/\/zntfdr.dev","titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link"},"https://developer.apple.com/wwdc22/10099":{"identifier":"https:\/\/developer.apple.com\/wwdc22\/10099","url":"https:\/\/developer.apple.com\/wwdc22\/10099","type":"download","checksum":null},"WWDCNotes.png":{"identifier":"WWDCNotes.png","alt":null,"variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes.png"}],"type":"image"}}}