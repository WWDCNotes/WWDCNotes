{"metadata":{"title":"Explore WKWebView additions","modules":[{"name":"WWDC Notes"}],"role":"sampleCode","roleHeading":"WWDC21"},"kind":"article","sections":[],"abstract":[{"text":"Explore the latest updates to WKWebView. We’ll show you how to use APIs to manipulate web content without JavaScript, explore delegates that can help with WebRTC and Downloads, and share how you can easily create a richer web experience within your app.","type":"text"}],"hierarchy":{"paths":[["doc:\/\/WWDCNotes\/documentation\/WWDCNotes","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21"]]},"schemaVersion":{"major":0,"minor":3,"patch":0},"identifier":{"url":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10032-Explore-WKWebView-additions","interfaceLanguage":"swift"},"variants":[{"paths":["\/documentation\/wwdcnotes\/wwdc21-10032-explore-wkwebview-additions"],"traits":[{"interfaceLanguage":"swift"}]}],"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":2,"anchor":"Whats-new-in-SFSafariViewController","text":"What’s new in `SFSafariViewController`"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"New API to bring one of your app extensions to a customized button on ","type":"text"},{"type":"codeVoice","code":"SFSafariViewController"},{"text":".","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Tapping that button will run your app extensions directly from "},{"type":"codeVoice","code":"SFSafariViewController"},{"type":"text","text":"’s toolbar, including running JavaScript on the page"}],"type":"paragraph"}]}]},{"type":"codeListing","syntax":"swift","code":["import UIKit","import SafariServices","","class ViewController: UIViewController {","  func showSafariViewController (pageURL: URL) {","    let configuration = SFSafariViewController.Configuration()","    configuration.activityButton = SFSafariViewController.ActivityButton(","      templateImage: UlImage(named: \"example_image\")!,","      extensionIdentifier: \"com.example.extension\"","    )","    ","    let safariViewController = SFSafariViewController(url: pageURL, configuration: configuration)","    present(safariViewController, animated: true)","  }","}"]},{"type":"aside","style":"note","name":"Note","content":[{"type":"paragraph","inlineContent":[{"text":"For anything more than this, you will need to use ","type":"text"},{"code":"WKWebView","type":"codeVoice"},{"text":".","type":"text"}]}]},{"type":"heading","level":2,"anchor":"Whats-new-in-WKWebView","text":"What’s new in `WKWebView`"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"new APIs to allow you to easily interact with the content in your web view without having to deal with injecting JavaScript:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"access theme and related colors for a website","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"manage text interaction","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"control media playback"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"new browser-level APIs, previously only available to Safari.app:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"disable HTTPS upgrade","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"control media capture (getUserMedia)","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"manage downloads","type":"text"}]}]}]}]}]},{"type":"heading","level":3,"anchor":"Access-colors","text":"Access colors"},{"type":"paragraph","inlineContent":[{"text":"Get ","type":"text"},{"code":"themeColor","type":"codeVoice"},{"text":":","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["class ViewController : UIViewController {","  var headerView: UIView","  var webView: WKWebView","  var observations: [NSKevValueObservation] = []","","  override func viewDidLoad() {","    let observation = webView.observe(\\.themeColor) { \/\/ 👈🏻","      [unowned self] webView, _ in","      self.headerView.backgroundColor=webView.themeColor","    }","    observations.append (observation)","  }","}"]},{"type":"paragraph","inlineContent":[{"text":"If ","type":"text"},{"code":"themeColor","type":"codeVoice"},{"text":" isn’t set, there’s an alternate calculated background color exposed as ","type":"text"},{"code":"underPageBackgroundColor","type":"codeVoice"},{"text":":","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["class ViewController : UIViewController {","  var headerView: UIView","  var webView: WKWebView","  var observations: [NSKeyValueObservation] = []","  ","  override func viewDidLoad() {","    let observation = webView.observe(\\.underPageBackgroundColor) { \/\/ 👈🏻","      [unowned self] webView,_ in","      self.headerView.backgroundColor = webView.underPageBackgroundColor","    }","    observations.append (observation)","  }","}"]},{"type":"heading","level":3,"anchor":"Text-interaction","text":"Text interaction"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Disable\/enable text interaction:"}]},{"type":"codeListing","syntax":"swift","code":["override func loadView(){","  let preferences = WKPreferences()","  preferences.textInteractionEnabled = false","  ","  let webConfiguration = WKWebViewConfiguration()","  configuration.preferences = preferences","","  webView = WKWebView(frame: .zero, configuration: preferences)","","  ...","}"]},{"type":"heading","level":3,"anchor":"Media-playback","text":"Media playback"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Pause all media:"}]},{"type":"codeListing","syntax":"swift","code":["await webView.pauseAllMediaPlayback()"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Close all media windows:"}]},{"type":"codeListing","syntax":"swift","code":["await webView.closeAllMediaPresentations()"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Request media state:"}]},{"type":"codeListing","syntax":"swift","code":["let playbackState = await webView.requestMediaPlaybackState()"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Set Media Playback Suspended State"}]},{"type":"codeListing","syntax":"swift","code":["await webView.setAllMediaPlaybackSuspended(true)"]},{"type":"heading","level":3,"anchor":"Disable-HTTPS-upgrade","text":"Disable HTTPS upgrade"},{"type":"codeListing","syntax":"swift","code":["override func loadView(){","  let webConfiguration = WKWebViewConfiguration()","  webConfiguration.upgradeknownHostsToHTTPS = false","  webView = WKWebView(frame: .zero, configuration: webConfiguration)","  ...","}"]},{"type":"heading","level":3,"anchor":"Control-media-capture-getUserMedia","text":"Control media capture (getUserMedia)"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"WKWebView","type":"codeVoice"},{"text":" supports ","type":"text"},{"code":"getUserMedia","type":"codeVoice"},{"text":" from iOS 14.3; which allows WebRTC functions to work inside your app","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"From iOS 15, you can load your web content from a custom scheme handler; the user request prompt will show your app as the origin of the request, rather than show a request from the website URL"}]}]},{"content":[{"inlineContent":[{"text":"New api to prompt user for camera and microphone permissions when working with web content","type":"text"}],"type":"paragraph"}]}]},{"type":"codeListing","syntax":"swift","code":["\/\/ Prompt for microphone access only","class ViewController: UIViewController, WKUIDelegate{","  var webView: WKWebView","  ","  override func viewDidLoad() { ","    webView.uiDelegate = self","    webView.load(URLRequest (url: URL(string: \"https:\/\/recordMyMic.example.org\")!))","  }","","  func webView(","    _ webView: WKWebView,","    decideMediaCapturePermissionFor origin: WKSecurityOrigin,","    initiatedByFrame frame: WKFrameInfo,","    type: WKMediaCaptureType","  ) async -> WKPermissionDecision {","    return type == .microphone? .prompt: .deny","  }","}"]},{"type":"heading","level":3,"anchor":"Manage-downloads","text":"Manage downloads"},{"type":"paragraph","inlineContent":[{"text":"Three ways to initiate a download from the web:","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The Web Content can initiate a download via Javascript:"}]}]}]},{"type":"codeListing","syntax":"js","code":["let a = document.createElement('a'):","let b = new Blob([1,2,3]);","a.href = URL.createObjectURL (b);","a.download = \"filename.dat\":","a.click();"]},{"type":"orderedList","start":2,"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The server can initiate a download by responding like this, after calling a "},{"type":"codeVoice","code":"loadRequest"},{"type":"text","text":" on your web view"}]}]}]},{"type":"codeListing","syntax":"js","code":["HTTP\/1.1 200 OK","Content-Disposition: attachment; filename=\"filename.dat\"","Content-Length: 100"]},{"type":"orderedList","start":3,"items":[{"content":[{"inlineContent":[{"type":"text","text":"App via new API"}],"type":"paragraph"}]}]},{"type":"codeListing","syntax":"swift","code":["class ViewController : UIViewController, WKDownloadDelegate {","  @IBOutlet var textField: UITextField!","  @IBOutlet var webView: WKWebView!","  ","  @IBAction func downloadFile() {","    guard let url = URL(string: textField.text ??\"') else { return }","    async {","      let download = await webView.startDownload(using: URLRequest (url: url))","      download.delegate = self","    }","  }"]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Whatever method you use, when you get the ","type":"text"},{"type":"codeVoice","code":"WKDownload"},{"text":" object, you need to set the ","type":"text"},{"type":"codeVoice","code":"delegate"},{"text":" property on that object to be able to tell it where to write the bytes to disk. If you do not, the download will automatically be cancelled","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"If a download fails, the data to resume the download will be handed to you if you implement the ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/documentation\/webkit\/wkdownloaddelegate\/3727345-download","isActive":true,"type":"reference"},{"text":" method on the delegate","type":"text"}]}]}]},{"type":"heading","level":2,"anchor":"Written-By","text":"Written By"},{"type":"row","columns":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"zntfdr","type":"image"}]}],"size":1},{"content":[{"level":3,"type":"heading","text":"Federico Zanetello","anchor":"Federico-Zanetello"},{"type":"paragraph","inlineContent":[{"overridingTitleInlineContent":[{"type":"text","text":"Contributed Notes"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","isActive":true,"overridingTitle":"Contributed Notes","type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/github.com\/zntfdr","isActive":true,"type":"reference"},{"text":" ","type":"text"},{"text":"|","type":"text"},{"text":" ","type":"text"},{"identifier":"https:\/\/zntfdr.dev","isActive":true,"type":"reference"}]}],"size":4}],"numberOfColumns":5},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"text":"Missing anything? Corrections? ","type":"text"},{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"reference","isActive":true}]},{"type":"heading","level":2,"anchor":"Related-Sessions","text":"Related Sessions"},{"type":"links","style":"list","items":["doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10029-Design-for-Safari-15","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10030-Develop-advanced-web-content","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10031-Discover-Web-Inspector-improvements","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10033-Meet-privacypreserving-ad-attribution","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS","doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10188-Discover-WKWebView-enhancements"]},{"type":"small","inlineContent":[{"inlineContent":[{"type":"text","text":"Legal Notice"}],"type":"strong"}]},{"type":"small","inlineContent":[{"type":"text","text":"All content copyright © 2012 – 2024 Apple Inc. All rights reserved."},{"type":"text","text":" "},{"type":"text","text":"Swift, the Swift logo, Swift Playgrounds, Xcode, Instruments, Cocoa Touch, Touch ID, FaceID, iPhone, iPad, Safari, Apple Vision, Apple Watch, App Store, iPadOS, watchOS, visionOS, tvOS, Mac, and macOS are trademarks of Apple Inc., registered in the U.S. and other countries."},{"type":"text","text":" "},{"type":"text","text":"This website is not made by, affiliated with, nor endorsed by Apple."}]}]}],"sampleCodeDownload":{"kind":"sampleDownload","action":{"overridingTitle":"Watch Video (21 min)","type":"reference","identifier":"https:\/\/developer.apple.com\/wwdc21\/10032","isActive":true}},"references":{"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10031-Discover-Web-Inspector-improvements":{"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21-10031-discover-web-inspector-improvements","abstract":[{"text":"Web Inspector provides the tools for you to understand and debug your web pages on macOS, iOS, and iPadOS. We’ll take you through the latest features and improvements to Web Inspector, including a new overlay for inspecting CSS Grid containers on your pages, even more configurable breakpoints to make debugging simpler, and the ability to create and edit Audits.","type":"text"}],"identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10031-Discover-Web-Inspector-improvements","role":"sampleCode","type":"topic","title":"Discover Web Inspector improvements"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10029-Design-for-Safari-15":{"role":"sampleCode","title":"Design for Safari 15","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10029-Design-for-Safari-15","abstract":[{"text":"Meet Safari 15: redesigned and ready to help people explore the web. Discover how you can approach designing websites and apps for Safari, and learn how to incorporate the tab bar in your designs. We’ll also take you through features like Live Text and accessibility best practices, explore the latest updates to CSS and Form Controls, and learn how to use the aspect-ratio property in CSS to create incredible websites.","type":"text"}],"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21-10029-design-for-safari-15"},"https://developer.apple.com/wwdc21/10032":{"checksum":null,"identifier":"https:\/\/developer.apple.com\/wwdc21\/10032","url":"https:\/\/developer.apple.com\/wwdc21\/10032","type":"download"},"WWDC21-Icon.png":{"type":"image","alt":null,"identifier":"WWDC21-Icon.png","variants":[{"url":"\/images\/WWDCNotes\/WWDC21-Icon.png","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21":{"title":"WWDC21","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21","kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21","role":"collectionGroup","type":"topic","abstract":[{"text":"Xcode 13, Swift 5.5, iOS 15, macOS 12 (Monterey), tvOS 15, watchOS 8.","type":"text"},{"text":" ","type":"text"},{"text":"New APIs: ","type":"text"},{"code":"MusicKit","type":"codeVoice"},{"text":", ","type":"text"},{"code":"DocC","type":"codeVoice"},{"text":", ","type":"text"},{"code":"StoreKit 2","type":"codeVoice"},{"text":", and more.","type":"text"}],"images":[{"type":"icon","identifier":"WWDC21-Icon.png"},{"type":"card","identifier":"WWDC21.jpeg"}]},"https://wwdcnotes.com/documentation/wwdcnotes/contributing":{"identifier":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","title":"Contributions are welcome!","titleInlineContent":[{"type":"text","text":"Contributions are welcome!"}],"url":"https:\/\/wwdcnotes.com\/documentation\/wwdcnotes\/contributing","type":"link"},"zntfdr.jpeg":{"type":"image","alt":null,"identifier":"zntfdr.jpeg","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/zntfdr.jpeg"}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC20-10188-Discover-WKWebView-enhancements":{"role":"sampleCode","title":"Discover WKWebView enhancements","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC20-10188-Discover-WKWebView-enhancements","abstract":[{"text":"WKWebView is the best way to present rich, interactive web content right within your app. Explore new APIs that help you convert apps using WebViews or UIWebViews while adding entirely new capabilities. Learn about better ways to handle JavaScript, fine tune the rendering process, export web content, and more.","type":"text"}],"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc20-10188-discover-wkwebview-enhancements"},"doc://WWDCNotes/documentation/WWDCNotes":{"type":"topic","role":"collection","abstract":[{"type":"text","text":"Session notes shared by the community for the community."}],"images":[{"identifier":"WWDCNotes.png","type":"icon"}],"url":"\/documentation\/wwdcnotes","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes","title":"WWDC Notes","kind":"symbol"},"https://developer.apple.com/documentation/webkit/wkdownloaddelegate/3727345-download":{"type":"link","title":"download(_:didFailWithError:resumeData:)","identifier":"https:\/\/developer.apple.com\/documentation\/webkit\/wkdownloaddelegate\/3727345-download","titleInlineContent":[{"code":"download(_:didFailWithError:resumeData:)","type":"codeVoice"}],"url":"https:\/\/developer.apple.com\/documentation\/webkit\/wkdownloaddelegate\/3727345-download"},"WWDCNotes.png":{"identifier":"WWDCNotes.png","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/WWDCNotes.png"}],"type":"image","alt":null},"doc://WWDCNotes/documentation/WWDCNotes/zntfdr":{"title":"Federico Zanetello (332 notes)","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/zntfdr","url":"\/documentation\/wwdcnotes\/zntfdr","role":"sampleCode","type":"topic","abstract":[{"type":"text","text":"Software engineer with a strong passion for well-written code, thought-out composable architectures, automation, tests, and more."}],"images":[{"type":"card","identifier":"zntfdr.jpeg"},{"type":"icon","identifier":"zntfdr.jpeg"}]},"https://zntfdr.dev":{"titleInlineContent":[{"type":"text","text":"Blog"}],"type":"link","identifier":"https:\/\/zntfdr.dev","title":"Blog","url":"https:\/\/zntfdr.dev"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS":{"abstract":[{"type":"text","text":"Safari Web Extensions use HTML, CSS, and JavaScript to offer people powerful browser customizations — and you can now create them for every device that supports Safari. Learn how to build a Safari Web Extension that works for all devices, and discover how you can convert an existing extension to Safari through Xcode and the Safari Web Extension Converter."}],"kind":"article","type":"topic","role":"sampleCode","title":"Meet Safari Web Extensions on iOS","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10104-Meet-Safari-Web-Extensions-on-iOS","url":"\/documentation\/wwdcnotes\/wwdc21-10104-meet-safari-web-extensions-on-ios"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10033-Meet-privacypreserving-ad-attribution":{"title":"Meet privacy-preserving ad attribution","type":"topic","role":"sampleCode","abstract":[{"type":"text","text":"Discover how you can measure your ad campaigns in apps and on the web without compromising privacy. We’ll introduce you to Private Click Measurement and explore SKAdNetwork, which provides you with a more secure, private, and useful way to measure your app installs."}],"url":"\/documentation\/wwdcnotes\/wwdc21-10033-meet-privacypreserving-ad-attribution","kind":"article","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10033-Meet-privacypreserving-ad-attribution"},"WWDC21.jpeg":{"type":"image","alt":null,"identifier":"WWDC21.jpeg","variants":[{"url":"\/images\/WWDCNotes\/WWDC21.jpeg","traits":["1x","light"]}]},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10027-Explore-Safari-Web-Extension-improvements":{"type":"topic","kind":"article","role":"sampleCode","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10027-Explore-Safari-Web-Extension-improvements","abstract":[{"text":"Learn how you can extend Safari’s functionality with Safari Web Extensions. We’ll introduce you to the latest WebExtension APIs, explore non-persistent background page support — a particularly relevant topic if you’re developing for iOS — and discover how you can use the Declarative Net Request WebExtensions API to block content on the web. Finally, we’ll show you how to customize tabs in Safari 15.","type":"text"}],"url":"\/documentation\/wwdcnotes\/wwdc21-10027-explore-safari-web-extension-improvements","title":"Explore Safari Web Extension improvements"},"zntfdr":{"identifier":"zntfdr","variants":[{"traits":["1x","light"],"url":"\/images\/WWDCNotes\/zntfdr.jpeg"}],"type":"image","alt":"Profile image of Federico Zanetello"},"https://github.com/zntfdr":{"titleInlineContent":[{"type":"text","text":"GitHub"}],"type":"link","identifier":"https:\/\/github.com\/zntfdr","title":"GitHub","url":"https:\/\/github.com\/zntfdr"},"doc://WWDCNotes/documentation/WWDCNotes/WWDC21-10030-Develop-advanced-web-content":{"role":"sampleCode","title":"Develop advanced web content","type":"topic","identifier":"doc:\/\/WWDCNotes\/documentation\/WWDCNotes\/WWDC21-10030-Develop-advanced-web-content","abstract":[{"text":"Develop in JavaScript, WebGL, or WebAssembly? Learn how the latest updates to Safari and WebKit — including language changes to class syntax — can help simplify your development process, enhance performance, and improve security. We’ll explore several web APIs that can help provide better interoperability and bring new capabilities to your web content.","type":"text"}],"kind":"article","url":"\/documentation\/wwdcnotes\/wwdc21-10030-develop-advanced-web-content"}}}